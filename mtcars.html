<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Chapter 7 The mtcars example and drake plan generation | The drake R Package User Manual</title>
  <meta name="description" content="In-depth walkthroughs and examples of drake, an R package for reproducible computation at scale.">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="Chapter 7 The mtcars example and drake plan generation | The drake R Package User Manual" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://ropenscilabs.github.io/drake-manual" />
  <meta property="og:image" content="https://ropenscilabs.github.io/drake-manual/images/logo.png" />
  <meta property="og:description" content="In-depth walkthroughs and examples of drake, an R package for reproducible computation at scale." />
  <meta name="github-repo" content="ropenscilabs/drake-manual" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 The mtcars example and drake plan generation | The drake R Package User Manual" />
  
  <meta name="twitter:description" content="In-depth walkthroughs and examples of drake, an R package for reproducible computation at scale." />
  <meta name="twitter:image" content="https://ropenscilabs.github.io/drake-manual/images/logo.png" />

<meta name="author" content="Will Landau, Kirill Müller, Alex Axthelm, Jasper Clarkberg, Lorenz Walthert">
<meta name="author" content="Copyright Eli Lilly and Company">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="images/apple-touch-icon.png">
  <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon">
<link rel="prev" href="gsp.html">
<link rel="next" href="visuals.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<link href="libs/vis-4.20.1/vis.css" rel="stylesheet" />
<script src="libs/vis-4.20.1/vis.min.js"></script>
<script src="libs/visNetwork-binding-2.0.6/visNetwork.js"></script>
<script src="libs/d3-4.5.0/d3.min.js"></script>
<script src="libs/sankey-1/sankey.js"></script>
<script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="https://ropensci.github.io/dev_guide/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">The drake R Package User Manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#the-drake-r-package"><i class="fa fa-check"></i><b>1.1</b> The drake R package</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#installation"><i class="fa fa-check"></i><b>1.2</b> Installation</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#why-drake"><i class="fa fa-check"></i><b>1.3</b> Why drake?</a><ul>
<li class="chapter" data-level="1.3.1" data-path="index.html"><a href="index.html#what-gets-done-stays-done."><i class="fa fa-check"></i><b>1.3.1</b> What gets done stays done.</a></li>
<li class="chapter" data-level="1.3.2" data-path="index.html"><a href="index.html#reproducibility-with-confidence"><i class="fa fa-check"></i><b>1.3.2</b> Reproducibility with confidence</a></li>
<li class="chapter" data-level="1.3.3" data-path="index.html"><a href="index.html#aggressively-scale-up."><i class="fa fa-check"></i><b>1.3.3</b> Aggressively scale up.</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#documentation"><i class="fa fa-check"></i><b>1.4</b> Documentation</a><ul>
<li class="chapter" data-level="1.4.1" data-path="index.html"><a href="index.html#cheat-sheet"><i class="fa fa-check"></i><b>1.4.1</b> Cheat sheet</a></li>
<li class="chapter" data-level="1.4.2" data-path="index.html"><a href="index.html#frequently-asked-questions"><i class="fa fa-check"></i><b>1.4.2</b> Frequently asked questions</a></li>
<li class="chapter" data-level="1.4.3" data-path="index.html"><a href="index.html#function-reference"><i class="fa fa-check"></i><b>1.4.3</b> Function reference</a></li>
<li class="chapter" data-level="1.4.4" data-path="index.html"><a href="index.html#tutorials"><i class="fa fa-check"></i><b>1.4.4</b> Tutorials</a></li>
<li class="chapter" data-level="1.4.5" data-path="index.html"><a href="index.html#examples"><i class="fa fa-check"></i><b>1.4.5</b> Examples</a></li>
<li class="chapter" data-level="1.4.6" data-path="index.html"><a href="index.html#presentations"><i class="fa fa-check"></i><b>1.4.6</b> Presentations</a></li>
<li class="chapter" data-level="1.4.7" data-path="index.html"><a href="index.html#context-and-history"><i class="fa fa-check"></i><b>1.4.7</b> Context and history</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#help-and-troubleshooting"><i class="fa fa-check"></i><b>1.5</b> Help and troubleshooting</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#similar-work"><i class="fa fa-check"></i><b>1.6</b> Similar work</a><ul>
<li class="chapter" data-level="1.6.1" data-path="index.html"><a href="index.html#gnu-make"><i class="fa fa-check"></i><b>1.6.1</b> GNU Make</a></li>
<li class="chapter" data-level="1.6.2" data-path="index.html"><a href="index.html#remake"><i class="fa fa-check"></i><b>1.6.2</b> Remake</a></li>
<li class="chapter" data-level="1.6.3" data-path="index.html"><a href="index.html#memoise"><i class="fa fa-check"></i><b>1.6.3</b> Memoise</a></li>
<li class="chapter" data-level="1.6.4" data-path="index.html"><a href="index.html#knitr-and-r-markdown"><i class="fa fa-check"></i><b>1.6.4</b> Knitr and R Markdown</a></li>
<li class="chapter" data-level="1.6.5" data-path="index.html"><a href="index.html#factuals-drake"><i class="fa fa-check"></i><b>1.6.5</b> Factual’s Drake</a></li>
<li class="chapter" data-level="1.6.6" data-path="index.html"><a href="index.html#other-pipeline-toolkits"><i class="fa fa-check"></i><b>1.6.6</b> Other pipeline toolkits</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i><b>1.7</b> Acknowledgements</a></li>
</ul></li>
<li class="part"><span><b>I Getting started</b></span></li>
<li class="chapter" data-level="2" data-path="main.html"><a href="main.html"><i class="fa fa-check"></i><b>2</b> The main example</a><ul>
<li class="chapter" data-level="2.1" data-path="main.html"><a href="main.html#set-the-stage."><i class="fa fa-check"></i><b>2.1</b> Set the stage.</a></li>
<li class="chapter" data-level="2.2" data-path="main.html"><a href="main.html#make-your-results."><i class="fa fa-check"></i><b>2.2</b> Make your results.</a></li>
<li class="chapter" data-level="2.3" data-path="main.html"><a href="main.html#go-back-and-fix-things."><i class="fa fa-check"></i><b>2.3</b> Go back and fix things.</a></li>
<li class="chapter" data-level="2.4" data-path="main.html"><a href="main.html#try-it-yourself"><i class="fa fa-check"></i><b>2.4</b> Try it yourself!</a></li>
<li class="chapter" data-level="2.5" data-path="main.html"><a href="main.html#thanks"><i class="fa fa-check"></i><b>2.5</b> Thanks</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="plans.html"><a href="plans.html"><i class="fa fa-check"></i><b>3</b> <code>drake</code> plans</a><ul>
<li class="chapter" data-level="3.1" data-path="plans.html"><a href="plans.html#what-is-a-drake-plan"><i class="fa fa-check"></i><b>3.1</b> What is a <code>drake</code> plan?</a></li>
<li class="chapter" data-level="3.2" data-path="plans.html"><a href="plans.html#plans-are-similar-to-r-scripts."><i class="fa fa-check"></i><b>3.2</b> Plans are similar to R scripts.</a></li>
<li class="chapter" data-level="3.3" data-path="plans.html"><a href="plans.html#so-why-do-we-use-plans"><i class="fa fa-check"></i><b>3.3</b> So why do we use plans?</a><ul>
<li class="chapter" data-level="3.3.1" data-path="plans.html"><a href="plans.html#plans-chop-up-the-work-into-pieces."><i class="fa fa-check"></i><b>3.3.1</b> Plans chop up the work into pieces.</a></li>
<li class="chapter" data-level="3.3.2" data-path="plans.html"><a href="plans.html#drake-uses-plans-to-schedule-you-work."><i class="fa fa-check"></i><b>3.3.2</b> <code>drake</code> uses plans to schedule you work.</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="plans.html"><a href="plans.html#special-custom-columns-in-your-plan"><i class="fa fa-check"></i><b>3.4</b> Special custom columns in your plan</a></li>
<li class="chapter" data-level="3.5" data-path="plans.html"><a href="plans.html#large-plans"><i class="fa fa-check"></i><b>3.5</b> Large plans</a><ul>
<li class="chapter" data-level="3.5.1" data-path="plans.html"><a href="plans.html#how-to-create-large-plans"><i class="fa fa-check"></i><b>3.5.1</b> How to create large plans</a></li>
<li class="chapter" data-level="3.5.2" data-path="plans.html"><a href="plans.html#the-types-of-transformations"><i class="fa fa-check"></i><b>3.5.2</b> The types of transformations</a></li>
<li class="chapter" data-level="3.5.3" data-path="plans.html"><a href="plans.html#grouping-variables"><i class="fa fa-check"></i><b>3.5.3</b> Grouping variables</a></li>
<li class="chapter" data-level="3.5.4" data-path="plans.html"><a href="plans.html#tags"><i class="fa fa-check"></i><b>3.5.4</b> Tags</a></li>
<li class="chapter" data-level="3.5.5" data-path="plans.html"><a href="plans.html#target-names"><i class="fa fa-check"></i><b>3.5.5</b> Target names</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="plans.html"><a href="plans.html#create-large-plans-the-old-way"><i class="fa fa-check"></i><b>3.6</b> Create large plans the <em>old</em> way</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="projects.html"><a href="projects.html"><i class="fa fa-check"></i><b>4</b> <code>drake</code> projects</a><ul>
<li class="chapter" data-level="4.1" data-path="projects.html"><a href="projects.html#code-files"><i class="fa fa-check"></i><b>4.1</b> Code files</a></li>
<li class="chapter" data-level="4.2" data-path="projects.html"><a href="projects.html#safer-interactivity"><i class="fa fa-check"></i><b>4.2</b> Safer interactivity</a><ul>
<li class="chapter" data-level="4.2.1" data-path="projects.html"><a href="projects.html#motivation"><i class="fa fa-check"></i><b>4.2.1</b> Motivation</a></li>
<li class="chapter" data-level="4.2.2" data-path="projects.html"><a href="projects.html#usage"><i class="fa fa-check"></i><b>4.2.2</b> Usage</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="projects.html"><a href="projects.html#script-file-pitfalls"><i class="fa fa-check"></i><b>4.3</b> Script file pitfalls</a></li>
<li class="chapter" data-level="4.4" data-path="projects.html"><a href="projects.html#workflows-as-r-packages"><i class="fa fa-check"></i><b>4.4</b> Workflows as R packages</a></li>
<li class="chapter" data-level="4.5" data-path="projects.html"><a href="projects.html#other-tools"><i class="fa fa-check"></i><b>4.5</b> Other tools</a></li>
</ul></li>
<li class="part"><span><b>II Examples</b></span></li>
<li class="chapter" data-level="5" data-path="packages.html"><a href="packages.html"><i class="fa fa-check"></i><b>5</b> An analysis of R package download trends</a><ul>
<li class="chapter" data-level="5.1" data-path="packages.html"><a href="packages.html#get-the-code."><i class="fa fa-check"></i><b>5.1</b> Get the code.</a></li>
<li class="chapter" data-level="5.2" data-path="packages.html"><a href="packages.html#overview"><i class="fa fa-check"></i><b>5.2</b> Overview</a></li>
<li class="chapter" data-level="5.3" data-path="packages.html"><a href="packages.html#analysis"><i class="fa fa-check"></i><b>5.3</b> Analysis</a></li>
<li class="chapter" data-level="5.4" data-path="packages.html"><a href="packages.html#other-ways-to-trigger-downloads"><i class="fa fa-check"></i><b>5.4</b> Other ways to trigger downloads</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="gsp.html"><a href="gsp.html"><i class="fa fa-check"></i><b>6</b> Finding the best model of gross state product</a><ul>
<li class="chapter" data-level="6.1" data-path="gsp.html"><a href="gsp.html#get-the-code.-1"><i class="fa fa-check"></i><b>6.1</b> Get the code.</a></li>
<li class="chapter" data-level="6.2" data-path="gsp.html"><a href="gsp.html#objective-and-methods"><i class="fa fa-check"></i><b>6.2</b> Objective and methods</a></li>
<li class="chapter" data-level="6.3" data-path="gsp.html"><a href="gsp.html#data"><i class="fa fa-check"></i><b>6.3</b> Data</a></li>
<li class="chapter" data-level="6.4" data-path="gsp.html"><a href="gsp.html#analysis-1"><i class="fa fa-check"></i><b>6.4</b> Analysis</a></li>
<li class="chapter" data-level="6.5" data-path="gsp.html"><a href="gsp.html#results"><i class="fa fa-check"></i><b>6.5</b> Results</a></li>
<li class="chapter" data-level="6.6" data-path="gsp.html"><a href="gsp.html#comparison-with-gnu-make"><i class="fa fa-check"></i><b>6.6</b> Comparison with GNU Make</a></li>
<li class="chapter" data-level="6.7" data-path="gsp.html"><a href="gsp.html#references"><i class="fa fa-check"></i><b>6.7</b> References</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="mtcars.html"><a href="mtcars.html"><i class="fa fa-check"></i><b>7</b> The mtcars example and <code>drake</code> plan generation</a><ul>
<li class="chapter" data-level="7.1" data-path="mtcars.html"><a href="mtcars.html#get-the-code.-2"><i class="fa fa-check"></i><b>7.1</b> Get the code.</a></li>
<li class="chapter" data-level="7.2" data-path="mtcars.html"><a href="mtcars.html#quick-examples"><i class="fa fa-check"></i><b>7.2</b> Quick examples</a></li>
<li class="chapter" data-level="7.3" data-path="mtcars.html"><a href="mtcars.html#the-motivation-of-the-mtcars-example"><i class="fa fa-check"></i><b>7.3</b> The motivation of the mtcars example</a></li>
<li class="chapter" data-level="7.4" data-path="mtcars.html"><a href="mtcars.html#set-up-the-mtcars-example"><i class="fa fa-check"></i><b>7.4</b> Set up the mtcars example</a></li>
<li class="chapter" data-level="7.5" data-path="mtcars.html"><a href="mtcars.html#the-drake-plan"><i class="fa fa-check"></i><b>7.5</b> The <code>drake</code> plan</a></li>
<li class="chapter" data-level="7.6" data-path="mtcars.html"><a href="mtcars.html#generate-the-plan"><i class="fa fa-check"></i><b>7.6</b> Generate the plan</a><ul>
<li class="chapter" data-level="7.6.1" data-path="mtcars.html"><a href="mtcars.html#the-easy-way"><i class="fa fa-check"></i><b>7.6.1</b> The easy way</a></li>
<li class="chapter" data-level="7.6.2" data-path="mtcars.html"><a href="mtcars.html#the-old-way"><i class="fa fa-check"></i><b>7.6.2</b> The old way</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="mtcars.html"><a href="mtcars.html#run-the-workflow"><i class="fa fa-check"></i><b>7.7</b> Run the workflow</a></li>
</ul></li>
<li class="part"><span><b>III Functionality</b></span></li>
<li class="chapter" data-level="8" data-path="visuals.html"><a href="visuals.html"><i class="fa fa-check"></i><b>8</b> Visualization with drake</a><ul>
<li class="chapter" data-level="8.0.1" data-path="visuals.html"><a href="visuals.html#vis_drake_graph"><i class="fa fa-check"></i><b>8.0.1</b> <code>vis_drake_graph()</code></a></li>
<li class="chapter" data-level="8.0.2" data-path="visuals.html"><a href="visuals.html#sankey_drake_graph"><i class="fa fa-check"></i><b>8.0.2</b> <code>sankey_drake_graph()</code></a></li>
<li class="chapter" data-level="8.0.3" data-path="visuals.html"><a href="visuals.html#drake_ggraph"><i class="fa fa-check"></i><b>8.0.3</b> <code>drake_ggraph()</code></a></li>
<li class="chapter" data-level="8.1" data-path="visuals.html"><a href="visuals.html#underlying-graph-data-node-and-edge-data-frames"><i class="fa fa-check"></i><b>8.1</b> Underlying graph data: node and edge data frames</a></li>
<li class="chapter" data-level="8.2" data-path="visuals.html"><a href="visuals.html#visualizing-target-status"><i class="fa fa-check"></i><b>8.2</b> Visualizing target status</a></li>
<li class="chapter" data-level="8.3" data-path="visuals.html"><a href="visuals.html#subgraphs"><i class="fa fa-check"></i><b>8.3</b> Subgraphs</a></li>
<li class="chapter" data-level="8.4" data-path="visuals.html"><a href="visuals.html#control-the-vis_drake_graph-legend."><i class="fa fa-check"></i><b>8.4</b> Control the <code>vis_drake_graph()</code> legend.</a></li>
<li class="chapter" data-level="8.5" data-path="visuals.html"><a href="visuals.html#clusters"><i class="fa fa-check"></i><b>8.5</b> Clusters</a></li>
<li class="chapter" data-level="8.6" data-path="visuals.html"><a href="visuals.html#output-files"><i class="fa fa-check"></i><b>8.6</b> Output files</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="debug.html"><a href="debug.html"><i class="fa fa-check"></i><b>9</b> Debugging and testing drake projects</a><ul>
<li class="chapter" data-level="9.1" data-path="debug.html"><a href="debug.html#dependencies"><i class="fa fa-check"></i><b>9.1</b> Dependencies</a><ul>
<li class="chapter" data-level="9.1.1" data-path="debug.html"><a href="debug.html#visualize-your-dependency-graph."><i class="fa fa-check"></i><b>9.1.1</b> Visualize your dependency graph.</a></li>
<li class="chapter" data-level="9.1.2" data-path="debug.html"><a href="debug.html#check-specific-dependency-information."><i class="fa fa-check"></i><b>9.1.2</b> Check specific dependency information.</a></li>
<li class="chapter" data-level="9.1.3" data-path="debug.html"><a href="debug.html#outdated-targets-and-missing-dependencies"><i class="fa fa-check"></i><b>9.1.3</b> Outdated targets and missing dependencies</a></li>
<li class="chapter" data-level="9.1.4" data-path="debug.html"><a href="debug.html#but-why-are-my-targets-out-of-date"><i class="fa fa-check"></i><b>9.1.4</b> But <em>why</em> are my targets out of date?</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="debug.html"><a href="debug.html#diagnose-failures."><i class="fa fa-check"></i><b>9.2</b> Diagnose failures.</a></li>
<li class="chapter" data-level="9.3" data-path="debug.html"><a href="debug.html#timeouts-and-retries"><i class="fa fa-check"></i><b>9.3</b> Timeouts and retries</a></li>
<li class="chapter" data-level="9.4" data-path="debug.html"><a href="debug.html#more-help"><i class="fa fa-check"></i><b>9.4</b> More help</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="hpc.html"><a href="hpc.html"><i class="fa fa-check"></i><b>10</b> High-performance computing</a><ul>
<li class="chapter" data-level="10.1" data-path="hpc.html"><a href="hpc.html#batch-mode-for-long-workflows"><i class="fa fa-check"></i><b>10.1</b> Batch mode for long workflows</a></li>
<li class="chapter" data-level="10.2" data-path="hpc.html"><a href="hpc.html#let-make-schedule-your-targets."><i class="fa fa-check"></i><b>10.2</b> Let <code>make()</code> schedule your targets.</a></li>
<li class="chapter" data-level="10.3" data-path="hpc.html"><a href="hpc.html#parallel-backends"><i class="fa fa-check"></i><b>10.3</b> Parallel backends</a></li>
<li class="chapter" data-level="10.4" data-path="hpc.html"><a href="hpc.html#the-clustermq-backend"><i class="fa fa-check"></i><b>10.4</b> The <code>clustermq</code> backend</a><ul>
<li class="chapter" data-level="10.4.1" data-path="hpc.html"><a href="hpc.html#persistent-workers"><i class="fa fa-check"></i><b>10.4.1</b> Persistent workers</a></li>
<li class="chapter" data-level="10.4.2" data-path="hpc.html"><a href="hpc.html#installation-1"><i class="fa fa-check"></i><b>10.4.2</b> Installation</a></li>
<li class="chapter" data-level="10.4.3" data-path="hpc.html"><a href="hpc.html#on-your-local-machine"><i class="fa fa-check"></i><b>10.4.3</b> On your local machine</a></li>
<li class="chapter" data-level="10.4.4" data-path="hpc.html"><a href="hpc.html#on-a-cluster"><i class="fa fa-check"></i><b>10.4.4</b> On a cluster</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="hpc.html"><a href="hpc.html#the-future-backend"><i class="fa fa-check"></i><b>10.5</b> The <code>future</code> backend</a><ul>
<li class="chapter" data-level="10.5.1" data-path="hpc.html"><a href="hpc.html#transient-workers"><i class="fa fa-check"></i><b>10.5.1</b> Transient workers</a></li>
<li class="chapter" data-level="10.5.2" data-path="hpc.html"><a href="hpc.html#installation-2"><i class="fa fa-check"></i><b>10.5.2</b> Installation</a></li>
<li class="chapter" data-level="10.5.3" data-path="hpc.html"><a href="hpc.html#on-your-local-machine-1"><i class="fa fa-check"></i><b>10.5.3</b> On your local machine</a></li>
<li class="chapter" data-level="10.5.4" data-path="hpc.html"><a href="hpc.html#on-a-cluster-1"><i class="fa fa-check"></i><b>10.5.4</b> On a cluster</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="hpc.html"><a href="hpc.html#advanced-options"><i class="fa fa-check"></i><b>10.6</b> Advanced options</a><ul>
<li class="chapter" data-level="10.6.1" data-path="hpc.html"><a href="hpc.html#selectivity"><i class="fa fa-check"></i><b>10.6.1</b> Selectivity</a></li>
<li class="chapter" data-level="10.6.2" data-path="hpc.html"><a href="hpc.html#memory"><i class="fa fa-check"></i><b>10.6.2</b> Memory</a></li>
<li class="chapter" data-level="10.6.3" data-path="hpc.html"><a href="hpc.html#storage"><i class="fa fa-check"></i><b>10.6.3</b> Storage</a></li>
<li class="chapter" data-level="10.6.4" data-path="hpc.html"><a href="hpc.html#the-template-argument-for-persistent-workers"><i class="fa fa-check"></i><b>10.6.4</b> The <code>template</code> argument for persistent workers</a></li>
<li class="chapter" data-level="10.6.5" data-path="hpc.html"><a href="hpc.html#the-resources-column-for-transient-workers"><i class="fa fa-check"></i><b>10.6.5</b> The <code>resources</code> column for transient workers</a></li>
<li class="chapter" data-level="10.6.6" data-path="hpc.html"><a href="hpc.html#parallel-computing-within-targets"><i class="fa fa-check"></i><b>10.6.6</b> Parallel computing <em>within</em> targets</a></li>
<li class="chapter" data-level="10.6.7" data-path="hpc.html"><a href="hpc.html#custom-job-schedulers"><i class="fa fa-check"></i><b>10.6.7</b> Custom job schedulers</a></li>
<li class="chapter" data-level="10.6.8" data-path="hpc.html"><a href="hpc.html#hasty-mode"><i class="fa fa-check"></i><b>10.6.8</b> Hasty mode</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="triggers.html"><a href="triggers.html"><i class="fa fa-check"></i><b>11</b> Triggers: decision rules for building targets</a><ul>
<li class="chapter" data-level="11.1" data-path="triggers.html"><a href="triggers.html#what-are-triggers"><i class="fa fa-check"></i><b>11.1</b> What are triggers?</a></li>
<li class="chapter" data-level="11.2" data-path="triggers.html"><a href="triggers.html#customization"><i class="fa fa-check"></i><b>11.2</b> Customization</a></li>
<li class="chapter" data-level="11.3" data-path="triggers.html"><a href="triggers.html#alternative-trigger-modes"><i class="fa fa-check"></i><b>11.3</b> Alternative trigger modes</a></li>
<li class="chapter" data-level="11.4" data-path="triggers.html"><a href="triggers.html#consider-hasty-mode"><i class="fa fa-check"></i><b>11.4</b> Consider hasty mode</a></li>
<li class="chapter" data-level="11.5" data-path="triggers.html"><a href="triggers.html#a-more-practical-example"><i class="fa fa-check"></i><b>11.5</b> A more practical example</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="time.html"><a href="time.html"><i class="fa fa-check"></i><b>12</b> Time: logging, prediction, and strategy</a><ul>
<li class="chapter" data-level="12.1" data-path="time.html"><a href="time.html#predict-total-runtime"><i class="fa fa-check"></i><b>12.1</b> Predict total runtime</a></li>
<li class="chapter" data-level="12.2" data-path="time.html"><a href="time.html#strategize-your-high-performance-computing"><i class="fa fa-check"></i><b>12.2</b> Strategize your high-performance computing</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="store.html"><a href="store.html"><i class="fa fa-check"></i><b>13</b> Storage</a><ul>
<li class="chapter" data-level="13.1" data-path="store.html"><a href="store.html#cache-formats"><i class="fa fa-check"></i><b>13.1</b> Cache formats</a><ul>
<li class="chapter" data-level="13.1.1" data-path="store.html"><a href="store.html#rds-caches"><i class="fa fa-check"></i><b>13.1.1</b> RDS caches</a></li>
<li class="chapter" data-level="13.1.2" data-path="store.html"><a href="store.html#database-caches"><i class="fa fa-check"></i><b>13.1.2</b> Database caches</a></li>
<li class="chapter" data-level="13.1.3" data-path="store.html"><a href="store.html#environment-caches"><i class="fa fa-check"></i><b>13.1.3</b> Environment caches</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="store.html"><a href="store.html#hash-algorithms"><i class="fa fa-check"></i><b>13.2</b> Hash algorithms</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="faq.html"><a href="faq.html"><i class="fa fa-check"></i><b>A</b> Frequently-asked questions</a></li>
<li class="chapter" data-level="B" data-path="caution.html"><a href="caution.html"><i class="fa fa-check"></i><b>B</b> Cautionary notes</a><ul>
<li class="chapter" data-level="B.1" data-path="caution.html"><a href="caution.html#workflow-plans"><i class="fa fa-check"></i><b>B.1</b> Workflow plans</a><ul>
<li class="chapter" data-level="B.1.1" data-path="caution.html"><a href="caution.html#externalizing-commands-in-r-script-files"><i class="fa fa-check"></i><b>B.1.1</b> Externalizing commands in R script files</a></li>
<li class="chapter" data-level="B.1.2" data-path="caution.html"><a href="caution.html#commands-are-not-perfectly-flexible."><i class="fa fa-check"></i><b>B.1.2</b> Commands are NOT perfectly flexible.</a></li>
</ul></li>
<li class="chapter" data-level="B.2" data-path="caution.html"><a href="caution.html#execution"><i class="fa fa-check"></i><b>B.2</b> Execution</a><ul>
<li class="chapter" data-level="B.2.1" data-path="caution.html"><a href="caution.html#install-drake-properly."><i class="fa fa-check"></i><b>B.2.1</b> Install <code>drake</code> properly.</a></li>
<li class="chapter" data-level="B.2.2" data-path="caution.html"><a href="caution.html#install-all-your-packages."><i class="fa fa-check"></i><b>B.2.2</b> Install all your packages.</a></li>
<li class="chapter" data-level="B.2.3" data-path="caution.html"><a href="caution.html#a-note-on-tidy-evaluation"><i class="fa fa-check"></i><b>B.2.3</b> A note on tidy evaluation</a></li>
<li class="chapter" data-level="B.2.4" data-path="caution.html"><a href="caution.html#find-and-diagnose-your-errors."><i class="fa fa-check"></i><b>B.2.4</b> Find and diagnose your errors.</a></li>
<li class="chapter" data-level="B.2.5" data-path="caution.html"><a href="caution.html#refresh-the-drake_config-list-early-and-often."><i class="fa fa-check"></i><b>B.2.5</b> Refresh the <code>drake_config()</code> list early and often.</a></li>
<li class="chapter" data-level="B.2.6" data-path="caution.html"><a href="caution.html#workflows-as-r-packages."><i class="fa fa-check"></i><b>B.2.6</b> Workflows as R packages.</a></li>
<li class="chapter" data-level="B.2.7" data-path="caution.html"><a href="caution.html#the-lazy_load-flag-does-not-work-with-parlapply-parallelism."><i class="fa fa-check"></i><b>B.2.7</b> The <code>lazy_load</code> flag does not work with <code>&quot;parLapply&quot;</code> parallelism.</a></li>
<li class="chapter" data-level="B.2.8" data-path="caution.html"><a href="caution.html#timeouts-may-be-unreliable."><i class="fa fa-check"></i><b>B.2.8</b> Timeouts may be unreliable.</a></li>
</ul></li>
<li class="chapter" data-level="B.3" data-path="caution.html"><a href="caution.html#dependencies-1"><i class="fa fa-check"></i><b>B.3</b> Dependencies</a><ul>
<li class="chapter" data-level="B.3.1" data-path="caution.html"><a href="caution.html#objects-that-contain-functions-may-rebuild-too-often"><i class="fa fa-check"></i><b>B.3.1</b> Objects that contain functions may rebuild too often</a></li>
<li class="chapter" data-level="B.3.2" data-path="caution.html"><a href="caution.html#dependencies-are-not-tracked-in-some-edge-cases."><i class="fa fa-check"></i><b>B.3.2</b> Dependencies are not tracked in some edge cases.</a></li>
<li class="chapter" data-level="B.3.3" data-path="caution.html"><a href="caution.html#dependencies-of-knitr-reports"><i class="fa fa-check"></i><b>B.3.3</b> Dependencies of <code>knitr</code> reports</a></li>
<li class="chapter" data-level="B.3.4" data-path="caution.html"><a href="caution.html#s3-and-generic-methods"><i class="fa fa-check"></i><b>B.3.4</b> S3 and generic methods</a></li>
<li class="chapter" data-level="B.3.5" data-path="caution.html"><a href="caution.html#file-outputs-in-imported-functions."><i class="fa fa-check"></i><b>B.3.5</b> File outputs in imported functions.</a></li>
<li class="chapter" data-level="B.3.6" data-path="caution.html"><a href="caution.html#functions-produced-by-vectorize"><i class="fa fa-check"></i><b>B.3.6</b> Functions produced by <code>Vectorize()</code></a></li>
<li class="chapter" data-level="B.3.7" data-path="caution.html"><a href="caution.html#compiled-code-is-not-reproducibly-tracked."><i class="fa fa-check"></i><b>B.3.7</b> Compiled code is not reproducibly tracked.</a></li>
<li class="chapter" data-level="B.3.8" data-path="caution.html"><a href="caution.html#directories-folders-are-not-reproducibly-tracked."><i class="fa fa-check"></i><b>B.3.8</b> Directories (folders) are not reproducibly tracked.</a></li>
<li class="chapter" data-level="B.3.9" data-path="caution.html"><a href="caution.html#packages-are-not-tracked-as-dependencies."><i class="fa fa-check"></i><b>B.3.9</b> Packages are not tracked as dependencies.</a></li>
</ul></li>
<li class="chapter" data-level="B.4" data-path="caution.html"><a href="caution.html#high-performance-computing"><i class="fa fa-check"></i><b>B.4</b> High-performance computing</a><ul>
<li class="chapter" data-level="B.4.1" data-path="caution.html"><a href="caution.html#calling-mclapply-within-targets"><i class="fa fa-check"></i><b>B.4.1</b> Calling <code>mclapply()</code> <em>within</em> targets</a></li>
<li class="chapter" data-level="B.4.2" data-path="caution.html"><a href="caution.html#zombie-processes"><i class="fa fa-check"></i><b>B.4.2</b> Zombie processes</a></li>
</ul></li>
<li class="chapter" data-level="B.5" data-path="caution.html"><a href="caution.html#storage-1"><i class="fa fa-check"></i><b>B.5</b> Storage</a><ul>
<li class="chapter" data-level="B.5.1" data-path="caution.html"><a href="caution.html#projects-hosted-on-dropbox-and-similar-platforms"><i class="fa fa-check"></i><b>B.5.1</b> Projects hosted on Dropbox and similar platforms</a></li>
<li class="chapter" data-level="B.5.2" data-path="caution.html"><a href="caution.html#cache-customization-is-limited"><i class="fa fa-check"></i><b>B.5.2</b> Cache customization is limited</a></li>
<li class="chapter" data-level="B.5.3" data-path="caution.html"><a href="caution.html#runtime-predictions"><i class="fa fa-check"></i><b>B.5.3</b> Runtime predictions</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The drake R Package User Manual</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="mtcars" class="section level1">
<h1><span class="header-section-number">Chapter 7</span> The mtcars example and <code>drake</code> plan generation</h1>
<p>This chapter is a walkthrough of <code>drake</code>’s main functionality based on the mtcars example. It sets up the project and runs it repeatedly to demonstrate <code>drake</code>’s most important functionality.</p>
<div id="get-the-code.-2" class="section level2">
<h2><span class="header-section-number">7.1</span> Get the code.</h2>
<p>Write the code files to your workspace.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">drake_example</span>(<span class="st">&quot;mtcars&quot;</span>)</code></pre>
<p>The new <code>mtcars</code> folder now includes a file structure of a serious <code>drake</code> project, plus an <code>interactive-tutorial.R</code> to narrate the example. The code is also <a href="https://github.com/wlandau/drake-examples/tree/master/mtcars">online here</a>.</p>
</div>
<div id="quick-examples" class="section level2">
<h2><span class="header-section-number">7.2</span> Quick examples</h2>
<p>Inspect and run your project.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(drake)
<span class="kw">load_mtcars_example</span>()            <span class="co"># Get the code with drake_example(&quot;mtcars&quot;).</span>
config &lt;-<span class="st"> </span><span class="kw">drake_config</span>(my_plan) <span class="co"># Master configuration list</span>
<span class="kw">vis_drake_graph</span>(config)         <span class="co"># Hover, click, drag, zoom, pan.</span>
<span class="kw">make</span>(my_plan)                   <span class="co"># Run the workflow.</span>
<span class="kw">outdated</span>(config)                <span class="co"># Everything is up to date.</span></code></pre>
<p>Debug errors.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">failed</span>()                   <span class="co"># Targets that failed in the most recent `make()`</span>
context &lt;-<span class="st"> </span><span class="kw">diagnose</span>(large) <span class="co"># Diagnostic metadata: errors, warnings, etc.</span>
error &lt;-<span class="st"> </span>context<span class="op">$</span>error
<span class="kw">str</span>(error)                 <span class="co"># Object of class &quot;error&quot;</span>
error<span class="op">$</span>message
error<span class="op">$</span>call
error<span class="op">$</span>calls                <span class="co"># Full traceback of nested calls leading up to the error. # nolint</span></code></pre>
<p>Dive deeper into the built-in examples.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">drake_example</span>(<span class="st">&quot;mtcars&quot;</span>) <span class="co"># Write the code files.</span>
<span class="kw">drake_examples</span>()        <span class="co"># List the other examples.</span></code></pre>
</div>
<div id="the-motivation-of-the-mtcars-example" class="section level2">
<h2><span class="header-section-number">7.3</span> The motivation of the mtcars example</h2>
<p>Is there an association between the weight and the fuel efficiency of cars? To find out, we use the <code>mtcars</code> dataset from the <code>datasets</code> package. The <code>mtcars</code> dataset originally came from the 1974 Motor Trend US magazine, and it contains design and performance data on 32 models of automobile.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># ?mtcars # more info</span>
<span class="kw">head</span>(mtcars)
<span class="co">#&gt;                    mpg cyl disp  hp drat    wt  qsec vs am gear carb</span>
<span class="co">#&gt; Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4</span>
<span class="co">#&gt; Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4</span>
<span class="co">#&gt; Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1</span>
<span class="co">#&gt; Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1</span>
<span class="co">#&gt; Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2</span>
<span class="co">#&gt; Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</span></code></pre>
<p>Here, <code>wt</code> is weight in tons, and <code>mpg</code> is fuel efficiency in miles per gallon. We want to figure out if there is an association between <code>wt</code> and <code>mpg</code>. The <code>mtcars</code> dataset itself only has 32 rows, so we generate two larger bootstrapped datasets and then analyze them with regression models. We summarize the regression models to see if there is an association.</p>
</div>
<div id="set-up-the-mtcars-example" class="section level2">
<h2><span class="header-section-number">7.4</span> Set up the mtcars example</h2>
<p>Before you run your project, you need to set up the workspace. In other words, you need to gather the “imports”: functions, pre-loaded data objects, and saved files that you want to be available before the real work begins.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(knitr) <span class="co"># drake knows which packages you load.</span>
<span class="kw">library</span>(drake)</code></pre>
<p>We need a function to bootstrap larger datasets from <code>mtcars</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Pick a random subset of n rows from a dataset</span>
random_rows &lt;-<span class="st"> </span><span class="cf">function</span>(data, n){
  data[<span class="kw">sample.int</span>(<span class="dt">n =</span> <span class="kw">nrow</span>(data), <span class="dt">size =</span> n, <span class="dt">replace =</span> <span class="ot">TRUE</span>), ]
}

<span class="co"># Bootstrapped datasets from mtcars.</span>
simulate &lt;-<span class="st"> </span><span class="cf">function</span>(n){
  <span class="co"># Pick a random set of cars to bootstrap from the mtcars data.</span>
  data &lt;-<span class="st"> </span><span class="kw">random_rows</span>(<span class="dt">data =</span> mtcars, <span class="dt">n =</span> n)

  <span class="co"># x is the car&#39;s weight, and y is the fuel efficiency.</span>
  <span class="kw">data.frame</span>(
    <span class="dt">x =</span> data<span class="op">$</span>wt,
    <span class="dt">y =</span> data<span class="op">$</span>mpg
  )
}</code></pre>
<p>We also need functions to apply the regression models we need for detecting associations.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Is fuel efficiency linearly related to weight?</span>
reg1 &lt;-<span class="st"> </span><span class="cf">function</span>(d){
  <span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span><span class="op">+</span><span class="st"> </span>x, <span class="dt">data =</span> d)
}

<span class="co"># Is fuel efficiency related to the SQUARE of the weight?</span>
reg2 &lt;-<span class="st"> </span><span class="cf">function</span>(d){
  d<span class="op">$</span>x2 &lt;-<span class="st"> </span>d<span class="op">$</span>x <span class="op">^</span><span class="st"> </span><span class="dv">2</span>
  <span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x2, <span class="dt">data =</span> d)
}</code></pre>
<p>We want to summarize the final results in an R Markdown report, so we need the the <code>report.Rmd</code> source file. You can get it with <code>drake_example(&quot;mtcars&quot;)</code> or <code>load_mtcars_example()</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">drake_example</span>(<span class="st">&quot;mtcars&quot;</span>, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)
<span class="kw">file.copy</span>(<span class="st">&quot;mtcars/report.Rmd&quot;</span>, <span class="st">&quot;.&quot;</span>, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; [1] TRUE</span></code></pre>
<p>Here are the contents of the report. It will serve as a final summary of our work, and we will process it at the very end. Admittedly, some of the text spoils the punch line.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cat</span>(<span class="kw">readLines</span>(<span class="st">&quot;report.Rmd&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)
<span class="co">#&gt; ---</span>
<span class="co">#&gt; title: &quot;Final results report for the mtcars example&quot;</span>
<span class="co">#&gt; author: You</span>
<span class="co">#&gt; output: html_document</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; # The weight and fuel efficiency of cars</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Is there an association between the weight and the fuel efficiency of cars? To find out, we use the `mtcars` dataset from the `datasets` package. The `mtcars` data originally came from the 1974 Motor Trend US magazine, and it contains design and performance data on 32 models of automobile.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ```{r showmtcars}</span>
<span class="co">#&gt; # ?mtcars # more info</span>
<span class="co">#&gt; head(mtcars)</span>
<span class="co">#&gt; ```</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Here, `wt` is weight in tons, and `mpg` is fuel efficiency in miles per gallon. We want to figure out if there is an association between `wt` and `mpg`. The `mtcars` dataset itself only has 32 rows, so we generated two larger bootstrapped datasets. We called them `small` and `large`.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ```{r example_chunk}</span>
<span class="co">#&gt; library(drake)</span>
<span class="co">#&gt; head(readd(small)) # 48 rows</span>
<span class="co">#&gt; loadd(large)       # 64 rows</span>
<span class="co">#&gt; head(large)</span>
<span class="co">#&gt; ```</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Then, we fit a couple regression models to the `small` and `large` to try to detect an association between `wt` and `mpg`. Here are the coefficients and p-values from one of the model fits.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ```{r second_example_chunk}</span>
<span class="co">#&gt; readd(coef_regression2_small)</span>
<span class="co">#&gt; ```</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Since the p-value on `x2` is so small, there may be an association between weight and fuel efficiency after all.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; # A note on knitr reports in drake projects.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Because of the calls to `readd()` and `loadd()`, `drake` knows that `small`, `large`, and `coef_regression2_small` are dependencies of this R Markdown report. This dependency relationship is what causes the report to be processed at the very end.</span></code></pre>
<p>Now, all our imports are set up. When the real work begins, <code>drake</code> will import functions and data objects from your R session environment</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ls</span>()
<span class="co">#&gt;  [1] &quot;as_chr&quot;          &quot;bad_config&quot;      &quot;bad_plan&quot;       </span>
<span class="co">#&gt;  [4] &quot;col&quot;             &quot;combos&quot;          &quot;config&quot;         </span>
<span class="co">#&gt;  [7] &quot;config1&quot;         &quot;config2&quot;         &quot;create_plot&quot;    </span>
<span class="co">#&gt; [10] &quot;get_logs&quot;        &quot;get_rmspe&quot;       &quot;good_config&quot;    </span>
<span class="co">#&gt; [13] &quot;good_plan&quot;       &quot;hist&quot;            &quot;latest_log_date&quot;</span>
<span class="co">#&gt; [16] &quot;lots_of_sds&quot;     &quot;make_my_plot&quot;    &quot;make_my_table&quot;  </span>
<span class="co">#&gt; [19] &quot;my_grid&quot;         &quot;plan&quot;            &quot;plan1&quot;          </span>
<span class="co">#&gt; [22] &quot;plan2&quot;           &quot;plot_rmspe&quot;      &quot;predictors&quot;     </span>
<span class="co">#&gt; [25] &quot;Produc&quot;          &quot;random_rows&quot;     &quot;reg1&quot;           </span>
<span class="co">#&gt; [28] &quot;reg2&quot;            &quot;results&quot;         &quot;simulate&quot;       </span>
<span class="co">#&gt; [31] &quot;small_config&quot;    &quot;small_plan&quot;      &quot;tmp&quot;            </span>
<span class="co">#&gt; [34] &quot;url&quot;             &quot;vals&quot;            &quot;y_vals&quot;</span></code></pre>
<p>and saved files from your file system.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">list.files</span>()
<span class="co">#&gt; [1] &quot;mtcars&quot;     &quot;report.Rmd&quot;</span></code></pre>
</div>
<div id="the-drake-plan" class="section level2">
<h2><span class="header-section-number">7.5</span> The <code>drake</code> plan</h2>
<p>Now that your workspace of imports is prepared, we can outline the real work step by step in a <code>drake</code> plan.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load_mtcars_example</span>() <span class="co"># Get the code with drake_example(&quot;mtcars&quot;).</span>
my_plan
<span class="co">#&gt; # A tibble: 15 x 2</span>
<span class="co">#&gt;    target              command                                             </span>
<span class="co">#&gt;    &lt;chr&gt;               &lt;expr&gt;                                              </span>
<span class="co">#&gt;  1 report              knit(knitr_in(&quot;report.Rmd&quot;), file_out(&quot;report.md&quot;),…</span>
<span class="co">#&gt;  2 small               simulate(48)                                       …</span>
<span class="co">#&gt;  3 large               simulate(64)                                       …</span>
<span class="co">#&gt;  4 regression1_small   reg1(small)                                        …</span>
<span class="co">#&gt;  5 regression1_large   reg1(large)                                        …</span>
<span class="co">#&gt;  6 regression2_small   reg2(small)                                        …</span>
<span class="co">#&gt;  7 regression2_large   reg2(large)                                        …</span>
<span class="co">#&gt;  8 summ_regression1_s… suppressWarnings(summary(regression1_small$residual…</span>
<span class="co">#&gt;  9 summ_regression1_l… suppressWarnings(summary(regression1_large$residual…</span>
<span class="co">#&gt; 10 summ_regression2_s… suppressWarnings(summary(regression2_small$residual…</span>
<span class="co">#&gt; 11 summ_regression2_l… suppressWarnings(summary(regression2_large$residual…</span>
<span class="co">#&gt; 12 coef_regression1_s… suppressWarnings(summary(regression1_small))$coeffi…</span>
<span class="co">#&gt; 13 coef_regression1_l… suppressWarnings(summary(regression1_large))$coeffi…</span>
<span class="co">#&gt; 14 coef_regression2_s… suppressWarnings(summary(regression2_small))$coeffi…</span>
<span class="co">#&gt; 15 coef_regression2_l… suppressWarnings(summary(regression2_large))$coeffi…</span></code></pre>
<p>Each row is an intermediate step, and each <strong>command</strong> generates a single <strong>target</strong>. A target is an output R object (cached when generated) or an output file (specified with single quotes), and a command just an ordinary piece of R code (not necessarily a single function call). Commands make use of targets generated by other commands, objects your environment, input files, and namespaced objects/functions from packages (referenced with <code>::</code> or <code>:::</code>). These dependencies give your project an underlying network representation.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Hover, click, drag, zoom, and pan.</span>
config &lt;-<span class="st"> </span><span class="kw">drake_config</span>(my_plan)
<span class="kw">vis_drake_graph</span>(config, <span class="dt">width =</span> <span class="st">&quot;100%&quot;</span>, <span class="dt">height =</span> <span class="st">&quot;500px&quot;</span>) <span class="co"># Also drake_graph()</span></code></pre>
<div id="htmlwidget-9832503ab331c471346d" style="width:100%;height:500px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-9832503ab331c471346d">{"x":{"nodes":{"id":["random_rows","n-MRQXIYLTMV2HGOR2NV2GGYLSOM","reg1","reg2","p-OJSXA33SOQXFE3LE","simulate","large","small","regression1_large","regression2_large","regression1_small","regression2_small","summ_regression1_large","coef_regression1_large","summ_regression2_large","coef_regression2_large","summ_regression1_small","coef_regression1_small","coef_regression2_small","summ_regression2_small","report","p-OJSXA33SOQXG2ZA"],"imported":[true,true,true,true,true,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],"label":["random_rows","datasets::mtcars","reg1","reg2","file report.Rmd","simulate","large","small","regression1_large","regression2_large","regression1_small","regression2_small","summ_regression1_large","coef_regression1_large","summ_regression2_large","coef_regression2_large","summ_regression1_small","coef_regression1_small","coef_regression2_small","summ_regression2_small","report","file report.md"],"status":["imported","imported","imported","imported","imported","imported","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated"],"type":["function","object","function","function","file","function","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","file"],"font.size":[20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20],"color":["#1874CD","#1874CD","#1874CD","#1874CD","#1874CD","#1874CD","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000"],"shape":["triangle","dot","triangle","triangle","square","triangle","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","square"],"level":[1,1,1,1,1,2,3,3,4,4,4,4,5,5,5,5,5,5,5,5,6,7],"x":[-1,-1,-1,-1,-1,-0.666666666666667,-0.333333333333333,-0.333333333333333,0,0,0,0,0.333333333333333,0.333333333333333,0.333333333333333,0.333333333333333,0.333333333333333,0.333333333333333,0.333333333333333,0.333333333333333,0.666666666666667,1],"y":[-0.857142857142857,-0.428571428571428,2.22044604925031e-16,0.428571428571429,0.857142857142857,2.22044604925031e-16,-0.428571428571428,0.428571428571429,-0.771428571428571,-0.257142857142857,0.257142857142858,0.771428571428572,-1,-0.714285714285714,-0.428571428571428,-0.142857142857143,0.142857142857143,0.428571428571429,0.714285714285714,1,2.22044604925031e-16,2.22044604925031e-16]},"edges":{"from":["random_rows","n-MRQXIYLTMV2HGOR2NV2GGYLSOM","reg1","reg1","reg2","reg2","large","large","large","small","small","small","coef_regression2_small","p-OJSXA33SOQXFE3LE","report","simulate","simulate","regression1_small","regression1_small","regression1_large","regression1_large","regression2_small","regression2_small","regression2_large","regression2_large"],"to":["simulate","simulate","regression1_small","regression1_large","regression2_small","regression2_large","report","regression1_large","regression2_large","report","regression1_small","regression2_small","report","report","p-OJSXA33SOQXG2ZA","large","small","summ_regression1_small","coef_regression1_small","summ_regression1_large","coef_regression1_large","coef_regression2_small","summ_regression2_small","summ_regression2_large","coef_regression2_large"],"arrows":["to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"edges":{"smooth":false},"physics":{"stabilization":false},"interaction":{"navigationButtons":true}},"groups":null,"width":"100%","height":"500px","idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)"},"main":{"text":"Dependency graph","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":false,"hoverNearest":false,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Outdated","Imported","Object","Function","File"],"color":["#000000","#1874CD","#888888","#888888","#888888"],"shape":["dot","dot","dot","triangle","square"],"font.color":["black","black","black","black","black"],"font.size":[20,20,20,20,20],"id":[2,5,7,8,9]},"nodesToDataframe":true},"igraphlayout":{"type":"square"},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script>
<p>You can also check the dependencies of individual targets and imported functions.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">deps_code</span>(reg2)
<span class="co">#&gt; # A tibble: 4 x 2</span>
<span class="co">#&gt;   name  type   </span>
<span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;  </span>
<span class="co">#&gt; 1 x     globals</span>
<span class="co">#&gt; 2 y     globals</span>
<span class="co">#&gt; 3 lm    globals</span>
<span class="co">#&gt; 4 x2    globals</span>

<span class="kw">deps_code</span>(my_plan<span class="op">$</span>command[[<span class="dv">1</span>]])
<span class="co">#&gt; # A tibble: 6 x 2</span>
<span class="co">#&gt;   name                   type    </span>
<span class="co">#&gt;   &lt;chr&gt;                  &lt;chr&gt;   </span>
<span class="co">#&gt; 1 knit                   globals </span>
<span class="co">#&gt; 2 large                  loadd   </span>
<span class="co">#&gt; 3 small                  readd   </span>
<span class="co">#&gt; 4 coef_regression2_small readd   </span>
<span class="co">#&gt; 5 report.md              file_out</span>
<span class="co">#&gt; 6 report.Rmd             knitr_in</span>

<span class="kw">deps_code</span>(my_plan<span class="op">$</span>command[[<span class="kw">nrow</span>(my_plan)]])
<span class="co">#&gt; # A tibble: 4 x 2</span>
<span class="co">#&gt;   name              type   </span>
<span class="co">#&gt;   &lt;chr&gt;             &lt;chr&gt;  </span>
<span class="co">#&gt; 1 summary           globals</span>
<span class="co">#&gt; 2 suppressWarnings  globals</span>
<span class="co">#&gt; 3 regression2_large globals</span>
<span class="co">#&gt; 4 coefficients      globals</span></code></pre>
<p>List all the reproducibly-tracked objects and files.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tracked</span>(config)
<span class="co">#&gt;  [1] &quot;coef_regression1_large&quot; &quot;coef_regression1_small&quot;</span>
<span class="co">#&gt;  [3] &quot;coef_regression2_large&quot; &quot;coef_regression2_small&quot;</span>
<span class="co">#&gt;  [5] &quot;large&quot;                  &quot;datasets::mtcars&quot;      </span>
<span class="co">#&gt;  [7] &quot;file report.Rmd&quot;        &quot;file report.md&quot;        </span>
<span class="co">#&gt;  [9] &quot;random_rows&quot;            &quot;reg1&quot;                  </span>
<span class="co">#&gt; [11] &quot;reg2&quot;                   &quot;regression1_large&quot;     </span>
<span class="co">#&gt; [13] &quot;regression1_small&quot;      &quot;regression2_large&quot;     </span>
<span class="co">#&gt; [15] &quot;regression2_small&quot;      &quot;report&quot;                </span>
<span class="co">#&gt; [17] &quot;simulate&quot;               &quot;small&quot;                 </span>
<span class="co">#&gt; [19] &quot;summ_regression1_large&quot; &quot;summ_regression1_small&quot;</span>
<span class="co">#&gt; [21] &quot;summ_regression2_large&quot; &quot;summ_regression2_small&quot;</span></code></pre>
</div>
<div id="generate-the-plan" class="section level2">
<h2><span class="header-section-number">7.6</span> Generate the plan</h2>
<div id="the-easy-way" class="section level3">
<h3><span class="header-section-number">7.6.1</span> The easy way</h3>
<p><code>drake</code> version 7.0.0 will support new special syntax to create complicated <code>drake</code> plans from boilerplate code. See the <a href="plans.html#plans">chapter on plans</a> for more details. To get the funcionality early, install development drake.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;remotes&quot;</span>)
<span class="kw">library</span>(remotes)
<span class="kw">install_github</span>(<span class="st">&quot;ropensci/drake&quot;</span>)</code></pre>
<p>Then, use transformations to generate the plan.</p>
<pre class="sourceCode r"><code class="sourceCode r">my_plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(
  <span class="dt">report =</span> <span class="kw">knit</span>(<span class="kw">knitr_in</span>(<span class="st">&quot;report.Rmd&quot;</span>), <span class="kw">file_out</span>(<span class="st">&quot;report.md&quot;</span>), <span class="dt">quiet =</span> <span class="ot">TRUE</span>),
  <span class="dt">small =</span> <span class="kw">simulate</span>(<span class="dv">48</span>),
  <span class="dt">large =</span> <span class="kw">simulate</span>(<span class="dv">64</span>),
  <span class="dt">regression1 =</span> <span class="kw">target</span>(
    <span class="kw">reg1</span>(data),
    <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">data =</span> <span class="kw">c</span>(small, large), <span class="dt">.tag_out =</span> reg)
  ),
  <span class="dt">regression2 =</span> <span class="kw">target</span>(
    <span class="kw">reg2</span>(data),
    <span class="dt">transform =</span> <span class="kw">map</span>(data, <span class="dt">.tag_out =</span> reg)
  ),
  <span class="dt">summ =</span> <span class="kw">target</span>(
    <span class="kw">suppressWarnings</span>(<span class="kw">summary</span>(reg<span class="op">$</span>residuals)),
    <span class="dt">transform =</span> <span class="kw">map</span>(reg)
  ),
  <span class="dt">coef =</span> <span class="kw">target</span>(
    <span class="kw">suppressWarnings</span>(<span class="kw">summary</span>(reg))<span class="op">$</span>coefficients,
    <span class="dt">transform =</span> <span class="kw">map</span>(reg)
  )
)

my_plan
<span class="co">#&gt; # A tibble: 15 x 2</span>
<span class="co">#&gt;    target              command                                             </span>
<span class="co">#&gt;    &lt;chr&gt;               &lt;expr&gt;                                              </span>
<span class="co">#&gt;  1 report              knit(knitr_in(&quot;report.Rmd&quot;), file_out(&quot;report.md&quot;),…</span>
<span class="co">#&gt;  2 small               simulate(48)                                       …</span>
<span class="co">#&gt;  3 large               simulate(64)                                       …</span>
<span class="co">#&gt;  4 regression1_small   reg1(small)                                        …</span>
<span class="co">#&gt;  5 regression1_large   reg1(large)                                        …</span>
<span class="co">#&gt;  6 regression2_small   reg2(small)                                        …</span>
<span class="co">#&gt;  7 regression2_large   reg2(large)                                        …</span>
<span class="co">#&gt;  8 summ_regression1_s… suppressWarnings(summary(regression1_small$residual…</span>
<span class="co">#&gt;  9 summ_regression1_l… suppressWarnings(summary(regression1_large$residual…</span>
<span class="co">#&gt; 10 summ_regression2_s… suppressWarnings(summary(regression2_small$residual…</span>
<span class="co">#&gt; 11 summ_regression2_l… suppressWarnings(summary(regression2_large$residual…</span>
<span class="co">#&gt; 12 coef_regression1_s… suppressWarnings(summary(regression1_small))$coeffi…</span>
<span class="co">#&gt; 13 coef_regression1_l… suppressWarnings(summary(regression1_large))$coeffi…</span>
<span class="co">#&gt; 14 coef_regression2_s… suppressWarnings(summary(regression2_small))$coeffi…</span>
<span class="co">#&gt; 15 coef_regression2_l… suppressWarnings(summary(regression2_large))$coeffi…</span></code></pre>
<p>In the first row above, <code>knitr_in()</code> indicates that <code>report.Rmd</code> is a dependency and targets loaded with <code>loadd()</code> and <code>readd()</code> in active code chunks are also dependencies. Use <code>file_out()</code> to tell <code>drake</code> that the target is a file output.</p>
</div>
<div id="the-old-way" class="section level3">
<h3><span class="header-section-number">7.6.2</span> The old way</h3>
<p><code>drake</code> has old wildcard templating functions to help generate plans. It is more difficult to adapt them to practical use cases, but they have been around since the early days of <code>drake</code>.</p>
<p>Here are the commands to generate the bootstrapped datasets.</p>
<pre class="sourceCode r"><code class="sourceCode r">my_datasets &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(
  <span class="dt">small =</span> <span class="kw">simulate</span>(<span class="dv">48</span>),
  <span class="dt">large =</span> <span class="kw">simulate</span>(<span class="dv">64</span>))
my_datasets
<span class="co">#&gt; # A tibble: 2 x 2</span>
<span class="co">#&gt;   target command     </span>
<span class="co">#&gt;   &lt;chr&gt;  &lt;expr&gt;      </span>
<span class="co">#&gt; 1 small  simulate(48)</span>
<span class="co">#&gt; 2 large  simulate(64)</span></code></pre>
<p>For multiple replicates:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">expand_plan</span>(my_datasets, <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;rep1&quot;</span>, <span class="st">&quot;rep2&quot;</span>))
<span class="co">#&gt; The interface at https://ropenscilabs.github.io/drake-manual/plans.html#large-plans is better than evaluate_plan(), map_plan(), gather_by(), etc.</span>
<span class="co">#&gt; # A tibble: 4 x 2</span>
<span class="co">#&gt;   target     command     </span>
<span class="co">#&gt;   &lt;chr&gt;      &lt;expr&gt;      </span>
<span class="co">#&gt; 1 small_rep1 simulate(48)</span>
<span class="co">#&gt; 2 small_rep2 simulate(48)</span>
<span class="co">#&gt; 3 large_rep1 simulate(64)</span>
<span class="co">#&gt; 4 large_rep2 simulate(64)</span></code></pre>
<p>Here is a template for applying our regression models to our bootstrapped datasets.</p>
<pre class="sourceCode r"><code class="sourceCode r">methods &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(
  <span class="dt">regression1 =</span> <span class="kw">reg1</span>(dataset__),
  <span class="dt">regression2 =</span> <span class="kw">reg2</span>(dataset__))
methods
<span class="co">#&gt; # A tibble: 2 x 2</span>
<span class="co">#&gt;   target      command        </span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;expr&gt;         </span>
<span class="co">#&gt; 1 regression1 reg1(dataset__)</span>
<span class="co">#&gt; 2 regression2 reg2(dataset__)</span></code></pre>
<p>We evaluate the <code>dataset__</code> wildcard to generate all the regression commands we need.</p>
<pre class="sourceCode r"><code class="sourceCode r">my_analyses &lt;-<span class="st"> </span><span class="kw">evaluate_plan</span>(
  methods, <span class="dt">wildcard =</span> <span class="st">&quot;dataset__&quot;</span>,
  <span class="dt">values =</span> my_datasets<span class="op">$</span>target
)
my_analyses
<span class="co">#&gt; # A tibble: 4 x 2</span>
<span class="co">#&gt;   target            command    </span>
<span class="co">#&gt;   &lt;chr&gt;             &lt;expr&gt;     </span>
<span class="co">#&gt; 1 regression1_small reg1(small)</span>
<span class="co">#&gt; 2 regression1_large reg1(large)</span>
<span class="co">#&gt; 3 regression2_small reg2(small)</span>
<span class="co">#&gt; 4 regression2_large reg2(large)</span></code></pre>
<p>Next, we summarize each analysis of each dataset. We calculate descriptive statistics on the residuals, and we collect the regression coefficients and their p-values.</p>
<pre class="sourceCode r"><code class="sourceCode r">summary_types &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(
  <span class="dt">summ =</span> <span class="kw">suppressWarnings</span>(<span class="kw">summary</span>(analysis__<span class="op">$</span>residuals)),
  <span class="dt">coef =</span> <span class="kw">suppressWarnings</span>(<span class="kw">summary</span>(analysis__))<span class="op">$</span>coefficients
)
summary_types
<span class="co">#&gt; # A tibble: 2 x 2</span>
<span class="co">#&gt;   target command                                           </span>
<span class="co">#&gt;   &lt;chr&gt;  &lt;expr&gt;                                            </span>
<span class="co">#&gt; 1 summ   suppressWarnings(summary(analysis__$residuals))   </span>
<span class="co">#&gt; 2 coef   suppressWarnings(summary(analysis__))$coefficients</span>

my_summaries &lt;-<span class="st"> </span><span class="kw">evaluate_plan</span>(
  summary_types,
  <span class="dt">wildcard =</span> <span class="st">&quot;analysis__&quot;</span>,
  <span class="dt">values =</span> my_analyses<span class="op">$</span>target
)
my_summaries
<span class="co">#&gt; # A tibble: 8 x 2</span>
<span class="co">#&gt;   target                command                                            </span>
<span class="co">#&gt;   &lt;chr&gt;                 &lt;expr&gt;                                             </span>
<span class="co">#&gt; 1 summ_regression1_sma… suppressWarnings(summary(regression1_small$residua…</span>
<span class="co">#&gt; 2 summ_regression1_lar… suppressWarnings(summary(regression1_large$residua…</span>
<span class="co">#&gt; 3 summ_regression2_sma… suppressWarnings(summary(regression2_small$residua…</span>
<span class="co">#&gt; 4 summ_regression2_lar… suppressWarnings(summary(regression2_large$residua…</span>
<span class="co">#&gt; 5 coef_regression1_sma… suppressWarnings(summary(regression1_small))$coeff…</span>
<span class="co">#&gt; 6 coef_regression1_lar… suppressWarnings(summary(regression1_large))$coeff…</span>
<span class="co">#&gt; 7 coef_regression2_sma… suppressWarnings(summary(regression2_small))$coeff…</span>
<span class="co">#&gt; 8 coef_regression2_lar… suppressWarnings(summary(regression2_large))$coeff…</span></code></pre>
<p>For your <code>knitr</code> reports, use <code>knitr_in()</code> in your commands so that <code>report.Rmd</code> is a dependency and targets loaded with <code>loadd()</code> and <code>readd()</code> in active code chunks are also dependencies. Use <code>file_out()</code> to tell <code>drake</code> that the target is a file output.</p>
<pre class="sourceCode r"><code class="sourceCode r">report &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(
  <span class="dt">report =</span> <span class="kw">knit</span>(<span class="kw">knitr_in</span>(<span class="st">&quot;report.Rmd&quot;</span>), <span class="kw">file_out</span>(<span class="st">&quot;report.md&quot;</span>), <span class="dt">quiet =</span> <span class="ot">TRUE</span>)
)
report
<span class="co">#&gt; # A tibble: 1 x 2</span>
<span class="co">#&gt;   target command                                                          </span>
<span class="co">#&gt;   &lt;chr&gt;  &lt;expr&gt;                                                           </span>
<span class="co">#&gt; 1 report knit(knitr_in(&quot;report.Rmd&quot;), file_out(&quot;report.md&quot;), quiet = TRUE)</span></code></pre>
<p>Finally, consolidate your workflow using <code>rbind()</code>. Row order does not matter.</p>
<pre class="sourceCode r"><code class="sourceCode r">my_plan &lt;-<span class="st"> </span><span class="kw">rbind</span>(report, my_datasets, my_analyses, my_summaries)
my_plan
<span class="co">#&gt; # A tibble: 15 x 2</span>
<span class="co">#&gt;    target              command                                             </span>
<span class="co">#&gt;    &lt;chr&gt;               &lt;expr&gt;                                              </span>
<span class="co">#&gt;  1 report              knit(knitr_in(&quot;report.Rmd&quot;), file_out(&quot;report.md&quot;),…</span>
<span class="co">#&gt;  2 small               simulate(48)                                       …</span>
<span class="co">#&gt;  3 large               simulate(64)                                       …</span>
<span class="co">#&gt;  4 regression1_small   reg1(small)                                        …</span>
<span class="co">#&gt;  5 regression1_large   reg1(large)                                        …</span>
<span class="co">#&gt;  6 regression2_small   reg2(small)                                        …</span>
<span class="co">#&gt;  7 regression2_large   reg2(large)                                        …</span>
<span class="co">#&gt;  8 summ_regression1_s… suppressWarnings(summary(regression1_small$residual…</span>
<span class="co">#&gt;  9 summ_regression1_l… suppressWarnings(summary(regression1_large$residual…</span>
<span class="co">#&gt; 10 summ_regression2_s… suppressWarnings(summary(regression2_small$residual…</span>
<span class="co">#&gt; 11 summ_regression2_l… suppressWarnings(summary(regression2_large$residual…</span>
<span class="co">#&gt; 12 coef_regression1_s… suppressWarnings(summary(regression1_small))$coeffi…</span>
<span class="co">#&gt; 13 coef_regression1_l… suppressWarnings(summary(regression1_large))$coeffi…</span>
<span class="co">#&gt; 14 coef_regression2_s… suppressWarnings(summary(regression2_small))$coeffi…</span>
<span class="co">#&gt; 15 coef_regression2_l… suppressWarnings(summary(regression2_large))$coeffi…</span></code></pre>
</div>
</div>
<div id="run-the-workflow" class="section level2">
<h2><span class="header-section-number">7.7</span> Run the workflow</h2>
<p>You may want to check for outdated or missing targets/imports first.</p>
<pre class="sourceCode r"><code class="sourceCode r">config &lt;-<span class="st"> </span><span class="kw">drake_config</span>(my_plan, <span class="dt">verbose =</span> 0L)
<span class="kw">outdated</span>(config) <span class="co"># Targets that need to be (re)built.</span>
<span class="co">#&gt;  [1] &quot;coef_regression1_large&quot; &quot;coef_regression1_small&quot;</span>
<span class="co">#&gt;  [3] &quot;coef_regression2_large&quot; &quot;coef_regression2_small&quot;</span>
<span class="co">#&gt;  [5] &quot;large&quot;                  &quot;regression1_large&quot;     </span>
<span class="co">#&gt;  [7] &quot;regression1_small&quot;      &quot;regression2_large&quot;     </span>
<span class="co">#&gt;  [9] &quot;regression2_small&quot;      &quot;report&quot;                </span>
<span class="co">#&gt; [11] &quot;small&quot;                  &quot;summ_regression1_large&quot;</span>
<span class="co">#&gt; [13] &quot;summ_regression1_small&quot; &quot;summ_regression2_large&quot;</span>
<span class="co">#&gt; [15] &quot;summ_regression2_small&quot;</span>

<span class="kw">missed</span>(config) <span class="co"># Checks your workspace.</span>
<span class="co">#&gt; character(0)</span></code></pre>
<p>Then just <code>make(my_plan)</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">make</span>(my_plan)
<span class="co">#&gt; target large</span>
<span class="co">#&gt; target small</span>
<span class="co">#&gt; target regression1_large</span>
<span class="co">#&gt; target regression2_large</span>
<span class="co">#&gt; target regression1_small</span>
<span class="co">#&gt; target regression2_small</span>
<span class="co">#&gt; target summ_regression1_large</span>
<span class="co">#&gt; target coef_regression1_large</span>
<span class="co">#&gt; target summ_regression2_large</span>
<span class="co">#&gt; target coef_regression2_large</span>
<span class="co">#&gt; target summ_regression1_small</span>
<span class="co">#&gt; target coef_regression1_small</span>
<span class="co">#&gt; target coef_regression2_small</span>
<span class="co">#&gt; target summ_regression2_small</span>
<span class="co">#&gt; target report</span></code></pre>
<p>For the <code>reg2()</code> model on the small dataset, the p-value on <code>x2</code> is so small that there may be an association between weight and fuel efficiency after all.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">readd</span>(coef_regression2_small)
<span class="co">#&gt;               Estimate Std. Error   t value     Pr(&gt;|t|)</span>
<span class="co">#&gt; (Intercept) 27.8369441 1.07966324 25.782988 5.443436e-29</span>
<span class="co">#&gt; x2          -0.6359335 0.07138918 -8.907981 1.408597e-11</span></code></pre>
<p>The non-file dependencies of your last target are already loaded in your workspace.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ls</span>()
<span class="co">#&gt;  [1] &quot;as_chr&quot;          &quot;bad_config&quot;      &quot;bad_plan&quot;       </span>
<span class="co">#&gt;  [4] &quot;col&quot;             &quot;combos&quot;          &quot;config&quot;         </span>
<span class="co">#&gt;  [7] &quot;config1&quot;         &quot;config2&quot;         &quot;create_plot&quot;    </span>
<span class="co">#&gt; [10] &quot;get_logs&quot;        &quot;get_rmspe&quot;       &quot;good_config&quot;    </span>
<span class="co">#&gt; [13] &quot;good_plan&quot;       &quot;hist&quot;            &quot;latest_log_date&quot;</span>
<span class="co">#&gt; [16] &quot;lots_of_sds&quot;     &quot;make_my_plot&quot;    &quot;make_my_table&quot;  </span>
<span class="co">#&gt; [19] &quot;methods&quot;         &quot;my_analyses&quot;     &quot;my_datasets&quot;    </span>
<span class="co">#&gt; [22] &quot;my_grid&quot;         &quot;my_plan&quot;         &quot;my_summaries&quot;   </span>
<span class="co">#&gt; [25] &quot;plan&quot;            &quot;plan1&quot;           &quot;plan2&quot;          </span>
<span class="co">#&gt; [28] &quot;plot_rmspe&quot;      &quot;predictors&quot;      &quot;Produc&quot;         </span>
<span class="co">#&gt; [31] &quot;random_rows&quot;     &quot;reg1&quot;            &quot;reg2&quot;           </span>
<span class="co">#&gt; [34] &quot;results&quot;         &quot;simulate&quot;        &quot;small_config&quot;   </span>
<span class="co">#&gt; [37] &quot;small_plan&quot;      &quot;summary_types&quot;   &quot;tmp&quot;            </span>
<span class="co">#&gt; [40] &quot;url&quot;             &quot;vals&quot;            &quot;y_vals&quot;</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">outdated</span>(config) <span class="co"># Everything is up to date.</span>
<span class="co">#&gt; character(0)</span>

<span class="kw">build_times</span>(<span class="dt">digits =</span> <span class="dv">4</span>) <span class="co"># How long did it take to make each target?</span>
<span class="co">#&gt; # A tibble: 15 x 4</span>
<span class="co">#&gt;    target                 elapsed        user           system        </span>
<span class="co">#&gt;    &lt;chr&gt;                  &lt;S4: Duration&gt; &lt;S4: Duration&gt; &lt;S4: Duration&gt;</span>
<span class="co">#&gt;  1 coef_regression1_large 0.004s         0.004s         0s            </span>
<span class="co">#&gt;  2 coef_regression1_small 0.003s         0s             0s            </span>
<span class="co">#&gt;  3 coef_regression2_large 0.003s         0.004s         0s            </span>
<span class="co">#&gt;  4 coef_regression2_small 0.004s         0s             0s            </span>
<span class="co">#&gt;  5 large                  0.005s         0.004s         0s            </span>
<span class="co">#&gt;  6 regression1_large      0.005s         0.004s         0s            </span>
<span class="co">#&gt;  7 regression1_small      0.007s         0.004s         0s            </span>
<span class="co">#&gt;  8 regression2_large      0.004s         0.004s         0s            </span>
<span class="co">#&gt;  9 regression2_small      0.008s         0.008s         0s            </span>
<span class="co">#&gt; 10 report                 0.055s         0.052s         0s            </span>
<span class="co">#&gt; 11 small                  0.011s         0.008s         0s            </span>
<span class="co">#&gt; 12 summ_regression1_large 0.004s         0.004s         0s            </span>
<span class="co">#&gt; 13 summ_regression1_small 0.003s         0.004s         0s            </span>
<span class="co">#&gt; 14 summ_regression2_large 0.004s         0.004s         0s            </span>
<span class="co">#&gt; 15 summ_regression2_small 0.003s         0.004s         0s</span></code></pre>
<p>See also <code>predict_runtime()</code> and <code>rate_limiting_times()</code>.</p>
<p>In the new graph, the black nodes from before are now green.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Hover, click, drag, zoom, and explore.</span>
<span class="kw">vis_drake_graph</span>(config, <span class="dt">width =</span> <span class="st">&quot;100%&quot;</span>, <span class="dt">height =</span> <span class="st">&quot;500px&quot;</span>)</code></pre>
<div id="htmlwidget-e3d93e3147390cf9f7b2" style="width:100%;height:500px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-e3d93e3147390cf9f7b2">{"x":{"nodes":{"id":["random_rows","n-MRQXIYLTMV2HGOR2NV2GGYLSOM","reg1","reg2","p-OJSXA33SOQXFE3LE","simulate","large","small","regression1_large","regression2_large","regression1_small","regression2_small","summ_regression1_large","coef_regression1_large","summ_regression2_large","coef_regression2_large","summ_regression1_small","coef_regression1_small","coef_regression2_small","summ_regression2_small","report","p-OJSXA33SOQXG2ZA"],"imported":[true,true,true,true,true,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],"label":["random_rows","datasets::mtcars","reg1","reg2","file report.Rmd","simulate","large\n0.005s","small\n0.011s","regression1_large\n0.005s","regression2_large\n0.004s","regression1_small\n0.007s","regression2_small\n0.008s","summ_regression1_large\n0.004s","coef_regression1_large\n0.004s","summ_regression2_large\n0.004s","coef_regression2_large\n0.003s","summ_regression1_small\n0.003s","coef_regression1_small\n0.003s","coef_regression2_small\n0.004s","summ_regression2_small\n0.003s","report\n0.055s","file report.md"],"status":["imported","imported","imported","imported","imported","imported","up to date","up to date","up to date","up to date","up to date","up to date","up to date","up to date","up to date","up to date","up to date","up to date","up to date","up to date","up to date","up to date"],"type":["function","object","function","function","file","function","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","file"],"font.size":[20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20],"color":["#1874CD","#1874CD","#1874CD","#1874CD","#1874CD","#1874CD","#228B22","#228B22","#228B22","#228B22","#228B22","#228B22","#228B22","#228B22","#228B22","#228B22","#228B22","#228B22","#228B22","#228B22","#228B22","#228B22"],"shape":["triangle","dot","triangle","triangle","square","triangle","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","square"],"level":[1,1,1,1,1,2,3,3,4,4,4,4,5,5,5,5,5,5,5,5,6,7],"x":[-1,-1,-1,-1,-1,-0.666666666666667,-0.333333333333333,-0.333333333333333,0,0,0,0,0.333333333333333,0.333333333333333,0.333333333333333,0.333333333333333,0.333333333333333,0.333333333333333,0.333333333333333,0.333333333333333,0.666666666666667,1],"y":[-0.857142857142857,-0.428571428571428,2.22044604925031e-16,0.428571428571429,0.857142857142857,2.22044604925031e-16,-0.428571428571428,0.428571428571429,-0.771428571428571,-0.257142857142857,0.257142857142858,0.771428571428572,-1,-0.714285714285714,-0.428571428571428,-0.142857142857143,0.142857142857143,0.428571428571429,0.714285714285714,1,2.22044604925031e-16,2.22044604925031e-16]},"edges":{"from":["random_rows","n-MRQXIYLTMV2HGOR2NV2GGYLSOM","reg1","reg1","reg2","reg2","large","large","large","small","small","small","coef_regression2_small","p-OJSXA33SOQXFE3LE","report","simulate","simulate","regression1_small","regression1_small","regression1_large","regression1_large","regression2_small","regression2_small","regression2_large","regression2_large"],"to":["simulate","simulate","regression1_small","regression1_large","regression2_small","regression2_large","report","regression1_large","regression2_large","report","regression1_small","regression2_small","report","report","p-OJSXA33SOQXG2ZA","large","small","summ_regression1_small","coef_regression1_small","summ_regression1_large","coef_regression1_large","coef_regression2_small","summ_regression2_small","summ_regression2_large","coef_regression2_large"],"arrows":["to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"edges":{"smooth":false},"physics":{"stabilization":false},"interaction":{"navigationButtons":true}},"groups":null,"width":"100%","height":"500px","idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)"},"main":{"text":"Dependency graph","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":false,"hoverNearest":false,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Up to date","Imported","Object","Function","File"],"color":["#228B22","#1874CD","#888888","#888888","#888888"],"shape":["dot","dot","dot","triangle","square"],"font.color":["black","black","black","black","black"],"font.size":[20,20,20,20,20],"id":[1,5,7,8,9]},"nodesToDataframe":true},"igraphlayout":{"type":"square"},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script>
<p>Optionally, get <a href="http://datastorm-open.github.io/visNetwork/">visNetwork</a> nodes and edges so you can make your own plot with <code>visNetwork()</code> or <code>render_drake_graph()</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">drake_graph_info</span>(config)</code></pre>
<p>Use <code>readd()</code> and <code>loadd()</code> to load targets into your workspace. (They are cached in the hidden <code>.drake/</code> folder using <a href="https://CRAN.R-project.org/package=storr">storr</a>). There are many more functions for interacting with the cache.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">readd</span>(coef_regression2_large)
<span class="co">#&gt;               Estimate Std. Error   t value     Pr(&gt;|t|)</span>
<span class="co">#&gt; (Intercept) 27.7764504 0.85871209  32.34664 1.569624e-40</span>
<span class="co">#&gt; x2          -0.7056179 0.06942808 -10.16329 7.950479e-15</span>

<span class="kw">loadd</span>(small)

<span class="kw">head</span>(small)
<span class="co">#&gt;       x    y</span>
<span class="co">#&gt; 1 5.424 10.4</span>
<span class="co">#&gt; 2 3.440 17.8</span>
<span class="co">#&gt; 3 3.440 19.2</span>
<span class="co">#&gt; 4 3.170 15.8</span>
<span class="co">#&gt; 5 3.730 17.3</span>
<span class="co">#&gt; 6 3.845 19.2</span>

<span class="kw">rm</span>(small)

<span class="kw">cached</span>()
<span class="co">#&gt;  [1] &quot;coef_regression1_large&quot; &quot;coef_regression1_small&quot;</span>
<span class="co">#&gt;  [3] &quot;coef_regression2_large&quot; &quot;coef_regression2_small&quot;</span>
<span class="co">#&gt;  [5] &quot;large&quot;                  &quot;regression1_large&quot;     </span>
<span class="co">#&gt;  [7] &quot;regression1_small&quot;      &quot;regression2_large&quot;     </span>
<span class="co">#&gt;  [9] &quot;regression2_small&quot;      &quot;report&quot;                </span>
<span class="co">#&gt; [11] &quot;small&quot;                  &quot;summ_regression1_large&quot;</span>
<span class="co">#&gt; [13] &quot;summ_regression1_small&quot; &quot;summ_regression2_large&quot;</span>
<span class="co">#&gt; [15] &quot;summ_regression2_small&quot;</span>

drake<span class="op">::</span><span class="kw">progress</span>()
<span class="co">#&gt; # A tibble: 15 x 2</span>
<span class="co">#&gt;    target                 progress</span>
<span class="co">#&gt;    &lt;chr&gt;                  &lt;chr&gt;   </span>
<span class="co">#&gt;  1 coef_regression1_large done    </span>
<span class="co">#&gt;  2 coef_regression1_small done    </span>
<span class="co">#&gt;  3 coef_regression2_large done    </span>
<span class="co">#&gt;  4 coef_regression2_small done    </span>
<span class="co">#&gt;  5 large                  done    </span>
<span class="co">#&gt;  6 regression1_large      done    </span>
<span class="co">#&gt;  7 regression1_small      done    </span>
<span class="co">#&gt;  8 regression2_large      done    </span>
<span class="co">#&gt;  9 regression2_small      done    </span>
<span class="co">#&gt; 10 report                 done    </span>
<span class="co">#&gt; 11 small                  done    </span>
<span class="co">#&gt; 12 summ_regression1_large done    </span>
<span class="co">#&gt; 13 summ_regression1_small done    </span>
<span class="co">#&gt; 14 summ_regression2_large done    </span>
<span class="co">#&gt; 15 summ_regression2_small done</span></code></pre>
<p>The next time you run <code>make(my_plan)</code>, nothing will build because <code>drake</code> knows everything is already up to date.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">make</span>(my_plan)
<span class="co">#&gt; All targets are already up to date.</span></code></pre>
<p>But if you change one of your functions, commands, or other dependencies, drake will update the affected targets. Suppose we change the quadratic term to a cubic term in <code>reg2()</code>. We might want to do this if we suspect a cubic relationship between tons and miles per gallon.</p>
<pre class="sourceCode r"><code class="sourceCode r">reg2 &lt;-<span class="st"> </span><span class="cf">function</span>(d) {
  d<span class="op">$</span>x3 &lt;-<span class="st"> </span>d<span class="op">$</span>x <span class="op">^</span><span class="st"> </span><span class="dv">3</span>
  <span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x3, <span class="dt">data =</span> d)
}</code></pre>
<p>The targets that depend on <code>reg2()</code> need to be rebuilt.</p>
<pre class="sourceCode r"><code class="sourceCode r">config &lt;-<span class="st"> </span><span class="kw">drake_config</span>(my_plan)
<span class="kw">outdated</span>(config)
<span class="co">#&gt; [1] &quot;coef_regression2_large&quot; &quot;coef_regression2_small&quot;</span>
<span class="co">#&gt; [3] &quot;regression2_large&quot;      &quot;regression2_small&quot;     </span>
<span class="co">#&gt; [5] &quot;report&quot;                 &quot;summ_regression2_large&quot;</span>
<span class="co">#&gt; [7] &quot;summ_regression2_small&quot;</span></code></pre>
<p><strong>Advanced</strong>: To get a rough idea of why a target is out of date, you can use <code>dependency_profile()</code>. It will tell you if any of the following changed since the last <code>make()</code>:</p>
<ul>
<li>The command in the <code>drake</code> plan.</li>
<li>At least one non-file dependency. (For this, the imports have to be up to date and cached, either with <code>make()</code>, <code>make(skip_targets = TRUE)</code>, <code>outdated()</code>, or similar.)</li>
<li>At least one input file declared with <code>file_in()</code> or <code>knitr_in()</code>.</li>
<li>At least one output file declared with <code>file_out()</code>.</li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dependency_profile</span>(<span class="dt">target =</span> regression2_small, <span class="dt">config =</span> config)
<span class="co">#&gt; Warning: dependency_profile() in drake is deprecated. Use deps_profile()</span>
<span class="co">#&gt; instead.</span>
<span class="co">#&gt; # A tibble: 4 x 4</span>
<span class="co">#&gt;   hash     changed old_hash         new_hash        </span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;lgl&gt;   &lt;chr&gt;            &lt;chr&gt;           </span>
<span class="co">#&gt; 1 command  FALSE   39e1321ff2265cac 39e1321ff2265cac</span>
<span class="co">#&gt; 2 depend   TRUE    ab16d2a0b3c4d844 4d6e115872246cea</span>
<span class="co">#&gt; 3 file_in  FALSE   &quot;&quot;               &quot;&quot;              </span>
<span class="co">#&gt; 4 file_out FALSE   &quot;&quot;               &quot;&quot;</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Hover, click, drag, zoom, and explore.</span>
<span class="kw">vis_drake_graph</span>(config, <span class="dt">width =</span> <span class="st">&quot;100%&quot;</span>, <span class="dt">height =</span> <span class="st">&quot;500px&quot;</span>)</code></pre>
<div id="htmlwidget-ff72399370c1bb4b860b" style="width:100%;height:500px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-ff72399370c1bb4b860b">{"x":{"nodes":{"id":["random_rows","n-MRQXIYLTMV2HGOR2NV2GGYLSOM","reg1","reg2","p-OJSXA33SOQXFE3LE","simulate","large","small","regression1_large","regression2_large","regression1_small","regression2_small","summ_regression1_large","coef_regression1_large","summ_regression2_large","coef_regression2_large","summ_regression1_small","coef_regression1_small","coef_regression2_small","summ_regression2_small","report","p-OJSXA33SOQXG2ZA"],"imported":[true,true,true,true,true,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],"label":["random_rows","datasets::mtcars","reg1","reg2","file report.Rmd","simulate","large\n0.005s","small\n0.011s","regression1_large\n0.005s","regression2_large\n0.004s","regression1_small\n0.007s","regression2_small\n0.008s","summ_regression1_large\n0.004s","coef_regression1_large\n0.004s","summ_regression2_large\n0.004s","coef_regression2_large\n0.003s","summ_regression1_small\n0.003s","coef_regression1_small\n0.003s","coef_regression2_small\n0.004s","summ_regression2_small\n0.003s","report\n0.055s","file report.md"],"status":["imported","imported","imported","imported","imported","imported","up to date","up to date","up to date","outdated","up to date","outdated","up to date","up to date","outdated","outdated","up to date","up to date","outdated","outdated","outdated","outdated"],"type":["function","object","function","function","file","function","object","object","object","object","object","object","object","object","object","object","object","object","object","object","object","file"],"font.size":[20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20],"color":["#1874CD","#1874CD","#1874CD","#1874CD","#1874CD","#1874CD","#228B22","#228B22","#228B22","#000000","#228B22","#000000","#228B22","#228B22","#000000","#000000","#228B22","#228B22","#000000","#000000","#000000","#000000"],"shape":["triangle","dot","triangle","triangle","square","triangle","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","square"],"level":[1,1,1,1,1,2,3,3,4,4,4,4,5,5,5,5,5,5,5,5,6,7],"x":[-1,-1,-1,-1,-1,-0.666666666666667,-0.333333333333333,-0.333333333333333,0,0,0,0,0.333333333333333,0.333333333333333,0.333333333333333,0.333333333333333,0.333333333333333,0.333333333333333,0.333333333333333,0.333333333333333,0.666666666666667,1],"y":[-0.857142857142857,-0.428571428571428,2.22044604925031e-16,0.428571428571429,0.857142857142857,2.22044604925031e-16,-0.428571428571428,0.428571428571429,-0.771428571428571,-0.257142857142857,0.257142857142858,0.771428571428572,-1,-0.714285714285714,-0.428571428571428,-0.142857142857143,0.142857142857143,0.428571428571429,0.714285714285714,1,2.22044604925031e-16,2.22044604925031e-16]},"edges":{"from":["random_rows","n-MRQXIYLTMV2HGOR2NV2GGYLSOM","reg1","reg1","reg2","reg2","large","large","large","small","small","small","coef_regression2_small","p-OJSXA33SOQXFE3LE","report","simulate","simulate","regression1_small","regression1_small","regression1_large","regression1_large","regression2_small","regression2_small","regression2_large","regression2_large"],"to":["simulate","simulate","regression1_small","regression1_large","regression2_small","regression2_large","report","regression1_large","regression2_large","report","regression1_small","regression2_small","report","report","p-OJSXA33SOQXG2ZA","large","small","summ_regression1_small","coef_regression1_small","summ_regression1_large","coef_regression1_large","coef_regression2_small","summ_regression2_small","summ_regression2_large","coef_regression2_large"],"arrows":["to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"edges":{"smooth":false},"physics":{"stabilization":false},"interaction":{"navigationButtons":true}},"groups":null,"width":"100%","height":"500px","idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)"},"main":{"text":"Dependency graph","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":false,"hoverNearest":false,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Up to date","Outdated","Imported","Object","Function","File"],"color":["#228B22","#000000","#1874CD","#888888","#888888","#888888"],"shape":["dot","dot","dot","dot","triangle","square"],"font.color":["black","black","black","black","black","black"],"font.size":[20,20,20,20,20,20],"id":[1,2,5,7,8,9]},"nodesToDataframe":true},"igraphlayout":{"type":"square"},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script>
<p>The next <code>make()</code> will rebuild the targets depending on <code>reg2()</code> and leave everything else alone.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">make</span>(my_plan)
<span class="co">#&gt; target regression2_small</span>
<span class="co">#&gt; target regression2_large</span>
<span class="co">#&gt; target coef_regression2_small</span>
<span class="co">#&gt; target summ_regression2_small</span>
<span class="co">#&gt; target summ_regression2_large</span>
<span class="co">#&gt; target coef_regression2_large</span>
<span class="co">#&gt; target report</span></code></pre>
<p>Trivial changes to whitespace and comments are totally ignored.</p>
<pre class="sourceCode r"><code class="sourceCode r">reg2 &lt;-<span class="st"> </span><span class="cf">function</span>(d) {
  d<span class="op">$</span>x3 &lt;-<span class="st"> </span>d<span class="op">$</span>x <span class="op">^</span><span class="st"> </span><span class="dv">3</span>
    <span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x3, <span class="dt">data =</span> d) <span class="co"># I indented here.</span>
}
<span class="kw">outdated</span>(config) <span class="co"># Everything is up to date.</span>
<span class="co">#&gt; character(0)</span></code></pre>
<p>drake cares about nested functions too: nontrivial changes to <code>random_rows()</code> will propagate to <code>simulate()</code> and all the downstream targets.</p>
<pre class="sourceCode r"><code class="sourceCode r">random_rows &lt;-<span class="st"> </span><span class="cf">function</span>(data, n){
  n &lt;-<span class="st"> </span>n <span class="op">+</span><span class="st"> </span><span class="dv">1</span>
  data[<span class="kw">sample.int</span>(<span class="dt">n =</span> <span class="kw">nrow</span>(data), <span class="dt">size =</span> n, <span class="dt">replace =</span> <span class="ot">TRUE</span>), ]
}

<span class="kw">outdated</span>(config)
<span class="co">#&gt;  [1] &quot;coef_regression1_large&quot; &quot;coef_regression1_small&quot;</span>
<span class="co">#&gt;  [3] &quot;coef_regression2_large&quot; &quot;coef_regression2_small&quot;</span>
<span class="co">#&gt;  [5] &quot;large&quot;                  &quot;regression1_large&quot;     </span>
<span class="co">#&gt;  [7] &quot;regression1_small&quot;      &quot;regression2_large&quot;     </span>
<span class="co">#&gt;  [9] &quot;regression2_small&quot;      &quot;report&quot;                </span>
<span class="co">#&gt; [11] &quot;small&quot;                  &quot;summ_regression1_large&quot;</span>
<span class="co">#&gt; [13] &quot;summ_regression1_small&quot; &quot;summ_regression2_large&quot;</span>
<span class="co">#&gt; [15] &quot;summ_regression2_small&quot;</span>

<span class="kw">make</span>(my_plan)
<span class="co">#&gt; target large</span>
<span class="co">#&gt; target small</span>
<span class="co">#&gt; target regression1_large</span>
<span class="co">#&gt; target regression2_large</span>
<span class="co">#&gt; target regression1_small</span>
<span class="co">#&gt; target regression2_small</span>
<span class="co">#&gt; target summ_regression1_large</span>
<span class="co">#&gt; target coef_regression1_large</span>
<span class="co">#&gt; target summ_regression2_large</span>
<span class="co">#&gt; target coef_regression2_large</span>
<span class="co">#&gt; target summ_regression1_small</span>
<span class="co">#&gt; target coef_regression1_small</span>
<span class="co">#&gt; target coef_regression2_small</span>
<span class="co">#&gt; target summ_regression2_small</span>
<span class="co">#&gt; target report</span></code></pre>
<p>Need to add new work on the fly? Just append rows to the <code>drake</code> plan. If the rest of your workflow is up to date, only the new work is run.</p>
<pre class="sourceCode r"><code class="sourceCode r">new_simulation &lt;-<span class="st"> </span><span class="cf">function</span>(n){
  <span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="kw">rnorm</span>(n), <span class="dt">y =</span> <span class="kw">rnorm</span>(n))
}

additions &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(
  <span class="dt">new_data =</span> <span class="kw">new_simulation</span>(<span class="dv">36</span>) <span class="op">+</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">10</span>))
additions
<span class="co">#&gt; # A tibble: 1 x 2</span>
<span class="co">#&gt;   target   command                      </span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;expr&gt;                       </span>
<span class="co">#&gt; 1 new_data new_simulation(36) + sqrt(10)</span>

my_plan &lt;-<span class="st"> </span><span class="kw">rbind</span>(my_plan, additions)
my_plan
<span class="co">#&gt; # A tibble: 16 x 2</span>
<span class="co">#&gt;    target              command                                             </span>
<span class="co">#&gt;    &lt;chr&gt;               &lt;expr&gt;                                              </span>
<span class="co">#&gt;  1 report              knit(knitr_in(&quot;report.Rmd&quot;), file_out(&quot;report.md&quot;),…</span>
<span class="co">#&gt;  2 small               simulate(48)                                       …</span>
<span class="co">#&gt;  3 large               simulate(64)                                       …</span>
<span class="co">#&gt;  4 regression1_small   reg1(small)                                        …</span>
<span class="co">#&gt;  5 regression1_large   reg1(large)                                        …</span>
<span class="co">#&gt;  6 regression2_small   reg2(small)                                        …</span>
<span class="co">#&gt;  7 regression2_large   reg2(large)                                        …</span>
<span class="co">#&gt;  8 summ_regression1_s… suppressWarnings(summary(regression1_small$residual…</span>
<span class="co">#&gt;  9 summ_regression1_l… suppressWarnings(summary(regression1_large$residual…</span>
<span class="co">#&gt; 10 summ_regression2_s… suppressWarnings(summary(regression2_small$residual…</span>
<span class="co">#&gt; 11 summ_regression2_l… suppressWarnings(summary(regression2_large$residual…</span>
<span class="co">#&gt; 12 coef_regression1_s… suppressWarnings(summary(regression1_small))$coeffi…</span>
<span class="co">#&gt; 13 coef_regression1_l… suppressWarnings(summary(regression1_large))$coeffi…</span>
<span class="co">#&gt; 14 coef_regression2_s… suppressWarnings(summary(regression2_small))$coeffi…</span>
<span class="co">#&gt; 15 coef_regression2_l… suppressWarnings(summary(regression2_large))$coeffi…</span>
<span class="co">#&gt; 16 new_data            new_simulation(36) + sqrt(10)                      …</span>

<span class="kw">make</span>(my_plan)
<span class="co">#&gt; target new_data</span></code></pre>
<p>If you ever need to erase your work, use <code>clean()</code>. The next <code>make()</code> will rebuild any cleaned targets, so be careful. You may notice that by default, the size of the cache does not go down very much. To purge old data, you could use <code>clean(garbage_collection = TRUE, purge = TRUE)</code>. To do garbage collection without removing any important targets, use <code>drake_gc()</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Uncaches individual targets and imported objects.</span>
<span class="kw">clean</span>(small, reg1, <span class="dt">verbose =</span> 0L)
<span class="kw">clean</span>(<span class="dt">verbose =</span> 0L) <span class="co"># Cleans all targets out of the cache.</span>
<span class="kw">drake_gc</span>(<span class="dt">verbose =</span> 0L) <span class="co"># Just garbage collection.</span>
<span class="kw">clean</span>(<span class="dt">destroy =</span> <span class="ot">TRUE</span>, <span class="dt">verbose =</span> 0L) <span class="co"># removes the cache entirely</span></code></pre>

</div>
</div>



</div>
<div style = "background: #1C356D; color: white; padding: 10px 10px 10px 25px; font-size: 1em; width: 100%;">
  Copyright Eli Lilly and Company
</div>
            </section>

          </div>
        </div>
      </div>
<a href="gsp.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="visuals.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ropenscilabs/drake-manual/edit/master/mtcars.Rmd",
"text": "Edit this chapter"
},
"history": {
"link": "https://github.com/ropenscilabs/drake-manual/commits/master/mtcars.Rmd",
"text": "Chapter edit history"
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
