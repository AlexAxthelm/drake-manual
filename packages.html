<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>The drake R Package User Manual</title>
  <meta name="description" content="The drake R Package User Manual">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="The drake R Package User Manual" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="The drake R Package User Manual" />
  
  
  

<meta name="author" content="Will Landau, Kirill Müller, Alex Axthelm, Jasper Clarkberg, Lorenz Walthert">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="main.html">
<link rel="next" href="gsp.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.2/htmlwidgets.js"></script>
<link href="libs/vis-4.20.1/vis.css" rel="stylesheet" />
<script src="libs/vis-4.20.1/vis.min.js"></script>
<script src="libs/visNetwork-binding-2.0.4/visNetwork.js"></script>
<script src="libs/d3-4.5.0/d3.min.js"></script>
<script src="libs/sankey-1/sankey.js"></script>
<script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#the-drake-r-package"><i class="fa fa-check"></i><b>1.1</b> The drake R package</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#installation"><i class="fa fa-check"></i><b>1.2</b> Installation</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#why-drake"><i class="fa fa-check"></i><b>1.3</b> Why drake?</a><ul>
<li class="chapter" data-level="1.3.1" data-path="index.html"><a href="index.html#what-gets-done-stays-done."><i class="fa fa-check"></i><b>1.3.1</b> What gets done stays done.</a></li>
<li class="chapter" data-level="1.3.2" data-path="index.html"><a href="index.html#reproducibility-with-confidence"><i class="fa fa-check"></i><b>1.3.2</b> Reproducibility with confidence</a></li>
<li class="chapter" data-level="1.3.3" data-path="index.html"><a href="index.html#aggressively-scale-up."><i class="fa fa-check"></i><b>1.3.3</b> Aggressively scale up.</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#documentation"><i class="fa fa-check"></i><b>1.4</b> Documentation</a><ul>
<li class="chapter" data-level="1.4.1" data-path="index.html"><a href="index.html#cheat-sheet"><i class="fa fa-check"></i><b>1.4.1</b> Cheat sheet</a></li>
<li class="chapter" data-level="1.4.2" data-path="index.html"><a href="index.html#frequently-asked-questions"><i class="fa fa-check"></i><b>1.4.2</b> Frequently asked questions</a></li>
<li class="chapter" data-level="1.4.3" data-path="index.html"><a href="index.html#function-reference"><i class="fa fa-check"></i><b>1.4.3</b> Function reference</a></li>
<li class="chapter" data-level="1.4.4" data-path="index.html"><a href="index.html#tutorials"><i class="fa fa-check"></i><b>1.4.4</b> Tutorials</a></li>
<li class="chapter" data-level="1.4.5" data-path="index.html"><a href="index.html#examples"><i class="fa fa-check"></i><b>1.4.5</b> Examples</a></li>
<li class="chapter" data-level="1.4.6" data-path="index.html"><a href="index.html#presentations"><i class="fa fa-check"></i><b>1.4.6</b> Presentations</a></li>
<li class="chapter" data-level="1.4.7" data-path="index.html"><a href="index.html#real-example-projects"><i class="fa fa-check"></i><b>1.4.7</b> Real example projects</a></li>
<li class="chapter" data-level="1.4.8" data-path="index.html"><a href="index.html#context-and-history"><i class="fa fa-check"></i><b>1.4.8</b> Context and history</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#help-and-troubleshooting"><i class="fa fa-check"></i><b>1.5</b> Help and troubleshooting</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#similar-work"><i class="fa fa-check"></i><b>1.6</b> Similar work</a><ul>
<li class="chapter" data-level="1.6.1" data-path="index.html"><a href="index.html#gnu-make"><i class="fa fa-check"></i><b>1.6.1</b> GNU Make</a></li>
<li class="chapter" data-level="1.6.2" data-path="index.html"><a href="index.html#remake"><i class="fa fa-check"></i><b>1.6.2</b> Remake</a></li>
<li class="chapter" data-level="1.6.3" data-path="index.html"><a href="index.html#memoise"><i class="fa fa-check"></i><b>1.6.3</b> Memoise</a></li>
<li class="chapter" data-level="1.6.4" data-path="index.html"><a href="index.html#knitr-and-r-markdown"><i class="fa fa-check"></i><b>1.6.4</b> Knitr and R Markdown</a></li>
<li class="chapter" data-level="1.6.5" data-path="index.html"><a href="index.html#factuals-drake"><i class="fa fa-check"></i><b>1.6.5</b> Factual’s Drake</a></li>
<li class="chapter" data-level="1.6.6" data-path="index.html"><a href="index.html#other-pipeline-toolkits"><i class="fa fa-check"></i><b>1.6.6</b> Other pipeline toolkits</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i><b>1.7</b> Acknowledgements</a></li>
</ul></li>
<li class="part"><span><b>I Examples</b></span></li>
<li class="chapter" data-level="2" data-path="main.html"><a href="main.html"><i class="fa fa-check"></i><b>2</b> The main example</a><ul>
<li class="chapter" data-level="2.1" data-path="main.html"><a href="main.html#set-the-stage."><i class="fa fa-check"></i><b>2.1</b> Set the stage.</a></li>
<li class="chapter" data-level="2.2" data-path="main.html"><a href="main.html#make-your-results."><i class="fa fa-check"></i><b>2.2</b> Make your results.</a></li>
<li class="chapter" data-level="2.3" data-path="main.html"><a href="main.html#go-back-and-fix-things."><i class="fa fa-check"></i><b>2.3</b> Go back and fix things.</a></li>
<li class="chapter" data-level="2.4" data-path="main.html"><a href="main.html#try-it-yourself"><i class="fa fa-check"></i><b>2.4</b> Try it yourself!</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="packages.html"><a href="packages.html"><i class="fa fa-check"></i><b>3</b> An analysis of R package download trends</a><ul>
<li class="chapter" data-level="3.1" data-path="packages.html"><a href="packages.html#get-the-code."><i class="fa fa-check"></i><b>3.1</b> Get the code.</a></li>
<li class="chapter" data-level="3.2" data-path="packages.html"><a href="packages.html#overview"><i class="fa fa-check"></i><b>3.2</b> Overview</a></li>
<li class="chapter" data-level="3.3" data-path="packages.html"><a href="packages.html#analysis"><i class="fa fa-check"></i><b>3.3</b> Analysis</a></li>
<li class="chapter" data-level="3.4" data-path="packages.html"><a href="packages.html#other-ways-to-trigger-downloads"><i class="fa fa-check"></i><b>3.4</b> Other ways to trigger downloads</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="gsp.html"><a href="gsp.html"><i class="fa fa-check"></i><b>4</b> Finding the best model of gross state product</a><ul>
<li class="chapter" data-level="4.1" data-path="gsp.html"><a href="gsp.html#get-the-code.-1"><i class="fa fa-check"></i><b>4.1</b> Get the code.</a></li>
<li class="chapter" data-level="4.2" data-path="gsp.html"><a href="gsp.html#objective-and-methods"><i class="fa fa-check"></i><b>4.2</b> Objective and methods</a></li>
<li class="chapter" data-level="4.3" data-path="gsp.html"><a href="gsp.html#data"><i class="fa fa-check"></i><b>4.3</b> Data</a></li>
<li class="chapter" data-level="4.4" data-path="gsp.html"><a href="gsp.html#analysis-1"><i class="fa fa-check"></i><b>4.4</b> Analysis</a></li>
<li class="chapter" data-level="4.5" data-path="gsp.html"><a href="gsp.html#results"><i class="fa fa-check"></i><b>4.5</b> Results</a></li>
<li class="chapter" data-level="4.6" data-path="gsp.html"><a href="gsp.html#comparison-with-gnu-make"><i class="fa fa-check"></i><b>4.6</b> Comparison with GNU Make</a></li>
<li class="chapter" data-level="4.7" data-path="gsp.html"><a href="gsp.html#references"><i class="fa fa-check"></i><b>4.7</b> References</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="mtcars.html"><a href="mtcars.html"><i class="fa fa-check"></i><b>5</b> The mtcars example and workflow plan generation</a><ul>
<li class="chapter" data-level="5.1" data-path="mtcars.html"><a href="mtcars.html#get-the-code.-2"><i class="fa fa-check"></i><b>5.1</b> Get the code.</a></li>
<li class="chapter" data-level="5.2" data-path="mtcars.html"><a href="mtcars.html#quick-examples"><i class="fa fa-check"></i><b>5.2</b> Quick examples</a></li>
<li class="chapter" data-level="5.3" data-path="mtcars.html"><a href="mtcars.html#the-motivation-of-the-mtcars-example"><i class="fa fa-check"></i><b>5.3</b> The motivation of the mtcars example</a></li>
<li class="chapter" data-level="5.4" data-path="mtcars.html"><a href="mtcars.html#set-up-the-mtcars-example"><i class="fa fa-check"></i><b>5.4</b> Set up the mtcars example</a></li>
<li class="chapter" data-level="5.5" data-path="mtcars.html"><a href="mtcars.html#the-workflow-plan-data-frame"><i class="fa fa-check"></i><b>5.5</b> The workflow plan data frame</a></li>
<li class="chapter" data-level="5.6" data-path="mtcars.html"><a href="mtcars.html#generate-the-workflow-plan"><i class="fa fa-check"></i><b>5.6</b> Generate the workflow plan</a></li>
<li class="chapter" data-level="5.7" data-path="mtcars.html"><a href="mtcars.html#flexible-workflow-plan-generation"><i class="fa fa-check"></i><b>5.7</b> Flexible workflow plan generation</a></li>
<li class="chapter" data-level="5.8" data-path="mtcars.html"><a href="mtcars.html#run-the-workflow"><i class="fa fa-check"></i><b>5.8</b> Run the workflow</a></li>
<li class="chapter" data-level="5.9" data-path="mtcars.html"><a href="mtcars.html#automatic-watching-for-changed-dependencies"><i class="fa fa-check"></i><b>5.9</b> Automatic watching for changed dependencies</a></li>
<li class="chapter" data-level="5.10" data-path="mtcars.html"><a href="mtcars.html#a-note-on-tidy-evaluation"><i class="fa fa-check"></i><b>5.10</b> A note on tidy evaluation</a></li>
<li class="chapter" data-level="5.11" data-path="mtcars.html"><a href="mtcars.html#need-more-speed"><i class="fa fa-check"></i><b>5.11</b> Need more speed?</a></li>
</ul></li>
<li class="part"><span><b>II Functionality</b></span></li>
<li class="chapter" data-level="6" data-path="plans.html"><a href="plans.html"><i class="fa fa-check"></i><b>6</b> Workflow data frames</a><ul>
<li class="chapter" data-level="6.1" data-path="plans.html"><a href="plans.html#what-is-a-workflow-plan-data-frame"><i class="fa fa-check"></i><b>6.1</b> What is a workflow plan data frame?</a></li>
<li class="chapter" data-level="6.2" data-path="plans.html"><a href="plans.html#rationale"><i class="fa fa-check"></i><b>6.2</b> Rationale</a><ul>
<li class="chapter" data-level="6.2.1" data-path="plans.html"><a href="plans.html#you-can-skip-up-to-date-work."><i class="fa fa-check"></i><b>6.2.1</b> You can skip up-to-date work.</a></li>
<li class="chapter" data-level="6.2.2" data-path="plans.html"><a href="plans.html#data-frames-scale-well."><i class="fa fa-check"></i><b>6.2.2</b> Data frames scale well.</a></li>
<li class="chapter" data-level="6.2.3" data-path="plans.html"><a href="plans.html#you-do-not-need-to-worry-about-which-targets-run-first."><i class="fa fa-check"></i><b>6.2.3</b> You do not need to worry about which targets run first.</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="plans.html"><a href="plans.html#automatic-dependency-detection"><i class="fa fa-check"></i><b>6.3</b> Automatic dependency detection</a></li>
<li class="chapter" data-level="6.4" data-path="plans.html"><a href="plans.html#generating-large-workflow-plans"><i class="fa fa-check"></i><b>6.4</b> Generating large workflow plans</a><ul>
<li class="chapter" data-level="6.4.1" data-path="plans.html"><a href="plans.html#wildcard-templating"><i class="fa fa-check"></i><b>6.4.1</b> Wildcard templating</a></li>
<li class="chapter" data-level="6.4.2" data-path="plans.html"><a href="plans.html#wildcard-clusters"><i class="fa fa-check"></i><b>6.4.2</b> Wildcard clusters</a></li>
<li class="chapter" data-level="6.4.3" data-path="plans.html"><a href="plans.html#specialized-wildcard-functionality"><i class="fa fa-check"></i><b>6.4.3</b> Specialized wildcard functionality</a></li>
<li class="chapter" data-level="6.4.4" data-path="plans.html"><a href="plans.html#non-wildcard-functions"><i class="fa fa-check"></i><b>6.4.4</b> Non-wildcard functions</a></li>
<li class="chapter" data-level="6.4.5" data-path="plans.html"><a href="plans.html#custom-metaprogramming"><i class="fa fa-check"></i><b>6.4.5</b> Custom metaprogramming</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="plans.html"><a href="plans.html#optional-columns-in-your-plan."><i class="fa fa-check"></i><b>6.5</b> Optional columns in your plan.</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="organize.html"><a href="organize.html"><i class="fa fa-check"></i><b>7</b> How to organize the files of drake projects</a><ul>
<li class="chapter" data-level="7.1" data-path="organize.html"><a href="organize.html#examples-1"><i class="fa fa-check"></i><b>7.1</b> Examples</a></li>
<li class="chapter" data-level="7.2" data-path="organize.html"><a href="organize.html#where-do-you-put-your-code"><i class="fa fa-check"></i><b>7.2</b> Where do you put your code?</a></li>
<li class="chapter" data-level="7.3" data-path="organize.html"><a href="organize.html#your-commands-are-code-chunks-not-r-scripts"><i class="fa fa-check"></i><b>7.3</b> Your commands are code chunks, not R scripts</a></li>
<li class="chapter" data-level="7.4" data-path="organize.html"><a href="organize.html#workflows-as-r-packages"><i class="fa fa-check"></i><b>7.4</b> Workflows as R packages</a><ul>
<li class="chapter" data-level="7.4.1" data-path="organize.html"><a href="organize.html#advantages-of-putting-workflows-in-r-packages"><i class="fa fa-check"></i><b>7.4.1</b> Advantages of putting workflows in R packages</a></li>
<li class="chapter" data-level="7.4.2" data-path="organize.html"><a href="organize.html#the-problem"><i class="fa fa-check"></i><b>7.4.2</b> The problem</a></li>
<li class="chapter" data-level="7.4.3" data-path="organize.html"><a href="organize.html#the-solution"><i class="fa fa-check"></i><b>7.4.3</b> The solution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="vis.html"><a href="vis.html"><i class="fa fa-check"></i><b>8</b> Visualization with drake</a><ul>
<li class="chapter" data-level="8.0.1" data-path="vis.html"><a href="vis.html#vis_drake_graph"><i class="fa fa-check"></i><b>8.0.1</b> <code>vis_drake_graph()</code></a></li>
<li class="chapter" data-level="8.0.2" data-path="vis.html"><a href="vis.html#sankey_drake_graph"><i class="fa fa-check"></i><b>8.0.2</b> <code>sankey_drake_graph()</code></a></li>
<li class="chapter" data-level="8.0.3" data-path="vis.html"><a href="vis.html#drake_ggraph"><i class="fa fa-check"></i><b>8.0.3</b> <code>drake_ggraph()</code></a></li>
<li class="chapter" data-level="8.1" data-path="vis.html"><a href="vis.html#underlying-graph-data-node-and-edge-data-frames"><i class="fa fa-check"></i><b>8.1</b> Underlying graph data: node and edge data frames</a></li>
<li class="chapter" data-level="8.2" data-path="vis.html"><a href="vis.html#visualizing-target-status"><i class="fa fa-check"></i><b>8.2</b> Visualizing target status</a></li>
<li class="chapter" data-level="8.3" data-path="vis.html"><a href="vis.html#subgraphs"><i class="fa fa-check"></i><b>8.3</b> Subgraphs</a></li>
<li class="chapter" data-level="8.4" data-path="vis.html"><a href="vis.html#control-the-vis_drake_graph-legend."><i class="fa fa-check"></i><b>8.4</b> Control the <code>vis_drake_graph()</code> legend.</a></li>
<li class="chapter" data-level="8.5" data-path="vis.html"><a href="vis.html#clusters"><i class="fa fa-check"></i><b>8.5</b> Clusters</a></li>
<li class="chapter" data-level="8.6" data-path="vis.html"><a href="vis.html#output-files"><i class="fa fa-check"></i><b>8.6</b> Output files</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="debug.html"><a href="debug.html"><i class="fa fa-check"></i><b>9</b> Debugging and testing drake projects</a><ul>
<li class="chapter" data-level="9.1" data-path="debug.html"><a href="debug.html#the-configuration-list"><i class="fa fa-check"></i><b>9.1</b> The configuration list</a></li>
<li class="chapter" data-level="9.2" data-path="debug.html"><a href="debug.html#plan-your-work."><i class="fa fa-check"></i><b>9.2</b> Plan your work.</a><ul>
<li class="chapter" data-level="9.2.1" data-path="debug.html"><a href="debug.html#workflow-plan-data-frames"><i class="fa fa-check"></i><b>9.2.1</b> Workflow plan data frames</a></li>
<li class="chapter" data-level="9.2.2" data-path="debug.html"><a href="debug.html#visualize-your-workflow."><i class="fa fa-check"></i><b>9.2.2</b> Visualize your workflow.</a></li>
<li class="chapter" data-level="9.2.3" data-path="debug.html"><a href="debug.html#check-dependency-relationships."><i class="fa fa-check"></i><b>9.2.3</b> Check dependency relationships.</a></li>
<li class="chapter" data-level="9.2.4" data-path="debug.html"><a href="debug.html#outdated-up-to-date-and-missing-items"><i class="fa fa-check"></i><b>9.2.4</b> Outdated, up to date, and missing items</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="debug.html"><a href="debug.html#skipping-imports"><i class="fa fa-check"></i><b>9.3</b> Skipping imports</a></li>
<li class="chapter" data-level="9.4" data-path="debug.html"><a href="debug.html#impose-timeouts-and-retries"><i class="fa fa-check"></i><b>9.4</b> Impose timeouts and retries</a></li>
<li class="chapter" data-level="9.5" data-path="debug.html"><a href="debug.html#diagnose-failures."><i class="fa fa-check"></i><b>9.5</b> Diagnose failures.</a><ul>
<li class="chapter" data-level="9.5.1" data-path="debug.html"><a href="debug.html#tidy-evaluation-a-caveat-to-diagnosing-interactively"><i class="fa fa-check"></i><b>9.5.1</b> Tidy evaluation: a caveat to diagnosing interactively</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="debug.html"><a href="debug.html#debrief-a-build-session."><i class="fa fa-check"></i><b>9.6</b> Debrief a build session.</a></li>
<li class="chapter" data-level="9.7" data-path="debug.html"><a href="debug.html#start-tinkering."><i class="fa fa-check"></i><b>9.7</b> Start tinkering.</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="hpc.html"><a href="hpc.html"><i class="fa fa-check"></i><b>10</b> High-performance computing with drake</a><ul>
<li class="chapter" data-level="10.1" data-path="hpc.html"><a href="hpc.html#batch-mode-for-long-workflows"><i class="fa fa-check"></i><b>10.1</b> Batch mode for long workflows</a></li>
<li class="chapter" data-level="10.2" data-path="hpc.html"><a href="hpc.html#let-drake-schedule-your-targets."><i class="fa fa-check"></i><b>10.2</b> Let drake schedule your targets.</a></li>
<li class="chapter" data-level="10.3" data-path="hpc.html"><a href="hpc.html#parallel-backends"><i class="fa fa-check"></i><b>10.3</b> Parallel backends</a></li>
<li class="chapter" data-level="10.4" data-path="hpc.html"><a href="hpc.html#local-workers"><i class="fa fa-check"></i><b>10.4</b> Local workers</a></li>
<li class="chapter" data-level="10.5" data-path="hpc.html"><a href="hpc.html#remote-workers"><i class="fa fa-check"></i><b>10.5</b> Remote workers</a><ul>
<li class="chapter" data-level="10.5.1" data-path="hpc.html"><a href="hpc.html#future-future_lapply-and-future_lapply_staged"><i class="fa fa-check"></i><b>10.5.1</b> <code>&quot;future&quot;</code>, <code>&quot;future_lapply&quot;</code>, and <code>&quot;future_lapply_staged&quot;</code></a></li>
<li class="chapter" data-level="10.5.2" data-path="hpc.html"><a href="hpc.html#clustermq_staged"><i class="fa fa-check"></i><b>10.5.2</b> <code>&quot;clustermq_staged&quot;</code></a></li>
<li class="chapter" data-level="10.5.3" data-path="hpc.html"><a href="hpc.html#makefile"><i class="fa fa-check"></i><b>10.5.3</b> <code>&quot;Makefile&quot;</code></a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="hpc.html"><a href="hpc.html#scheduling-algorithms"><i class="fa fa-check"></i><b>10.6</b> Scheduling algorithms</a><ul>
<li class="chapter" data-level="10.6.1" data-path="hpc.html"><a href="hpc.html#persistent-scheduling"><i class="fa fa-check"></i><b>10.6.1</b> Persistent scheduling</a></li>
<li class="chapter" data-level="10.6.2" data-path="hpc.html"><a href="hpc.html#transient-scheduling"><i class="fa fa-check"></i><b>10.6.2</b> Transient scheduling</a></li>
<li class="chapter" data-level="10.6.3" data-path="hpc.html"><a href="hpc.html#staged-scheduling"><i class="fa fa-check"></i><b>10.6.3</b> Staged scheduling</a></li>
</ul></li>
<li class="chapter" data-level="10.7" data-path="hpc.html"><a href="hpc.html#final-thoughts"><i class="fa fa-check"></i><b>10.7</b> Final thoughts</a><ul>
<li class="chapter" data-level="10.7.1" data-path="hpc.html"><a href="hpc.html#debugging"><i class="fa fa-check"></i><b>10.7.1</b> Debugging</a></li>
<li class="chapter" data-level="10.7.2" data-path="hpc.html"><a href="hpc.html#drake-as-an-ordinary-job-scheduler"><i class="fa fa-check"></i><b>10.7.2</b> Drake as an ordinary job scheduler</a></li>
<li class="chapter" data-level="10.7.3" data-path="hpc.html"><a href="hpc.html#more-resources"><i class="fa fa-check"></i><b>10.7.3</b> More resources</a></li>
</ul></li>
<li class="chapter" data-level="10.8" data-path="hpc.html"><a href="hpc.html#footnotes"><i class="fa fa-check"></i><b>10.8</b> Footnotes</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="triggers.html"><a href="triggers.html"><i class="fa fa-check"></i><b>11</b> Triggers: decision rules for building targets</a><ul>
<li class="chapter" data-level="11.1" data-path="triggers.html"><a href="triggers.html#what-are-triggers"><i class="fa fa-check"></i><b>11.1</b> What are triggers?</a></li>
<li class="chapter" data-level="11.2" data-path="triggers.html"><a href="triggers.html#customization"><i class="fa fa-check"></i><b>11.2</b> Customization</a></li>
<li class="chapter" data-level="11.3" data-path="triggers.html"><a href="triggers.html#a-more-practical-example"><i class="fa fa-check"></i><b>11.3</b> A more practical example</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="time.html"><a href="time.html"><i class="fa fa-check"></i><b>12</b> Time: logging, prediction, and strategy</a><ul>
<li class="chapter" data-level="12.1" data-path="time.html"><a href="time.html#predict-total-runtime"><i class="fa fa-check"></i><b>12.1</b> Predict total runtime</a></li>
<li class="chapter" data-level="12.2" data-path="time.html"><a href="time.html#strategize-your-high-performance-computing"><i class="fa fa-check"></i><b>12.2</b> Strategize your high-performance computing</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="store.html"><a href="store.html"><i class="fa fa-check"></i><b>13</b> Storage</a><ul>
<li class="chapter" data-level="13.1" data-path="store.html"><a href="store.html#caches"><i class="fa fa-check"></i><b>13.1</b> Caches</a></li>
<li class="chapter" data-level="13.2" data-path="store.html"><a href="store.html#hash-algorithms"><i class="fa fa-check"></i><b>13.2</b> Hash algorithms</a></li>
<li class="chapter" data-level="13.3" data-path="store.html"><a href="store.html#which-hash-algorithm-should-you-choose"><i class="fa fa-check"></i><b>13.3</b> Which hash algorithm should you choose?</a></li>
<li class="chapter" data-level="13.4" data-path="store.html"><a href="store.html#select-the-hash-algorithms-of-the-cache"><i class="fa fa-check"></i><b>13.4</b> Select the hash algorithms of the cache</a></li>
<li class="chapter" data-level="13.5" data-path="store.html"><a href="store.html#using-storr-directly"><i class="fa fa-check"></i><b>13.5</b> Using <code>storr</code> directly</a></li>
<li class="chapter" data-level="13.6" data-path="store.html"><a href="store.html#cleaning-up"><i class="fa fa-check"></i><b>13.6</b> Cleaning up</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="faq.html"><a href="faq.html"><i class="fa fa-check"></i><b>A</b> Frequently-asked questions</a></li>
<li class="chapter" data-level="B" data-path="caution.html"><a href="caution.html"><i class="fa fa-check"></i><b>B</b> Cautionary notes</a><ul>
<li class="chapter" data-level="B.1" data-path="caution.html"><a href="caution.html#projects-built-with-drake-4.4.0-are-not-back-compatible-with-drake-4.4.0."><i class="fa fa-check"></i><b>B.1</b> Projects built with drake &lt;= 4.4.0 are not back compatible with drake &gt; 4.4.0.</a></li>
<li class="chapter" data-level="B.2" data-path="caution.html"><a href="caution.html#workflow-plans"><i class="fa fa-check"></i><b>B.2</b> Workflow plans</a><ul>
<li class="chapter" data-level="B.2.1" data-path="caution.html"><a href="caution.html#externalizing-commands-in-r-script-files"><i class="fa fa-check"></i><b>B.2.1</b> Externalizing commands in R script files</a></li>
<li class="chapter" data-level="B.2.2" data-path="caution.html"><a href="caution.html#commands-are-not-perfectly-flexible."><i class="fa fa-check"></i><b>B.2.2</b> Commands are NOT perfectly flexible.</a></li>
</ul></li>
<li class="chapter" data-level="B.3" data-path="caution.html"><a href="caution.html#execution"><i class="fa fa-check"></i><b>B.3</b> Execution</a><ul>
<li class="chapter" data-level="B.3.1" data-path="caution.html"><a href="caution.html#install-drake-properly."><i class="fa fa-check"></i><b>B.3.1</b> Install <code>drake</code> properly.</a></li>
<li class="chapter" data-level="B.3.2" data-path="caution.html"><a href="caution.html#install-all-your-packages."><i class="fa fa-check"></i><b>B.3.2</b> Install all your packages.</a></li>
<li class="chapter" data-level="B.3.3" data-path="caution.html"><a href="caution.html#a-note-on-tidy-evaluation-1"><i class="fa fa-check"></i><b>B.3.3</b> A note on tidy evaluation</a></li>
<li class="chapter" data-level="B.3.4" data-path="caution.html"><a href="caution.html#find-and-diagnose-your-errors."><i class="fa fa-check"></i><b>B.3.4</b> Find and diagnose your errors.</a></li>
<li class="chapter" data-level="B.3.5" data-path="caution.html"><a href="caution.html#refresh-the-drake_config-list-early-and-often."><i class="fa fa-check"></i><b>B.3.5</b> Refresh the <code>drake_config()</code> list early and often.</a></li>
<li class="chapter" data-level="B.3.6" data-path="caution.html"><a href="caution.html#workflows-as-r-packages."><i class="fa fa-check"></i><b>B.3.6</b> Workflows as R packages.</a></li>
<li class="chapter" data-level="B.3.7" data-path="caution.html"><a href="caution.html#the-lazy_load-flag-does-not-work-with-parlapply-parallelism."><i class="fa fa-check"></i><b>B.3.7</b> The <code>lazy_load</code> flag does not work with <code>&quot;parLapply&quot;</code> parallelism.</a></li>
<li class="chapter" data-level="B.3.8" data-path="caution.html"><a href="caution.html#timeouts-may-be-unreliable."><i class="fa fa-check"></i><b>B.3.8</b> Timeouts may be unreliable.</a></li>
</ul></li>
<li class="chapter" data-level="B.4" data-path="caution.html"><a href="caution.html#dependencies"><i class="fa fa-check"></i><b>B.4</b> Dependencies</a><ul>
<li class="chapter" data-level="B.4.1" data-path="caution.html"><a href="caution.html#objects-that-contain-functions-may-rebuild-too-often"><i class="fa fa-check"></i><b>B.4.1</b> Objects that contain functions may rebuild too often</a></li>
<li class="chapter" data-level="B.4.2" data-path="caution.html"><a href="caution.html#the-magrittr-dot-.-is-always-ignored."><i class="fa fa-check"></i><b>B.4.2</b> The <code>magrittr</code> dot (<code>.</code>) is always ignored.</a></li>
<li class="chapter" data-level="B.4.3" data-path="caution.html"><a href="caution.html#dependencies-are-not-tracked-in-some-edge-cases."><i class="fa fa-check"></i><b>B.4.3</b> Dependencies are not tracked in some edge cases.</a></li>
<li class="chapter" data-level="B.4.4" data-path="caution.html"><a href="caution.html#dependencies-of-knitr-reports"><i class="fa fa-check"></i><b>B.4.4</b> Dependencies of <code>knitr</code> reports</a></li>
<li class="chapter" data-level="B.4.5" data-path="caution.html"><a href="caution.html#file-outputs-in-imported-functions."><i class="fa fa-check"></i><b>B.4.5</b> File outputs in imported functions.</a></li>
<li class="chapter" data-level="B.4.6" data-path="caution.html"><a href="caution.html#functions-produced-by-vectorize"><i class="fa fa-check"></i><b>B.4.6</b> Functions produced by <code>Vectorize()</code></a></li>
<li class="chapter" data-level="B.4.7" data-path="caution.html"><a href="caution.html#compiled-code-is-not-reproducibly-tracked."><i class="fa fa-check"></i><b>B.4.7</b> Compiled code is not reproducibly tracked.</a></li>
<li class="chapter" data-level="B.4.8" data-path="caution.html"><a href="caution.html#directories-folders-are-not-reproducibly-tracked."><i class="fa fa-check"></i><b>B.4.8</b> Directories (folders) are not reproducibly tracked.</a></li>
<li class="chapter" data-level="B.4.9" data-path="caution.html"><a href="caution.html#packages-are-not-tracked-as-dependencies."><i class="fa fa-check"></i><b>B.4.9</b> Packages are not tracked as dependencies.</a></li>
</ul></li>
<li class="chapter" data-level="B.5" data-path="caution.html"><a href="caution.html#high-performance-computing"><i class="fa fa-check"></i><b>B.5</b> High-performance computing</a><ul>
<li class="chapter" data-level="B.5.1" data-path="caution.html"><a href="caution.html#the-practical-utility-of-parallel-computing"><i class="fa fa-check"></i><b>B.5.1</b> The practical utility of parallel computing</a></li>
<li class="chapter" data-level="B.5.2" data-path="caution.html"><a href="caution.html#maximum-number-of-simultaneous-jobs"><i class="fa fa-check"></i><b>B.5.2</b> Maximum number of simultaneous jobs</a></li>
<li class="chapter" data-level="B.5.3" data-path="caution.html"><a href="caution.html#parallel-computing-on-windows"><i class="fa fa-check"></i><b>B.5.3</b> Parallel computing on Windows</a></li>
<li class="chapter" data-level="B.5.4" data-path="caution.html"><a href="caution.html#configuring-futurebatchtools-parallelism-for-clusters"><i class="fa fa-check"></i><b>B.5.4</b> Configuring <a href="https://github.com/HenrikBengtsson/future">future</a>/<a href="https://github.com/mllg/batchtools">batchtools</a> parallelism for clusters</a></li>
<li class="chapter" data-level="B.5.5" data-path="caution.html"><a href="caution.html#proper-makefiles-are-not-standalone."><i class="fa fa-check"></i><b>B.5.5</b> Proper Makefiles are not standalone.</a></li>
<li class="chapter" data-level="B.5.6" data-path="caution.html"><a href="caution.html#makefile-level-parallelism-for-imported-objects-and-files"><i class="fa fa-check"></i><b>B.5.6</b> Makefile-level parallelism for imported objects and files</a></li>
<li class="chapter" data-level="B.5.7" data-path="caution.html"><a href="caution.html#zombie-processes"><i class="fa fa-check"></i><b>B.5.7</b> Zombie processes</a></li>
</ul></li>
<li class="chapter" data-level="B.6" data-path="caution.html"><a href="caution.html#storage"><i class="fa fa-check"></i><b>B.6</b> Storage</a><ul>
<li class="chapter" data-level="B.6.1" data-path="caution.html"><a href="caution.html#projects-hosted-on-dropbox-and-similar-platforms"><i class="fa fa-check"></i><b>B.6.1</b> Projects hosted on Dropbox and similar platforms</a></li>
<li class="chapter" data-level="B.6.2" data-path="caution.html"><a href="caution.html#cache-customization-is-limited"><i class="fa fa-check"></i><b>B.6.2</b> Cache customization is limited</a></li>
<li class="chapter" data-level="B.6.3" data-path="caution.html"><a href="caution.html#runtime-predictions"><i class="fa fa-check"></i><b>B.6.3</b> Runtime predictions</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The drake R Package User Manual</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="packages" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> An analysis of R package download trends</h1>
<p>This chapter explores R package download trends using the <code>cranlogs</code> package, and it shows how <code>drake</code>’s custom triggers can help with workflows with remote data sources.</p>
<div id="get-the-code." class="section level2">
<h2><span class="header-section-number">3.1</span> Get the code.</h2>
<p>Write the code files to your workspace.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">drake_example</span>(<span class="st">&quot;packages&quot;</span>)</code></pre>
<p>The new <code>packages</code> folder now includes a file structure of a serious <code>drake</code> project, plus an <code>interactive-tutorial.R</code> to narrate the example. The code is also <a href="https://github.com/ropensci/drake/tree/master/inst/examples/packages">online here</a>.</p>
</div>
<div id="overview" class="section level2">
<h2><span class="header-section-number">3.2</span> Overview</h2>
<p>This small data analysis project explores some trends in R package downloads over time. The datasets are downloaded using the <a href="https://github.com/metacran/cranlogs">cranlogs package</a>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(cranlogs)
<span class="kw">cran_downloads</span>(<span class="dt">packages =</span> <span class="st">&quot;dplyr&quot;</span>, <span class="dt">when =</span> <span class="st">&quot;last-week&quot;</span>)
##         date count package
## 1 2018-07-24 17007   dplyr
## 2 2018-07-25 16495   dplyr
## 3 2018-07-26 15932   dplyr
## 4 2018-07-27 14783   dplyr
## 7 2018-07-28     0   dplyr
## 5 2018-07-29  6828   dplyr
## 6 2018-07-30 15311   dplyr</code></pre>
<p>Above, each count is the number of times <code>dplyr</code> was downloaded from the RStudio CRAN mirror on the given day. To stay up to date with the latest download statistics, we need to refresh the data frequently. With <code>drake</code>, we can bring all our work up to date without restarting everything from scratch.</p>
</div>
<div id="analysis" class="section level2">
<h2><span class="header-section-number">3.3</span> Analysis</h2>
<p>First, we load the required packages. <code>drake</code> detects the packages you install and load.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(cranlogs)
<span class="kw">library</span>(drake)
<span class="kw">library</span>(dplyr)
<span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(knitr)
<span class="kw">library</span>(rvest)</code></pre>
<p>We want to explore the daily downloads from these packages.</p>
<pre class="sourceCode r"><code class="sourceCode r">package_list &lt;-<span class="st"> </span><span class="kw">c</span>(
  <span class="st">&quot;knitr&quot;</span>,
  <span class="st">&quot;Rcpp&quot;</span>,
  <span class="st">&quot;ggplot2&quot;</span>
)</code></pre>
<p>We will use the <a href="https://github.com/metacran/cranlogs"><code>cranlogs</code> package</a> to get daily logs of package downloads from RStudio’s CRAN mirror. In our <code>drake_plan()</code>, we declare targets <code>older</code> and <code>recent</code> to contain snapshots of the logs.</p>
<pre class="sourceCode r"><code class="sourceCode r">data_plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(
  <span class="dt">older =</span> <span class="kw">cran_downloads</span>(
    <span class="dt">packages =</span> package_list,
    <span class="dt">from =</span> <span class="st">&quot;2016-11-01&quot;</span>,
    <span class="dt">to =</span> <span class="st">&quot;2016-12-01&quot;</span>
  ),
  <span class="dt">recent =</span> <span class="kw">target</span>(
    <span class="dt">command =</span> <span class="kw">cran_downloads</span>(
      <span class="dt">packages =</span> package_list,
      <span class="dt">when =</span> <span class="st">&quot;last-month&quot;</span>
    ),
    <span class="dt">trigger =</span> <span class="kw">trigger</span>(<span class="dt">change =</span> <span class="kw">latest_log_date</span>())
  )
)

data_plan
## # A tibble: 2 x 3
##   target command                                       trigger            
## * &lt;chr&gt;  &lt;chr&gt;                                         &lt;chr&gt;              
## 1 older  &quot;cran_downloads(packages = package_list, fro… &lt;NA&gt;               
## 2 recent &quot;cran_downloads(packages = package_list, whe… trigger(change = l…</code></pre>
<p>Notice the custom trigger for the target <code>recent</code>. Here, we are telling <code>drake</code> to rebuild <code>recent</code> whenever a new day’s log is uploaded to <a href="http://cran-logs.rstudio.com" class="uri">http://cran-logs.rstudio.com</a>. In other words, <code>drake</code> keeps track of the return value of <code>latest_log_date()</code> and recomputes <code>recent</code> (during <code>make()</code>) if that value changed since the last <code>make()</code>. Here, <code>latest_log_date()</code> is one of our custom imported functions. We use it to scrape <a href="http://cran-logs.rstudio.com" class="uri">http://cran-logs.rstudio.com</a> using the <a href="https://github.com/hadley/rvest"><code>rvest</code></a> package.</p>
<pre class="sourceCode r"><code class="sourceCode r">latest_log_date &lt;-<span class="st"> </span><span class="cf">function</span>(){
  <span class="kw">read_html</span>(<span class="st">&quot;http://cran-logs.rstudio.com/&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">html_nodes</span>(<span class="st">&quot;li:last-of-type&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">html_nodes</span>(<span class="st">&quot;a:last-of-type&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">html_text</span>() <span class="op">%&gt;%</span>
<span class="st">    </span>max
}</code></pre>
<p>Continuing with the setup, we want to summarize each set of
download statistics a couple different ways.</p>
<pre class="sourceCode r"><code class="sourceCode r">output_types &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(
  <span class="dt">averages =</span> <span class="kw">make_my_table</span>(dataset__),
  <span class="dt">plot =</span> <span class="kw">make_my_plot</span>(dataset__)
)

output_types
## # A tibble: 2 x 2
##   target   command                 
## * &lt;chr&gt;    &lt;chr&gt;                   
## 1 averages make_my_table(dataset__)
## 2 plot     make_my_plot(dataset__)</code></pre>
<p>We need to define functions to summarize
and plot the data.</p>
<pre class="sourceCode r"><code class="sourceCode r">make_my_table &lt;-<span class="st"> </span><span class="cf">function</span>(downloads){
  <span class="kw">group_by</span>(downloads, package) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">mean_downloads =</span> <span class="kw">mean</span>(count))
}

make_my_plot &lt;-<span class="st"> </span><span class="cf">function</span>(downloads){
  <span class="kw">ggplot</span>(downloads) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> date, <span class="dt">y =</span> count, <span class="dt">group =</span> package, <span class="dt">color =</span> package))
}</code></pre>
<p>Below, the targets <code>recent</code> and <code>older</code>
each take turns substituting the <code>dataset__</code> wildcard.
Thus, <code>output_plan</code> has four rows.</p>
<pre class="sourceCode r"><code class="sourceCode r">output_plan &lt;-<span class="st"> </span><span class="kw">plan_analyses</span>(
  <span class="dt">plan =</span> output_types,
  <span class="dt">datasets =</span> data_plan
)

output_plan
## # A tibble: 4 x 2
##   target          command              
## * &lt;chr&gt;           &lt;chr&gt;                
## 1 averages_older  make_my_table(older) 
## 2 averages_recent make_my_table(recent)
## 3 plot_older      make_my_plot(older)  
## 4 plot_recent     make_my_plot(recent)</code></pre>
<p>We plan to weave the results together
in a dynamic knitr report.</p>
<pre class="sourceCode r"><code class="sourceCode r">report_plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(
  <span class="dt">report =</span> <span class="kw">knit</span>(<span class="kw">knitr_in</span>(<span class="st">&quot;report.Rmd&quot;</span>), <span class="kw">file_out</span>(<span class="st">&quot;report.md&quot;</span>), <span class="dt">quiet =</span> <span class="ot">TRUE</span>)
)

report_plan
## # A tibble: 1 x 2
##   target command                                                          
## * &lt;chr&gt;  &lt;chr&gt;                                                            
## 1 report &quot;knit(knitr_in(\&quot;report.Rmd\&quot;), file_out(\&quot;report.md\&quot;), quiet =…</code></pre>
<p>Because of the mention of <code>knitr_in()</code> above, <code>make()</code> will look dependencies inside <code>report.Rmd</code> (targets mentioned with <code>loadd()</code> or <code>readd()</code> in active code chunks). That way, whenever a dependency changes, <code>drake</code> will rebuild <code>report.md</code> when you call <code>make()</code>. For that to happen, we need <code>report.Rmd</code> to exist before the call to <code>make()</code>. For this example, you can find <a href="https://github.com/ropensci/drake/blob/master/inst/examples/packages/report.Rmd">report.Rmd here</a>.</p>
<p>Now, we complete the workflow plan data frame by concatenating the results together. <code>drake</code> uses implicit dependency relationships to resolve execution order, so row order in the plan does not matter.</p>
<pre class="sourceCode r"><code class="sourceCode r">whole_plan &lt;-<span class="st"> </span><span class="kw">bind_plans</span>(
  data_plan,
  output_plan,
  report_plan
)

whole_plan
## # A tibble: 7 x 3
##   target          command                                trigger          
## * &lt;chr&gt;           &lt;chr&gt;                                  &lt;chr&gt;            
## 1 older           &quot;cran_downloads(packages = package_li… &lt;NA&gt;             
## 2 recent          &quot;cran_downloads(packages = package_li… trigger(change =…
## 3 averages_older  make_my_table(older)                   &lt;NA&gt;             
## 4 averages_recent make_my_table(recent)                  &lt;NA&gt;             
## 5 plot_older      make_my_plot(older)                    &lt;NA&gt;             
## 6 plot_recent     make_my_plot(recent)                   &lt;NA&gt;             
## 7 report          &quot;knit(knitr_in(\&quot;report.Rmd\&quot;), file_… &lt;NA&gt;</code></pre>
<p>Now, we run the project to download the data and analyze it.
The results will be summarized in the knitted report, <code>report.md</code>,
but you can also read the results directly from the cache.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">make</span>(whole_plan)
## target older
## target recent
## target averages_older
## target plot_older
## target averages_recent
## target plot_recent
## target report

<span class="kw">readd</span>(averages_recent)
## # A tibble: 3 x 2
##   package mean_downloads
##   &lt;chr&gt;            &lt;dbl&gt;
## 1 ggplot2         16678.
## 2 knitr            8664.
## 3 Rcpp            19385.

<span class="kw">readd</span>(averages_older)
## # A tibble: 3 x 2
##   package mean_downloads
##   &lt;chr&gt;            &lt;dbl&gt;
## 1 ggplot2         14641.
## 2 knitr            9069.
## 3 Rcpp            14408.

<span class="kw">readd</span>(plot_recent)</code></pre>
<p><img src="drake-manual_files/figure-html/firstmakepackages-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">readd</span>(plot_older)</code></pre>
<p><img src="drake-manual_files/figure-html/firstmakepackages-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>If we run <code>make()</code> again right away, we see that everything is up to date. But if we wait until a new day’s log is uploaded, <code>make()</code> will update <code>recent</code> and everything that depends on it.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">make</span>(whole_plan)
## All targets are already up to date.</code></pre>
<p>To visualize the build behavior, you can plot the dependency network.</p>
<pre class="sourceCode r"><code class="sourceCode r">config &lt;-<span class="st"> </span><span class="kw">drake_config</span>(whole_plan)
<span class="kw">vis_drake_graph</span>(config)</code></pre>
<div id="htmlwidget-e2045036e7a6211c2d88" style="width:576px;height:576px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-e2045036e7a6211c2d88">{"x":{"nodes":{"id":["\"report.md\"","\"report.Rmd\"","aes","averages_older","averages_recent","count","cran_downloads","date","geom_line","ggplot","group_by","html_nodes","html_text","knit","latest_log_date","make_my_plot","make_my_table","max","mean","older","package","package_list","plot_older","plot_recent","read_html","recent","report","summarize"],"deps":[{},null,null,{},{},null,null,null,null,null,null,null,null,null,{},{},{},null,null,{},null,{},{},{},null,{},{},null],"trigger.x":[{},null,null,{},{},null,null,null,null,null,null,null,null,null,null,null,null,null,null,{},null,null,{},{},null,{},{},null],"label":["\"report.md\"","\"report.Rmd\"\n0.004s","aes\n0.01s","averages_older\n0.015s","averages_recent\n0.019s","count\n0.009s","cran_downloads\n0.01s","date\n0.016s","geom_line\n0.009s","ggplot\n0.009s","group_by\n0.008s","html_nodes\n0.004s","html_text\n0.005s","knit\n0.048s","latest_log_date\n0.005s","make_my_plot\n0.005s","make_my_table\n0.005s","max\n0.004s","mean\n0.015s","older\n0.12s","package\n0.004s","package_list\n0.004s","plot_older\n0.039s","plot_recent\n0.041s","read_html\n0.005s","recent\n0.092s","report\n3.567s","summarize\n0.007s"],"command":["knit(knitr_in(\"report.Rmd\"), file_out(\"report.md\"), quiet = TRUE)",null,null,"make_my_table(older)","make_my_table(recent)",null,null,null,null,null,null,null,null,null,null,null,null,null,null,"cran_downloads(packages = package_list, from = \"2016-11-01\", \n    to = \"2016-12-01\")",null,null,"make_my_plot(older)","make_my_plot(recent)",null,"cran_downloads(packages = package_list, when = \"last-month\")","knit(knitr_in(\"report.Rmd\"), file_out(\"report.md\"), quiet = TRUE)",null],"trigger.y":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"trigger(change = latest_log_date())",null,null],"status":["up to date","imported","imported","up to date","up to date","imported","imported","imported","imported","imported","imported","imported","imported","imported","imported","imported","imported","imported","imported","up to date","missing","imported","up to date","up to date","imported","up to date","up to date","imported"],"type":["file","file","function","object","object","function","function","function","function","function","function","function","function","function","function","function","function","function","function","object","object","object","object","object","function","object","object","function"],"font.size":[20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20],"color":["#228B22","#1874CD","#1874CD","#228B22","#228B22","#1874CD","#1874CD","#1874CD","#1874CD","#1874CD","#1874CD","#1874CD","#1874CD","#1874CD","#1874CD","#1874CD","#1874CD","#1874CD","#1874CD","#228B22","#9A32CD","#1874CD","#228B22","#228B22","#1874CD","#228B22","#228B22","#1874CD"],"shape":["square","square","triangle","dot","dot","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","dot","dot","dot","dot","dot","triangle","dot","dot","triangle"],"level":[6,1,1,3,4,1,1,1,1,1,1,1,1,1,2,2,2,1,1,2,1,1,3,4,1,3,5,1],"hover_label":["knit(knitr_in(\"report.Rmd\"), file_out(\"report.md\"), quiet = TRUE)","---\ntitle: \"Results report: package downloads example\"\nauthor: \"William Michael Landau\"\noutput: html_document\n---\n\n```{r setuppackagesreport, echo = FALSE}\nsuppressPackageStartupMessages(library(drake))\nsuppressPackageStartupMessages(library(Ecdat...","function (x, y, ...) \n{\n    exprs <- rlang::enquos(x = x, y = y, ...)\n    is_missing <- vapply(exprs, rlang::quo_is_missing, logical(1))\n    aes <- new_aes(exprs[!is_missing], env = parent.frame())\n    rename_aes(aes)\n}","make_my_table(older)","make_my_table(recent)","function (x, ..., wt = NULL, sort = FALSE) \n{\n    groups <- group_vars(x)\n    x <- group_by(x, ..., add = TRUE)\n    x <- tally(x, wt = !!enquo(wt), sort = sort)\n    x <- group_by(x, !!!syms(groups), add = FALSE)\n    x\n}","function (packages = NULL, when = c(\"last-day\", \"last-week\", \n    \"last-month\"), from = \"last-day\", to = \"last-day\") \n{\n    if (!missing(when)) {\n        interval <- match.arg(when)\n    }\n    else {\n        if (from == to) {\n            interval <...","function () \n.Internal(date())","function (mapping = NULL, data = NULL, stat = \"identity\", position = \"identity\", \n    na.rm = FALSE, show.legend = NA, inherit.aes = TRUE, ...) \n{\n    layer(data = data, mapping = mapping, stat = stat, geom = GeomLine, \n        position = position...","function (data = NULL, mapping = aes(), ..., environment = parent.frame()) \n{\n    UseMethod(\"ggplot\")\n}","function (.data, ..., add = FALSE) \n{\n    UseMethod(\"group_by\")\n}","function (x, css, xpath) \n{\n    UseMethod(\"html_nodes\")\n}","function (x, trim = FALSE) \n{\n    xml2::xml_text(x, trim = trim)\n}","function (input, output = NULL, tangle = FALSE, text = NULL, \n    quiet = FALSE, envir = parent.frame(), encoding = getOption(\"encoding\")) \n{\n    in.file = !missing(input) && (is.character(input) || prod(inherits(input, \n        c(\"file\", \"connect...","function () \n{\n    read_html(\"http://cran-logs.rstudio.com/\") %>% html_nodes(\"li:last-of-type\") %>% \n        html_nodes(\"a:last-of-type\") %>% html_text() %>% max\n}","function (downloads) \n{\n    ggplot(downloads) + geom_line(aes(x = date, y = count, group = package, \n        color = package))\n}","function (downloads) \n{\n    group_by(downloads, package) %>% summarize(mean_downloads = mean(count))\n}",".Primitive(\"max\")","function (x, ...) \nUseMethod(\"mean\")","cran_downloads(packages = package_list, from = \"2016-11-01\", to =\n\"2016-12-01\")","package","package_list","make_my_plot(older)","make_my_plot(recent)","function (x, encoding = \"\", ..., options = c(\"RECOVER\", \"NOERROR\", \n    \"NOBLANKS\")) \n{\n    UseMethod(\"read_html\")\n}","cran_downloads(packages = package_list, when = \"last-month\")","knit(knitr_in(\"report.Rmd\"), file_out(\"report.md\"), quiet = TRUE)","function (.data, ...) \n{\n    UseMethod(\"summarise\")\n}"],"x":[0.2,0.714285714285714,-0.0857142857142857,-0.942857142857143,-0.142857142857143,-0.542857142857143,0.0285714285714285,-0.428571428571429,-0.314285714285714,-0.2,-0.885714285714286,0.371428571428571,0.142857142857143,1,0.371428571428571,-0.428571428571429,-0.771428571428571,0.257142857142857,-0.771428571428571,-0.942857142857143,-0.657142857142857,0.6,-0.828571428571429,0.0285714285714285,0.485714285714286,-0.142857142857143,0.2,-1],"y":[1,-1,-1,-0.2,0.2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-0.6,-0.6,-0.6,-1,-1,-0.6,-1,-1,-0.2,0.2,-1,-0.2,0.6,-1]},"edges":{"from":["package_list","package_list","package_list","count","count","group_by","mean","package","package","summarize","html_nodes","html_text","max","read_html","aes","date","geom_line","ggplot","cran_downloads","cran_downloads","latest_log_date","make_my_table","make_my_table","older","older","recent","recent","make_my_plot","make_my_plot","\"report.Rmd\"","averages_older","averages_recent","knit","plot_older","plot_recent","report"],"to":["older","recent","report","make_my_table","make_my_plot","make_my_table","make_my_table","make_my_table","make_my_plot","make_my_table","latest_log_date","latest_log_date","latest_log_date","latest_log_date","make_my_plot","make_my_plot","make_my_plot","make_my_plot","older","recent","recent","averages_older","averages_recent","averages_older","plot_older","averages_recent","plot_recent","plot_older","plot_recent","report","report","report","report","report","report","\"report.md\""],"file":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,null],"arrows":["to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}},"edges":{"smooth":false},"physics":{"stabilization":false},"interaction":{"navigationButtons":true,"hover":true}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false},"byselection":{"enabled":false},"main":{"text":"Dependency graph","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Up to date","Imported","Missing","Object","Function","File"],"color":["#228B22","#1874CD","#9A32CD","#888888","#888888","#888888"],"shape":["dot","dot","dot","dot","triangle","square"],"font.color":["black","black","black","black","black","black"],"font.size":[20,20,20,20,20,20],"id":[1,5,6,7,8,9]},"nodesToDataframe":true},"igraphlayout":{"type":"square"},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);","events":{"hoverNode":"function(e){\n        var label_info = this.body.data.nodes.get({\n          fields: ['label', 'hover_label'],\n          filter: function (item) {\n            return item.id === e.node\n          },\n          returnType :'Array'\n        });\n        this.body.data.nodes.update({\n          id: e.node,\n          label : label_info[0].hover_label,\n          hover_label : label_info[0].label\n        });\n      }","blurNode":"function(e){\n        var label_info = this.body.data.nodes.get({\n          fields: ['label', 'hover_label'],\n          filter: function (item) {\n            return item.id === e.node\n          },\n          returnType :'Array'\n        });\n        this.body.data.nodes.update({\n          id: e.node,\n          label : label_info[0].hover_label,\n          hover_label : label_info[0].label\n        });\n      }"}},"evals":["events.hoverNode","events.blurNode"],"jsHooks":[]}</script>
</div>
<div id="other-ways-to-trigger-downloads" class="section level2">
<h2><span class="header-section-number">3.4</span> Other ways to trigger downloads</h2>
<p>Sometimes, our remote data sources get revised, and web scraping may not be the best way to detect changes. We may want to look at our remote dataset’s modification time or HTTP ETag. To see how this works, consider the CRAN log file from February 9, 2018.</p>
<pre class="sourceCode r"><code class="sourceCode r">url &lt;-<span class="st"> &quot;http://cran-logs.rstudio.com/2018/2018-02-09-r.csv.gz&quot;</span></code></pre>
<p>We can track the modification date using the <a href="https://github.com/r-lib/httr"><code>httr</code></a> package.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(httr)    <span class="co"># For querying websites.</span>
<span class="kw">HEAD</span>(url)<span class="op">$</span>headers[[<span class="st">&quot;last-modified&quot;</span>]]
## [1] &quot;Mon, 12 Feb 2018 16:34:48 GMT&quot;</code></pre>
<p>In our workflow plan, we can track this timestamp and trigger a download whenever it changes.</p>
<pre class="sourceCode r"><code class="sourceCode r">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(
  <span class="dt">logs =</span> <span class="kw">target</span>(
    <span class="kw">get_logs</span>(url),
    <span class="kw">trigger</span>(<span class="dt">change =</span> <span class="kw">HEAD</span>(url)<span class="op">$</span>headers[[<span class="st">&quot;last-modified&quot;</span>]])
  )
)
plan
## # A tibble: 1 x 3
##   target command       trigger                                            
## * &lt;chr&gt;  &lt;chr&gt;         &lt;chr&gt;                                              
## 1 logs   get_logs(url) &quot;trigger(change = HEAD(url)$headers[[\&quot;last-modifi…</code></pre>
<p>where</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(R.utils) <span class="co"># For unzipping the files we download.</span>
<span class="kw">library</span>(curl)    <span class="co"># For downloading data.</span>
get_logs &lt;-<span class="st"> </span><span class="cf">function</span>(url){
  <span class="kw">curl_download</span>(url, <span class="st">&quot;logs.csv.gz&quot;</span>)       <span class="co"># Get a big file.</span>
  <span class="kw">gunzip</span>(<span class="st">&quot;logs.csv.gz&quot;</span>, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>) <span class="co"># Unzip it.</span>
  out &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;logs.csv&quot;</span>, <span class="dt">nrows =</span> <span class="dv">4</span>)  <span class="co"># Extract the data you need.</span>
  <span class="kw">unlink</span>(<span class="kw">c</span>(<span class="st">&quot;logs.csv.gz&quot;</span>, <span class="st">&quot;logs.csv&quot;</span>))    <span class="co"># Remove the big files</span>
  out                                     <span class="co"># Value of the target.</span>
}</code></pre>
<p>When we are ready, we run the workflow.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">make</span>(plan)
## target logs

<span class="kw">readd</span>(logs)
##         date     time     size version  os country ip_id
## 1 2018-02-09 13:01:13 82375220   3.4.3 win      RO     1
## 2 2018-02-09 13:02:06 74286541   3.3.3 win      US     2
## 3 2018-02-09 13:02:10 82375216   3.4.3 win      US     3
## 4 2018-02-09 13:03:30 82375220   3.4.3 win      IS     4</code></pre>
<p>If the log file at the <code>url</code> ever changes, the timestamp will update remotely, and <code>make()</code> will download the file again.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="main.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="gsp.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
