<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>The drake R Package User Manual</title>
  <meta name="description" content="The drake R Package User Manual">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="The drake R Package User Manual" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="The drake R Package User Manual" />
  
  
  

<meta name="author" content="Will Landau, Kirill Müller, Alex Axthelm, Jasper Clarkberg, Lorenz Walthert">
<meta name="author" content="Copyright Eli Lilly and Company">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="plans.html">
<link rel="next" href="vis.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<link href="libs/vis-4.20.1/vis.css" rel="stylesheet" />
<script src="libs/vis-4.20.1/vis.min.js"></script>
<script src="libs/visNetwork-binding-2.0.4/visNetwork.js"></script>
<script src="libs/d3-4.5.0/d3.min.js"></script>
<script src="libs/sankey-1/sankey.js"></script>
<script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#the-drake-r-package"><i class="fa fa-check"></i><b>1.1</b> The drake R package</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#installation"><i class="fa fa-check"></i><b>1.2</b> Installation</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#why-drake"><i class="fa fa-check"></i><b>1.3</b> Why drake?</a><ul>
<li class="chapter" data-level="1.3.1" data-path="index.html"><a href="index.html#what-gets-done-stays-done."><i class="fa fa-check"></i><b>1.3.1</b> What gets done stays done.</a></li>
<li class="chapter" data-level="1.3.2" data-path="index.html"><a href="index.html#reproducibility-with-confidence"><i class="fa fa-check"></i><b>1.3.2</b> Reproducibility with confidence</a></li>
<li class="chapter" data-level="1.3.3" data-path="index.html"><a href="index.html#aggressively-scale-up."><i class="fa fa-check"></i><b>1.3.3</b> Aggressively scale up.</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#documentation"><i class="fa fa-check"></i><b>1.4</b> Documentation</a><ul>
<li class="chapter" data-level="1.4.1" data-path="index.html"><a href="index.html#cheat-sheet"><i class="fa fa-check"></i><b>1.4.1</b> Cheat sheet</a></li>
<li class="chapter" data-level="1.4.2" data-path="index.html"><a href="index.html#frequently-asked-questions"><i class="fa fa-check"></i><b>1.4.2</b> Frequently asked questions</a></li>
<li class="chapter" data-level="1.4.3" data-path="index.html"><a href="index.html#function-reference"><i class="fa fa-check"></i><b>1.4.3</b> Function reference</a></li>
<li class="chapter" data-level="1.4.4" data-path="index.html"><a href="index.html#tutorials"><i class="fa fa-check"></i><b>1.4.4</b> Tutorials</a></li>
<li class="chapter" data-level="1.4.5" data-path="index.html"><a href="index.html#examples"><i class="fa fa-check"></i><b>1.4.5</b> Examples</a></li>
<li class="chapter" data-level="1.4.6" data-path="index.html"><a href="index.html#presentations"><i class="fa fa-check"></i><b>1.4.6</b> Presentations</a></li>
<li class="chapter" data-level="1.4.7" data-path="index.html"><a href="index.html#real-example-projects"><i class="fa fa-check"></i><b>1.4.7</b> Real example projects</a></li>
<li class="chapter" data-level="1.4.8" data-path="index.html"><a href="index.html#context-and-history"><i class="fa fa-check"></i><b>1.4.8</b> Context and history</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#help-and-troubleshooting"><i class="fa fa-check"></i><b>1.5</b> Help and troubleshooting</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#similar-work"><i class="fa fa-check"></i><b>1.6</b> Similar work</a><ul>
<li class="chapter" data-level="1.6.1" data-path="index.html"><a href="index.html#gnu-make"><i class="fa fa-check"></i><b>1.6.1</b> GNU Make</a></li>
<li class="chapter" data-level="1.6.2" data-path="index.html"><a href="index.html#remake"><i class="fa fa-check"></i><b>1.6.2</b> Remake</a></li>
<li class="chapter" data-level="1.6.3" data-path="index.html"><a href="index.html#memoise"><i class="fa fa-check"></i><b>1.6.3</b> Memoise</a></li>
<li class="chapter" data-level="1.6.4" data-path="index.html"><a href="index.html#knitr-and-r-markdown"><i class="fa fa-check"></i><b>1.6.4</b> Knitr and R Markdown</a></li>
<li class="chapter" data-level="1.6.5" data-path="index.html"><a href="index.html#factuals-drake"><i class="fa fa-check"></i><b>1.6.5</b> Factual’s Drake</a></li>
<li class="chapter" data-level="1.6.6" data-path="index.html"><a href="index.html#other-pipeline-toolkits"><i class="fa fa-check"></i><b>1.6.6</b> Other pipeline toolkits</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i><b>1.7</b> Acknowledgements</a></li>
</ul></li>
<li class="part"><span><b>I Examples</b></span></li>
<li class="chapter" data-level="2" data-path="main.html"><a href="main.html"><i class="fa fa-check"></i><b>2</b> The main example</a><ul>
<li class="chapter" data-level="2.1" data-path="main.html"><a href="main.html#set-the-stage."><i class="fa fa-check"></i><b>2.1</b> Set the stage.</a></li>
<li class="chapter" data-level="2.2" data-path="main.html"><a href="main.html#make-your-results."><i class="fa fa-check"></i><b>2.2</b> Make your results.</a></li>
<li class="chapter" data-level="2.3" data-path="main.html"><a href="main.html#go-back-and-fix-things."><i class="fa fa-check"></i><b>2.3</b> Go back and fix things.</a></li>
<li class="chapter" data-level="2.4" data-path="main.html"><a href="main.html#try-it-yourself"><i class="fa fa-check"></i><b>2.4</b> Try it yourself!</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="packages.html"><a href="packages.html"><i class="fa fa-check"></i><b>3</b> An analysis of R package download trends</a><ul>
<li class="chapter" data-level="3.1" data-path="packages.html"><a href="packages.html#get-the-code."><i class="fa fa-check"></i><b>3.1</b> Get the code.</a></li>
<li class="chapter" data-level="3.2" data-path="packages.html"><a href="packages.html#overview"><i class="fa fa-check"></i><b>3.2</b> Overview</a></li>
<li class="chapter" data-level="3.3" data-path="packages.html"><a href="packages.html#analysis"><i class="fa fa-check"></i><b>3.3</b> Analysis</a></li>
<li class="chapter" data-level="3.4" data-path="packages.html"><a href="packages.html#other-ways-to-trigger-downloads"><i class="fa fa-check"></i><b>3.4</b> Other ways to trigger downloads</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="gsp.html"><a href="gsp.html"><i class="fa fa-check"></i><b>4</b> Finding the best model of gross state product</a><ul>
<li class="chapter" data-level="4.1" data-path="gsp.html"><a href="gsp.html#get-the-code.-1"><i class="fa fa-check"></i><b>4.1</b> Get the code.</a></li>
<li class="chapter" data-level="4.2" data-path="gsp.html"><a href="gsp.html#objective-and-methods"><i class="fa fa-check"></i><b>4.2</b> Objective and methods</a></li>
<li class="chapter" data-level="4.3" data-path="gsp.html"><a href="gsp.html#data"><i class="fa fa-check"></i><b>4.3</b> Data</a></li>
<li class="chapter" data-level="4.4" data-path="gsp.html"><a href="gsp.html#analysis-1"><i class="fa fa-check"></i><b>4.4</b> Analysis</a></li>
<li class="chapter" data-level="4.5" data-path="gsp.html"><a href="gsp.html#results"><i class="fa fa-check"></i><b>4.5</b> Results</a></li>
<li class="chapter" data-level="4.6" data-path="gsp.html"><a href="gsp.html#comparison-with-gnu-make"><i class="fa fa-check"></i><b>4.6</b> Comparison with GNU Make</a></li>
<li class="chapter" data-level="4.7" data-path="gsp.html"><a href="gsp.html#references"><i class="fa fa-check"></i><b>4.7</b> References</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="mtcars.html"><a href="mtcars.html"><i class="fa fa-check"></i><b>5</b> The mtcars example and workflow plan generation</a><ul>
<li class="chapter" data-level="5.1" data-path="mtcars.html"><a href="mtcars.html#get-the-code.-2"><i class="fa fa-check"></i><b>5.1</b> Get the code.</a></li>
<li class="chapter" data-level="5.2" data-path="mtcars.html"><a href="mtcars.html#quick-examples"><i class="fa fa-check"></i><b>5.2</b> Quick examples</a></li>
<li class="chapter" data-level="5.3" data-path="mtcars.html"><a href="mtcars.html#the-motivation-of-the-mtcars-example"><i class="fa fa-check"></i><b>5.3</b> The motivation of the mtcars example</a></li>
<li class="chapter" data-level="5.4" data-path="mtcars.html"><a href="mtcars.html#set-up-the-mtcars-example"><i class="fa fa-check"></i><b>5.4</b> Set up the mtcars example</a></li>
<li class="chapter" data-level="5.5" data-path="mtcars.html"><a href="mtcars.html#the-workflow-plan-data-frame"><i class="fa fa-check"></i><b>5.5</b> The workflow plan data frame</a></li>
<li class="chapter" data-level="5.6" data-path="mtcars.html"><a href="mtcars.html#generate-the-workflow-plan"><i class="fa fa-check"></i><b>5.6</b> Generate the workflow plan</a></li>
<li class="chapter" data-level="5.7" data-path="mtcars.html"><a href="mtcars.html#run-the-workflow"><i class="fa fa-check"></i><b>5.7</b> Run the workflow</a></li>
</ul></li>
<li class="part"><span><b>II Functionality</b></span></li>
<li class="chapter" data-level="6" data-path="plans.html"><a href="plans.html"><i class="fa fa-check"></i><b>6</b> Workflow plan data frames</a><ul>
<li class="chapter" data-level="6.1" data-path="plans.html"><a href="plans.html#what-is-a-workflow-plan-data-frame"><i class="fa fa-check"></i><b>6.1</b> What is a workflow plan data frame?</a></li>
<li class="chapter" data-level="6.2" data-path="plans.html"><a href="plans.html#plans-are-like-r-scripts."><i class="fa fa-check"></i><b>6.2</b> Plans are like R scripts.</a></li>
<li class="chapter" data-level="6.3" data-path="plans.html"><a href="plans.html#so-why-do-we-use-plans"><i class="fa fa-check"></i><b>6.3</b> So why do we use plans?</a><ul>
<li class="chapter" data-level="6.3.1" data-path="plans.html"><a href="plans.html#you-can-skip-up-to-date-work."><i class="fa fa-check"></i><b>6.3.1</b> You can skip up-to-date work.</a></li>
<li class="chapter" data-level="6.3.2" data-path="plans.html"><a href="plans.html#data-frames-scale-well."><i class="fa fa-check"></i><b>6.3.2</b> Data frames scale well.</a></li>
<li class="chapter" data-level="6.3.3" data-path="plans.html"><a href="plans.html#you-do-not-need-to-worry-about-which-targets-run-first."><i class="fa fa-check"></i><b>6.3.3</b> You do not need to worry about which targets run first.</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="plans.html"><a href="plans.html#automatic-dependency-detection"><i class="fa fa-check"></i><b>6.4</b> Automatic dependency detection</a></li>
<li class="chapter" data-level="6.5" data-path="plans.html"><a href="plans.html#automatically-generating-workflow-plans"><i class="fa fa-check"></i><b>6.5</b> Automatically generating workflow plans</a><ul>
<li class="chapter" data-level="6.5.1" data-path="plans.html"><a href="plans.html#map_plan"><i class="fa fa-check"></i><b>6.5.1</b> <code>map_plan()</code></a></li>
<li class="chapter" data-level="6.5.2" data-path="plans.html"><a href="plans.html#wildcard-templating"><i class="fa fa-check"></i><b>6.5.2</b> Wildcard templating</a></li>
<li class="chapter" data-level="6.5.3" data-path="plans.html"><a href="plans.html#wildcard-clusters"><i class="fa fa-check"></i><b>6.5.3</b> Wildcard clusters</a></li>
<li class="chapter" data-level="6.5.4" data-path="plans.html"><a href="plans.html#specialized-wildcard-functionality"><i class="fa fa-check"></i><b>6.5.4</b> Specialized wildcard functionality</a></li>
<li class="chapter" data-level="6.5.5" data-path="plans.html"><a href="plans.html#non-wildcard-functions"><i class="fa fa-check"></i><b>6.5.5</b> Non-wildcard functions</a></li>
<li class="chapter" data-level="6.5.6" data-path="plans.html"><a href="plans.html#custom-metaprogramming"><i class="fa fa-check"></i><b>6.5.6</b> Custom metaprogramming</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="plans.html"><a href="plans.html#optional-columns-in-your-plan."><i class="fa fa-check"></i><b>6.6</b> Optional columns in your plan.</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="organize.html"><a href="organize.html"><i class="fa fa-check"></i><b>7</b> How to organize the files of drake projects</a><ul>
<li class="chapter" data-level="7.1" data-path="organize.html"><a href="organize.html#examples-1"><i class="fa fa-check"></i><b>7.1</b> Examples</a></li>
<li class="chapter" data-level="7.2" data-path="organize.html"><a href="organize.html#where-do-you-put-your-code"><i class="fa fa-check"></i><b>7.2</b> Where do you put your code?</a></li>
<li class="chapter" data-level="7.3" data-path="organize.html"><a href="organize.html#your-commands-are-code-chunks-not-r-scripts"><i class="fa fa-check"></i><b>7.3</b> Your commands are code chunks, not R scripts</a></li>
<li class="chapter" data-level="7.4" data-path="organize.html"><a href="organize.html#workflows-as-r-packages"><i class="fa fa-check"></i><b>7.4</b> Workflows as R packages</a><ul>
<li class="chapter" data-level="7.4.1" data-path="organize.html"><a href="organize.html#advantages-of-putting-workflows-in-r-packages"><i class="fa fa-check"></i><b>7.4.1</b> Advantages of putting workflows in R packages</a></li>
<li class="chapter" data-level="7.4.2" data-path="organize.html"><a href="organize.html#the-problem"><i class="fa fa-check"></i><b>7.4.2</b> The problem</a></li>
<li class="chapter" data-level="7.4.3" data-path="organize.html"><a href="organize.html#the-solution"><i class="fa fa-check"></i><b>7.4.3</b> The solution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="vis.html"><a href="vis.html"><i class="fa fa-check"></i><b>8</b> Visualization with drake</a><ul>
<li class="chapter" data-level="8.0.1" data-path="vis.html"><a href="vis.html#vis_drake_graph"><i class="fa fa-check"></i><b>8.0.1</b> <code>vis_drake_graph()</code></a></li>
<li class="chapter" data-level="8.0.2" data-path="vis.html"><a href="vis.html#sankey_drake_graph"><i class="fa fa-check"></i><b>8.0.2</b> <code>sankey_drake_graph()</code></a></li>
<li class="chapter" data-level="8.0.3" data-path="vis.html"><a href="vis.html#drake_ggraph"><i class="fa fa-check"></i><b>8.0.3</b> <code>drake_ggraph()</code></a></li>
<li class="chapter" data-level="8.1" data-path="vis.html"><a href="vis.html#underlying-graph-data-node-and-edge-data-frames"><i class="fa fa-check"></i><b>8.1</b> Underlying graph data: node and edge data frames</a></li>
<li class="chapter" data-level="8.2" data-path="vis.html"><a href="vis.html#visualizing-target-status"><i class="fa fa-check"></i><b>8.2</b> Visualizing target status</a></li>
<li class="chapter" data-level="8.3" data-path="vis.html"><a href="vis.html#subgraphs"><i class="fa fa-check"></i><b>8.3</b> Subgraphs</a></li>
<li class="chapter" data-level="8.4" data-path="vis.html"><a href="vis.html#control-the-vis_drake_graph-legend."><i class="fa fa-check"></i><b>8.4</b> Control the <code>vis_drake_graph()</code> legend.</a></li>
<li class="chapter" data-level="8.5" data-path="vis.html"><a href="vis.html#clusters"><i class="fa fa-check"></i><b>8.5</b> Clusters</a></li>
<li class="chapter" data-level="8.6" data-path="vis.html"><a href="vis.html#output-files"><i class="fa fa-check"></i><b>8.6</b> Output files</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="debug.html"><a href="debug.html"><i class="fa fa-check"></i><b>9</b> Debugging and testing drake projects</a><ul>
<li class="chapter" data-level="9.1" data-path="debug.html"><a href="debug.html#dependencies"><i class="fa fa-check"></i><b>9.1</b> Dependencies</a><ul>
<li class="chapter" data-level="9.1.1" data-path="debug.html"><a href="debug.html#visualize-your-dependency-graph."><i class="fa fa-check"></i><b>9.1.1</b> Visualize your dependency graph.</a></li>
<li class="chapter" data-level="9.1.2" data-path="debug.html"><a href="debug.html#check-specific-dependency-information."><i class="fa fa-check"></i><b>9.1.2</b> Check specific dependency information.</a></li>
<li class="chapter" data-level="9.1.3" data-path="debug.html"><a href="debug.html#outdated-targets-and-missing-dependencies"><i class="fa fa-check"></i><b>9.1.3</b> Outdated targets and missing dependencies</a></li>
<li class="chapter" data-level="9.1.4" data-path="debug.html"><a href="debug.html#but-why-are-my-targets-out-of-date"><i class="fa fa-check"></i><b>9.1.4</b> But <em>why</em> are my targets out of date?</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="debug.html"><a href="debug.html#diagnose-failures."><i class="fa fa-check"></i><b>9.2</b> Diagnose failures.</a></li>
<li class="chapter" data-level="9.3" data-path="debug.html"><a href="debug.html#timeouts-and-retries"><i class="fa fa-check"></i><b>9.3</b> Timeouts and retries</a></li>
<li class="chapter" data-level="9.4" data-path="debug.html"><a href="debug.html#consider-hasty-mode"><i class="fa fa-check"></i><b>9.4</b> Consider hasty mode</a></li>
<li class="chapter" data-level="9.5" data-path="debug.html"><a href="debug.html#more-help"><i class="fa fa-check"></i><b>9.5</b> More help</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="hpc.html"><a href="hpc.html"><i class="fa fa-check"></i><b>10</b> High-performance computing with drake</a><ul>
<li class="chapter" data-level="10.1" data-path="hpc.html"><a href="hpc.html#batch-mode-for-long-workflows"><i class="fa fa-check"></i><b>10.1</b> Batch mode for long workflows</a></li>
<li class="chapter" data-level="10.2" data-path="hpc.html"><a href="hpc.html#let-drake-schedule-your-targets."><i class="fa fa-check"></i><b>10.2</b> Let drake schedule your targets.</a></li>
<li class="chapter" data-level="10.3" data-path="hpc.html"><a href="hpc.html#parallel-backends"><i class="fa fa-check"></i><b>10.3</b> Parallel backends</a></li>
<li class="chapter" data-level="10.4" data-path="hpc.html"><a href="hpc.html#local-workers"><i class="fa fa-check"></i><b>10.4</b> Local workers</a></li>
<li class="chapter" data-level="10.5" data-path="hpc.html"><a href="hpc.html#remote-workers"><i class="fa fa-check"></i><b>10.5</b> Remote workers</a><ul>
<li class="chapter" data-level="10.5.1" data-path="hpc.html"><a href="hpc.html#clustermq-clustermq_staged-and-hasty"><i class="fa fa-check"></i><b>10.5.1</b> <code>&quot;clustermq&quot;</code>, <code>&quot;clustermq_staged&quot;</code>, and <code>&quot;hasty&quot;</code></a></li>
<li class="chapter" data-level="10.5.2" data-path="hpc.html"><a href="hpc.html#future-future_lapply-and-future_lapply_staged"><i class="fa fa-check"></i><b>10.5.2</b> <code>&quot;future&quot;</code>, <code>&quot;future_lapply&quot;</code>, and <code>&quot;future_lapply_staged&quot;</code></a></li>
<li class="chapter" data-level="10.5.3" data-path="hpc.html"><a href="hpc.html#makefile"><i class="fa fa-check"></i><b>10.5.3</b> <code>&quot;Makefile&quot;</code></a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="hpc.html"><a href="hpc.html#scheduling-algorithms"><i class="fa fa-check"></i><b>10.6</b> Scheduling algorithms</a><ul>
<li class="chapter" data-level="10.6.1" data-path="hpc.html"><a href="hpc.html#persistent-scheduling"><i class="fa fa-check"></i><b>10.6.1</b> Persistent scheduling</a></li>
<li class="chapter" data-level="10.6.2" data-path="hpc.html"><a href="hpc.html#transient-scheduling"><i class="fa fa-check"></i><b>10.6.2</b> Transient scheduling</a></li>
<li class="chapter" data-level="10.6.3" data-path="hpc.html"><a href="hpc.html#staged-scheduling"><i class="fa fa-check"></i><b>10.6.3</b> Staged scheduling</a></li>
</ul></li>
<li class="chapter" data-level="10.7" data-path="hpc.html"><a href="hpc.html#final-thoughts"><i class="fa fa-check"></i><b>10.7</b> Final thoughts</a><ul>
<li class="chapter" data-level="10.7.1" data-path="hpc.html"><a href="hpc.html#debugging"><i class="fa fa-check"></i><b>10.7.1</b> Debugging</a></li>
<li class="chapter" data-level="10.7.2" data-path="hpc.html"><a href="hpc.html#drake-as-an-ordinary-job-scheduler"><i class="fa fa-check"></i><b>10.7.2</b> drake as an ordinary job scheduler</a></li>
<li class="chapter" data-level="10.7.3" data-path="hpc.html"><a href="hpc.html#more-resources"><i class="fa fa-check"></i><b>10.7.3</b> More resources</a></li>
</ul></li>
<li class="chapter" data-level="10.8" data-path="hpc.html"><a href="hpc.html#footnotes"><i class="fa fa-check"></i><b>10.8</b> Footnotes</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="triggers.html"><a href="triggers.html"><i class="fa fa-check"></i><b>11</b> Triggers: decision rules for building targets</a><ul>
<li class="chapter" data-level="11.1" data-path="triggers.html"><a href="triggers.html#what-are-triggers"><i class="fa fa-check"></i><b>11.1</b> What are triggers?</a></li>
<li class="chapter" data-level="11.2" data-path="triggers.html"><a href="triggers.html#customization"><i class="fa fa-check"></i><b>11.2</b> Customization</a></li>
<li class="chapter" data-level="11.3" data-path="triggers.html"><a href="triggers.html#alternative-trigger-modes"><i class="fa fa-check"></i><b>11.3</b> Alternative trigger modes</a></li>
<li class="chapter" data-level="11.4" data-path="triggers.html"><a href="triggers.html#consider-hasty-mode-1"><i class="fa fa-check"></i><b>11.4</b> Consider hasty mode</a></li>
<li class="chapter" data-level="11.5" data-path="triggers.html"><a href="triggers.html#a-more-practical-example"><i class="fa fa-check"></i><b>11.5</b> A more practical example</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="time.html"><a href="time.html"><i class="fa fa-check"></i><b>12</b> Time: logging, prediction, and strategy</a><ul>
<li class="chapter" data-level="12.1" data-path="time.html"><a href="time.html#predict-total-runtime"><i class="fa fa-check"></i><b>12.1</b> Predict total runtime</a></li>
<li class="chapter" data-level="12.2" data-path="time.html"><a href="time.html#strategize-your-high-performance-computing"><i class="fa fa-check"></i><b>12.2</b> Strategize your high-performance computing</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="store.html"><a href="store.html"><i class="fa fa-check"></i><b>13</b> Storage</a><ul>
<li class="chapter" data-level="13.1" data-path="store.html"><a href="store.html#caches"><i class="fa fa-check"></i><b>13.1</b> Caches</a></li>
<li class="chapter" data-level="13.2" data-path="store.html"><a href="store.html#hash-algorithms"><i class="fa fa-check"></i><b>13.2</b> Hash algorithms</a></li>
<li class="chapter" data-level="13.3" data-path="store.html"><a href="store.html#which-hash-algorithm-should-you-choose"><i class="fa fa-check"></i><b>13.3</b> Which hash algorithm should you choose?</a></li>
<li class="chapter" data-level="13.4" data-path="store.html"><a href="store.html#select-the-hash-algorithms-of-the-cache"><i class="fa fa-check"></i><b>13.4</b> Select the hash algorithms of the cache</a></li>
<li class="chapter" data-level="13.5" data-path="store.html"><a href="store.html#using-storr-directly"><i class="fa fa-check"></i><b>13.5</b> Using <code>storr</code> directly</a></li>
<li class="chapter" data-level="13.6" data-path="store.html"><a href="store.html#cleaning-up"><i class="fa fa-check"></i><b>13.6</b> Cleaning up</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="faq.html"><a href="faq.html"><i class="fa fa-check"></i><b>A</b> Frequently-asked questions</a></li>
<li class="chapter" data-level="B" data-path="caution.html"><a href="caution.html"><i class="fa fa-check"></i><b>B</b> Cautionary notes</a><ul>
<li class="chapter" data-level="B.1" data-path="caution.html"><a href="caution.html#projects-built-with-drake-4.4.0-are-not-back-compatible-with-drake-4.4.0."><i class="fa fa-check"></i><b>B.1</b> Projects built with drake &lt;= 4.4.0 are not back compatible with drake &gt; 4.4.0.</a></li>
<li class="chapter" data-level="B.2" data-path="caution.html"><a href="caution.html#workflow-plans"><i class="fa fa-check"></i><b>B.2</b> Workflow plans</a><ul>
<li class="chapter" data-level="B.2.1" data-path="caution.html"><a href="caution.html#externalizing-commands-in-r-script-files"><i class="fa fa-check"></i><b>B.2.1</b> Externalizing commands in R script files</a></li>
<li class="chapter" data-level="B.2.2" data-path="caution.html"><a href="caution.html#commands-are-not-perfectly-flexible."><i class="fa fa-check"></i><b>B.2.2</b> Commands are NOT perfectly flexible.</a></li>
</ul></li>
<li class="chapter" data-level="B.3" data-path="caution.html"><a href="caution.html#execution"><i class="fa fa-check"></i><b>B.3</b> Execution</a><ul>
<li class="chapter" data-level="B.3.1" data-path="caution.html"><a href="caution.html#install-drake-properly."><i class="fa fa-check"></i><b>B.3.1</b> Install <code>drake</code> properly.</a></li>
<li class="chapter" data-level="B.3.2" data-path="caution.html"><a href="caution.html#install-all-your-packages."><i class="fa fa-check"></i><b>B.3.2</b> Install all your packages.</a></li>
<li class="chapter" data-level="B.3.3" data-path="caution.html"><a href="caution.html#a-note-on-tidy-evaluation"><i class="fa fa-check"></i><b>B.3.3</b> A note on tidy evaluation</a></li>
<li class="chapter" data-level="B.3.4" data-path="caution.html"><a href="caution.html#find-and-diagnose-your-errors."><i class="fa fa-check"></i><b>B.3.4</b> Find and diagnose your errors.</a></li>
<li class="chapter" data-level="B.3.5" data-path="caution.html"><a href="caution.html#refresh-the-drake_config-list-early-and-often."><i class="fa fa-check"></i><b>B.3.5</b> Refresh the <code>drake_config()</code> list early and often.</a></li>
<li class="chapter" data-level="B.3.6" data-path="caution.html"><a href="caution.html#workflows-as-r-packages."><i class="fa fa-check"></i><b>B.3.6</b> Workflows as R packages.</a></li>
<li class="chapter" data-level="B.3.7" data-path="caution.html"><a href="caution.html#the-lazy_load-flag-does-not-work-with-parlapply-parallelism."><i class="fa fa-check"></i><b>B.3.7</b> The <code>lazy_load</code> flag does not work with <code>&quot;parLapply&quot;</code> parallelism.</a></li>
<li class="chapter" data-level="B.3.8" data-path="caution.html"><a href="caution.html#timeouts-may-be-unreliable."><i class="fa fa-check"></i><b>B.3.8</b> Timeouts may be unreliable.</a></li>
</ul></li>
<li class="chapter" data-level="B.4" data-path="caution.html"><a href="caution.html#dependencies-1"><i class="fa fa-check"></i><b>B.4</b> Dependencies</a><ul>
<li class="chapter" data-level="B.4.1" data-path="caution.html"><a href="caution.html#objects-that-contain-functions-may-rebuild-too-often"><i class="fa fa-check"></i><b>B.4.1</b> Objects that contain functions may rebuild too often</a></li>
<li class="chapter" data-level="B.4.2" data-path="caution.html"><a href="caution.html#the-magrittr-dot-.-is-always-ignored."><i class="fa fa-check"></i><b>B.4.2</b> The <code>magrittr</code> dot (<code>.</code>) is always ignored.</a></li>
<li class="chapter" data-level="B.4.3" data-path="caution.html"><a href="caution.html#dependencies-are-not-tracked-in-some-edge-cases."><i class="fa fa-check"></i><b>B.4.3</b> Dependencies are not tracked in some edge cases.</a></li>
<li class="chapter" data-level="B.4.4" data-path="caution.html"><a href="caution.html#dependencies-of-knitr-reports"><i class="fa fa-check"></i><b>B.4.4</b> Dependencies of <code>knitr</code> reports</a></li>
<li class="chapter" data-level="B.4.5" data-path="caution.html"><a href="caution.html#file-outputs-in-imported-functions."><i class="fa fa-check"></i><b>B.4.5</b> File outputs in imported functions.</a></li>
<li class="chapter" data-level="B.4.6" data-path="caution.html"><a href="caution.html#functions-produced-by-vectorize"><i class="fa fa-check"></i><b>B.4.6</b> Functions produced by <code>Vectorize()</code></a></li>
<li class="chapter" data-level="B.4.7" data-path="caution.html"><a href="caution.html#compiled-code-is-not-reproducibly-tracked."><i class="fa fa-check"></i><b>B.4.7</b> Compiled code is not reproducibly tracked.</a></li>
<li class="chapter" data-level="B.4.8" data-path="caution.html"><a href="caution.html#directories-folders-are-not-reproducibly-tracked."><i class="fa fa-check"></i><b>B.4.8</b> Directories (folders) are not reproducibly tracked.</a></li>
<li class="chapter" data-level="B.4.9" data-path="caution.html"><a href="caution.html#packages-are-not-tracked-as-dependencies."><i class="fa fa-check"></i><b>B.4.9</b> Packages are not tracked as dependencies.</a></li>
</ul></li>
<li class="chapter" data-level="B.5" data-path="caution.html"><a href="caution.html#high-performance-computing"><i class="fa fa-check"></i><b>B.5</b> High-performance computing</a><ul>
<li class="chapter" data-level="B.5.1" data-path="caution.html"><a href="caution.html#the-practical-utility-of-parallel-computing"><i class="fa fa-check"></i><b>B.5.1</b> The practical utility of parallel computing</a></li>
<li class="chapter" data-level="B.5.2" data-path="caution.html"><a href="caution.html#maximum-number-of-simultaneous-jobs"><i class="fa fa-check"></i><b>B.5.2</b> Maximum number of simultaneous jobs</a></li>
<li class="chapter" data-level="B.5.3" data-path="caution.html"><a href="caution.html#parallel-computing-on-windows"><i class="fa fa-check"></i><b>B.5.3</b> Parallel computing on Windows</a></li>
<li class="chapter" data-level="B.5.4" data-path="caution.html"><a href="caution.html#configuring-futurebatchtools-parallelism-for-clusters"><i class="fa fa-check"></i><b>B.5.4</b> Configuring <a href="https://github.com/HenrikBengtsson/future">future</a>/<a href="https://github.com/mllg/batchtools">batchtools</a> parallelism for clusters</a></li>
<li class="chapter" data-level="B.5.5" data-path="caution.html"><a href="caution.html#proper-makefiles-are-not-standalone."><i class="fa fa-check"></i><b>B.5.5</b> Proper Makefiles are not standalone.</a></li>
<li class="chapter" data-level="B.5.6" data-path="caution.html"><a href="caution.html#makefile-level-parallelism-for-imported-objects-and-files"><i class="fa fa-check"></i><b>B.5.6</b> Makefile-level parallelism for imported objects and files</a></li>
<li class="chapter" data-level="B.5.7" data-path="caution.html"><a href="caution.html#zombie-processes"><i class="fa fa-check"></i><b>B.5.7</b> Zombie processes</a></li>
</ul></li>
<li class="chapter" data-level="B.6" data-path="caution.html"><a href="caution.html#storage"><i class="fa fa-check"></i><b>B.6</b> Storage</a><ul>
<li class="chapter" data-level="B.6.1" data-path="caution.html"><a href="caution.html#projects-hosted-on-dropbox-and-similar-platforms"><i class="fa fa-check"></i><b>B.6.1</b> Projects hosted on Dropbox and similar platforms</a></li>
<li class="chapter" data-level="B.6.2" data-path="caution.html"><a href="caution.html#cache-customization-is-limited"><i class="fa fa-check"></i><b>B.6.2</b> Cache customization is limited</a></li>
<li class="chapter" data-level="B.6.3" data-path="caution.html"><a href="caution.html#runtime-predictions"><i class="fa fa-check"></i><b>B.6.3</b> Runtime predictions</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The drake R Package User Manual</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="organize" class="section level1">
<h1><span class="header-section-number">Chapter 7</span> How to organize the files of drake projects</h1>
<p>Unlike most workflow managers, <code>drake</code> focuses on your R session, and it does not care how you organize your files. This flexibility is great in the long run, but it leaves many new users wondering how to structure their projects. This chapter provides guidance, advice, and recommendations on structure and organization.</p>
<div id="examples-1" class="section level2">
<h2><span class="header-section-number">7.1</span> Examples</h2>
<p>For examples of how to structure your code files, see the beginner oriented example projects:</p>
<ul>
<li><a href="https://github.com/wlandau/drake-examples/tree/master/mtcars">mtcars</a></li>
<li><a href="https://github.com/wlandau/drake-examples/tree/master/gsp">gsp</a></li>
<li><a href="https://github.com/wlandau/drake-examples/tree/master/packages">packages</a></li>
</ul>
<p>Write the code directly with the <code>drake_example()</code> function.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb138-1" data-line-number="1"><span class="kw">drake_example</span>(<span class="st">&quot;mtcars&quot;</span>)</a>
<a class="sourceLine" id="cb138-2" data-line-number="2"><span class="kw">drake_example</span>(<span class="st">&quot;gsp&quot;</span>)</a>
<a class="sourceLine" id="cb138-3" data-line-number="3"><span class="kw">drake_example</span>(<span class="st">&quot;packages&quot;</span>)</a></code></pre></div>
<p>In practice, you do not need to organize your files the way the examples do, but it does happen to be a reasonable way of doing things.</p>
</div>
<div id="where-do-you-put-your-code" class="section level2">
<h2><span class="header-section-number">7.2</span> Where do you put your code?</h2>
<p>It is best to write your code as a bunch of functions. You can save those functions in R scripts and then <code>source()</code> them before doing anything else.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb139-1" data-line-number="1"><span class="co"># Load functions get_data(), analyze_data, and summarize_results()</span></a>
<a class="sourceLine" id="cb139-2" data-line-number="2"><span class="kw">source</span>(<span class="st">&quot;my_functions.R&quot;</span>)</a></code></pre></div>
<p>Then, set up your workflow plan data frame.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb140-1" data-line-number="1">good_plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb140-2" data-line-number="2">  <span class="dt">my_data =</span> <span class="kw">get_data</span>(<span class="kw">file_in</span>(<span class="st">&quot;data.csv&quot;</span>)), <span class="co"># External files need to be in commands explicitly. # nolint</span></a>
<a class="sourceLine" id="cb140-3" data-line-number="3">  <span class="dt">my_analysis =</span> <span class="kw">analyze_data</span>(my_data),</a>
<a class="sourceLine" id="cb140-4" data-line-number="4">  <span class="dt">my_summaries =</span> <span class="kw">summarize_results</span>(my_data, my_analysis)</a>
<a class="sourceLine" id="cb140-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb140-6" data-line-number="6"></a>
<a class="sourceLine" id="cb140-7" data-line-number="7">good_plan</a>
<a class="sourceLine" id="cb140-8" data-line-number="8">## # A tibble: 3 x 2</a>
<a class="sourceLine" id="cb140-9" data-line-number="9">##   target       command                                </a>
<a class="sourceLine" id="cb140-10" data-line-number="10">##   &lt;chr&gt;        &lt;chr&gt;                                  </a>
<a class="sourceLine" id="cb140-11" data-line-number="11">## 1 my_data      &quot;get_data(file_in(\&quot;data.csv\&quot;))&quot;      </a>
<a class="sourceLine" id="cb140-12" data-line-number="12">## 2 my_analysis  analyze_data(my_data)                  </a>
<a class="sourceLine" id="cb140-13" data-line-number="13">## 3 my_summaries summarize_results(my_data, my_analysis)</a></code></pre></div>
<p><code>drake</code> knows that <code>my_analysis</code> depends on <code>my_data</code> because <code>my_data</code> is an argument to <code>analyze_data()</code>, which is part of the command for <code>my_analysis</code>.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb141-1" data-line-number="1">config &lt;-<span class="st"> </span><span class="kw">drake_config</span>(good_plan)</a>
<a class="sourceLine" id="cb141-2" data-line-number="2">## Unloading targets from environment:</a>
<a class="sourceLine" id="cb141-3" data-line-number="3">##   my_summaries</a>
<a class="sourceLine" id="cb141-4" data-line-number="4"><span class="kw">vis_drake_graph</span>(config)</a></code></pre></div>
<div id="htmlwidget-e9f90e3194077d960e00" style="width:576px;height:576px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-e9f90e3194077d960e00">{"x":{"nodes":{"id":["\"data.csv\"","analyze_data","get_data","my_analysis","my_data","my_summaries","summarize_results"],"deps":[null,{},{},{},{},{},{}],"trigger":[null,null,null,{},{},{},null],"label":["\"data.csv\"\n0.015s","analyze_data\n0.006s","get_data\n0.003s","my_analysis","my_data","my_summaries","summarize_results\n0.003s"],"command":[null,null,null,"analyze_data(my_data)","get_data(file_in(\"data.csv\"))","summarize_results(my_data, my_analysis)",null],"status":["imported","imported","imported","outdated","outdated","outdated","imported"],"type":["file","function","function","object","object","object","function"],"font.size":[20,20,20,20,20,20,20],"color":["#1874CD","#1874CD","#1874CD","#000000","#000000","#000000","#1874CD"],"shape":["square","triangle","triangle","dot","dot","dot","triangle"],"level":[1,1,1,3,2,4,1],"title":["","function&nbsp;()&nbsp;<br>{<br>}","function&nbsp;()&nbsp;<br>{<br>}","analyze_data(my_data)","get_data(file_in(\"data.csv\"))","summarize_results(my_data,&nbsp;my_analysis)","function&nbsp;()&nbsp;<br>{<br>}"],"x":[-1,0.333333333333333,-0.333333333333333,0.333333333333333,-0.666666666666667,0.333333333333333,1],"y":[-1,-1,-1,0.333333333333333,-0.333333333333333,1,-1]},"edges":{"from":["analyze_data","get_data","summarize_results","\"data.csv\"","my_data","my_data","my_analysis"],"to":["my_analysis","my_data","my_summaries","my_data","my_analysis","my_summaries","my_summaries"],"file":[0,0,0,0,0,0,0],"arrows":["to","to","to","to","to","to","to"],"smooth":[true,true,true,true,true,true,true]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}},"edges":{"smooth":false},"physics":{"stabilization":false},"interaction":{"navigationButtons":true}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)"},"main":{"text":"Dependency graph","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":false,"hoverNearest":false,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null},"legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Outdated","Imported","Object","Function","File"],"color":["#000000","#1874CD","#888888","#888888","#888888"],"shape":["dot","dot","dot","triangle","square"],"font.color":["black","black","black","black","black"],"font.size":[20,20,20,20,20],"id":[2,5,7,8,9]},"nodesToDataframe":true},"igraphlayout":{"type":"square"},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script>
<p>Now, you can call <code>make()</code> to build the targets.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb142-1" data-line-number="1"><span class="kw">make</span>(good_plan)</a></code></pre></div>
<p>If your commands are really long, just put them in larger functions. <code>drake</code> analyzes imported functions for non-file dependencies.</p>
</div>
<div id="your-commands-are-code-chunks-not-r-scripts" class="section level2">
<h2><span class="header-section-number">7.3</span> Your commands are code chunks, not R scripts</h2>
<p>Some people are accustomed to dividing their work into R scripts and then calling <code>source()</code> to run each step of the analysis. For example you might have the following files.</p>
<ul>
<li><code>get_data.R</code></li>
<li><code>analyze_data.R</code></li>
<li><code>summarize_results.R</code></li>
</ul>
<p>If you migrate to <code>drake</code>, you may be tempted to set up a workflow plan like this.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb143-1" data-line-number="1">bad_plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb143-2" data-line-number="2">  <span class="dt">my_data =</span> <span class="kw">source</span>(<span class="kw">file_in</span>(<span class="st">&quot;get_data.R&quot;</span>)),</a>
<a class="sourceLine" id="cb143-3" data-line-number="3">  <span class="dt">my_analysis =</span> <span class="kw">source</span>(<span class="kw">file_in</span>(<span class="st">&quot;analyze_data.R&quot;</span>)),</a>
<a class="sourceLine" id="cb143-4" data-line-number="4">  <span class="dt">my_summaries =</span> <span class="kw">source</span>(<span class="kw">file_in</span>(<span class="st">&quot;summarize_data.R&quot;</span>))</a>
<a class="sourceLine" id="cb143-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb143-6" data-line-number="6"></a>
<a class="sourceLine" id="cb143-7" data-line-number="7">bad_plan</a>
<a class="sourceLine" id="cb143-8" data-line-number="8">## # A tibble: 3 x 2</a>
<a class="sourceLine" id="cb143-9" data-line-number="9">##   target       command                                </a>
<a class="sourceLine" id="cb143-10" data-line-number="10">##   &lt;chr&gt;        &lt;chr&gt;                                  </a>
<a class="sourceLine" id="cb143-11" data-line-number="11">## 1 my_data      &quot;source(file_in(\&quot;get_data.R\&quot;))&quot;      </a>
<a class="sourceLine" id="cb143-12" data-line-number="12">## 2 my_analysis  &quot;source(file_in(\&quot;analyze_data.R\&quot;))&quot;  </a>
<a class="sourceLine" id="cb143-13" data-line-number="13">## 3 my_summaries &quot;source(file_in(\&quot;summarize_data.R\&quot;))&quot;</a></code></pre></div>
<p>But now, the dependency structure of your work is broken. Your R script files are dependencies, but since <code>my_data</code> is not mentioned in a function or command, <code>drake</code> does not know that <code>my_analysis</code> depends on it.</p>
<pre><code>## [[1]]
## [1] TRUE
## 
## [[2]]
## [1] TRUE
## 
## [[3]]
## [1] TRUE</code></pre>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb145-1" data-line-number="1">config &lt;-<span class="st"> </span><span class="kw">drake_config</span>(bad_plan)</a>
<a class="sourceLine" id="cb145-2" data-line-number="2"><span class="kw">vis_drake_graph</span>(config)</a></code></pre></div>
<div id="htmlwidget-270cf12dee99691b5d50" style="width:576px;height:576px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-270cf12dee99691b5d50">{"x":{"nodes":{"id":["\"analyze_data.R\"","\"get_data.R\"","\"summarize_data.R\"","my_analysis","my_data","my_summaries"],"deps":[null,null,null,{},{},{}],"trigger":[null,null,null,{},{},{}],"label":["\"analyze_data.R\"\n0.014s","\"get_data.R\"\n0.005s","\"summarize_data.R\"\n0.005s","my_analysis","my_data","my_summaries"],"command":[null,null,null,"source(file_in(\"analyze_data.R\"))","source(file_in(\"get_data.R\"))","source(file_in(\"summarize_data.R\"))"],"status":["imported","imported","imported","outdated","outdated","outdated"],"type":["file","file","file","object","object","object"],"font.size":[20,20,20,20,20,20],"color":["#1874CD","#1874CD","#1874CD","#000000","#000000","#000000"],"shape":["square","square","square","dot","dot","dot"],"level":[1,1,1,2,2,2],"title":["","","","source(file_in(\"analyze_data.R\"))","source(file_in(\"get_data.R\"))","source(file_in(\"summarize_data.R\"))"],"x":[-1,0,1,-1,0,1],"y":[-1,-1,-1,1,1,1]},"edges":{"from":["\"get_data.R\"","\"analyze_data.R\"","\"summarize_data.R\""],"to":["my_data","my_analysis","my_summaries"],"file":[0,0,0],"arrows":["to","to","to"],"smooth":[true,true,true]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}},"edges":{"smooth":false},"physics":{"stabilization":false},"interaction":{"navigationButtons":true}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)"},"main":{"text":"Dependency graph","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":false,"hoverNearest":false,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null},"legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Outdated","Imported","Object","File"],"color":["#000000","#1874CD","#888888","#888888"],"shape":["dot","dot","dot","square"],"font.color":["black","black","black","black"],"font.size":[20,20,20,20],"id":[2,5,7,9]},"nodesToDataframe":true},"igraphlayout":{"type":"square"},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script>
<pre><code>## [[1]]
## [1] TRUE
## 
## [[2]]
## [1] TRUE
## 
## [[3]]
## [1] TRUE</code></pre>
<p>Dangers:</p>
<ol style="list-style-type: decimal">
<li>In the first <code>make(bad_plan, jobs = 2)</code>, <code>drake</code> will try to build <code>my_data</code> and <code>my_analysis</code> at the same time even though <code>my_data</code> must finish before <code>my_analysis</code> begins.</li>
<li><code>drake</code> is oblivious to <code>data.csv</code> since it is not explicitly mentioned in a workflow plan command. So when <code>data.csv</code> changes, <code>make(bad_plan)</code> will not rebuild <code>my_data</code>.</li>
<li><code>my_analysis</code> will not update when <code>my_data</code> changes.</li>
<li>The return value of <code>source()</code> is formatted counter-intuitively. If <code>source(file_in(&quot;get_data.R&quot;))</code> is the command for <code>my_data</code>, then <code>my_data</code> will always be a list with elements <code>&quot;value&quot;</code> and <code>&quot;visible&quot;</code>. In other words, <code>source(file_in(&quot;get_data.R&quot;))$value</code> is really what you would want.</li>
</ol>
<p>In addition, this <code>source()</code>-based approach is simply inconvenient. <code>drake</code> rebuilds <code>my_data</code> every time <code>get_data.R</code> changes, even when those changes are just extra comments or blank lines. On the other hand, in the previous plan that uses <code>my_data = get_data()</code>, <code>drake</code> does not trigger rebuilds when comments or whitespace in <code>get_data()</code> are modified. <code>drake</code> is R-focused, not file-focused. If you embrace this viewpoint, your work will be easier.</p>
</div>
<div id="workflows-as-r-packages" class="section level2">
<h2><span class="header-section-number">7.4</span> Workflows as R packages</h2>
<p>The R package structure is a great way to organize the files of your project. Writing your own package to contain your data science workflow is a good idea, but you will need to</p>
<ol style="list-style-type: decimal">
<li>Use <code>expose_imports()</code> to properly account for all your nested function dependencies, and</li>
<li>If you load the package with <code>devtools::load_all()</code>, set the <code>prework</code> argument of <code>make()</code>: e.g. <code>make(prework = &quot;devtools::load_all()&quot;)</code>.</li>
</ol>
<p>Thanks to <a href="https://github.com/dapperjapper">Jasper Clarkberg</a> for the workaround behind <code>expose_imports()</code>.</p>
<div id="advantages-of-putting-workflows-in-r-packages" class="section level3">
<h3><span class="header-section-number">7.4.1</span> Advantages of putting workflows in R packages</h3>
<ul>
<li>The file organization of R packages is a well-understood community standard. If you follow it, your work may be more readable and thus reproducible.</li>
<li>R package installation is a standard process. The system makes it easier for others to obtain and run your code.</li>
<li>You get development and quality control tools for free: <a href="https://github.com/hadley/devtools">helpers for loading code and creating files</a>, <a href="http://r-pkgs.had.co.nz/tests.html">unit testing</a>, <a href="http://r-pkgs.had.co.nz/check.html">package checks</a>, <a href="https://github.com/r-lib/covr">code coverage</a>, and <a href="https://ipub.com/continuous-integration-for-r/">continuous integration</a>.</li>
</ul>
</div>
<div id="the-problem" class="section level3">
<h3><span class="header-section-number">7.4.2</span> The problem</h3>
<p>For <code>drake</code>, there is one problem: nested functions. <code>drake</code> always looks for imported functions nested in other imported functions, but only in your environment. When it sees a function from a package, it does not look in its body for other imports.</p>
<p>To see this, consider the <code>digest()</code> function from the <a href="https://github.com/eddelbuettel/digest"><code>digest</code> package</a>. <a href="https://github.com/eddelbuettel/digest"><code>Digest</code> package</a> is a utility for computing hashes, not a data science workflow, but I will use it to demonstrate how <code>drake</code> treats imports from packages.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb147-1" data-line-number="1"><span class="kw">library</span>(digest)</a>
<a class="sourceLine" id="cb147-2" data-line-number="2">g &lt;-<span class="st"> </span><span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb147-3" data-line-number="3">  <span class="kw">digest</span>(x)</a>
<a class="sourceLine" id="cb147-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb147-5" data-line-number="5">f &lt;-<span class="st"> </span><span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb147-6" data-line-number="6">  <span class="kw">g</span>(x)</a>
<a class="sourceLine" id="cb147-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb147-8" data-line-number="8">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(<span class="dt">x =</span> <span class="kw">f</span>(<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb147-9" data-line-number="9"></a>
<a class="sourceLine" id="cb147-10" data-line-number="10"><span class="co"># Here are the reproducibly tracked objects in the workflow.</span></a>
<a class="sourceLine" id="cb147-11" data-line-number="11">config &lt;-<span class="st"> </span><span class="kw">drake_config</span>(plan)</a>
<a class="sourceLine" id="cb147-12" data-line-number="12"><span class="kw">tracked</span>(config)</a>
<a class="sourceLine" id="cb147-13" data-line-number="13">## [1] &quot;f&quot; &quot;g&quot; &quot;x&quot;</a>
<a class="sourceLine" id="cb147-14" data-line-number="14"></a>
<a class="sourceLine" id="cb147-15" data-line-number="15"><span class="co"># But the `digest()` function has dependencies too.</span></a>
<a class="sourceLine" id="cb147-16" data-line-number="16"><span class="co"># Because `drake` knows `digest()` is from a package,</span></a>
<a class="sourceLine" id="cb147-17" data-line-number="17"><span class="co"># it ignores these dependencies by default.</span></a>
<a class="sourceLine" id="cb147-18" data-line-number="18"><span class="kw">head</span>(<span class="kw">deps_code</span>(digest), <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb147-19" data-line-number="19">## $globals</a>
<a class="sourceLine" id="cb147-20" data-line-number="20">##  [1] &quot;match.arg&quot;                &quot;stop&quot;                    </a>
<a class="sourceLine" id="cb147-21" data-line-number="21">##  [3] &quot;warning&quot;                  &quot;return&quot;                  </a>
<a class="sourceLine" id="cb147-22" data-line-number="22">##  [5] &quot;invisible&quot;                &quot;is.infinite&quot;             </a>
<a class="sourceLine" id="cb147-23" data-line-number="23">##  [7] &quot;is.character&quot;             &quot;missing&quot;                 </a>
<a class="sourceLine" id="cb147-24" data-line-number="24">##  [9] &quot;names&quot;                    &quot;formals&quot;                 </a>
<a class="sourceLine" id="cb147-25" data-line-number="25">## [11] &quot;any&quot;                      &quot;is.na&quot;                   </a>
<a class="sourceLine" id="cb147-26" data-line-number="26">## [13] &quot;pmatch&quot;                   &quot;which&quot;                   </a>
<a class="sourceLine" id="cb147-27" data-line-number="27">## [15] &quot;as.raw&quot;                   &quot;inherits&quot;                </a>
<a class="sourceLine" id="cb147-28" data-line-number="28">## [17] &quot;paste&quot;                    &quot;switch&quot;                  </a>
<a class="sourceLine" id="cb147-29" data-line-number="29">## [19] &quot;path.expand&quot;              &quot;file.exists&quot;             </a>
<a class="sourceLine" id="cb147-30" data-line-number="30">## [21] &quot;isTRUE&quot;                   &quot;file.info&quot;               </a>
<a class="sourceLine" id="cb147-31" data-line-number="31">## [23] &quot;file.access&quot;              &quot;.Call&quot;                   </a>
<a class="sourceLine" id="cb147-32" data-line-number="32">## [25] &quot;digest_impl&quot;              &quot;as.integer&quot;              </a>
<a class="sourceLine" id="cb147-33" data-line-number="33">## [27] &quot;.getCRC32PreferOldOutput&quot; &quot;sub&quot;                     </a>
<a class="sourceLine" id="cb147-34" data-line-number="34">## </a>
<a class="sourceLine" id="cb147-35" data-line-number="35">## $namespaced</a>
<a class="sourceLine" id="cb147-36" data-line-number="36">## [1] &quot;base::serialize&quot;</a></code></pre></div>
</div>
<div id="the-solution" class="section level3">
<h3><span class="header-section-number">7.4.3</span> The solution</h3>
<p>To force <code>drake</code> to dive deeper into the nested functions in a package, you must use <code>expose_imports()</code>. Again, I demonstrate with the <a href="https://github.com/eddelbuettel/digest"><code>digest</code> package</a> package, but you should really only do this with a package you write yourself to contain your workflow. For external packages, <a href="https://rstudio.github.io/packrat/">packrat</a> is a much better solution for package reproducibility.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb148-1" data-line-number="1"><span class="kw">expose_imports</span>(digest)</a>
<a class="sourceLine" id="cb148-2" data-line-number="2">## &lt;environment: R_GlobalEnv&gt;</a>
<a class="sourceLine" id="cb148-3" data-line-number="3">config &lt;-<span class="st"> </span><span class="kw">drake_config</span>(plan)</a>
<a class="sourceLine" id="cb148-4" data-line-number="4">new_objects &lt;-<span class="st"> </span><span class="kw">tracked</span>(config)</a>
<a class="sourceLine" id="cb148-5" data-line-number="5"><span class="kw">head</span>(new_objects, <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb148-6" data-line-number="6">## [1] &quot;.getCRC32PreferOldOutput&quot; &quot;base::serialize&quot;         </a>
<a class="sourceLine" id="cb148-7" data-line-number="7">## [3] &quot;digest&quot;                   &quot;digest_impl&quot;             </a>
<a class="sourceLine" id="cb148-8" data-line-number="8">## [5] &quot;f&quot;                        &quot;g&quot;                       </a>
<a class="sourceLine" id="cb148-9" data-line-number="9">## [7] &quot;x&quot;</a>
<a class="sourceLine" id="cb148-10" data-line-number="10"><span class="kw">length</span>(new_objects)</a>
<a class="sourceLine" id="cb148-11" data-line-number="11">## [1] 7</a>
<a class="sourceLine" id="cb148-12" data-line-number="12"></a>
<a class="sourceLine" id="cb148-13" data-line-number="13"><span class="co"># Now when you call `make()`, `drake` will dive into `digest`</span></a>
<a class="sourceLine" id="cb148-14" data-line-number="14"><span class="co"># to import dependencies.</span></a>
<a class="sourceLine" id="cb148-15" data-line-number="15"></a>
<a class="sourceLine" id="cb148-16" data-line-number="16">cache &lt;-<span class="st"> </span>storr<span class="op">::</span><span class="kw">storr_environment</span>() <span class="co"># just for examples</span></a>
<a class="sourceLine" id="cb148-17" data-line-number="17"><span class="kw">make</span>(plan, <span class="dt">cache =</span> cache)</a>
<a class="sourceLine" id="cb148-18" data-line-number="18">## target x</a>
<a class="sourceLine" id="cb148-19" data-line-number="19"><span class="kw">head</span>(<span class="kw">cached</span>(<span class="dt">cache =</span> cache), <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb148-20" data-line-number="20">## [1] &quot;base::serialize&quot; &quot;digest&quot;          &quot;digest_impl&quot;     &quot;f&quot;              </a>
<a class="sourceLine" id="cb148-21" data-line-number="21">## [5] &quot;g&quot;               &quot;x&quot;</a>
<a class="sourceLine" id="cb148-22" data-line-number="22"><span class="kw">length</span>(<span class="kw">cached</span>(<span class="dt">cache =</span> cache))</a>
<a class="sourceLine" id="cb148-23" data-line-number="23">## [1] 6</a></code></pre></div>

</div>
</div>
</div>
<div style = "background: #1C356D; color: white; padding: 10px 10px 10px 25px; font-size: 1em; width: 100%;">
  Copyright Eli Lilly and Company
</div>
            </section>

          </div>
        </div>
      </div>
<a href="plans.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="vis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
