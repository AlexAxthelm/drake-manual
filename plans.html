<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>The drake R Package User Manual</title>
  <meta name="description" content="The drake R Package User Manual">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="The drake R Package User Manual" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="The drake R Package User Manual" />
  
  
  

<meta name="author" content="Will Landau, Kirill Müller, Alex Axthelm, Jasper Clarkberg, Lorenz Walthert">
<meta name="author" content="Copyright Eli Lilly and Company">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="mtcars.html">
<link rel="next" href="organize.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<link href="libs/vis-4.20.1/vis.css" rel="stylesheet" />
<script src="libs/vis-4.20.1/vis.min.js"></script>
<script src="libs/visNetwork-binding-2.0.4/visNetwork.js"></script>
<script src="libs/d3-4.5.0/d3.min.js"></script>
<script src="libs/sankey-1/sankey.js"></script>
<script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#the-drake-r-package"><i class="fa fa-check"></i><b>1.1</b> The drake R package</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#installation"><i class="fa fa-check"></i><b>1.2</b> Installation</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#why-drake"><i class="fa fa-check"></i><b>1.3</b> Why drake?</a><ul>
<li class="chapter" data-level="1.3.1" data-path="index.html"><a href="index.html#what-gets-done-stays-done."><i class="fa fa-check"></i><b>1.3.1</b> What gets done stays done.</a></li>
<li class="chapter" data-level="1.3.2" data-path="index.html"><a href="index.html#reproducibility-with-confidence"><i class="fa fa-check"></i><b>1.3.2</b> Reproducibility with confidence</a></li>
<li class="chapter" data-level="1.3.3" data-path="index.html"><a href="index.html#aggressively-scale-up."><i class="fa fa-check"></i><b>1.3.3</b> Aggressively scale up.</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#documentation"><i class="fa fa-check"></i><b>1.4</b> Documentation</a><ul>
<li class="chapter" data-level="1.4.1" data-path="index.html"><a href="index.html#cheat-sheet"><i class="fa fa-check"></i><b>1.4.1</b> Cheat sheet</a></li>
<li class="chapter" data-level="1.4.2" data-path="index.html"><a href="index.html#frequently-asked-questions"><i class="fa fa-check"></i><b>1.4.2</b> Frequently asked questions</a></li>
<li class="chapter" data-level="1.4.3" data-path="index.html"><a href="index.html#function-reference"><i class="fa fa-check"></i><b>1.4.3</b> Function reference</a></li>
<li class="chapter" data-level="1.4.4" data-path="index.html"><a href="index.html#tutorials"><i class="fa fa-check"></i><b>1.4.4</b> Tutorials</a></li>
<li class="chapter" data-level="1.4.5" data-path="index.html"><a href="index.html#examples"><i class="fa fa-check"></i><b>1.4.5</b> Examples</a></li>
<li class="chapter" data-level="1.4.6" data-path="index.html"><a href="index.html#presentations"><i class="fa fa-check"></i><b>1.4.6</b> Presentations</a></li>
<li class="chapter" data-level="1.4.7" data-path="index.html"><a href="index.html#real-example-projects"><i class="fa fa-check"></i><b>1.4.7</b> Real example projects</a></li>
<li class="chapter" data-level="1.4.8" data-path="index.html"><a href="index.html#context-and-history"><i class="fa fa-check"></i><b>1.4.8</b> Context and history</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#help-and-troubleshooting"><i class="fa fa-check"></i><b>1.5</b> Help and troubleshooting</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#similar-work"><i class="fa fa-check"></i><b>1.6</b> Similar work</a><ul>
<li class="chapter" data-level="1.6.1" data-path="index.html"><a href="index.html#gnu-make"><i class="fa fa-check"></i><b>1.6.1</b> GNU Make</a></li>
<li class="chapter" data-level="1.6.2" data-path="index.html"><a href="index.html#remake"><i class="fa fa-check"></i><b>1.6.2</b> Remake</a></li>
<li class="chapter" data-level="1.6.3" data-path="index.html"><a href="index.html#memoise"><i class="fa fa-check"></i><b>1.6.3</b> Memoise</a></li>
<li class="chapter" data-level="1.6.4" data-path="index.html"><a href="index.html#knitr-and-r-markdown"><i class="fa fa-check"></i><b>1.6.4</b> Knitr and R Markdown</a></li>
<li class="chapter" data-level="1.6.5" data-path="index.html"><a href="index.html#factuals-drake"><i class="fa fa-check"></i><b>1.6.5</b> Factual’s Drake</a></li>
<li class="chapter" data-level="1.6.6" data-path="index.html"><a href="index.html#other-pipeline-toolkits"><i class="fa fa-check"></i><b>1.6.6</b> Other pipeline toolkits</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i><b>1.7</b> Acknowledgements</a></li>
</ul></li>
<li class="part"><span><b>I Examples</b></span></li>
<li class="chapter" data-level="2" data-path="main.html"><a href="main.html"><i class="fa fa-check"></i><b>2</b> The main example</a><ul>
<li class="chapter" data-level="2.1" data-path="main.html"><a href="main.html#set-the-stage."><i class="fa fa-check"></i><b>2.1</b> Set the stage.</a></li>
<li class="chapter" data-level="2.2" data-path="main.html"><a href="main.html#make-your-results."><i class="fa fa-check"></i><b>2.2</b> Make your results.</a></li>
<li class="chapter" data-level="2.3" data-path="main.html"><a href="main.html#go-back-and-fix-things."><i class="fa fa-check"></i><b>2.3</b> Go back and fix things.</a></li>
<li class="chapter" data-level="2.4" data-path="main.html"><a href="main.html#try-it-yourself"><i class="fa fa-check"></i><b>2.4</b> Try it yourself!</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="packages.html"><a href="packages.html"><i class="fa fa-check"></i><b>3</b> An analysis of R package download trends</a><ul>
<li class="chapter" data-level="3.1" data-path="packages.html"><a href="packages.html#get-the-code."><i class="fa fa-check"></i><b>3.1</b> Get the code.</a></li>
<li class="chapter" data-level="3.2" data-path="packages.html"><a href="packages.html#overview"><i class="fa fa-check"></i><b>3.2</b> Overview</a></li>
<li class="chapter" data-level="3.3" data-path="packages.html"><a href="packages.html#analysis"><i class="fa fa-check"></i><b>3.3</b> Analysis</a></li>
<li class="chapter" data-level="3.4" data-path="packages.html"><a href="packages.html#other-ways-to-trigger-downloads"><i class="fa fa-check"></i><b>3.4</b> Other ways to trigger downloads</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="gsp.html"><a href="gsp.html"><i class="fa fa-check"></i><b>4</b> Finding the best model of gross state product</a><ul>
<li class="chapter" data-level="4.1" data-path="gsp.html"><a href="gsp.html#get-the-code.-1"><i class="fa fa-check"></i><b>4.1</b> Get the code.</a></li>
<li class="chapter" data-level="4.2" data-path="gsp.html"><a href="gsp.html#objective-and-methods"><i class="fa fa-check"></i><b>4.2</b> Objective and methods</a></li>
<li class="chapter" data-level="4.3" data-path="gsp.html"><a href="gsp.html#data"><i class="fa fa-check"></i><b>4.3</b> Data</a></li>
<li class="chapter" data-level="4.4" data-path="gsp.html"><a href="gsp.html#analysis-1"><i class="fa fa-check"></i><b>4.4</b> Analysis</a></li>
<li class="chapter" data-level="4.5" data-path="gsp.html"><a href="gsp.html#results"><i class="fa fa-check"></i><b>4.5</b> Results</a></li>
<li class="chapter" data-level="4.6" data-path="gsp.html"><a href="gsp.html#comparison-with-gnu-make"><i class="fa fa-check"></i><b>4.6</b> Comparison with GNU Make</a></li>
<li class="chapter" data-level="4.7" data-path="gsp.html"><a href="gsp.html#references"><i class="fa fa-check"></i><b>4.7</b> References</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="mtcars.html"><a href="mtcars.html"><i class="fa fa-check"></i><b>5</b> The mtcars example and workflow plan generation</a><ul>
<li class="chapter" data-level="5.1" data-path="mtcars.html"><a href="mtcars.html#get-the-code.-2"><i class="fa fa-check"></i><b>5.1</b> Get the code.</a></li>
<li class="chapter" data-level="5.2" data-path="mtcars.html"><a href="mtcars.html#quick-examples"><i class="fa fa-check"></i><b>5.2</b> Quick examples</a></li>
<li class="chapter" data-level="5.3" data-path="mtcars.html"><a href="mtcars.html#the-motivation-of-the-mtcars-example"><i class="fa fa-check"></i><b>5.3</b> The motivation of the mtcars example</a></li>
<li class="chapter" data-level="5.4" data-path="mtcars.html"><a href="mtcars.html#set-up-the-mtcars-example"><i class="fa fa-check"></i><b>5.4</b> Set up the mtcars example</a></li>
<li class="chapter" data-level="5.5" data-path="mtcars.html"><a href="mtcars.html#the-workflow-plan-data-frame"><i class="fa fa-check"></i><b>5.5</b> The workflow plan data frame</a></li>
<li class="chapter" data-level="5.6" data-path="mtcars.html"><a href="mtcars.html#generate-the-workflow-plan"><i class="fa fa-check"></i><b>5.6</b> Generate the workflow plan</a></li>
<li class="chapter" data-level="5.7" data-path="mtcars.html"><a href="mtcars.html#run-the-workflow"><i class="fa fa-check"></i><b>5.7</b> Run the workflow</a></li>
</ul></li>
<li class="part"><span><b>II Functionality</b></span></li>
<li class="chapter" data-level="6" data-path="plans.html"><a href="plans.html"><i class="fa fa-check"></i><b>6</b> Workflow plan data frames</a><ul>
<li class="chapter" data-level="6.1" data-path="plans.html"><a href="plans.html#what-is-a-workflow-plan-data-frame"><i class="fa fa-check"></i><b>6.1</b> What is a workflow plan data frame?</a></li>
<li class="chapter" data-level="6.2" data-path="plans.html"><a href="plans.html#plans-are-like-r-scripts."><i class="fa fa-check"></i><b>6.2</b> Plans are like R scripts.</a></li>
<li class="chapter" data-level="6.3" data-path="plans.html"><a href="plans.html#so-why-do-we-use-plans"><i class="fa fa-check"></i><b>6.3</b> So why do we use plans?</a><ul>
<li class="chapter" data-level="6.3.1" data-path="plans.html"><a href="plans.html#you-can-skip-up-to-date-work."><i class="fa fa-check"></i><b>6.3.1</b> You can skip up-to-date work.</a></li>
<li class="chapter" data-level="6.3.2" data-path="plans.html"><a href="plans.html#data-frames-scale-well."><i class="fa fa-check"></i><b>6.3.2</b> Data frames scale well.</a></li>
<li class="chapter" data-level="6.3.3" data-path="plans.html"><a href="plans.html#you-do-not-need-to-worry-about-which-targets-run-first."><i class="fa fa-check"></i><b>6.3.3</b> You do not need to worry about which targets run first.</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="plans.html"><a href="plans.html#automatic-dependency-detection"><i class="fa fa-check"></i><b>6.4</b> Automatic dependency detection</a></li>
<li class="chapter" data-level="6.5" data-path="plans.html"><a href="plans.html#automatically-generating-workflow-plans"><i class="fa fa-check"></i><b>6.5</b> Automatically generating workflow plans</a><ul>
<li class="chapter" data-level="6.5.1" data-path="plans.html"><a href="plans.html#map_plan"><i class="fa fa-check"></i><b>6.5.1</b> <code>map_plan()</code></a></li>
<li class="chapter" data-level="6.5.2" data-path="plans.html"><a href="plans.html#wildcard-templating"><i class="fa fa-check"></i><b>6.5.2</b> Wildcard templating</a></li>
<li class="chapter" data-level="6.5.3" data-path="plans.html"><a href="plans.html#wildcard-clusters"><i class="fa fa-check"></i><b>6.5.3</b> Wildcard clusters</a></li>
<li class="chapter" data-level="6.5.4" data-path="plans.html"><a href="plans.html#specialized-wildcard-functionality"><i class="fa fa-check"></i><b>6.5.4</b> Specialized wildcard functionality</a></li>
<li class="chapter" data-level="6.5.5" data-path="plans.html"><a href="plans.html#non-wildcard-functions"><i class="fa fa-check"></i><b>6.5.5</b> Non-wildcard functions</a></li>
<li class="chapter" data-level="6.5.6" data-path="plans.html"><a href="plans.html#custom-metaprogramming"><i class="fa fa-check"></i><b>6.5.6</b> Custom metaprogramming</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="plans.html"><a href="plans.html#optional-columns-in-your-plan."><i class="fa fa-check"></i><b>6.6</b> Optional columns in your plan.</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="organize.html"><a href="organize.html"><i class="fa fa-check"></i><b>7</b> How to organize the files of drake projects</a><ul>
<li class="chapter" data-level="7.1" data-path="organize.html"><a href="organize.html#examples-1"><i class="fa fa-check"></i><b>7.1</b> Examples</a></li>
<li class="chapter" data-level="7.2" data-path="organize.html"><a href="organize.html#where-do-you-put-your-code"><i class="fa fa-check"></i><b>7.2</b> Where do you put your code?</a></li>
<li class="chapter" data-level="7.3" data-path="organize.html"><a href="organize.html#your-commands-are-code-chunks-not-r-scripts"><i class="fa fa-check"></i><b>7.3</b> Your commands are code chunks, not R scripts</a></li>
<li class="chapter" data-level="7.4" data-path="organize.html"><a href="organize.html#workflows-as-r-packages"><i class="fa fa-check"></i><b>7.4</b> Workflows as R packages</a><ul>
<li class="chapter" data-level="7.4.1" data-path="organize.html"><a href="organize.html#advantages-of-putting-workflows-in-r-packages"><i class="fa fa-check"></i><b>7.4.1</b> Advantages of putting workflows in R packages</a></li>
<li class="chapter" data-level="7.4.2" data-path="organize.html"><a href="organize.html#the-problem"><i class="fa fa-check"></i><b>7.4.2</b> The problem</a></li>
<li class="chapter" data-level="7.4.3" data-path="organize.html"><a href="organize.html#the-solution"><i class="fa fa-check"></i><b>7.4.3</b> The solution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="vis.html"><a href="vis.html"><i class="fa fa-check"></i><b>8</b> Visualization with drake</a><ul>
<li class="chapter" data-level="8.0.1" data-path="vis.html"><a href="vis.html#vis_drake_graph"><i class="fa fa-check"></i><b>8.0.1</b> <code>vis_drake_graph()</code></a></li>
<li class="chapter" data-level="8.0.2" data-path="vis.html"><a href="vis.html#sankey_drake_graph"><i class="fa fa-check"></i><b>8.0.2</b> <code>sankey_drake_graph()</code></a></li>
<li class="chapter" data-level="8.0.3" data-path="vis.html"><a href="vis.html#drake_ggraph"><i class="fa fa-check"></i><b>8.0.3</b> <code>drake_ggraph()</code></a></li>
<li class="chapter" data-level="8.1" data-path="vis.html"><a href="vis.html#underlying-graph-data-node-and-edge-data-frames"><i class="fa fa-check"></i><b>8.1</b> Underlying graph data: node and edge data frames</a></li>
<li class="chapter" data-level="8.2" data-path="vis.html"><a href="vis.html#visualizing-target-status"><i class="fa fa-check"></i><b>8.2</b> Visualizing target status</a></li>
<li class="chapter" data-level="8.3" data-path="vis.html"><a href="vis.html#subgraphs"><i class="fa fa-check"></i><b>8.3</b> Subgraphs</a></li>
<li class="chapter" data-level="8.4" data-path="vis.html"><a href="vis.html#control-the-vis_drake_graph-legend."><i class="fa fa-check"></i><b>8.4</b> Control the <code>vis_drake_graph()</code> legend.</a></li>
<li class="chapter" data-level="8.5" data-path="vis.html"><a href="vis.html#clusters"><i class="fa fa-check"></i><b>8.5</b> Clusters</a></li>
<li class="chapter" data-level="8.6" data-path="vis.html"><a href="vis.html#output-files"><i class="fa fa-check"></i><b>8.6</b> Output files</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="debug.html"><a href="debug.html"><i class="fa fa-check"></i><b>9</b> Debugging and testing drake projects</a><ul>
<li class="chapter" data-level="9.1" data-path="debug.html"><a href="debug.html#dependencies"><i class="fa fa-check"></i><b>9.1</b> Dependencies</a><ul>
<li class="chapter" data-level="9.1.1" data-path="debug.html"><a href="debug.html#visualize-your-dependency-graph."><i class="fa fa-check"></i><b>9.1.1</b> Visualize your dependency graph.</a></li>
<li class="chapter" data-level="9.1.2" data-path="debug.html"><a href="debug.html#check-specific-dependency-information."><i class="fa fa-check"></i><b>9.1.2</b> Check specific dependency information.</a></li>
<li class="chapter" data-level="9.1.3" data-path="debug.html"><a href="debug.html#outdated-targets-and-missing-dependencies"><i class="fa fa-check"></i><b>9.1.3</b> Outdated targets and missing dependencies</a></li>
<li class="chapter" data-level="9.1.4" data-path="debug.html"><a href="debug.html#but-why-are-my-targets-out-of-date"><i class="fa fa-check"></i><b>9.1.4</b> But <em>why</em> are my targets out of date?</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="debug.html"><a href="debug.html#diagnose-failures."><i class="fa fa-check"></i><b>9.2</b> Diagnose failures.</a></li>
<li class="chapter" data-level="9.3" data-path="debug.html"><a href="debug.html#timeouts-and-retries"><i class="fa fa-check"></i><b>9.3</b> Timeouts and retries</a></li>
<li class="chapter" data-level="9.4" data-path="debug.html"><a href="debug.html#consider-blitz-mode"><i class="fa fa-check"></i><b>9.4</b> Consider blitz mode</a></li>
<li class="chapter" data-level="9.5" data-path="debug.html"><a href="debug.html#more-help"><i class="fa fa-check"></i><b>9.5</b> More help</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="hpc.html"><a href="hpc.html"><i class="fa fa-check"></i><b>10</b> High-performance computing with drake</a><ul>
<li class="chapter" data-level="10.1" data-path="hpc.html"><a href="hpc.html#batch-mode-for-long-workflows"><i class="fa fa-check"></i><b>10.1</b> Batch mode for long workflows</a></li>
<li class="chapter" data-level="10.2" data-path="hpc.html"><a href="hpc.html#let-drake-schedule-your-targets."><i class="fa fa-check"></i><b>10.2</b> Let drake schedule your targets.</a></li>
<li class="chapter" data-level="10.3" data-path="hpc.html"><a href="hpc.html#parallel-backends"><i class="fa fa-check"></i><b>10.3</b> Parallel backends</a></li>
<li class="chapter" data-level="10.4" data-path="hpc.html"><a href="hpc.html#local-workers"><i class="fa fa-check"></i><b>10.4</b> Local workers</a></li>
<li class="chapter" data-level="10.5" data-path="hpc.html"><a href="hpc.html#remote-workers"><i class="fa fa-check"></i><b>10.5</b> Remote workers</a><ul>
<li class="chapter" data-level="10.5.1" data-path="hpc.html"><a href="hpc.html#clustermq-clustermq_staged-and-blitz"><i class="fa fa-check"></i><b>10.5.1</b> <code>&quot;clustermq&quot;</code>, <code>&quot;clustermq_staged&quot;</code>, and <code>&quot;blitz&quot;</code></a></li>
<li class="chapter" data-level="10.5.2" data-path="hpc.html"><a href="hpc.html#future-future_lapply-and-future_lapply_staged"><i class="fa fa-check"></i><b>10.5.2</b> <code>&quot;future&quot;</code>, <code>&quot;future_lapply&quot;</code>, and <code>&quot;future_lapply_staged&quot;</code></a></li>
<li class="chapter" data-level="10.5.3" data-path="hpc.html"><a href="hpc.html#makefile"><i class="fa fa-check"></i><b>10.5.3</b> <code>&quot;Makefile&quot;</code></a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="hpc.html"><a href="hpc.html#scheduling-algorithms"><i class="fa fa-check"></i><b>10.6</b> Scheduling algorithms</a><ul>
<li class="chapter" data-level="10.6.1" data-path="hpc.html"><a href="hpc.html#persistent-scheduling"><i class="fa fa-check"></i><b>10.6.1</b> Persistent scheduling</a></li>
<li class="chapter" data-level="10.6.2" data-path="hpc.html"><a href="hpc.html#transient-scheduling"><i class="fa fa-check"></i><b>10.6.2</b> Transient scheduling</a></li>
<li class="chapter" data-level="10.6.3" data-path="hpc.html"><a href="hpc.html#staged-scheduling"><i class="fa fa-check"></i><b>10.6.3</b> Staged scheduling</a></li>
</ul></li>
<li class="chapter" data-level="10.7" data-path="hpc.html"><a href="hpc.html#final-thoughts"><i class="fa fa-check"></i><b>10.7</b> Final thoughts</a><ul>
<li class="chapter" data-level="10.7.1" data-path="hpc.html"><a href="hpc.html#debugging"><i class="fa fa-check"></i><b>10.7.1</b> Debugging</a></li>
<li class="chapter" data-level="10.7.2" data-path="hpc.html"><a href="hpc.html#drake-as-an-ordinary-job-scheduler"><i class="fa fa-check"></i><b>10.7.2</b> Drake as an ordinary job scheduler</a></li>
<li class="chapter" data-level="10.7.3" data-path="hpc.html"><a href="hpc.html#more-resources"><i class="fa fa-check"></i><b>10.7.3</b> More resources</a></li>
</ul></li>
<li class="chapter" data-level="10.8" data-path="hpc.html"><a href="hpc.html#footnotes"><i class="fa fa-check"></i><b>10.8</b> Footnotes</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="triggers.html"><a href="triggers.html"><i class="fa fa-check"></i><b>11</b> Triggers: decision rules for building targets</a><ul>
<li class="chapter" data-level="11.1" data-path="triggers.html"><a href="triggers.html#what-are-triggers"><i class="fa fa-check"></i><b>11.1</b> What are triggers?</a></li>
<li class="chapter" data-level="11.2" data-path="triggers.html"><a href="triggers.html#customization"><i class="fa fa-check"></i><b>11.2</b> Customization</a></li>
<li class="chapter" data-level="11.3" data-path="triggers.html"><a href="triggers.html#alternative-trigger-modes"><i class="fa fa-check"></i><b>11.3</b> Alternative trigger modes</a></li>
<li class="chapter" data-level="11.4" data-path="triggers.html"><a href="triggers.html#consider-blitz-mode-1"><i class="fa fa-check"></i><b>11.4</b> Consider blitz mode</a></li>
<li class="chapter" data-level="11.5" data-path="triggers.html"><a href="triggers.html#a-more-practical-example"><i class="fa fa-check"></i><b>11.5</b> A more practical example</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="time.html"><a href="time.html"><i class="fa fa-check"></i><b>12</b> Time: logging, prediction, and strategy</a><ul>
<li class="chapter" data-level="12.1" data-path="time.html"><a href="time.html#predict-total-runtime"><i class="fa fa-check"></i><b>12.1</b> Predict total runtime</a></li>
<li class="chapter" data-level="12.2" data-path="time.html"><a href="time.html#strategize-your-high-performance-computing"><i class="fa fa-check"></i><b>12.2</b> Strategize your high-performance computing</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="store.html"><a href="store.html"><i class="fa fa-check"></i><b>13</b> Storage</a><ul>
<li class="chapter" data-level="13.1" data-path="store.html"><a href="store.html#caches"><i class="fa fa-check"></i><b>13.1</b> Caches</a></li>
<li class="chapter" data-level="13.2" data-path="store.html"><a href="store.html#hash-algorithms"><i class="fa fa-check"></i><b>13.2</b> Hash algorithms</a></li>
<li class="chapter" data-level="13.3" data-path="store.html"><a href="store.html#which-hash-algorithm-should-you-choose"><i class="fa fa-check"></i><b>13.3</b> Which hash algorithm should you choose?</a></li>
<li class="chapter" data-level="13.4" data-path="store.html"><a href="store.html#select-the-hash-algorithms-of-the-cache"><i class="fa fa-check"></i><b>13.4</b> Select the hash algorithms of the cache</a></li>
<li class="chapter" data-level="13.5" data-path="store.html"><a href="store.html#using-storr-directly"><i class="fa fa-check"></i><b>13.5</b> Using <code>storr</code> directly</a></li>
<li class="chapter" data-level="13.6" data-path="store.html"><a href="store.html#cleaning-up"><i class="fa fa-check"></i><b>13.6</b> Cleaning up</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="faq.html"><a href="faq.html"><i class="fa fa-check"></i><b>A</b> Frequently-asked questions</a></li>
<li class="chapter" data-level="B" data-path="caution.html"><a href="caution.html"><i class="fa fa-check"></i><b>B</b> Cautionary notes</a><ul>
<li class="chapter" data-level="B.1" data-path="caution.html"><a href="caution.html#projects-built-with-drake-4.4.0-are-not-back-compatible-with-drake-4.4.0."><i class="fa fa-check"></i><b>B.1</b> Projects built with drake &lt;= 4.4.0 are not back compatible with drake &gt; 4.4.0.</a></li>
<li class="chapter" data-level="B.2" data-path="caution.html"><a href="caution.html#workflow-plans"><i class="fa fa-check"></i><b>B.2</b> Workflow plans</a><ul>
<li class="chapter" data-level="B.2.1" data-path="caution.html"><a href="caution.html#externalizing-commands-in-r-script-files"><i class="fa fa-check"></i><b>B.2.1</b> Externalizing commands in R script files</a></li>
<li class="chapter" data-level="B.2.2" data-path="caution.html"><a href="caution.html#commands-are-not-perfectly-flexible."><i class="fa fa-check"></i><b>B.2.2</b> Commands are NOT perfectly flexible.</a></li>
</ul></li>
<li class="chapter" data-level="B.3" data-path="caution.html"><a href="caution.html#execution"><i class="fa fa-check"></i><b>B.3</b> Execution</a><ul>
<li class="chapter" data-level="B.3.1" data-path="caution.html"><a href="caution.html#install-drake-properly."><i class="fa fa-check"></i><b>B.3.1</b> Install <code>drake</code> properly.</a></li>
<li class="chapter" data-level="B.3.2" data-path="caution.html"><a href="caution.html#install-all-your-packages."><i class="fa fa-check"></i><b>B.3.2</b> Install all your packages.</a></li>
<li class="chapter" data-level="B.3.3" data-path="caution.html"><a href="caution.html#a-note-on-tidy-evaluation"><i class="fa fa-check"></i><b>B.3.3</b> A note on tidy evaluation</a></li>
<li class="chapter" data-level="B.3.4" data-path="caution.html"><a href="caution.html#find-and-diagnose-your-errors."><i class="fa fa-check"></i><b>B.3.4</b> Find and diagnose your errors.</a></li>
<li class="chapter" data-level="B.3.5" data-path="caution.html"><a href="caution.html#refresh-the-drake_config-list-early-and-often."><i class="fa fa-check"></i><b>B.3.5</b> Refresh the <code>drake_config()</code> list early and often.</a></li>
<li class="chapter" data-level="B.3.6" data-path="caution.html"><a href="caution.html#workflows-as-r-packages."><i class="fa fa-check"></i><b>B.3.6</b> Workflows as R packages.</a></li>
<li class="chapter" data-level="B.3.7" data-path="caution.html"><a href="caution.html#the-lazy_load-flag-does-not-work-with-parlapply-parallelism."><i class="fa fa-check"></i><b>B.3.7</b> The <code>lazy_load</code> flag does not work with <code>&quot;parLapply&quot;</code> parallelism.</a></li>
<li class="chapter" data-level="B.3.8" data-path="caution.html"><a href="caution.html#timeouts-may-be-unreliable."><i class="fa fa-check"></i><b>B.3.8</b> Timeouts may be unreliable.</a></li>
</ul></li>
<li class="chapter" data-level="B.4" data-path="caution.html"><a href="caution.html#dependencies-1"><i class="fa fa-check"></i><b>B.4</b> Dependencies</a><ul>
<li class="chapter" data-level="B.4.1" data-path="caution.html"><a href="caution.html#objects-that-contain-functions-may-rebuild-too-often"><i class="fa fa-check"></i><b>B.4.1</b> Objects that contain functions may rebuild too often</a></li>
<li class="chapter" data-level="B.4.2" data-path="caution.html"><a href="caution.html#the-magrittr-dot-.-is-always-ignored."><i class="fa fa-check"></i><b>B.4.2</b> The <code>magrittr</code> dot (<code>.</code>) is always ignored.</a></li>
<li class="chapter" data-level="B.4.3" data-path="caution.html"><a href="caution.html#dependencies-are-not-tracked-in-some-edge-cases."><i class="fa fa-check"></i><b>B.4.3</b> Dependencies are not tracked in some edge cases.</a></li>
<li class="chapter" data-level="B.4.4" data-path="caution.html"><a href="caution.html#dependencies-of-knitr-reports"><i class="fa fa-check"></i><b>B.4.4</b> Dependencies of <code>knitr</code> reports</a></li>
<li class="chapter" data-level="B.4.5" data-path="caution.html"><a href="caution.html#file-outputs-in-imported-functions."><i class="fa fa-check"></i><b>B.4.5</b> File outputs in imported functions.</a></li>
<li class="chapter" data-level="B.4.6" data-path="caution.html"><a href="caution.html#functions-produced-by-vectorize"><i class="fa fa-check"></i><b>B.4.6</b> Functions produced by <code>Vectorize()</code></a></li>
<li class="chapter" data-level="B.4.7" data-path="caution.html"><a href="caution.html#compiled-code-is-not-reproducibly-tracked."><i class="fa fa-check"></i><b>B.4.7</b> Compiled code is not reproducibly tracked.</a></li>
<li class="chapter" data-level="B.4.8" data-path="caution.html"><a href="caution.html#directories-folders-are-not-reproducibly-tracked."><i class="fa fa-check"></i><b>B.4.8</b> Directories (folders) are not reproducibly tracked.</a></li>
<li class="chapter" data-level="B.4.9" data-path="caution.html"><a href="caution.html#packages-are-not-tracked-as-dependencies."><i class="fa fa-check"></i><b>B.4.9</b> Packages are not tracked as dependencies.</a></li>
</ul></li>
<li class="chapter" data-level="B.5" data-path="caution.html"><a href="caution.html#high-performance-computing"><i class="fa fa-check"></i><b>B.5</b> High-performance computing</a><ul>
<li class="chapter" data-level="B.5.1" data-path="caution.html"><a href="caution.html#the-practical-utility-of-parallel-computing"><i class="fa fa-check"></i><b>B.5.1</b> The practical utility of parallel computing</a></li>
<li class="chapter" data-level="B.5.2" data-path="caution.html"><a href="caution.html#maximum-number-of-simultaneous-jobs"><i class="fa fa-check"></i><b>B.5.2</b> Maximum number of simultaneous jobs</a></li>
<li class="chapter" data-level="B.5.3" data-path="caution.html"><a href="caution.html#parallel-computing-on-windows"><i class="fa fa-check"></i><b>B.5.3</b> Parallel computing on Windows</a></li>
<li class="chapter" data-level="B.5.4" data-path="caution.html"><a href="caution.html#configuring-futurebatchtools-parallelism-for-clusters"><i class="fa fa-check"></i><b>B.5.4</b> Configuring <a href="https://github.com/HenrikBengtsson/future">future</a>/<a href="https://github.com/mllg/batchtools">batchtools</a> parallelism for clusters</a></li>
<li class="chapter" data-level="B.5.5" data-path="caution.html"><a href="caution.html#proper-makefiles-are-not-standalone."><i class="fa fa-check"></i><b>B.5.5</b> Proper Makefiles are not standalone.</a></li>
<li class="chapter" data-level="B.5.6" data-path="caution.html"><a href="caution.html#makefile-level-parallelism-for-imported-objects-and-files"><i class="fa fa-check"></i><b>B.5.6</b> Makefile-level parallelism for imported objects and files</a></li>
<li class="chapter" data-level="B.5.7" data-path="caution.html"><a href="caution.html#zombie-processes"><i class="fa fa-check"></i><b>B.5.7</b> Zombie processes</a></li>
</ul></li>
<li class="chapter" data-level="B.6" data-path="caution.html"><a href="caution.html#storage"><i class="fa fa-check"></i><b>B.6</b> Storage</a><ul>
<li class="chapter" data-level="B.6.1" data-path="caution.html"><a href="caution.html#projects-hosted-on-dropbox-and-similar-platforms"><i class="fa fa-check"></i><b>B.6.1</b> Projects hosted on Dropbox and similar platforms</a></li>
<li class="chapter" data-level="B.6.2" data-path="caution.html"><a href="caution.html#cache-customization-is-limited"><i class="fa fa-check"></i><b>B.6.2</b> Cache customization is limited</a></li>
<li class="chapter" data-level="B.6.3" data-path="caution.html"><a href="caution.html#runtime-predictions"><i class="fa fa-check"></i><b>B.6.3</b> Runtime predictions</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The drake R Package User Manual</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="plans" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> Workflow plan data frames</h1>
<div id="what-is-a-workflow-plan-data-frame" class="section level2">
<h2><span class="header-section-number">6.1</span> What is a workflow plan data frame?</h2>
<p>Your workflow plan data frame is the object where you declare all the objects and files you are going to produce when you run your project. It enumerates each output R object, or <em>target</em>, and the <em>command</em> that will produce it. Here is the workflow plan from our <a href="hpc.html#hpc">previous example</a>.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb97-1" data-line-number="1">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb97-2" data-line-number="2">  <span class="dt">raw_data =</span> readxl<span class="op">::</span><span class="kw">read_excel</span>(<span class="kw">file_in</span>(<span class="st">&quot;raw_data.xlsx&quot;</span>)),</a>
<a class="sourceLine" id="cb97-3" data-line-number="3">  <span class="dt">data =</span> raw_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb97-4" data-line-number="4"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Species =</span> forcats<span class="op">::</span><span class="kw">fct_inorder</span>(Species)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb97-5" data-line-number="5"><span class="st">    </span><span class="kw">select</span>(<span class="op">-</span>X__<span class="dv">1</span>),</a>
<a class="sourceLine" id="cb97-6" data-line-number="6">  <span class="dt">hist =</span> <span class="kw">create_plot</span>(data),</a>
<a class="sourceLine" id="cb97-7" data-line-number="7">  <span class="dt">fit =</span> <span class="kw">lm</span>(Sepal.Width <span class="op">~</span><span class="st"> </span>Petal.Width <span class="op">+</span><span class="st"> </span>Species, data),</a>
<a class="sourceLine" id="cb97-8" data-line-number="8">  <span class="dt">report =</span> rmarkdown<span class="op">::</span><span class="kw">render</span>(</a>
<a class="sourceLine" id="cb97-9" data-line-number="9">    <span class="kw">knitr_in</span>(<span class="st">&quot;report.Rmd&quot;</span>),</a>
<a class="sourceLine" id="cb97-10" data-line-number="10">    <span class="dt">output_file =</span> <span class="kw">file_out</span>(<span class="st">&quot;report.html&quot;</span>),</a>
<a class="sourceLine" id="cb97-11" data-line-number="11">    <span class="dt">quiet =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb97-12" data-line-number="12">  )</a>
<a class="sourceLine" id="cb97-13" data-line-number="13">)</a>
<a class="sourceLine" id="cb97-14" data-line-number="14">## Warning: `list_len()` is soft-deprecated as of rlang 0.2.0.</a>
<a class="sourceLine" id="cb97-15" data-line-number="15">## Please use `new_list()` instead</a>
<a class="sourceLine" id="cb97-16" data-line-number="16">## This warning is displayed once per session.</a>
<a class="sourceLine" id="cb97-17" data-line-number="17">## Warning: The `printer` argument is soft-deprecated as of rlang 0.3.0.</a>
<a class="sourceLine" id="cb97-18" data-line-number="18">## This warning is displayed once per session.</a>
<a class="sourceLine" id="cb97-19" data-line-number="19">## Warning: `env_bind_fns()` is soft-deprecated as of rlang 0.3.0.</a>
<a class="sourceLine" id="cb97-20" data-line-number="20">## Please use `env_bind_active()` instead.</a>
<a class="sourceLine" id="cb97-21" data-line-number="21">## This warning is displayed once per session.</a>
<a class="sourceLine" id="cb97-22" data-line-number="22">## Warning: `new_overscope()` is soft-deprecated as of rlang 0.2.0.</a>
<a class="sourceLine" id="cb97-23" data-line-number="23">## Please use `new_data_mask()` instead</a>
<a class="sourceLine" id="cb97-24" data-line-number="24">## This warning is displayed once per session.</a>
<a class="sourceLine" id="cb97-25" data-line-number="25">## Warning: `overscope_eval_next()` is soft-deprecated as of rlang 0.2.0.</a>
<a class="sourceLine" id="cb97-26" data-line-number="26">## Please use `eval_tidy()` with a data mask instead</a>
<a class="sourceLine" id="cb97-27" data-line-number="27">## This warning is displayed once per session.</a>
<a class="sourceLine" id="cb97-28" data-line-number="28">## Warning: `overscope_clean()` is soft-deprecated as of rlang 0.2.0.</a>
<a class="sourceLine" id="cb97-29" data-line-number="29">## This warning is displayed once per session.</a>
<a class="sourceLine" id="cb97-30" data-line-number="30">plan</a>
<a class="sourceLine" id="cb97-31" data-line-number="31">## # A tibble: 5 x 2</a>
<a class="sourceLine" id="cb97-32" data-line-number="32">##   target   command                                                        </a>
<a class="sourceLine" id="cb97-33" data-line-number="33">##   &lt;chr&gt;    &lt;chr&gt;                                                          </a>
<a class="sourceLine" id="cb97-34" data-line-number="34">## 1 raw_data &quot;readxl::read_excel(file_in(\&quot;raw_data.xlsx\&quot;))&quot;               </a>
<a class="sourceLine" id="cb97-35" data-line-number="35">## 2 data     &quot;raw_data %&gt;% mutate(Species = forcats::fct_inorder(Species)) …</a>
<a class="sourceLine" id="cb97-36" data-line-number="36">## 3 hist     create_plot(data)                                              </a>
<a class="sourceLine" id="cb97-37" data-line-number="37">## 4 fit      lm(Sepal.Width ~ Petal.Width + Species, data)                  </a>
<a class="sourceLine" id="cb97-38" data-line-number="38">## 5 report   &quot;rmarkdown::render(knitr_in(\&quot;report.Rmd\&quot;), output_file = fil…</a></code></pre></div>
<p>When you run <code>make(plan)</code>, <code>drake</code> will produce targets <code>raw_data</code>, <code>data</code>, <code>hist</code>, <code>fit</code>, and <code>report</code>.</p>
</div>
<div id="plans-are-like-r-scripts." class="section level2">
<h2><span class="header-section-number">6.2</span> Plans are like R scripts.</h2>
<p>Your workflow plan data frame is like your top-level “run everything” script in a project. In fact, you can convert back and forth between plans and scripts using functions <a href="https://ropensci.github.io/drake/reference/plan_to_code.html"><code>plan_to_code()</code></a> and <a href="https://ropensci.github.io/drake/reference/code_to_plan.html"><code>code_to_plan()</code></a> (please note the <a href="https://ropensci.github.io/drake/reference/code_to_plan.html#details">caveats here</a>).</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb98-1" data-line-number="1"><span class="kw">plan_to_code</span>(plan, <span class="st">&quot;new_script.R&quot;</span>)</a>
<a class="sourceLine" id="cb98-2" data-line-number="2">## Loading required namespace: styler</a>
<a class="sourceLine" id="cb98-3" data-line-number="3">## Warning: `.named` can no longer be a width</a>
<a class="sourceLine" id="cb98-4" data-line-number="4">## This warning is displayed once per session.</a>
<a class="sourceLine" id="cb98-5" data-line-number="5"><span class="kw">cat</span>(<span class="kw">readLines</span>(<span class="st">&quot;new_script.R&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb98-6" data-line-number="6">## raw_data &lt;- readxl::read_excel(file_in(&quot;raw_data.xlsx&quot;))</a>
<a class="sourceLine" id="cb98-7" data-line-number="7">## data &lt;- raw_data %&gt;%</a>
<a class="sourceLine" id="cb98-8" data-line-number="8">##   mutate(Species = forcats::fct_inorder(Species)) %&gt;%</a>
<a class="sourceLine" id="cb98-9" data-line-number="9">##   select(-X__1)</a>
<a class="sourceLine" id="cb98-10" data-line-number="10">## fit &lt;- lm(Sepal.Width ~ Petal.Width + Species, data)</a>
<a class="sourceLine" id="cb98-11" data-line-number="11">## hist &lt;- create_plot(data)</a>
<a class="sourceLine" id="cb98-12" data-line-number="12">## report &lt;- rmarkdown::render(knitr_in(&quot;report.Rmd&quot;),</a>
<a class="sourceLine" id="cb98-13" data-line-number="13">##   output_file = file_out(&quot;report.html&quot;),</a>
<a class="sourceLine" id="cb98-14" data-line-number="14">##   quiet = TRUE</a>
<a class="sourceLine" id="cb98-15" data-line-number="15">## )</a>
<a class="sourceLine" id="cb98-16" data-line-number="16"></a>
<a class="sourceLine" id="cb98-17" data-line-number="17"><span class="kw">code_to_plan</span>(<span class="st">&quot;new_script.R&quot;</span>)</a>
<a class="sourceLine" id="cb98-18" data-line-number="18">## # A tibble: 5 x 2</a>
<a class="sourceLine" id="cb98-19" data-line-number="19">##   target   command                                                        </a>
<a class="sourceLine" id="cb98-20" data-line-number="20">##   &lt;chr&gt;    &lt;chr&gt;                                                          </a>
<a class="sourceLine" id="cb98-21" data-line-number="21">## 1 raw_data &quot;readxl::read_excel(file_in(\&quot;raw_data.xlsx\&quot;))&quot;               </a>
<a class="sourceLine" id="cb98-22" data-line-number="22">## 2 data     &quot;raw_data %&gt;% mutate(Species = forcats::fct_inorder(Species)) …</a>
<a class="sourceLine" id="cb98-23" data-line-number="23">## 3 fit      lm(Sepal.Width ~ Petal.Width + Species, data)                  </a>
<a class="sourceLine" id="cb98-24" data-line-number="24">## 4 hist     create_plot(data)                                              </a>
<a class="sourceLine" id="cb98-25" data-line-number="25">## 5 report   &quot;rmarkdown::render(knitr_in(\&quot;report.Rmd\&quot;), output_file = fil…</a></code></pre></div>
<p>And <a href="https://ropensci.github.io/drake/reference/plan_to_notebook.html"><code>plan_to_notebook()</code></a> turns plans into <a href="https://bookdown.org/yihui/rmarkdown/notebook.html">R notebooks</a>.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb99-1" data-line-number="1"><span class="kw">plan_to_notebook</span>(plan, <span class="st">&quot;new_notebook.Rmd&quot;</span>)</a>
<a class="sourceLine" id="cb99-2" data-line-number="2"><span class="kw">cat</span>(<span class="kw">readLines</span>(<span class="st">&quot;new_notebook.Rmd&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb99-3" data-line-number="3">## ---</a>
<a class="sourceLine" id="cb99-4" data-line-number="4">## title: &quot;My Notebook&quot;</a>
<a class="sourceLine" id="cb99-5" data-line-number="5">## output: html_notebook</a>
<a class="sourceLine" id="cb99-6" data-line-number="6">## ---</a>
<a class="sourceLine" id="cb99-7" data-line-number="7">## </a>
<a class="sourceLine" id="cb99-8" data-line-number="8">## ```{r my_code}</a>
<a class="sourceLine" id="cb99-9" data-line-number="9">## raw_data &lt;- readxl::read_excel(file_in(&quot;raw_data.xlsx&quot;))</a>
<a class="sourceLine" id="cb99-10" data-line-number="10">## data &lt;- raw_data %&gt;%</a>
<a class="sourceLine" id="cb99-11" data-line-number="11">##   mutate(Species = forcats::fct_inorder(Species)) %&gt;%</a>
<a class="sourceLine" id="cb99-12" data-line-number="12">##   select(-X__1)</a>
<a class="sourceLine" id="cb99-13" data-line-number="13">## fit &lt;- lm(Sepal.Width ~ Petal.Width + Species, data)</a>
<a class="sourceLine" id="cb99-14" data-line-number="14">## hist &lt;- create_plot(data)</a>
<a class="sourceLine" id="cb99-15" data-line-number="15">## report &lt;- rmarkdown::render(knitr_in(&quot;report.Rmd&quot;),</a>
<a class="sourceLine" id="cb99-16" data-line-number="16">##   output_file = file_out(&quot;report.html&quot;),</a>
<a class="sourceLine" id="cb99-17" data-line-number="17">##   quiet = TRUE</a>
<a class="sourceLine" id="cb99-18" data-line-number="18">## )</a>
<a class="sourceLine" id="cb99-19" data-line-number="19">## ```</a>
<a class="sourceLine" id="cb99-20" data-line-number="20"></a>
<a class="sourceLine" id="cb99-21" data-line-number="21"><span class="kw">code_to_plan</span>(<span class="st">&quot;new_notebook.Rmd&quot;</span>)</a>
<a class="sourceLine" id="cb99-22" data-line-number="22">## # A tibble: 5 x 2</a>
<a class="sourceLine" id="cb99-23" data-line-number="23">##   target   command                                                        </a>
<a class="sourceLine" id="cb99-24" data-line-number="24">##   &lt;chr&gt;    &lt;chr&gt;                                                          </a>
<a class="sourceLine" id="cb99-25" data-line-number="25">## 1 raw_data &quot;readxl::read_excel(file_in(\&quot;raw_data.xlsx\&quot;))&quot;               </a>
<a class="sourceLine" id="cb99-26" data-line-number="26">## 2 data     &quot;raw_data %&gt;% mutate(Species = forcats::fct_inorder(Species)) …</a>
<a class="sourceLine" id="cb99-27" data-line-number="27">## 3 fit      lm(Sepal.Width ~ Petal.Width + Species, data)                  </a>
<a class="sourceLine" id="cb99-28" data-line-number="28">## 4 hist     create_plot(data)                                              </a>
<a class="sourceLine" id="cb99-29" data-line-number="29">## 5 report   &quot;rmarkdown::render(knitr_in(\&quot;report.Rmd\&quot;), output_file = fil…</a></code></pre></div>
</div>
<div id="so-why-do-we-use-plans" class="section level2">
<h2><span class="header-section-number">6.3</span> So why do we use plans?</h2>
<p>The workflow plan may seem like a burden to set up, and the use of data frames may seem counterintuitive at first, but the rewards are worth the effort.</p>
<div id="you-can-skip-up-to-date-work." class="section level3">
<h3><span class="header-section-number">6.3.1</span> You can skip up-to-date work.</h3>
<p>As we saw in our <a href="main.html#main">first example</a>, subsequent <code>make()</code>s skip work that is already up to date. To skip steps of the workflow, we need to know what those steps actaully are. Workflow plan data frames formally define skippable steps, whereas scripts and notebooks on their own do not.</p>
<p>This general approach of declaring targets in advance has stood the test of time. The idea dates at least as far back as <a href="https://www.gnu.org/software/make/">GNU Make</a>, which uses <code>Makefile</code>s to declare targets and dependencies. <code>drake</code>’s predecessor <a href="https://github.com/richfitz/remake"><code>remake</code></a> uses <a href="http://yaml.org/"><code>YAML</code></a> files in a similar way.</p>
</div>
<div id="data-frames-scale-well." class="section level3">
<h3><span class="header-section-number">6.3.2</span> Data frames scale well.</h3>
<p><code>Makefile</code>s are successful for <a href="https://www.gnu.org/software/make/">Make</a> because they accommodate software written in multiple languages. However, such external configuration files are not the best solution for R. Maintaining a <code>Makefile</code> or a <a href="https://github.com/richfitz/remake"><code>remake</code></a> <a href="http://yaml.org/"><code>YAML</code></a> file requires a lot of manual typing. But with <code>drake</code> plans, you can use the usual data frame manipulation tools to expand, generate, and piece together large projets. The <a href="gsp.html#gsp">gsp example</a> shows how <code>expand.grid()</code> and <code>rbind()</code> to automatically create plans with hundreds of targets. In addition, <code>drake</code> has a wildcard templating mechanism to generate large plans.</p>
</div>
<div id="you-do-not-need-to-worry-about-which-targets-run-first." class="section level3">
<h3><span class="header-section-number">6.3.3</span> You do not need to worry about which targets run first.</h3>
<p>When you call <code>make()</code> on the plan above, <code>drake</code> takes care of <code>&quot;raw_data.xlsx&quot;</code>, then <code>raw_data</code>, and then <code>data</code> in sequence. Once <code>data</code> completes, <code>fit</code> and <code>hist</code> can start in any order, and then <code>report</code> begins once everything else is done. The execution does not depend on the order of the rows in your plan. In other words, the following plan is equivalent.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb100-1" data-line-number="1"><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb100-2" data-line-number="2">  <span class="dt">fit =</span> <span class="kw">lm</span>(Sepal.Width <span class="op">~</span><span class="st"> </span>Petal.Width <span class="op">+</span><span class="st"> </span>Species, data),</a>
<a class="sourceLine" id="cb100-3" data-line-number="3">  <span class="dt">report =</span> rmarkdown<span class="op">::</span><span class="kw">render</span>(</a>
<a class="sourceLine" id="cb100-4" data-line-number="4">    <span class="kw">knitr_in</span>(<span class="st">&quot;report.Rmd&quot;</span>),</a>
<a class="sourceLine" id="cb100-5" data-line-number="5">    <span class="dt">output_file =</span> <span class="kw">file_out</span>(<span class="st">&quot;report.html&quot;</span>),</a>
<a class="sourceLine" id="cb100-6" data-line-number="6">    <span class="dt">quiet =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb100-7" data-line-number="7">  ),</a>
<a class="sourceLine" id="cb100-8" data-line-number="8">  <span class="dt">hist =</span> <span class="kw">create_plot</span>(data),</a>
<a class="sourceLine" id="cb100-9" data-line-number="9">  <span class="dt">data =</span> raw_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb100-10" data-line-number="10"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Species =</span> forcats<span class="op">::</span><span class="kw">fct_inorder</span>(Species)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb100-11" data-line-number="11"><span class="st">    </span><span class="kw">select</span>(<span class="op">-</span>X__<span class="dv">1</span>),</a>
<a class="sourceLine" id="cb100-12" data-line-number="12">  <span class="dt">raw_data =</span> readxl<span class="op">::</span><span class="kw">read_excel</span>(<span class="kw">file_in</span>(<span class="st">&quot;raw_data.xlsx&quot;</span>))</a>
<a class="sourceLine" id="cb100-13" data-line-number="13">)</a>
<a class="sourceLine" id="cb100-14" data-line-number="14">## # A tibble: 5 x 2</a>
<a class="sourceLine" id="cb100-15" data-line-number="15">##   target   command                                                        </a>
<a class="sourceLine" id="cb100-16" data-line-number="16">##   &lt;chr&gt;    &lt;chr&gt;                                                          </a>
<a class="sourceLine" id="cb100-17" data-line-number="17">## 1 fit      lm(Sepal.Width ~ Petal.Width + Species, data)                  </a>
<a class="sourceLine" id="cb100-18" data-line-number="18">## 2 report   &quot;rmarkdown::render(knitr_in(\&quot;report.Rmd\&quot;), output_file = fil…</a>
<a class="sourceLine" id="cb100-19" data-line-number="19">## 3 hist     create_plot(data)                                              </a>
<a class="sourceLine" id="cb100-20" data-line-number="20">## 4 data     &quot;raw_data %&gt;% mutate(Species = forcats::fct_inorder(Species)) …</a>
<a class="sourceLine" id="cb100-21" data-line-number="21">## 5 raw_data &quot;readxl::read_excel(file_in(\&quot;raw_data.xlsx\&quot;))&quot;</a></code></pre></div>
</div>
</div>
<div id="automatic-dependency-detection" class="section level2">
<h2><span class="header-section-number">6.4</span> Automatic dependency detection</h2>
<p>Why can you safely scramble the rows of a <code>drake</code> plan? Why is row order irrelevant to execution order? Because <code>drake</code> analyzes commands for dependencies, and <code>make()</code> processes those dependencies before moving on to downstream targets. To detect dependencies, <code>drake</code> walks through the <a href="http://adv-r.had.co.nz/Expressions.html#ast-funs">abstract syntax tree</a> of every piece of code to find the objects and files relevant to the workflow pipeline.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb101-1" data-line-number="1">create_plot &lt;-<span class="st"> </span><span class="cf">function</span>(data) {</a>
<a class="sourceLine" id="cb101-2" data-line-number="2">  <span class="kw">ggplot</span>(data, <span class="kw">aes_string</span>(<span class="dt">x =</span> <span class="st">&quot;Petal.Width&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;Species&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb101-3" data-line-number="3"><span class="st">    </span><span class="kw">geom_histogram</span>()</a>
<a class="sourceLine" id="cb101-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb101-5" data-line-number="5"></a>
<a class="sourceLine" id="cb101-6" data-line-number="6"><span class="kw">deps_code</span>(create_plot)</a>
<a class="sourceLine" id="cb101-7" data-line-number="7">## $globals</a>
<a class="sourceLine" id="cb101-8" data-line-number="8">## [1] &quot;ggplot&quot;         &quot;aes_string&quot;     &quot;geom_histogram&quot;</a>
<a class="sourceLine" id="cb101-9" data-line-number="9"></a>
<a class="sourceLine" id="cb101-10" data-line-number="10"><span class="kw">deps_code</span>(</a>
<a class="sourceLine" id="cb101-11" data-line-number="11">  <span class="kw">quote</span>({</a>
<a class="sourceLine" id="cb101-12" data-line-number="12">    <span class="kw">some_function_i_wrote</span>(data)</a>
<a class="sourceLine" id="cb101-13" data-line-number="13">    rmarkdown<span class="op">::</span><span class="kw">render</span>(</a>
<a class="sourceLine" id="cb101-14" data-line-number="14">      <span class="kw">knitr_in</span>(<span class="st">&quot;report.Rmd&quot;</span>),</a>
<a class="sourceLine" id="cb101-15" data-line-number="15">      <span class="dt">output_file =</span> <span class="kw">file_out</span>(<span class="st">&quot;report.html&quot;</span>),</a>
<a class="sourceLine" id="cb101-16" data-line-number="16">      <span class="dt">quiet =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb101-17" data-line-number="17">    )</a>
<a class="sourceLine" id="cb101-18" data-line-number="18">  })</a>
<a class="sourceLine" id="cb101-19" data-line-number="19">)</a>
<a class="sourceLine" id="cb101-20" data-line-number="20">## $globals</a>
<a class="sourceLine" id="cb101-21" data-line-number="21">## [1] &quot;some_function_i_wrote&quot; &quot;data&quot;                 </a>
<a class="sourceLine" id="cb101-22" data-line-number="22">## </a>
<a class="sourceLine" id="cb101-23" data-line-number="23">## $namespaced</a>
<a class="sourceLine" id="cb101-24" data-line-number="24">## [1] &quot;rmarkdown::render&quot;</a>
<a class="sourceLine" id="cb101-25" data-line-number="25">## </a>
<a class="sourceLine" id="cb101-26" data-line-number="26">## $loadd</a>
<a class="sourceLine" id="cb101-27" data-line-number="27">## [1] &quot;fit&quot;</a>
<a class="sourceLine" id="cb101-28" data-line-number="28">## </a>
<a class="sourceLine" id="cb101-29" data-line-number="29">## $readd</a>
<a class="sourceLine" id="cb101-30" data-line-number="30">## [1] &quot;hist&quot;</a>
<a class="sourceLine" id="cb101-31" data-line-number="31">## </a>
<a class="sourceLine" id="cb101-32" data-line-number="32">## $knitr_in</a>
<a class="sourceLine" id="cb101-33" data-line-number="33">## [1] &quot;\&quot;report.Rmd\&quot;&quot;</a>
<a class="sourceLine" id="cb101-34" data-line-number="34">## </a>
<a class="sourceLine" id="cb101-35" data-line-number="35">## $file_out</a>
<a class="sourceLine" id="cb101-36" data-line-number="36">## [1] &quot;\&quot;report.html\&quot;&quot;</a></code></pre></div>
<p><code>drake</code> detects dependencies without actually running the command.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb102-1" data-line-number="1"><span class="kw">file.exists</span>(<span class="st">&quot;report.html&quot;</span>)</a>
<a class="sourceLine" id="cb102-2" data-line-number="2">## [1] FALSE</a></code></pre></div>
<p>Automatically detected dependencies include:</p>
<ol style="list-style-type: decimal">
<li>Other targets in the plan.</li>
<li>Objects and functions in your environment.</li>
<li>Objects and functions from packages that you reference with <code>::</code> or <code>:::</code> (namespaced objects).</li>
<li>Input and output files declared in your commands with <code>file_in()</code>, <code>knitr_in()</code>, or <code>file_out()</code>.</li>
<li>Input files declared in imported functions ((2) or (3)) with <code>file_in()</code> or <code>knitr_in()</code>.</li>
<li>For <code>knitr</code> or R Markdown reports declared with <code>knitr_in()</code> (<a href="https://github.com/wlandau/drake-examples/blob/master/main/report.Rmd">example here</a>), <code>drake</code> scans active code chunks for objects mentioned with <code>loadd()</code> and <code>readd()</code>. So when <code>fit</code> or <code>hist</code> change, <code>drake</code> rebuilds the <code>report</code> target to produce the file <code>report.html</code>.</li>
</ol>
<p>Targets can depend on one another through <code>file_in()</code>/<code>file_out()</code> connections.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb103-1" data-line-number="1"><span class="kw">saveRDS</span>(<span class="dv">1</span>, <span class="st">&quot;start.rds&quot;</span>)</a>
<a class="sourceLine" id="cb103-2" data-line-number="2"></a>
<a class="sourceLine" id="cb103-3" data-line-number="3">write_files &lt;-<span class="st"> </span><span class="cf">function</span>(){</a>
<a class="sourceLine" id="cb103-4" data-line-number="4">  x &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="kw">file_in</span>(<span class="st">&quot;start.rds&quot;</span>))</a>
<a class="sourceLine" id="cb103-5" data-line-number="5">  <span class="cf">for</span> (file <span class="cf">in</span> letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]){</a>
<a class="sourceLine" id="cb103-6" data-line-number="6">    <span class="kw">saveRDS</span>(x, file)</a>
<a class="sourceLine" id="cb103-7" data-line-number="7">  }</a>
<a class="sourceLine" id="cb103-8" data-line-number="8">}</a>
<a class="sourceLine" id="cb103-9" data-line-number="9"></a>
<a class="sourceLine" id="cb103-10" data-line-number="10">small_plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb103-11" data-line-number="11">  <span class="dt">x =</span> {</a>
<a class="sourceLine" id="cb103-12" data-line-number="12">    <span class="kw">write_files</span>()</a>
<a class="sourceLine" id="cb103-13" data-line-number="13">    <span class="kw">file_out</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>)</a>
<a class="sourceLine" id="cb103-14" data-line-number="14">  },</a>
<a class="sourceLine" id="cb103-15" data-line-number="15">  <span class="dt">y =</span> <span class="kw">readRDS</span>(<span class="kw">file_in</span>(<span class="st">&quot;a&quot;</span>))</a>
<a class="sourceLine" id="cb103-16" data-line-number="16">)</a>
<a class="sourceLine" id="cb103-17" data-line-number="17"></a>
<a class="sourceLine" id="cb103-18" data-line-number="18">config &lt;-<span class="st"> </span><span class="kw">drake_config</span>(small_plan)</a>
<a class="sourceLine" id="cb103-19" data-line-number="19"><span class="kw">vis_drake_graph</span>(config)</a></code></pre></div>
<div id="htmlwidget-ffb026e0f95f638569ee" style="width:576px;height:576px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-ffb026e0f95f638569ee">{"x":{"nodes":{"id":["\"a\"","\"b\"","\"c\"","\"start.rds\"","write_files","x","y"],"deps":[{},{},{},null,{},{},{}],"trigger":[{},{},{},null,null,{},{}],"label":["\"a\"","\"b\"","\"c\"","\"start.rds\"\n0.005s","write_files\n0.005s","x","y"],"command":["{\n    write_files()\n    file_out(\"a\", \"b\", \"c\")\n}","{\n    write_files()\n    file_out(\"a\", \"b\", \"c\")\n}","{\n    write_files()\n    file_out(\"a\", \"b\", \"c\")\n}",null,null,"{\n    write_files()\n    file_out(\"a\", \"b\", \"c\")\n}","readRDS(file_in(\"a\"))"],"status":["outdated","outdated","outdated","imported","imported","outdated","outdated"],"type":["file","file","file","file","function","object","object"],"font.size":[20,20,20,20,20,20,20],"color":["#000000","#000000","#000000","#1874CD","#1874CD","#000000","#000000"],"shape":["square","square","square","square","triangle","dot","dot"],"level":[4,4,4,1,2,3,5],"title":["{\n&nbsp;&nbsp;&nbsp;&nbsp;write_files()\n&nbsp;&nbsp;&nbsp;&nbsp;file_out(\"a\",&nbsp;\"b\",&nbsp;\"c\")\n}","{\n&nbsp;&nbsp;&nbsp;&nbsp;write_files()\n&nbsp;&nbsp;&nbsp;&nbsp;file_out(\"a\",&nbsp;\"b\",&nbsp;\"c\")\n}","{\n&nbsp;&nbsp;&nbsp;&nbsp;write_files()\n&nbsp;&nbsp;&nbsp;&nbsp;file_out(\"a\",&nbsp;\"b\",&nbsp;\"c\")\n}","X<br>","function&nbsp;()&nbsp;<br>{<br>&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;<-&nbsp;readRDS(file_in(\"start.rds\"))<br>&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(file&nbsp;in&nbsp;letters[1:3])&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;saveRDS(x,&nbsp;file)<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}","{\n&nbsp;&nbsp;&nbsp;&nbsp;write_files()\n&nbsp;&nbsp;&nbsp;&nbsp;file_out(\"a\",&nbsp;\"b\",&nbsp;\"c\")\n}","readRDS(file_in(\"a\"))"],"x":[-1,0,1,0,0,0,-1],"y":[0.5,0.5,0.5,-1,-0.5,0,1]},"edges":{"from":["\"start.rds\"","write_files","\"a\"","x","x","x"],"to":["write_files","x","y","\"a\"","\"b\"","\"c\""],"file":[0,0,null,null,null,null],"arrows":["to","to","to","to","to","to"],"smooth":[true,true,true,true,true,true]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}},"edges":{"smooth":false},"physics":{"stabilization":false},"interaction":{"navigationButtons":true}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)"},"main":{"text":"Dependency graph","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":false,"hoverNearest":false,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null},"legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Outdated","Imported","Object","Function","File"],"color":["#000000","#1874CD","#888888","#888888","#888888"],"shape":["dot","dot","dot","triangle","square"],"font.color":["black","black","black","black","black"],"font.size":[20,20,20,20,20],"id":[2,5,7,8,9]},"nodesToDataframe":true},"igraphlayout":{"type":"square"},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script>
<p>So when target <code>x</code> changes the output for files <code>&quot;a&quot;</code>, <code>&quot;b&quot;</code>, or <code>&quot;c&quot;</code>, <code>drake</code> knows to rebuild target <code>y</code>. In addition, if you accidentally modify any of these output files by hand, <code>drake</code> will run the command of <code>x</code> to restore the files to a reproducible state.</p>
</div>
<div id="automatically-generating-workflow-plans" class="section level2">
<h2><span class="header-section-number">6.5</span> Automatically generating workflow plans</h2>
<p><code>drake</code> provides many more utilites that increase the flexibility of workflow plan generation beyond <code>expand.grid()</code>.</p>
<ul>
<li><code>drake_plan()</code></li>
<li><code>map_plan()</code></li>
<li><code>evaluate_plan()</code></li>
<li><code>plan_analyses()</code></li>
<li><code>plan_summaries()</code></li>
<li><code>expand_plan()</code></li>
<li><code>gather_by()</code></li>
<li><code>reduce_by()</code></li>
<li><code>gather_plan()</code></li>
<li><code>reduce_plan()</code></li>
</ul>
<div id="map_plan" class="section level3">
<h3><span class="header-section-number">6.5.1</span> <code>map_plan()</code></h3>
<p><a href="https://github.com/tidyverse/purrr"><code>purrr</code></a>-like functional programming is like looping, but cleaner. The idea is to iterate the same computation over multiple different data points. You write a function to do something once, and a <a href="https://purrr.tidyverse.org/reference/map.html"><code>map()</code></a>-like helper invokes it on each point in your dataset. <code>drake</code>’s version of <a href="https://purrr.tidyverse.org/reference/map.html"><code>map()</code></a> — or more precisely, <a href="https://purrr.tidyverse.org/reference/map2.html"><code>pmap_df()</code></a> — is <a href="https://ropensci.github.io/drake/reference/map_plan.html"><code>map_plan()</code></a>.</p>
<p>In the following example, we want to know how well each pair covariates in the <a href="https://stat.ethz.ch/R-manual/R-devel/library/datasets/html/mtcars.html"><code>mtcars</code> dataset</a> can predict fuel efficiency (in miles per gallon). We will try multiple pairs of covariates using the same statistical analysis, so it is a great time for <code>drake</code>-flavored functional programming with <code>map_plan()</code>.</p>
<p>As with its cousin, <a href="https://purrr.tidyverse.org/reference/map2.html"><code>pmap_df()</code></a>, <a href="https://ropensci.github.io/drake/reference/map_plan.html"><code>map_plan()</code></a> needs</p>
<ol style="list-style-type: decimal">
<li>A function.</li>
<li>A grid of function arguments.</li>
</ol>
<p>Our function fits a fuel efficiency model given a <em>single</em> pair of covariate names <code>x1</code> and <code>x2</code>.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb104-1" data-line-number="1">my_model_fit &lt;-<span class="st"> </span><span class="cf">function</span>(x1, x2, data){</a>
<a class="sourceLine" id="cb104-2" data-line-number="2">  <span class="kw">lm</span>(<span class="kw">as.formula</span>(<span class="kw">paste</span>(<span class="st">&quot;mpg ~&quot;</span>, x1, <span class="st">&quot;+&quot;</span>, x2)), <span class="dt">data =</span> data)</a>
<a class="sourceLine" id="cb104-3" data-line-number="3">}</a></code></pre></div>
<p>Our grid of function arguments is a data frame of possible values for <code>x1</code>, <code>x2</code>, and <code>data</code>.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb105-1" data-line-number="1">covariates &lt;-<span class="st"> </span><span class="kw">setdiff</span>(<span class="kw">colnames</span>(mtcars), <span class="st">&quot;mpg&quot;</span>) <span class="co"># Exclude the response variable.</span></a>
<a class="sourceLine" id="cb105-2" data-line-number="2">args &lt;-<span class="st"> </span><span class="kw">combn</span>(covariates, <span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Take all possible pairs.</span></a>
<a class="sourceLine" id="cb105-3" data-line-number="3"><span class="st">  </span><span class="kw">t</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Take the transpose so each row is a single pair. %&gt;%</span></a>
<a class="sourceLine" id="cb105-4" data-line-number="4"><span class="st">  </span>tibble<span class="op">::</span><span class="kw">as_tibble</span>() <span class="co"># Tibbles are so nice.</span></a>
<a class="sourceLine" id="cb105-5" data-line-number="5"><span class="kw">colnames</span>(args) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;x1&quot;</span>, <span class="st">&quot;x2&quot;</span>) <span class="co"># The column names must be the argument names of my_model_fit()</span></a>
<a class="sourceLine" id="cb105-6" data-line-number="6">args<span class="op">$</span>data &lt;-<span class="st"> &quot;mtcars&quot;</span></a>
<a class="sourceLine" id="cb105-7" data-line-number="7">args</a>
<a class="sourceLine" id="cb105-8" data-line-number="8">## # A tibble: 45 x 3</a>
<a class="sourceLine" id="cb105-9" data-line-number="9">##    x1    x2    data  </a>
<a class="sourceLine" id="cb105-10" data-line-number="10">##    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; </a>
<a class="sourceLine" id="cb105-11" data-line-number="11">##  1 cyl   disp  mtcars</a>
<a class="sourceLine" id="cb105-12" data-line-number="12">##  2 cyl   hp    mtcars</a>
<a class="sourceLine" id="cb105-13" data-line-number="13">##  3 cyl   drat  mtcars</a>
<a class="sourceLine" id="cb105-14" data-line-number="14">##  4 cyl   wt    mtcars</a>
<a class="sourceLine" id="cb105-15" data-line-number="15">##  5 cyl   qsec  mtcars</a>
<a class="sourceLine" id="cb105-16" data-line-number="16">##  6 cyl   vs    mtcars</a>
<a class="sourceLine" id="cb105-17" data-line-number="17">##  7 cyl   am    mtcars</a>
<a class="sourceLine" id="cb105-18" data-line-number="18">##  8 cyl   gear  mtcars</a>
<a class="sourceLine" id="cb105-19" data-line-number="19">##  9 cyl   carb  mtcars</a>
<a class="sourceLine" id="cb105-20" data-line-number="20">## 10 disp  hp    mtcars</a>
<a class="sourceLine" id="cb105-21" data-line-number="21">## # ... with 35 more rows</a></code></pre></div>
<p>Each row of <code>args</code> corresponds to a call to <code>my_model_fit()</code>. To actually write out all those function calls, we use <code>map_plan()</code>.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb106-1" data-line-number="1"><span class="kw">map_plan</span>(args, my_model_fit)</a>
<a class="sourceLine" id="cb106-2" data-line-number="2">## # A tibble: 45 x 2</a>
<a class="sourceLine" id="cb106-3" data-line-number="3">##    target              command                                            </a>
<a class="sourceLine" id="cb106-4" data-line-number="4">##    &lt;chr&gt;               &lt;chr&gt;                                              </a>
<a class="sourceLine" id="cb106-5" data-line-number="5">##  1 my_model_fit_501e0… &quot;my_model_fit(x1 = \&quot;cyl\&quot;, x2 = \&quot;disp\&quot;, data = …</a>
<a class="sourceLine" id="cb106-6" data-line-number="6">##  2 my_model_fit_d5de1… &quot;my_model_fit(x1 = \&quot;cyl\&quot;, x2 = \&quot;hp\&quot;, data = \&quot;…</a>
<a class="sourceLine" id="cb106-7" data-line-number="7">##  3 my_model_fit_eac6c… &quot;my_model_fit(x1 = \&quot;cyl\&quot;, x2 = \&quot;drat\&quot;, data = …</a>
<a class="sourceLine" id="cb106-8" data-line-number="8">##  4 my_model_fit_3900e… &quot;my_model_fit(x1 = \&quot;cyl\&quot;, x2 = \&quot;wt\&quot;, data = \&quot;…</a>
<a class="sourceLine" id="cb106-9" data-line-number="9">##  5 my_model_fit_a2d79… &quot;my_model_fit(x1 = \&quot;cyl\&quot;, x2 = \&quot;qsec\&quot;, data = …</a>
<a class="sourceLine" id="cb106-10" data-line-number="10">##  6 my_model_fit_f5c0a… &quot;my_model_fit(x1 = \&quot;cyl\&quot;, x2 = \&quot;vs\&quot;, data = \&quot;…</a>
<a class="sourceLine" id="cb106-11" data-line-number="11">##  7 my_model_fit_507d2… &quot;my_model_fit(x1 = \&quot;cyl\&quot;, x2 = \&quot;am\&quot;, data = \&quot;…</a>
<a class="sourceLine" id="cb106-12" data-line-number="12">##  8 my_model_fit_b5f9a… &quot;my_model_fit(x1 = \&quot;cyl\&quot;, x2 = \&quot;gear\&quot;, data = …</a>
<a class="sourceLine" id="cb106-13" data-line-number="13">##  9 my_model_fit_8c4c5… &quot;my_model_fit(x1 = \&quot;cyl\&quot;, x2 = \&quot;carb\&quot;, data = …</a>
<a class="sourceLine" id="cb106-14" data-line-number="14">## 10 my_model_fit_f9bb9… &quot;my_model_fit(x1 = \&quot;disp\&quot;, x2 = \&quot;hp\&quot;, data = \…</a>
<a class="sourceLine" id="cb106-15" data-line-number="15">## # ... with 35 more rows</a></code></pre></div>
<p>We now have a plan, but it has a couple issues.</p>
<ol style="list-style-type: decimal">
<li>The <code>data</code> argument should be a symbol. In other words, we want <code>my_model_fit(data = mtcars)</code>, not <code>my_model_fit(data = &quot;mtcars&quot;)</code>. So we use the <a href="https://rlang.r-lib.org/reference/sym.html"><code>syms()</code></a> function from the <a href="https://github.com/r-lib/rlang"><code>rlang</code></a> package turn <code>args$data</code> into a list of symbols.</li>
<li>The default argument names are ugly, so we can add a new <code>&quot;id&quot;</code> column to <code>args</code> (or select one with the <code>id</code> argument of <code>map_plan()</code>).</li>
</ol>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb107-1" data-line-number="1"><span class="co"># Fixes (1)</span></a>
<a class="sourceLine" id="cb107-2" data-line-number="2">args<span class="op">$</span>data &lt;-<span class="st"> </span>rlang<span class="op">::</span><span class="kw">syms</span>(args<span class="op">$</span>data)</a>
<a class="sourceLine" id="cb107-3" data-line-number="3"></a>
<a class="sourceLine" id="cb107-4" data-line-number="4"><span class="co"># Alternative if each element of `args$data` is code with multiple symbols:</span></a>
<a class="sourceLine" id="cb107-5" data-line-number="5"><span class="co"># args$data &lt;- purrr::map(args$data, rlang::parse_expr)</span></a>
<a class="sourceLine" id="cb107-6" data-line-number="6"></a>
<a class="sourceLine" id="cb107-7" data-line-number="7"><span class="co"># Fixes (2)</span></a>
<a class="sourceLine" id="cb107-8" data-line-number="8">args<span class="op">$</span>id &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;fit_&quot;</span>, args<span class="op">$</span>x1, <span class="st">&quot;_&quot;</span>, args<span class="op">$</span>x2)</a>
<a class="sourceLine" id="cb107-9" data-line-number="9"></a>
<a class="sourceLine" id="cb107-10" data-line-number="10">args</a>
<a class="sourceLine" id="cb107-11" data-line-number="11">## # A tibble: 45 x 4</a>
<a class="sourceLine" id="cb107-12" data-line-number="12">##    x1    x2    data     id          </a>
<a class="sourceLine" id="cb107-13" data-line-number="13">##    &lt;chr&gt; &lt;chr&gt; &lt;list&gt;   &lt;chr&gt;       </a>
<a class="sourceLine" id="cb107-14" data-line-number="14">##  1 cyl   disp  &lt;symbol&gt; fit_cyl_disp</a>
<a class="sourceLine" id="cb107-15" data-line-number="15">##  2 cyl   hp    &lt;symbol&gt; fit_cyl_hp  </a>
<a class="sourceLine" id="cb107-16" data-line-number="16">##  3 cyl   drat  &lt;symbol&gt; fit_cyl_drat</a>
<a class="sourceLine" id="cb107-17" data-line-number="17">##  4 cyl   wt    &lt;symbol&gt; fit_cyl_wt  </a>
<a class="sourceLine" id="cb107-18" data-line-number="18">##  5 cyl   qsec  &lt;symbol&gt; fit_cyl_qsec</a>
<a class="sourceLine" id="cb107-19" data-line-number="19">##  6 cyl   vs    &lt;symbol&gt; fit_cyl_vs  </a>
<a class="sourceLine" id="cb107-20" data-line-number="20">##  7 cyl   am    &lt;symbol&gt; fit_cyl_am  </a>
<a class="sourceLine" id="cb107-21" data-line-number="21">##  8 cyl   gear  &lt;symbol&gt; fit_cyl_gear</a>
<a class="sourceLine" id="cb107-22" data-line-number="22">##  9 cyl   carb  &lt;symbol&gt; fit_cyl_carb</a>
<a class="sourceLine" id="cb107-23" data-line-number="23">## 10 disp  hp    &lt;symbol&gt; fit_disp_hp </a>
<a class="sourceLine" id="cb107-24" data-line-number="24">## # ... with 35 more rows</a></code></pre></div>
<p>Much better.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb108-1" data-line-number="1">plan &lt;-<span class="st"> </span><span class="kw">map_plan</span>(args, my_model_fit)</a>
<a class="sourceLine" id="cb108-2" data-line-number="2">plan</a>
<a class="sourceLine" id="cb108-3" data-line-number="3">## # A tibble: 45 x 2</a>
<a class="sourceLine" id="cb108-4" data-line-number="4">##    target       command                                                   </a>
<a class="sourceLine" id="cb108-5" data-line-number="5">##    &lt;chr&gt;        &lt;chr&gt;                                                     </a>
<a class="sourceLine" id="cb108-6" data-line-number="6">##  1 fit_cyl_disp &quot;my_model_fit(x1 = \&quot;cyl\&quot;, x2 = \&quot;disp\&quot;, data = mtcars)&quot;</a>
<a class="sourceLine" id="cb108-7" data-line-number="7">##  2 fit_cyl_hp   &quot;my_model_fit(x1 = \&quot;cyl\&quot;, x2 = \&quot;hp\&quot;, data = mtcars)&quot;  </a>
<a class="sourceLine" id="cb108-8" data-line-number="8">##  3 fit_cyl_drat &quot;my_model_fit(x1 = \&quot;cyl\&quot;, x2 = \&quot;drat\&quot;, data = mtcars)&quot;</a>
<a class="sourceLine" id="cb108-9" data-line-number="9">##  4 fit_cyl_wt   &quot;my_model_fit(x1 = \&quot;cyl\&quot;, x2 = \&quot;wt\&quot;, data = mtcars)&quot;  </a>
<a class="sourceLine" id="cb108-10" data-line-number="10">##  5 fit_cyl_qsec &quot;my_model_fit(x1 = \&quot;cyl\&quot;, x2 = \&quot;qsec\&quot;, data = mtcars)&quot;</a>
<a class="sourceLine" id="cb108-11" data-line-number="11">##  6 fit_cyl_vs   &quot;my_model_fit(x1 = \&quot;cyl\&quot;, x2 = \&quot;vs\&quot;, data = mtcars)&quot;  </a>
<a class="sourceLine" id="cb108-12" data-line-number="12">##  7 fit_cyl_am   &quot;my_model_fit(x1 = \&quot;cyl\&quot;, x2 = \&quot;am\&quot;, data = mtcars)&quot;  </a>
<a class="sourceLine" id="cb108-13" data-line-number="13">##  8 fit_cyl_gear &quot;my_model_fit(x1 = \&quot;cyl\&quot;, x2 = \&quot;gear\&quot;, data = mtcars)&quot;</a>
<a class="sourceLine" id="cb108-14" data-line-number="14">##  9 fit_cyl_carb &quot;my_model_fit(x1 = \&quot;cyl\&quot;, x2 = \&quot;carb\&quot;, data = mtcars)&quot;</a>
<a class="sourceLine" id="cb108-15" data-line-number="15">## 10 fit_disp_hp  &quot;my_model_fit(x1 = \&quot;disp\&quot;, x2 = \&quot;hp\&quot;, data = mtcars)&quot; </a>
<a class="sourceLine" id="cb108-16" data-line-number="16">## # ... with 35 more rows</a></code></pre></div>
<p>We may also want to retain information about the constituent function arguments of each target. With <code>map_plan(trace = TRUE)</code>, we can append the columns of <code>args</code> alongside the usual <code>&quot;target&quot;</code> and <code>&quot;command&quot;</code> columns of our plan.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb109-1" data-line-number="1"><span class="kw">map_plan</span>(args, my_model_fit, <span class="dt">trace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb109-2" data-line-number="2">## # A tibble: 45 x 6</a>
<a class="sourceLine" id="cb109-3" data-line-number="3">##    target    command                           x1    x2    data   id      </a>
<a class="sourceLine" id="cb109-4" data-line-number="4">##    &lt;chr&gt;     &lt;chr&gt;                             &lt;chr&gt; &lt;chr&gt; &lt;list&gt; &lt;chr&gt;   </a>
<a class="sourceLine" id="cb109-5" data-line-number="5">##  1 fit_cyl_… &quot;my_model_fit(x1 = \&quot;cyl\&quot;, x2 =… cyl   disp  &lt;symb… fit_cyl…</a>
<a class="sourceLine" id="cb109-6" data-line-number="6">##  2 fit_cyl_… &quot;my_model_fit(x1 = \&quot;cyl\&quot;, x2 =… cyl   hp    &lt;symb… fit_cyl…</a>
<a class="sourceLine" id="cb109-7" data-line-number="7">##  3 fit_cyl_… &quot;my_model_fit(x1 = \&quot;cyl\&quot;, x2 =… cyl   drat  &lt;symb… fit_cyl…</a>
<a class="sourceLine" id="cb109-8" data-line-number="8">##  4 fit_cyl_… &quot;my_model_fit(x1 = \&quot;cyl\&quot;, x2 =… cyl   wt    &lt;symb… fit_cyl…</a>
<a class="sourceLine" id="cb109-9" data-line-number="9">##  5 fit_cyl_… &quot;my_model_fit(x1 = \&quot;cyl\&quot;, x2 =… cyl   qsec  &lt;symb… fit_cyl…</a>
<a class="sourceLine" id="cb109-10" data-line-number="10">##  6 fit_cyl_… &quot;my_model_fit(x1 = \&quot;cyl\&quot;, x2 =… cyl   vs    &lt;symb… fit_cyl…</a>
<a class="sourceLine" id="cb109-11" data-line-number="11">##  7 fit_cyl_… &quot;my_model_fit(x1 = \&quot;cyl\&quot;, x2 =… cyl   am    &lt;symb… fit_cyl…</a>
<a class="sourceLine" id="cb109-12" data-line-number="12">##  8 fit_cyl_… &quot;my_model_fit(x1 = \&quot;cyl\&quot;, x2 =… cyl   gear  &lt;symb… fit_cyl…</a>
<a class="sourceLine" id="cb109-13" data-line-number="13">##  9 fit_cyl_… &quot;my_model_fit(x1 = \&quot;cyl\&quot;, x2 =… cyl   carb  &lt;symb… fit_cyl…</a>
<a class="sourceLine" id="cb109-14" data-line-number="14">## 10 fit_disp… &quot;my_model_fit(x1 = \&quot;disp\&quot;, x2 … disp  hp    &lt;symb… fit_dis…</a>
<a class="sourceLine" id="cb109-15" data-line-number="15">## # ... with 35 more rows</a></code></pre></div>
<p>In any case, we can now fit our models.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb110-1" data-line-number="1"><span class="kw">make</span>(plan, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p>And inspect the output.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb111-1" data-line-number="1"><span class="kw">readd</span>(fit_cyl_disp)</a>
<a class="sourceLine" id="cb111-2" data-line-number="2">## </a>
<a class="sourceLine" id="cb111-3" data-line-number="3">## Call:</a>
<a class="sourceLine" id="cb111-4" data-line-number="4">## lm(formula = as.formula(paste(&quot;mpg ~&quot;, x1, &quot;+&quot;, x2)), data = data)</a>
<a class="sourceLine" id="cb111-5" data-line-number="5">## </a>
<a class="sourceLine" id="cb111-6" data-line-number="6">## Coefficients:</a>
<a class="sourceLine" id="cb111-7" data-line-number="7">## (Intercept)          cyl         disp  </a>
<a class="sourceLine" id="cb111-8" data-line-number="8">##    34.66099     -1.58728     -0.02058</a></code></pre></div>
</div>
<div id="wildcard-templating" class="section level3">
<h3><span class="header-section-number">6.5.2</span> Wildcard templating</h3>
<p>In <code>drake</code>, you can write plans with wildcards. These wilrdards are placeholders for text in commands. By iterating over the possible values of a wildcard, you can easily generate plans with thousands of targets. Let’s say you are running a simulation study, and you need to generate sets of random numbers from different distributions.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb112-1" data-line-number="1">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb112-2" data-line-number="2">  <span class="dt">t  =</span> <span class="kw">rt</span>(<span class="dv">1000</span>, <span class="dt">df =</span> <span class="dv">5</span>),</a>
<a class="sourceLine" id="cb112-3" data-line-number="3">  <span class="dt">normal =</span> <span class="kw">runif</span>(<span class="dv">1000</span>, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb112-4" data-line-number="4">)</a></code></pre></div>
<p>If you need to generate many datasets with different means, you may wish to write out each target individually.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb113-1" data-line-number="1"><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb113-2" data-line-number="2">  <span class="dt">t  =</span> <span class="kw">rt</span>(<span class="dv">1000</span>, <span class="dt">df =</span> <span class="dv">5</span>),</a>
<a class="sourceLine" id="cb113-3" data-line-number="3">  <span class="dt">normal_0 =</span> <span class="kw">runif</span>(<span class="dv">1000</span>, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb113-4" data-line-number="4">  <span class="dt">normal_1 =</span> <span class="kw">runif</span>(<span class="dv">1000</span>, <span class="dt">mean =</span> <span class="dv">1</span>, <span class="dt">sd =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb113-5" data-line-number="5">  <span class="dt">normal_2 =</span> <span class="kw">runif</span>(<span class="dv">1000</span>, <span class="dt">mean =</span> <span class="dv">2</span>, <span class="dt">sd =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb113-6" data-line-number="6">  <span class="dt">normal_3 =</span> <span class="kw">runif</span>(<span class="dv">1000</span>, <span class="dt">mean =</span> <span class="dv">3</span>, <span class="dt">sd =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb113-7" data-line-number="7">  <span class="dt">normal_4 =</span> <span class="kw">runif</span>(<span class="dv">1000</span>, <span class="dt">mean =</span> <span class="dv">4</span>, <span class="dt">sd =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb113-8" data-line-number="8">  <span class="dt">normal_5 =</span> <span class="kw">runif</span>(<span class="dv">1000</span>, <span class="dt">mean =</span> <span class="dv">5</span>, <span class="dt">sd =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb113-9" data-line-number="9">  <span class="dt">normal_6 =</span> <span class="kw">runif</span>(<span class="dv">1000</span>, <span class="dt">mean =</span> <span class="dv">6</span>, <span class="dt">sd =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb113-10" data-line-number="10">  <span class="dt">normal_7 =</span> <span class="kw">runif</span>(<span class="dv">1000</span>, <span class="dt">mean =</span> <span class="dv">7</span>, <span class="dt">sd =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb113-11" data-line-number="11">  <span class="dt">normal_8 =</span> <span class="kw">runif</span>(<span class="dv">1000</span>, <span class="dt">mean =</span> <span class="dv">8</span>, <span class="dt">sd =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb113-12" data-line-number="12">  <span class="dt">normal_9 =</span> <span class="kw">runif</span>(<span class="dv">1000</span>, <span class="dt">mean =</span> <span class="dv">9</span>, <span class="dt">sd =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb113-13" data-line-number="13">)</a></code></pre></div>
<p>But writing all that code manually is a pain and prone to human error. Instead, use <code>evaluate_plan()</code></p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb114-1" data-line-number="1">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb114-2" data-line-number="2">  <span class="dt">t  =</span> <span class="kw">rt</span>(<span class="dv">1000</span>, <span class="dt">df =</span> <span class="dv">5</span>),</a>
<a class="sourceLine" id="cb114-3" data-line-number="3">  <span class="dt">normal =</span> <span class="kw">runif</span>(<span class="dv">1000</span>, <span class="dt">mean =</span> mean__, <span class="dt">sd =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb114-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb114-5" data-line-number="5"><span class="kw">evaluate_plan</span>(plan, <span class="dt">wildcard =</span> <span class="st">&quot;mean__&quot;</span>, <span class="dt">values =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">9</span>)</a>
<a class="sourceLine" id="cb114-6" data-line-number="6">## # A tibble: 11 x 2</a>
<a class="sourceLine" id="cb114-7" data-line-number="7">##    target   command                      </a>
<a class="sourceLine" id="cb114-8" data-line-number="8">##    &lt;chr&gt;    &lt;chr&gt;                        </a>
<a class="sourceLine" id="cb114-9" data-line-number="9">##  1 t        rt(1000, df = 5)             </a>
<a class="sourceLine" id="cb114-10" data-line-number="10">##  2 normal_0 runif(1000, mean = 0, sd = 1)</a>
<a class="sourceLine" id="cb114-11" data-line-number="11">##  3 normal_1 runif(1000, mean = 1, sd = 1)</a>
<a class="sourceLine" id="cb114-12" data-line-number="12">##  4 normal_2 runif(1000, mean = 2, sd = 1)</a>
<a class="sourceLine" id="cb114-13" data-line-number="13">##  5 normal_3 runif(1000, mean = 3, sd = 1)</a>
<a class="sourceLine" id="cb114-14" data-line-number="14">##  6 normal_4 runif(1000, mean = 4, sd = 1)</a>
<a class="sourceLine" id="cb114-15" data-line-number="15">##  7 normal_5 runif(1000, mean = 5, sd = 1)</a>
<a class="sourceLine" id="cb114-16" data-line-number="16">##  8 normal_6 runif(1000, mean = 6, sd = 1)</a>
<a class="sourceLine" id="cb114-17" data-line-number="17">##  9 normal_7 runif(1000, mean = 7, sd = 1)</a>
<a class="sourceLine" id="cb114-18" data-line-number="18">## 10 normal_8 runif(1000, mean = 8, sd = 1)</a>
<a class="sourceLine" id="cb114-19" data-line-number="19">## 11 normal_9 runif(1000, mean = 9, sd = 1)</a></code></pre></div>
<p>You can specify multiple wildcards at once. If multiple wildcards appear in the same command, you will get a new target for each unique combination of values.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb115-1" data-line-number="1">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb115-2" data-line-number="2">  <span class="dt">t  =</span> <span class="kw">rt</span>(<span class="dv">1000</span>, <span class="dt">df =</span> df__),</a>
<a class="sourceLine" id="cb115-3" data-line-number="3">  <span class="dt">normal =</span> <span class="kw">runif</span>(<span class="dv">1000</span>, <span class="dt">mean =</span> mean__, <span class="dt">sd =</span> sd__)</a>
<a class="sourceLine" id="cb115-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb115-5" data-line-number="5"><span class="kw">evaluate_plan</span>(</a>
<a class="sourceLine" id="cb115-6" data-line-number="6">  plan,</a>
<a class="sourceLine" id="cb115-7" data-line-number="7">  <span class="dt">rules =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb115-8" data-line-number="8">    <span class="dt">mean__ =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb115-9" data-line-number="9">    <span class="dt">sd__ =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">4</span>),</a>
<a class="sourceLine" id="cb115-10" data-line-number="10">    <span class="dt">df__ =</span> <span class="dv">5</span><span class="op">:</span><span class="dv">7</span></a>
<a class="sourceLine" id="cb115-11" data-line-number="11">  )</a>
<a class="sourceLine" id="cb115-12" data-line-number="12">)</a>
<a class="sourceLine" id="cb115-13" data-line-number="13">## # A tibble: 7 x 2</a>
<a class="sourceLine" id="cb115-14" data-line-number="14">##   target     command                      </a>
<a class="sourceLine" id="cb115-15" data-line-number="15">##   &lt;chr&gt;      &lt;chr&gt;                        </a>
<a class="sourceLine" id="cb115-16" data-line-number="16">## 1 t_5        rt(1000, df = 5)             </a>
<a class="sourceLine" id="cb115-17" data-line-number="17">## 2 t_6        rt(1000, df = 6)             </a>
<a class="sourceLine" id="cb115-18" data-line-number="18">## 3 t_7        rt(1000, df = 7)             </a>
<a class="sourceLine" id="cb115-19" data-line-number="19">## 4 normal_0_3 runif(1000, mean = 0, sd = 3)</a>
<a class="sourceLine" id="cb115-20" data-line-number="20">## 5 normal_0_4 runif(1000, mean = 0, sd = 4)</a>
<a class="sourceLine" id="cb115-21" data-line-number="21">## 6 normal_1_3 runif(1000, mean = 1, sd = 3)</a>
<a class="sourceLine" id="cb115-22" data-line-number="22">## 7 normal_1_4 runif(1000, mean = 1, sd = 4)</a></code></pre></div>
<p>Set <code>expand</code> to <code>FALSE</code> to disable expansion.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb116-1" data-line-number="1">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb116-2" data-line-number="2">  <span class="dt">t  =</span> <span class="kw">rpois</span>(samples__, <span class="dt">lambda =</span> mean__),</a>
<a class="sourceLine" id="cb116-3" data-line-number="3">  <span class="dt">normal =</span> <span class="kw">runif</span>(samples__, <span class="dt">mean =</span> mean__)</a>
<a class="sourceLine" id="cb116-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb116-5" data-line-number="5"><span class="kw">evaluate_plan</span>(</a>
<a class="sourceLine" id="cb116-6" data-line-number="6">  plan,</a>
<a class="sourceLine" id="cb116-7" data-line-number="7">  <span class="dt">rules =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb116-8" data-line-number="8">    <span class="dt">samples__ =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">100</span>),</a>
<a class="sourceLine" id="cb116-9" data-line-number="9">    <span class="dt">mean__ =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb116-10" data-line-number="10">  ),</a>
<a class="sourceLine" id="cb116-11" data-line-number="11">  <span class="dt">expand =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb116-12" data-line-number="12">)</a>
<a class="sourceLine" id="cb116-13" data-line-number="13">## # A tibble: 2 x 2</a>
<a class="sourceLine" id="cb116-14" data-line-number="14">##   target command              </a>
<a class="sourceLine" id="cb116-15" data-line-number="15">##   &lt;chr&gt;  &lt;chr&gt;                </a>
<a class="sourceLine" id="cb116-16" data-line-number="16">## 1 t      rpois(50, lambda = 1)</a>
<a class="sourceLine" id="cb116-17" data-line-number="17">## 2 normal runif(100, mean = 5)</a></code></pre></div>
<p>Wildcard templating can sometimes be tricky. For example, suppose your project is to analyze school data, and your workflow checks several metrics of several schools. The idea is to write a workflow plan with your metrics and let the wildcard templating expand over the available schools.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb117-1" data-line-number="1">hard_plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb117-2" data-line-number="2">  <span class="dt">credits =</span> <span class="kw">check_credit_hours</span>(school__),</a>
<a class="sourceLine" id="cb117-3" data-line-number="3">  <span class="dt">students =</span> <span class="kw">check_students</span>(school__),</a>
<a class="sourceLine" id="cb117-4" data-line-number="4">  <span class="dt">grads =</span> <span class="kw">check_graduations</span>(school__),</a>
<a class="sourceLine" id="cb117-5" data-line-number="5">  <span class="dt">public_funds =</span> <span class="kw">check_public_funding</span>(school__)</a>
<a class="sourceLine" id="cb117-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb117-7" data-line-number="7"></a>
<a class="sourceLine" id="cb117-8" data-line-number="8"><span class="kw">evaluate_plan</span>(</a>
<a class="sourceLine" id="cb117-9" data-line-number="9">  hard_plan,</a>
<a class="sourceLine" id="cb117-10" data-line-number="10">  <span class="dt">rules =</span> <span class="kw">list</span>(<span class="dt">school__ =</span> <span class="kw">c</span>(<span class="st">&quot;schoolA&quot;</span>, <span class="st">&quot;schoolB&quot;</span>, <span class="st">&quot;schoolC&quot;</span>))</a>
<a class="sourceLine" id="cb117-11" data-line-number="11">)</a>
<a class="sourceLine" id="cb117-12" data-line-number="12">## # A tibble: 12 x 2</a>
<a class="sourceLine" id="cb117-13" data-line-number="13">##    target               command                      </a>
<a class="sourceLine" id="cb117-14" data-line-number="14">##    &lt;chr&gt;                &lt;chr&gt;                        </a>
<a class="sourceLine" id="cb117-15" data-line-number="15">##  1 credits_schoolA      check_credit_hours(schoolA)  </a>
<a class="sourceLine" id="cb117-16" data-line-number="16">##  2 credits_schoolB      check_credit_hours(schoolB)  </a>
<a class="sourceLine" id="cb117-17" data-line-number="17">##  3 credits_schoolC      check_credit_hours(schoolC)  </a>
<a class="sourceLine" id="cb117-18" data-line-number="18">##  4 students_schoolA     check_students(schoolA)      </a>
<a class="sourceLine" id="cb117-19" data-line-number="19">##  5 students_schoolB     check_students(schoolB)      </a>
<a class="sourceLine" id="cb117-20" data-line-number="20">##  6 students_schoolC     check_students(schoolC)      </a>
<a class="sourceLine" id="cb117-21" data-line-number="21">##  7 grads_schoolA        check_graduations(schoolA)   </a>
<a class="sourceLine" id="cb117-22" data-line-number="22">##  8 grads_schoolB        check_graduations(schoolB)   </a>
<a class="sourceLine" id="cb117-23" data-line-number="23">##  9 grads_schoolC        check_graduations(schoolC)   </a>
<a class="sourceLine" id="cb117-24" data-line-number="24">## 10 public_funds_schoolA check_public_funding(schoolA)</a>
<a class="sourceLine" id="cb117-25" data-line-number="25">## 11 public_funds_schoolB check_public_funding(schoolB)</a>
<a class="sourceLine" id="cb117-26" data-line-number="26">## 12 public_funds_schoolC check_public_funding(schoolC)</a></code></pre></div>
<p>But what if some metrics do not make sense? For example, what if <code>schoolC</code> is a completely privately-funded school? With no public funds, <code>check_public_funds(schoolC)</code> may quit in error if we are not careful. This is where setting up workflow plans requires a little creativity. In this case, we recommend that you use two wildcards: one for all the schools and another for just the public schools. The new plan has no twelfth row.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb118-1" data-line-number="1">plan_template &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb118-2" data-line-number="2">  <span class="dt">school =</span> <span class="kw">get_school_data</span>(<span class="st">&quot;school__&quot;</span>),</a>
<a class="sourceLine" id="cb118-3" data-line-number="3">  <span class="dt">credits =</span> <span class="kw">check_credit_hours</span>(all_schools__),</a>
<a class="sourceLine" id="cb118-4" data-line-number="4">  <span class="dt">students =</span> <span class="kw">check_students</span>(all_schools__),</a>
<a class="sourceLine" id="cb118-5" data-line-number="5">  <span class="dt">grads =</span> <span class="kw">check_graduations</span>(all_schools__),</a>
<a class="sourceLine" id="cb118-6" data-line-number="6">  <span class="dt">public_funds =</span> <span class="kw">check_public_funding</span>(public_schools__)</a>
<a class="sourceLine" id="cb118-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb118-8" data-line-number="8"><span class="kw">evaluate_plan</span>(</a>
<a class="sourceLine" id="cb118-9" data-line-number="9">  <span class="dt">plan =</span> plan_template,</a>
<a class="sourceLine" id="cb118-10" data-line-number="10">  <span class="dt">rules =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb118-11" data-line-number="11">    <span class="dt">school__ =</span> <span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>),</a>
<a class="sourceLine" id="cb118-12" data-line-number="12">    <span class="dt">all_schools__ =</span>  <span class="kw">c</span>(<span class="st">&quot;school_A&quot;</span>, <span class="st">&quot;school_B&quot;</span>, <span class="st">&quot;school_C&quot;</span>),</a>
<a class="sourceLine" id="cb118-13" data-line-number="13">    <span class="dt">public_schools__ =</span> <span class="kw">c</span>(<span class="st">&quot;school_A&quot;</span>, <span class="st">&quot;school_B&quot;</span>)</a>
<a class="sourceLine" id="cb118-14" data-line-number="14">  )</a>
<a class="sourceLine" id="cb118-15" data-line-number="15">)</a>
<a class="sourceLine" id="cb118-16" data-line-number="16">## # A tibble: 14 x 2</a>
<a class="sourceLine" id="cb118-17" data-line-number="17">##    target                command                       </a>
<a class="sourceLine" id="cb118-18" data-line-number="18">##    &lt;chr&gt;                 &lt;chr&gt;                         </a>
<a class="sourceLine" id="cb118-19" data-line-number="19">##  1 school_A              &quot;get_school_data(\&quot;A\&quot;)&quot;      </a>
<a class="sourceLine" id="cb118-20" data-line-number="20">##  2 school_B              &quot;get_school_data(\&quot;B\&quot;)&quot;      </a>
<a class="sourceLine" id="cb118-21" data-line-number="21">##  3 school_C              &quot;get_school_data(\&quot;C\&quot;)&quot;      </a>
<a class="sourceLine" id="cb118-22" data-line-number="22">##  4 credits_school_A      check_credit_hours(school_A)  </a>
<a class="sourceLine" id="cb118-23" data-line-number="23">##  5 credits_school_B      check_credit_hours(school_B)  </a>
<a class="sourceLine" id="cb118-24" data-line-number="24">##  6 credits_school_C      check_credit_hours(school_C)  </a>
<a class="sourceLine" id="cb118-25" data-line-number="25">##  7 students_school_A     check_students(school_A)      </a>
<a class="sourceLine" id="cb118-26" data-line-number="26">##  8 students_school_B     check_students(school_B)      </a>
<a class="sourceLine" id="cb118-27" data-line-number="27">##  9 students_school_C     check_students(school_C)      </a>
<a class="sourceLine" id="cb118-28" data-line-number="28">## 10 grads_school_A        check_graduations(school_A)   </a>
<a class="sourceLine" id="cb118-29" data-line-number="29">## 11 grads_school_B        check_graduations(school_B)   </a>
<a class="sourceLine" id="cb118-30" data-line-number="30">## 12 grads_school_C        check_graduations(school_C)   </a>
<a class="sourceLine" id="cb118-31" data-line-number="31">## 13 public_funds_school_A check_public_funding(school_A)</a>
<a class="sourceLine" id="cb118-32" data-line-number="32">## 14 public_funds_school_B check_public_funding(school_B)</a></code></pre></div>
<p>Thanks to <a href="https://github.com/AlexAxthelm">Alex Axthelm</a> for this use case in <a href="https://github.com/ropensci/drake/issues/235">issue 235</a>.</p>
</div>
<div id="wildcard-clusters" class="section level3">
<h3><span class="header-section-number">6.5.3</span> Wildcard clusters</h3>
<p>With <code>evaluate_plan(trace = TRUE)</code>, you can generate columns that show how the targets were generated from the wildcards.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb119-1" data-line-number="1">plan_template &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb119-2" data-line-number="2">  <span class="dt">school =</span> <span class="kw">get_school_data</span>(<span class="st">&quot;school__&quot;</span>),</a>
<a class="sourceLine" id="cb119-3" data-line-number="3">  <span class="dt">credits =</span> <span class="kw">check_credit_hours</span>(all_schools__),</a>
<a class="sourceLine" id="cb119-4" data-line-number="4">  <span class="dt">students =</span> <span class="kw">check_students</span>(all_schools__),</a>
<a class="sourceLine" id="cb119-5" data-line-number="5">  <span class="dt">grads =</span> <span class="kw">check_graduations</span>(all_schools__),</a>
<a class="sourceLine" id="cb119-6" data-line-number="6">  <span class="dt">public_funds =</span> <span class="kw">check_public_funding</span>(public_schools__)</a>
<a class="sourceLine" id="cb119-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb119-8" data-line-number="8">plan &lt;-<span class="st"> </span><span class="kw">evaluate_plan</span>(</a>
<a class="sourceLine" id="cb119-9" data-line-number="9">  <span class="dt">plan =</span> plan_template,</a>
<a class="sourceLine" id="cb119-10" data-line-number="10">  <span class="dt">rules =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb119-11" data-line-number="11">    <span class="dt">school__ =</span> <span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>),</a>
<a class="sourceLine" id="cb119-12" data-line-number="12">    <span class="dt">all_schools__ =</span>  <span class="kw">c</span>(<span class="st">&quot;school_A&quot;</span>, <span class="st">&quot;school_B&quot;</span>, <span class="st">&quot;school_C&quot;</span>),</a>
<a class="sourceLine" id="cb119-13" data-line-number="13">    <span class="dt">public_schools__ =</span> <span class="kw">c</span>(<span class="st">&quot;school_A&quot;</span>, <span class="st">&quot;school_B&quot;</span>)</a>
<a class="sourceLine" id="cb119-14" data-line-number="14">  ),</a>
<a class="sourceLine" id="cb119-15" data-line-number="15">  <span class="dt">trace =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb119-16" data-line-number="16">)</a>
<a class="sourceLine" id="cb119-17" data-line-number="17">plan</a>
<a class="sourceLine" id="cb119-18" data-line-number="18">## # A tibble: 14 x 8</a>
<a class="sourceLine" id="cb119-19" data-line-number="19">##    target command school__ school___from all_schools__ all_schools___f…</a>
<a class="sourceLine" id="cb119-20" data-line-number="20">##    &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;         &lt;chr&gt;         &lt;chr&gt;           </a>
<a class="sourceLine" id="cb119-21" data-line-number="21">##  1 schoo… &quot;get_s… A        school        &lt;NA&gt;          &lt;NA&gt;            </a>
<a class="sourceLine" id="cb119-22" data-line-number="22">##  2 schoo… &quot;get_s… B        school        &lt;NA&gt;          &lt;NA&gt;            </a>
<a class="sourceLine" id="cb119-23" data-line-number="23">##  3 schoo… &quot;get_s… C        school        &lt;NA&gt;          &lt;NA&gt;            </a>
<a class="sourceLine" id="cb119-24" data-line-number="24">##  4 credi… check_… &lt;NA&gt;     &lt;NA&gt;          school_A      credits         </a>
<a class="sourceLine" id="cb119-25" data-line-number="25">##  5 credi… check_… &lt;NA&gt;     &lt;NA&gt;          school_B      credits         </a>
<a class="sourceLine" id="cb119-26" data-line-number="26">##  6 credi… check_… &lt;NA&gt;     &lt;NA&gt;          school_C      credits         </a>
<a class="sourceLine" id="cb119-27" data-line-number="27">##  7 stude… check_… &lt;NA&gt;     &lt;NA&gt;          school_A      students        </a>
<a class="sourceLine" id="cb119-28" data-line-number="28">##  8 stude… check_… &lt;NA&gt;     &lt;NA&gt;          school_B      students        </a>
<a class="sourceLine" id="cb119-29" data-line-number="29">##  9 stude… check_… &lt;NA&gt;     &lt;NA&gt;          school_C      students        </a>
<a class="sourceLine" id="cb119-30" data-line-number="30">## 10 grads… check_… &lt;NA&gt;     &lt;NA&gt;          school_A      grads           </a>
<a class="sourceLine" id="cb119-31" data-line-number="31">## 11 grads… check_… &lt;NA&gt;     &lt;NA&gt;          school_B      grads           </a>
<a class="sourceLine" id="cb119-32" data-line-number="32">## 12 grads… check_… &lt;NA&gt;     &lt;NA&gt;          school_C      grads           </a>
<a class="sourceLine" id="cb119-33" data-line-number="33">## 13 publi… check_… &lt;NA&gt;     &lt;NA&gt;          &lt;NA&gt;          &lt;NA&gt;            </a>
<a class="sourceLine" id="cb119-34" data-line-number="34">## 14 publi… check_… &lt;NA&gt;     &lt;NA&gt;          &lt;NA&gt;          &lt;NA&gt;            </a>
<a class="sourceLine" id="cb119-35" data-line-number="35">## # ... with 2 more variables: public_schools__ &lt;chr&gt;,</a>
<a class="sourceLine" id="cb119-36" data-line-number="36">## #   public_schools___from &lt;chr&gt;</a></code></pre></div>
<p>And then when you visualize the dependency graph, you can cluster nodes based on the wildcard info.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb120-1" data-line-number="1">config &lt;-<span class="st"> </span><span class="kw">drake_config</span>(plan)</a>
<a class="sourceLine" id="cb120-2" data-line-number="2"><span class="kw">vis_drake_graph</span>(</a>
<a class="sourceLine" id="cb120-3" data-line-number="3">  config,</a>
<a class="sourceLine" id="cb120-4" data-line-number="4">  <span class="dt">group =</span> <span class="st">&quot;all_schools__&quot;</span>,</a>
<a class="sourceLine" id="cb120-5" data-line-number="5">  <span class="dt">clusters =</span> <span class="kw">c</span>(<span class="st">&quot;school_A&quot;</span>, <span class="st">&quot;school_B&quot;</span>, <span class="st">&quot;school_C&quot;</span>)</a>
<a class="sourceLine" id="cb120-6" data-line-number="6">)</a></code></pre></div>
<div id="htmlwidget-25db82eb3b31272a5d15" style="width:576px;height:576px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-25db82eb3b31272a5d15">{"x":{"nodes":{"id":["check_credit_hours","check_graduations","check_public_funding","check_students","get_school_data","public_funds_school_A","public_funds_school_B","school_A","school_B","school_C","all_schools__: school_A","all_schools__: school_B","all_schools__: school_C"],"deps":[{},{},{},{},{},{},{},{},{},{},{},{},{}],"trigger":[null,null,null,null,null,{},{},{},{},{},{},{},{}],"label":["check_credit_hours\n0.003s","check_graduations\n0.003s","check_public_funding\n0.003s","check_students\n0.003s","get_school_data\n0.004s","public_funds_school_A","public_funds_school_B","school_A","school_B","school_C","all_schools__: school_A","all_schools__: school_B","all_schools__: school_C"],"command":[null,null,null,null,null,"check_public_funding(school_A)","check_public_funding(school_B)","get_school_data(\"A\")","get_school_data(\"B\")","get_school_data(\"C\")","check_credit_hours(school_A)","check_credit_hours(school_B)","check_credit_hours(school_C)"],"school__":[null,null,null,null,null,null,null,"A","B","C",null,null,null],"school___from":[null,null,null,null,null,null,null,"school","school","school",null,null,null],"all_schools__":[null,null,null,null,null,null,null,null,null,null,"school_A","school_B","school_C"],"all_schools___from":[null,null,null,null,null,null,null,null,null,null,"credits","credits","credits"],"public_schools__":[null,null,null,null,null,"school_A","school_B",null,null,null,null,null,null],"public_schools___from":[null,null,null,null,null,"public_funds","public_funds",null,null,null,null,null,null],"status":["imported","imported","imported","imported","imported","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated"],"type":["function","function","function","function","function","object","object","object","object","object","cluster","cluster","cluster"],"font.size":[20,20,20,20,20,20,20,20,20,20,20,20,20],"color":["#1874CD","#1874CD","#1874CD","#1874CD","#1874CD","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000"],"shape":["triangle","triangle","triangle","triangle","triangle","dot","dot","dot","dot","dot","diamond","diamond","diamond"],"level":[1,1,1,1,1,3,3,2,2,2,3,3,3],"title":["function&nbsp;()&nbsp;<br>{<br>}","function&nbsp;()&nbsp;<br>{<br>}","function&nbsp;()&nbsp;<br>{<br>}","function&nbsp;()&nbsp;<br>{<br>}","function&nbsp;()&nbsp;<br>{<br>}","check_public_funding(school_A)","check_public_funding(school_B)","get_school_data(\"A\")","get_school_data(\"B\")","get_school_data(\"C\")","credits_school_A, grads_school_A, students_sch...","credits_school_B, grads_school_B, students_sch...","credits_school_C, grads_school_C, students_sch..."],"x":[-0.523809523809524,-1,1,-0.80952380952381,0.238095238095238,0.80952380952381,1,-0.238095238095238,0.714285714285714,0.333333333333333,-1,-0.428571428571429,0.333333333333333],"y":[-1,-1,-1,-1,-1,1,1,0,0,0,1,1,1]},"edges":{"from":["get_school_data","get_school_data","get_school_data","check_students","check_students","check_students","check_graduations","check_graduations","check_graduations","check_credit_hours","check_credit_hours","check_credit_hours","check_public_funding","check_public_funding","school_A","school_A","school_B","school_B","school_C"],"to":["school_A","school_B","school_C","all_schools__: school_A","all_schools__: school_B","all_schools__: school_C","all_schools__: school_A","all_schools__: school_B","all_schools__: school_C","all_schools__: school_A","all_schools__: school_B","all_schools__: school_C","public_funds_school_A","public_funds_school_B","all_schools__: school_A","public_funds_school_A","all_schools__: school_B","public_funds_school_B","all_schools__: school_C"],"file":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"arrows":["to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to"],"smooth":[true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}},"edges":{"smooth":false},"physics":{"stabilization":false},"interaction":{"navigationButtons":true}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)"},"main":{"text":"Dependency graph","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":false,"hoverNearest":false,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null},"legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Outdated","Imported","Object","Function","Cluster"],"color":["#000000","#1874CD","#888888","#888888","#888888"],"shape":["dot","dot","dot","triangle","diamond"],"font.color":["black","black","black","black","black"],"font.size":[20,20,20,20,20],"id":[2,5,7,8,10]},"nodesToDataframe":true},"igraphlayout":{"type":"square"},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script>
<p>See the <a href="vis.html#vis">visualization guide</a> for more details.</p>
</div>
<div id="specialized-wildcard-functionality" class="section level3">
<h3><span class="header-section-number">6.5.4</span> Specialized wildcard functionality</h3>
<p>In the <a href="mtcars.html#mtcars"><code>mtcars</code> example</a>, we will analyze bootstrapped versions of the <code>mtcars</code> dataset to look for an association between the weight and the fuel efficiency of cars. This example uses <code>plan_analyses()</code> and <code>plan_summaries()</code>, two specialized applications of <code>evaluate_plan()</code>. First, we generate the plan for the bootstrapped datasets.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" data-line-number="1">my_datasets &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb121-2" data-line-number="2">  <span class="dt">small =</span> <span class="kw">simulate</span>(<span class="dv">48</span>),</a>
<a class="sourceLine" id="cb121-3" data-line-number="3">  <span class="dt">large =</span> <span class="kw">simulate</span>(<span class="dv">64</span>))</a>
<a class="sourceLine" id="cb121-4" data-line-number="4">my_datasets</a>
<a class="sourceLine" id="cb121-5" data-line-number="5">## # A tibble: 2 x 2</a>
<a class="sourceLine" id="cb121-6" data-line-number="6">##   target command     </a>
<a class="sourceLine" id="cb121-7" data-line-number="7">##   &lt;chr&gt;  &lt;chr&gt;       </a>
<a class="sourceLine" id="cb121-8" data-line-number="8">## 1 small  simulate(48)</a>
<a class="sourceLine" id="cb121-9" data-line-number="9">## 2 large  simulate(64)</a></code></pre></div>
<p>We want to analyze each dataset with one of two regression models.</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb122-1" data-line-number="1">methods &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb122-2" data-line-number="2">  <span class="dt">regression1 =</span> <span class="kw">reg1</span>(dataset__),</a>
<a class="sourceLine" id="cb122-3" data-line-number="3">  <span class="dt">regression2 =</span> <span class="kw">reg2</span>(dataset__))</a>
<a class="sourceLine" id="cb122-4" data-line-number="4">methods</a>
<a class="sourceLine" id="cb122-5" data-line-number="5">## # A tibble: 2 x 2</a>
<a class="sourceLine" id="cb122-6" data-line-number="6">##   target      command        </a>
<a class="sourceLine" id="cb122-7" data-line-number="7">##   &lt;chr&gt;       &lt;chr&gt;          </a>
<a class="sourceLine" id="cb122-8" data-line-number="8">## 1 regression1 reg1(dataset__)</a>
<a class="sourceLine" id="cb122-9" data-line-number="9">## 2 regression2 reg2(dataset__)</a></code></pre></div>
<p>We evaluate the <code>dataset__</code> wildcard to generate all the regression commands we will need.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" data-line-number="1">my_analyses &lt;-<span class="st"> </span><span class="kw">plan_analyses</span>(methods, <span class="dt">datasets =</span> my_datasets)</a>
<a class="sourceLine" id="cb123-2" data-line-number="2">my_analyses</a>
<a class="sourceLine" id="cb123-3" data-line-number="3">## # A tibble: 4 x 2</a>
<a class="sourceLine" id="cb123-4" data-line-number="4">##   target            command    </a>
<a class="sourceLine" id="cb123-5" data-line-number="5">##   &lt;chr&gt;             &lt;chr&gt;      </a>
<a class="sourceLine" id="cb123-6" data-line-number="6">## 1 regression1_small reg1(small)</a>
<a class="sourceLine" id="cb123-7" data-line-number="7">## 2 regression1_large reg1(large)</a>
<a class="sourceLine" id="cb123-8" data-line-number="8">## 3 regression2_small reg2(small)</a>
<a class="sourceLine" id="cb123-9" data-line-number="9">## 4 regression2_large reg2(large)</a></code></pre></div>
<p>Next, we summarize each analysis of each dataset. We calculate descriptive statistics on the residuals, and we collect the regression coefficients and their p-values.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb124-1" data-line-number="1">summary_types &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb124-2" data-line-number="2">  <span class="dt">summ =</span> <span class="kw">suppressWarnings</span>(<span class="kw">summary</span>(analysis__<span class="op">$</span>residuals)),</a>
<a class="sourceLine" id="cb124-3" data-line-number="3">  <span class="dt">coef =</span> <span class="kw">suppressWarnings</span>(<span class="kw">summary</span>(analysis__))<span class="op">$</span>coefficients</a>
<a class="sourceLine" id="cb124-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb124-5" data-line-number="5">summary_types</a>
<a class="sourceLine" id="cb124-6" data-line-number="6">## # A tibble: 2 x 2</a>
<a class="sourceLine" id="cb124-7" data-line-number="7">##   target command                                           </a>
<a class="sourceLine" id="cb124-8" data-line-number="8">##   &lt;chr&gt;  &lt;chr&gt;                                             </a>
<a class="sourceLine" id="cb124-9" data-line-number="9">## 1 summ   suppressWarnings(summary(analysis__$residuals))   </a>
<a class="sourceLine" id="cb124-10" data-line-number="10">## 2 coef   suppressWarnings(summary(analysis__))$coefficients</a>
<a class="sourceLine" id="cb124-11" data-line-number="11"></a>
<a class="sourceLine" id="cb124-12" data-line-number="12">results &lt;-<span class="st"> </span><span class="kw">plan_summaries</span>(summary_types, <span class="dt">analyses =</span> my_analyses,</a>
<a class="sourceLine" id="cb124-13" data-line-number="13">  <span class="dt">datasets =</span> my_datasets, <span class="dt">gather =</span> <span class="ot">NULL</span>) <span class="co"># Gathering is suppressed here.</span></a>
<a class="sourceLine" id="cb124-14" data-line-number="14">results</a>
<a class="sourceLine" id="cb124-15" data-line-number="15">## # A tibble: 8 x 2</a>
<a class="sourceLine" id="cb124-16" data-line-number="16">##   target                command                                           </a>
<a class="sourceLine" id="cb124-17" data-line-number="17">##   &lt;chr&gt;                 &lt;chr&gt;                                             </a>
<a class="sourceLine" id="cb124-18" data-line-number="18">## 1 summ_regression1_sma… suppressWarnings(summary(regression1_small$residu…</a>
<a class="sourceLine" id="cb124-19" data-line-number="19">## 2 summ_regression1_lar… suppressWarnings(summary(regression1_large$residu…</a>
<a class="sourceLine" id="cb124-20" data-line-number="20">## 3 summ_regression2_sma… suppressWarnings(summary(regression2_small$residu…</a>
<a class="sourceLine" id="cb124-21" data-line-number="21">## 4 summ_regression2_lar… suppressWarnings(summary(regression2_large$residu…</a>
<a class="sourceLine" id="cb124-22" data-line-number="22">## 5 coef_regression1_sma… suppressWarnings(summary(regression1_small))$coef…</a>
<a class="sourceLine" id="cb124-23" data-line-number="23">## 6 coef_regression1_lar… suppressWarnings(summary(regression1_large))$coef…</a>
<a class="sourceLine" id="cb124-24" data-line-number="24">## 7 coef_regression2_sma… suppressWarnings(summary(regression2_small))$coef…</a>
<a class="sourceLine" id="cb124-25" data-line-number="25">## 8 coef_regression2_lar… suppressWarnings(summary(regression2_large))$coef…</a></code></pre></div>
<p>Next, we bind all the rows together for a single plan that we can later supply to <code>make()</code>.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" data-line-number="1">my_plan &lt;-<span class="st"> </span><span class="kw">rbind</span>(my_datasets, my_analyses, results)</a>
<a class="sourceLine" id="cb125-2" data-line-number="2">my_plan</a>
<a class="sourceLine" id="cb125-3" data-line-number="3">## # A tibble: 14 x 2</a>
<a class="sourceLine" id="cb125-4" data-line-number="4">##    target               command                                           </a>
<a class="sourceLine" id="cb125-5" data-line-number="5">##    &lt;chr&gt;                &lt;chr&gt;                                             </a>
<a class="sourceLine" id="cb125-6" data-line-number="6">##  1 small                simulate(48)                                      </a>
<a class="sourceLine" id="cb125-7" data-line-number="7">##  2 large                simulate(64)                                      </a>
<a class="sourceLine" id="cb125-8" data-line-number="8">##  3 regression1_small    reg1(small)                                       </a>
<a class="sourceLine" id="cb125-9" data-line-number="9">##  4 regression1_large    reg1(large)                                       </a>
<a class="sourceLine" id="cb125-10" data-line-number="10">##  5 regression2_small    reg2(small)                                       </a>
<a class="sourceLine" id="cb125-11" data-line-number="11">##  6 regression2_large    reg2(large)                                       </a>
<a class="sourceLine" id="cb125-12" data-line-number="12">##  7 summ_regression1_sm… suppressWarnings(summary(regression1_small$residu…</a>
<a class="sourceLine" id="cb125-13" data-line-number="13">##  8 summ_regression1_la… suppressWarnings(summary(regression1_large$residu…</a>
<a class="sourceLine" id="cb125-14" data-line-number="14">##  9 summ_regression2_sm… suppressWarnings(summary(regression2_small$residu…</a>
<a class="sourceLine" id="cb125-15" data-line-number="15">## 10 summ_regression2_la… suppressWarnings(summary(regression2_large$residu…</a>
<a class="sourceLine" id="cb125-16" data-line-number="16">## 11 coef_regression1_sm… suppressWarnings(summary(regression1_small))$coef…</a>
<a class="sourceLine" id="cb125-17" data-line-number="17">## 12 coef_regression1_la… suppressWarnings(summary(regression1_large))$coef…</a>
<a class="sourceLine" id="cb125-18" data-line-number="18">## 13 coef_regression2_sm… suppressWarnings(summary(regression2_small))$coef…</a>
<a class="sourceLine" id="cb125-19" data-line-number="19">## 14 coef_regression2_la… suppressWarnings(summary(regression2_large))$coef…</a></code></pre></div>
</div>
<div id="non-wildcard-functions" class="section level3">
<h3><span class="header-section-number">6.5.5</span> Non-wildcard functions</h3>
<div id="expand_plan" class="section level4">
<h4><span class="header-section-number">6.5.5.1</span> <code>expand_plan()</code></h4>
<p>Sometimes, you just want multiple replicates of the same targets.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb126-1" data-line-number="1">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb126-2" data-line-number="2">  <span class="dt">fake_data =</span> <span class="kw">simulate_from_model</span>(),</a>
<a class="sourceLine" id="cb126-3" data-line-number="3">  <span class="dt">bootstrapped_data =</span> <span class="kw">bootstrap_from_real_data</span>(real_data)</a>
<a class="sourceLine" id="cb126-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb126-5" data-line-number="5"><span class="kw">expand_plan</span>(plan, <span class="dt">values =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb126-6" data-line-number="6">## # A tibble: 6 x 2</a>
<a class="sourceLine" id="cb126-7" data-line-number="7">##   target              command                            </a>
<a class="sourceLine" id="cb126-8" data-line-number="8">##   &lt;chr&gt;               &lt;chr&gt;                              </a>
<a class="sourceLine" id="cb126-9" data-line-number="9">## 1 fake_data_1         simulate_from_model()              </a>
<a class="sourceLine" id="cb126-10" data-line-number="10">## 2 fake_data_2         simulate_from_model()              </a>
<a class="sourceLine" id="cb126-11" data-line-number="11">## 3 fake_data_3         simulate_from_model()              </a>
<a class="sourceLine" id="cb126-12" data-line-number="12">## 4 bootstrapped_data_1 bootstrap_from_real_data(real_data)</a>
<a class="sourceLine" id="cb126-13" data-line-number="13">## 5 bootstrapped_data_2 bootstrap_from_real_data(real_data)</a>
<a class="sourceLine" id="cb126-14" data-line-number="14">## 6 bootstrapped_data_3 bootstrap_from_real_data(real_data)</a></code></pre></div>
</div>
<div id="gather_plan-and-gather_by" class="section level4">
<h4><span class="header-section-number">6.5.5.2</span> <code>gather_plan()</code> and <code>gather_by()</code></h4>
<p>Other times, you want to combine multiple targets into one.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb127-1" data-line-number="1">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb127-2" data-line-number="2">  <span class="dt">small =</span> <span class="kw">data.frame</span>(<span class="dt">type =</span> <span class="st">&quot;small&quot;</span>, <span class="dt">x =</span> <span class="kw">rnorm</span>(<span class="dv">25</span>), <span class="dt">y =</span> <span class="kw">rnorm</span>(<span class="dv">25</span>)),</a>
<a class="sourceLine" id="cb127-3" data-line-number="3">  <span class="dt">large =</span> <span class="kw">data.frame</span>(<span class="dt">type =</span> <span class="st">&quot;large&quot;</span>, <span class="dt">x =</span> <span class="kw">rnorm</span>(<span class="dv">1000</span>), <span class="dt">y =</span> <span class="kw">rnorm</span>(<span class="dv">1000</span>))</a>
<a class="sourceLine" id="cb127-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb127-5" data-line-number="5"><span class="kw">gather_plan</span>(plan, <span class="dt">target =</span> <span class="st">&quot;combined&quot;</span>)</a>
<a class="sourceLine" id="cb127-6" data-line-number="6">## # A tibble: 1 x 2</a>
<a class="sourceLine" id="cb127-7" data-line-number="7">##   target   command                           </a>
<a class="sourceLine" id="cb127-8" data-line-number="8">##   &lt;chr&gt;    &lt;chr&gt;                             </a>
<a class="sourceLine" id="cb127-9" data-line-number="9">## 1 combined list(small = small, large = large)</a></code></pre></div>
<p>In this case, <code>small</code> and <code>large</code> are data frames, so it may be more convenient to combine the rows together.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb128-1" data-line-number="1"><span class="kw">gather_plan</span>(plan, <span class="dt">target =</span> <span class="st">&quot;combined&quot;</span>, <span class="dt">gather =</span> <span class="st">&quot;rbind&quot;</span>)</a>
<a class="sourceLine" id="cb128-2" data-line-number="2">## # A tibble: 1 x 2</a>
<a class="sourceLine" id="cb128-3" data-line-number="3">##   target   command                            </a>
<a class="sourceLine" id="cb128-4" data-line-number="4">##   &lt;chr&gt;    &lt;chr&gt;                              </a>
<a class="sourceLine" id="cb128-5" data-line-number="5">## 1 combined rbind(small = small, large = large)</a></code></pre></div>
<p>See also <code>gather_by()</code> to gather multiple groups of targets based on other columns in the plan (e.g. from <code>evaluate_plan(trace = TRUE)</code>).</p>
</div>
<div id="reduce_plan-and-reduce_by" class="section level4">
<h4><span class="header-section-number">6.5.5.3</span> <code>reduce_plan()</code> and <code>reduce_by()</code></h4>
<p><code>reduce_plan()</code> is similar to <code>gather_plan()</code>, but it allows you to combine multiple targets together in pairs. This is useful if combining everything at once requires too much time or computer memory, or if you want to parallelize the aggregation.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb129-1" data-line-number="1">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb129-2" data-line-number="2">  <span class="dt">a =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb129-3" data-line-number="3">  <span class="dt">b =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb129-4" data-line-number="4">  <span class="dt">c =</span> <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb129-5" data-line-number="5">  <span class="dt">d =</span> <span class="dv">4</span></a>
<a class="sourceLine" id="cb129-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb129-7" data-line-number="7"><span class="kw">reduce_plan</span>(plan)</a>
<a class="sourceLine" id="cb129-8" data-line-number="8">## # A tibble: 3 x 2</a>
<a class="sourceLine" id="cb129-9" data-line-number="9">##   target   command            </a>
<a class="sourceLine" id="cb129-10" data-line-number="10">##   &lt;chr&gt;    &lt;chr&gt;              </a>
<a class="sourceLine" id="cb129-11" data-line-number="11">## 1 target_1 a + b              </a>
<a class="sourceLine" id="cb129-12" data-line-number="12">## 2 target_2 c + d              </a>
<a class="sourceLine" id="cb129-13" data-line-number="13">## 3 target   target_1 + target_2</a></code></pre></div>
<p>You can control how each pair of targets gets combined.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb130-1" data-line-number="1"><span class="kw">reduce_plan</span>(plan, <span class="dt">begin =</span> <span class="st">&quot;c(&quot;</span>, <span class="dt">op =</span> <span class="st">&quot;, &quot;</span>, <span class="dt">end =</span> <span class="st">&quot;)&quot;</span>)</a>
<a class="sourceLine" id="cb130-2" data-line-number="2">## # A tibble: 3 x 2</a>
<a class="sourceLine" id="cb130-3" data-line-number="3">##   target   command              </a>
<a class="sourceLine" id="cb130-4" data-line-number="4">##   &lt;chr&gt;    &lt;chr&gt;                </a>
<a class="sourceLine" id="cb130-5" data-line-number="5">## 1 target_1 c(a, b)              </a>
<a class="sourceLine" id="cb130-6" data-line-number="6">## 2 target_2 c(c, d)              </a>
<a class="sourceLine" id="cb130-7" data-line-number="7">## 3 target   c(target_1, target_2)</a></code></pre></div>
<p>See also <code>reduce_by()</code> to do reductions on multiple groups of targets based on other columns in the plan (e.g. from <code>evaluate_plan(trace = TRUE)</code>).</p>
</div>
</div>
<div id="custom-metaprogramming" class="section level3">
<h3><span class="header-section-number">6.5.6</span> Custom metaprogramming</h3>
<p>The workflow plan is just a data frame. There is nothing magic about it, and you can create it any way you want. With your own custom metaprogramming, you don’t even need the <code>drake_plan()</code> function.</p>
<p>The following example could more easily be implemented with <code>map_plan()</code>, but we use other techniques to demonstrate the versatility of custom metaprogramming. Let’s consider a file-based example workflow. Here, our targets execute Linux commands to process input files and create output files.</p>
<pre><code>cat in1.txt > out1.txt
cat in2.txt > out2.txt
</code></pre>
<p>The <a href="https://github.com/tidyverse/glue"><code>glue</code></a> package can automatically generate these Linux commands.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" data-line-number="1"><span class="kw">library</span>(glue)</a>
<a class="sourceLine" id="cb131-2" data-line-number="2"><span class="kw">glue_data</span>(</a>
<a class="sourceLine" id="cb131-3" data-line-number="3">  <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb131-4" data-line-number="4">    <span class="dt">inputs =</span> <span class="kw">c</span>(<span class="st">&quot;in1.txt&quot;</span>, <span class="st">&quot;in2.txt&quot;</span>), </a>
<a class="sourceLine" id="cb131-5" data-line-number="5">    <span class="dt">outputs =</span> <span class="kw">c</span>(<span class="st">&quot;out1.txt&quot;</span>, <span class="st">&quot;out2.txt&quot;</span>)</a>
<a class="sourceLine" id="cb131-6" data-line-number="6">  ),</a>
<a class="sourceLine" id="cb131-7" data-line-number="7">  <span class="st">&quot;cat {inputs} &gt; {outputs}&quot;</span></a>
<a class="sourceLine" id="cb131-8" data-line-number="8">)</a>
<a class="sourceLine" id="cb131-9" data-line-number="9">## cat in1.txt &gt; out1.txt</a>
<a class="sourceLine" id="cb131-10" data-line-number="10">## cat in2.txt &gt; out2.txt</a></code></pre></div>
<p>Our <code>drake</code> commands will use <code>system()</code> to execute the Linux commands that <a href="https://github.com/tidyverse/glue"><code>glue</code></a> generates. Technically, we could use <code>drake_plan()</code> if we wanted.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb132-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb132-2" data-line-number="2"><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb132-3" data-line-number="3">  <span class="kw">glue_data</span>(</a>
<a class="sourceLine" id="cb132-4" data-line-number="4">    <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb132-5" data-line-number="5">      <span class="dt">inputs =</span> <span class="kw">file_in</span>(<span class="kw">c</span>(<span class="st">&quot;in1.txt&quot;</span>, <span class="st">&quot;in2.txt&quot;</span>)), </a>
<a class="sourceLine" id="cb132-6" data-line-number="6">      <span class="dt">outputs =</span> <span class="kw">file_out</span>(<span class="kw">c</span>(<span class="st">&quot;out1.txt&quot;</span>, <span class="st">&quot;out2.txt&quot;</span>))</a>
<a class="sourceLine" id="cb132-7" data-line-number="7">    ),</a>
<a class="sourceLine" id="cb132-8" data-line-number="8">    <span class="st">&quot;cat {inputs} &gt; {outputs}&quot;</span></a>
<a class="sourceLine" id="cb132-9" data-line-number="9">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb132-10" data-line-number="10"><span class="st">    </span><span class="kw">lapply</span>(<span class="dt">FUN =</span> system)</a>
<a class="sourceLine" id="cb132-11" data-line-number="11">)</a>
<a class="sourceLine" id="cb132-12" data-line-number="12">## # A tibble: 1 x 2</a>
<a class="sourceLine" id="cb132-13" data-line-number="13">##   target        command                                                   </a>
<a class="sourceLine" id="cb132-14" data-line-number="14">##   &lt;chr&gt;         &lt;chr&gt;                                                     </a>
<a class="sourceLine" id="cb132-15" data-line-number="15">## 1 drake_target… &quot;glue_data(list(inputs = file_in(c(\&quot;in1.txt\&quot;, \&quot;in2.txt…</a></code></pre></div>
<p>But what if we want to <em>generate</em> these <a href="https://github.com/tidyverse/glue"><code>glue</code></a> commands instead of writing them literally in our plan? This is a job for custom metaprogramming with <a href="https://www.youtube.com/watch?v=nERXS3ssntw">tidy evaluation</a>. First, we create a function to generate the <code>drake</code> command of an arbitrary target.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb133-1" data-line-number="1"><span class="kw">library</span>(rlang) <span class="co"># for tidy evaluation</span></a>
<a class="sourceLine" id="cb133-2" data-line-number="2">write_command &lt;-<span class="st"> </span><span class="cf">function</span>(cmd, <span class="dt">inputs =</span> <span class="ot">NULL</span> , <span class="dt">outputs =</span> <span class="ot">NULL</span>){</a>
<a class="sourceLine" id="cb133-3" data-line-number="3">  inputs &lt;-<span class="st"> </span><span class="kw">enexpr</span>(inputs)</a>
<a class="sourceLine" id="cb133-4" data-line-number="4">  outputs &lt;-<span class="st"> </span><span class="kw">enexpr</span>(outputs)</a>
<a class="sourceLine" id="cb133-5" data-line-number="5">  <span class="kw">expr</span>({</a>
<a class="sourceLine" id="cb133-6" data-line-number="6">    <span class="kw">glue_data</span>(</a>
<a class="sourceLine" id="cb133-7" data-line-number="7">      <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb133-8" data-line-number="8">        <span class="dt">inputs =</span> <span class="kw">file_in</span>(<span class="op">!!</span>inputs),</a>
<a class="sourceLine" id="cb133-9" data-line-number="9">        <span class="dt">outputs =</span> <span class="kw">file_out</span>(<span class="op">!!</span>outputs)</a>
<a class="sourceLine" id="cb133-10" data-line-number="10">      ),</a>
<a class="sourceLine" id="cb133-11" data-line-number="11">      <span class="op">!!</span>cmd</a>
<a class="sourceLine" id="cb133-12" data-line-number="12">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb133-13" data-line-number="13"><span class="st">      </span><span class="kw">lapply</span>(<span class="dt">FUN =</span> system)</a>
<a class="sourceLine" id="cb133-14" data-line-number="14">  }) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb133-15" data-line-number="15"><span class="st">    </span>expr_text</a>
<a class="sourceLine" id="cb133-16" data-line-number="16">}</a>
<a class="sourceLine" id="cb133-17" data-line-number="17"></a>
<a class="sourceLine" id="cb133-18" data-line-number="18"><span class="kw">write_command</span>(</a>
<a class="sourceLine" id="cb133-19" data-line-number="19">  <span class="dt">cmd =</span> <span class="st">&quot;cat {inputs} &gt; {outputs}&quot;</span>,</a>
<a class="sourceLine" id="cb133-20" data-line-number="20">  <span class="dt">inputs =</span> <span class="kw">c</span>(<span class="st">&quot;in1.txt&quot;</span>, <span class="st">&quot;in2.txt&quot;</span>),</a>
<a class="sourceLine" id="cb133-21" data-line-number="21">  <span class="dt">outputs =</span> <span class="kw">c</span>(<span class="st">&quot;out1.txt&quot;</span>, <span class="st">&quot;out2.txt&quot;</span>)</a>
<a class="sourceLine" id="cb133-22" data-line-number="22">) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb133-23" data-line-number="23"><span class="st">  </span>cat</a>
<a class="sourceLine" id="cb133-24" data-line-number="24">## {</a>
<a class="sourceLine" id="cb133-25" data-line-number="25">##     glue_data(list(inputs = file_in(c(&quot;in1.txt&quot;, &quot;in2.txt&quot;)), </a>
<a class="sourceLine" id="cb133-26" data-line-number="26">##         outputs = file_out(c(&quot;out1.txt&quot;, &quot;out2.txt&quot;))), &quot;cat {inputs} &gt; {outputs}&quot;) %&gt;% </a>
<a class="sourceLine" id="cb133-27" data-line-number="27">##         lapply(FUN = system)</a>
<a class="sourceLine" id="cb133-28" data-line-number="28">## }</a></code></pre></div>
<p>Then, we lay out all the arguments we will pass to <code>write_command()</code>. Here, each row corresponds to a separate target.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb134-1" data-line-number="1">meta_plan &lt;-<span class="st"> </span><span class="kw">tribble</span>(</a>
<a class="sourceLine" id="cb134-2" data-line-number="2">  <span class="op">~</span>cmd, <span class="op">~</span>inputs, <span class="op">~</span>outputs,</a>
<a class="sourceLine" id="cb134-3" data-line-number="3">  <span class="st">&quot;cat {inputs} &gt; {outputs}&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;in1.txt&quot;</span>, <span class="st">&quot;in2.txt&quot;</span>), <span class="kw">c</span>(<span class="st">&quot;out1.txt&quot;</span>, <span class="st">&quot;out2.txt&quot;</span>),</a>
<a class="sourceLine" id="cb134-4" data-line-number="4">  <span class="st">&quot;cat {inputs} {inputs} &gt; {outputs}&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;out1.txt&quot;</span>, <span class="st">&quot;out2.txt&quot;</span>), <span class="kw">c</span>(<span class="st">&quot;out3.txt&quot;</span>, <span class="st">&quot;out4.txt&quot;</span>)</a>
<a class="sourceLine" id="cb134-5" data-line-number="5">) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb134-6" data-line-number="6"><span class="st">  </span>print</a>
<a class="sourceLine" id="cb134-7" data-line-number="7">## # A tibble: 2 x 3</a>
<a class="sourceLine" id="cb134-8" data-line-number="8">##   cmd                               inputs    outputs  </a>
<a class="sourceLine" id="cb134-9" data-line-number="9">##   &lt;chr&gt;                             &lt;list&gt;    &lt;list&gt;   </a>
<a class="sourceLine" id="cb134-10" data-line-number="10">## 1 cat {inputs} &gt; {outputs}          &lt;chr [2]&gt; &lt;chr [2]&gt;</a>
<a class="sourceLine" id="cb134-11" data-line-number="11">## 2 cat {inputs} {inputs} &gt; {outputs} &lt;chr [2]&gt; &lt;chr [2]&gt;</a></code></pre></div>
<p>Finally, we create our workflow plan without any built-in <code>drake</code> functions.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" data-line-number="1">plan &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb135-2" data-line-number="2">  <span class="dt">target =</span> <span class="kw">paste0</span>(<span class="st">&quot;target_&quot;</span>, <span class="kw">seq_len</span>(<span class="kw">nrow</span>(meta_plan))),</a>
<a class="sourceLine" id="cb135-3" data-line-number="3">  <span class="dt">command =</span> <span class="kw">pmap_chr</span>(meta_plan, write_command)</a>
<a class="sourceLine" id="cb135-4" data-line-number="4">) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb135-5" data-line-number="5"><span class="st">  </span>print</a>
<a class="sourceLine" id="cb135-6" data-line-number="6">## # A tibble: 2 x 2</a>
<a class="sourceLine" id="cb135-7" data-line-number="7">##   target   command                                                        </a>
<a class="sourceLine" id="cb135-8" data-line-number="8">##   &lt;chr&gt;    &lt;chr&gt;                                                          </a>
<a class="sourceLine" id="cb135-9" data-line-number="9">## 1 target_1 &quot;{\n    glue_data(list(inputs = file_in(c(\&quot;in1.txt\&quot;, \&quot;in2.t…</a>
<a class="sourceLine" id="cb135-10" data-line-number="10">## 2 target_2 &quot;{\n    glue_data(list(inputs = file_in(c(\&quot;out1.txt\&quot;, \&quot;out2…</a>
<a class="sourceLine" id="cb135-11" data-line-number="11"><span class="kw">writeLines</span>(<span class="st">&quot;in1&quot;</span>, <span class="st">&quot;in1.txt&quot;</span>)</a>
<a class="sourceLine" id="cb135-12" data-line-number="12"><span class="kw">writeLines</span>(<span class="st">&quot;in2&quot;</span>, <span class="st">&quot;in2.txt&quot;</span>)</a>
<a class="sourceLine" id="cb135-13" data-line-number="13"><span class="kw">vis_drake_graph</span>(<span class="kw">drake_config</span>(plan))</a></code></pre></div>
<div id="htmlwidget-dda5858bd620d236e22c" style="width:576px;height:576px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-dda5858bd620d236e22c">{"x":{"nodes":{"id":["\"out1.txt\"","\"out2.txt\"","\"out3.txt\"","\"out4.txt\"","\"in1.txt\"","\"in2.txt\"","target_1","target_2"],"deps":[{},{},{},{},null,null,{},{}],"trigger":[{},{},{},{},null,null,{},{}],"label":["\"out1.txt\"","\"out2.txt\"","\"out3.txt\"","\"out4.txt\"","\"in1.txt\"\n0.005s","\"in2.txt\"\n0.005s","target_1","target_2"],"command":["{\n    glue_data(list(inputs = file_in(c(\"in1.txt\", \"in2.txt\")), \n        outputs = file_out(c(\"out1.txt\", \"out2.txt\"))), \"cat {inputs} > {outputs}\") %>% \n        lapply(FUN = system)\n}","{\n    glue_data(list(inputs = file_in(c(\"in1.txt\", \"in2.txt\")), \n        outputs = file_out(c(\"out1.txt\", \"out2.txt\"))), \"cat {inputs} > {outputs}\") %>% \n        lapply(FUN = system)\n}","{\n    glue_data(list(inputs = file_in(c(\"out1.txt\", \"out2.txt\")), \n        outputs = file_out(c(\"out3.txt\", \"out4.txt\"))), \"cat {inputs} {inputs} > {outputs}\") %>% \n        lapply(FUN = system)\n}","{\n    glue_data(list(inputs = file_in(c(\"out1.txt\", \"out2.txt\")), \n        outputs = file_out(c(\"out3.txt\", \"out4.txt\"))), \"cat {inputs} {inputs} > {outputs}\") %>% \n        lapply(FUN = system)\n}",null,null,"{\n    glue_data(list(inputs = file_in(c(\"in1.txt\", \"in2.txt\")), \n        outputs = file_out(c(\"out1.txt\", \"out2.txt\"))), \"cat {inputs} > {outputs}\") %>% \n        lapply(FUN = system)\n}","{\n    glue_data(list(inputs = file_in(c(\"out1.txt\", \"out2.txt\")), \n        outputs = file_out(c(\"out3.txt\", \"out4.txt\"))), \"cat {inputs} {inputs} > {outputs}\") %>% \n        lapply(FUN = system)\n}"],"status":["outdated","outdated","outdated","outdated","imported","imported","outdated","outdated"],"type":["file","file","file","file","file","file","object","object"],"font.size":[20,20,20,20,20,20,20,20],"color":["#000000","#000000","#000000","#000000","#1874CD","#1874CD","#000000","#000000"],"shape":["square","square","square","square","square","square","dot","dot"],"level":[3,3,5,5,1,1,2,4],"title":["{\n&nbsp;&nbsp;&nbsp;&nbsp;glue_data(list(inputs&nbsp;=&nbsp;file_in(c(\"in1.t...","{\n&nbsp;&nbsp;&nbsp;&nbsp;glue_data(list(inputs&nbsp;=&nbsp;file_in(c(\"in1.t...","{\n&nbsp;&nbsp;&nbsp;&nbsp;glue_data(list(inputs&nbsp;=&nbsp;file_in(c(\"out1....","{\n&nbsp;&nbsp;&nbsp;&nbsp;glue_data(list(inputs&nbsp;=&nbsp;file_in(c(\"out1....","in1","in2","{\n&nbsp;&nbsp;&nbsp;&nbsp;glue_data(list(inputs&nbsp;=&nbsp;file_in(c(\"in1.t...","{\n&nbsp;&nbsp;&nbsp;&nbsp;glue_data(list(inputs&nbsp;=&nbsp;file_in(c(\"out1...."],"x":[-1,1,-1,1,-1,1,0,0],"y":[0,0,1,1,-1,-1,-0.5,0.5]},"edges":{"from":["\"in1.txt\"","\"in2.txt\"","\"out1.txt\"","\"out2.txt\"","target_1","target_1","target_2","target_2"],"to":["target_1","target_1","target_2","target_2","\"out1.txt\"","\"out2.txt\"","\"out3.txt\"","\"out4.txt\""],"file":[0,0,null,null,null,null,null,null],"arrows":["to","to","to","to","to","to","to","to"],"smooth":[true,true,true,true,true,true,true,true]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}},"edges":{"smooth":false},"physics":{"stabilization":false},"interaction":{"navigationButtons":true}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)"},"main":{"text":"Dependency graph","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":false,"hoverNearest":false,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null},"legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Outdated","Imported","Object","File"],"color":["#000000","#1874CD","#888888","#888888"],"shape":["dot","dot","dot","square"],"font.color":["black","black","black","black"],"font.size":[20,20,20,20],"id":[2,5,7,9]},"nodesToDataframe":true},"igraphlayout":{"type":"square"},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script>
<p>Alternatively, you could use <code>as.call()</code> instead of tidy evaluation to generate your plan. Use <code>as.call()</code> to construct calls to <code>file_in()</code>, <code>file_out()</code>, and custom functions in your commands.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb136-1" data-line-number="1"><span class="kw">library</span>(purrr) <span class="co"># pmap_chr() is particularly useful here.</span></a>
<a class="sourceLine" id="cb136-2" data-line-number="2"></a>
<a class="sourceLine" id="cb136-3" data-line-number="3"><span class="co"># A function that will be called in your commands.</span></a>
<a class="sourceLine" id="cb136-4" data-line-number="4">command_function &lt;-<span class="st"> </span><span class="cf">function</span>(cmd, inputs, outputs){</a>
<a class="sourceLine" id="cb136-5" data-line-number="5">  <span class="kw">glue_data</span>(</a>
<a class="sourceLine" id="cb136-6" data-line-number="6">    <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb136-7" data-line-number="7">      <span class="dt">inputs =</span> inputs,</a>
<a class="sourceLine" id="cb136-8" data-line-number="8">      <span class="dt">outputs =</span> outputs</a>
<a class="sourceLine" id="cb136-9" data-line-number="9">    ),</a>
<a class="sourceLine" id="cb136-10" data-line-number="10">    cmd</a>
<a class="sourceLine" id="cb136-11" data-line-number="11">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb136-12" data-line-number="12"><span class="st">    </span>purrr<span class="op">::</span><span class="kw">walk</span>(system)</a>
<a class="sourceLine" id="cb136-13" data-line-number="13">}</a>
<a class="sourceLine" id="cb136-14" data-line-number="14"></a>
<a class="sourceLine" id="cb136-15" data-line-number="15"><span class="co"># A function to generate quoted calls to command_function(),</span></a>
<a class="sourceLine" id="cb136-16" data-line-number="16"><span class="co"># which in turn contain quoted calls to file_in() and file_out().</span></a>
<a class="sourceLine" id="cb136-17" data-line-number="17">write_command &lt;-<span class="st"> </span><span class="cf">function</span>(...){</a>
<a class="sourceLine" id="cb136-18" data-line-number="18">  args &lt;-<span class="st"> </span><span class="kw">list</span>(...)</a>
<a class="sourceLine" id="cb136-19" data-line-number="19">  args<span class="op">$</span>inputs &lt;-<span class="st"> </span><span class="kw">as.call</span>(<span class="kw">list</span>(<span class="kw">quote</span>(file_in), args<span class="op">$</span>inputs))</a>
<a class="sourceLine" id="cb136-20" data-line-number="20">  args<span class="op">$</span>outputs &lt;-<span class="st"> </span><span class="kw">as.call</span>(<span class="kw">list</span>(<span class="kw">quote</span>(file_out), args<span class="op">$</span>outputs))</a>
<a class="sourceLine" id="cb136-21" data-line-number="21">  <span class="kw">c</span>(<span class="kw">quote</span>(command_function), args) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb136-22" data-line-number="22"><span class="st">    </span><span class="kw">as.call</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb136-23" data-line-number="23"><span class="st">    </span>rlang<span class="op">::</span><span class="kw">expr_text</span>()</a>
<a class="sourceLine" id="cb136-24" data-line-number="24">}</a>
<a class="sourceLine" id="cb136-25" data-line-number="25"></a>
<a class="sourceLine" id="cb136-26" data-line-number="26">plan &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb136-27" data-line-number="27">  <span class="dt">target =</span> <span class="kw">paste0</span>(<span class="st">&quot;target_&quot;</span>, <span class="kw">seq_len</span>(<span class="kw">nrow</span>(meta_plan))),</a>
<a class="sourceLine" id="cb136-28" data-line-number="28">  <span class="dt">command =</span> <span class="kw">pmap_chr</span>(meta_plan, write_command)</a>
<a class="sourceLine" id="cb136-29" data-line-number="29">) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb136-30" data-line-number="30"><span class="st">  </span>print</a>
<a class="sourceLine" id="cb136-31" data-line-number="31">## # A tibble: 2 x 2</a>
<a class="sourceLine" id="cb136-32" data-line-number="32">##   target   command                                                        </a>
<a class="sourceLine" id="cb136-33" data-line-number="33">##   &lt;chr&gt;    &lt;chr&gt;                                                          </a>
<a class="sourceLine" id="cb136-34" data-line-number="34">## 1 target_1 &quot;command_function(cmd = \&quot;cat {inputs} &gt; {outputs}\&quot;, inputs =…</a>
<a class="sourceLine" id="cb136-35" data-line-number="35">## 2 target_2 &quot;command_function(cmd = \&quot;cat {inputs} {inputs} &gt; {outputs}\&quot;,…</a></code></pre></div>
<p>Metaprogramming gets much simpler if you do not need to construct literal calls to <code>file_in()</code>, <code>file_out()</code>, etc. in your commands. The construction of <code>model_plan</code> in the <a href="gsp.html#gsp">gross state product exmaple</a> is an example.</p>
<p>Thanks to <a href="https://github.com/cfhammill">Chris Hammill</a> for <a href="https://github.com/ropensci/drake/issues/451">presenting this scenario and contributing to the solution</a>.</p>
</div>
</div>
<div id="optional-columns-in-your-plan." class="section level2">
<h2><span class="header-section-number">6.6</span> Optional columns in your plan.</h2>
<p>Besides the usual columns <code>target</code> and <code>command</code>, there are other columns you can add.</p>
<ul>
<li><code>cpu</code>, <code>elapsed</code>, and <code>timeout</code>: number of seconds to wait for the target to build before timing out (<code>timeout</code> for a general upper bound, <code>cpu</code> for CPU time, and <code>elapsed</code> for elapsed time).</li>
<li><code>priority</code>: for <a href="hpc.html#hpc">paralllel computing</a>, optionally rank the targets according to priority. That way, when two targets become ready to build at the same time, <code>drake</code> will pick the one with the dominant priority first.</li>
<li><code>retries</code>: number of times to retry building a target in the event of an error.</li>
<li><code>trigger</code>: choose the criterion that <code>drake</code> uses to decide whether to build the target. See <code>?trigger</code> or read the <a href="triggers.html#triggers">trigger chapter</a> to learn more.</li>
<li><code>worker</code>: for <a href="hpc.html#hpc">paralllel computing</a>, optionally name the preferred worker to assign to each target.</li>
</ul>

</div>
</div>
<div style = "background: #1C356D; color: white; padding: 10px 10px 10px 25px; font-size: 1em; width: 100%;">
  Copyright Eli Lilly and Company
</div>
            </section>

          </div>
        </div>
      </div>
<a href="mtcars.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="organize.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
