<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 drake plans | The drake R Package User Manual</title>
  <meta name="description" content="In-depth walkthroughs and examples of drake, an R package for reproducible computation at scale." />
  <meta name="generator" content="bookdown 0.14 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 drake plans | The drake R Package User Manual" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://ropenscilabs.github.io/drake-manual" />
  <meta property="og:image" content="https://ropenscilabs.github.io/drake-manual/images/logo.png" />
  <meta property="og:description" content="In-depth walkthroughs and examples of drake, an R package for reproducible computation at scale." />
  <meta name="github-repo" content="ropenscilabs/drake-manual" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 drake plans | The drake R Package User Manual" />
  
  <meta name="twitter:description" content="In-depth walkthroughs and examples of drake, an R package for reproducible computation at scale." />
  <meta name="twitter:image" content="https://ropenscilabs.github.io/drake-manual/images/logo.png" />

<meta name="author" content="Copyright Eli Lilly and Company" />
<meta name="author" content="Will Landau, Kirill MÃ¼ller, Alex Axthelm, Jasper Clarkberg, Lorenz Walthert, Matthew Mark Strasiotto" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="images/apple-touch-icon.png" />
  <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
<link rel="prev" href="walkthrough.html"/>
<link rel="next" href="projects.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/vis-4.20.1/vis.css" rel="stylesheet" />
<script src="libs/vis-4.20.1/vis.min.js"></script>
<script src="libs/visNetwork-binding-2.0.8/visNetwork.js"></script>
<script src="libs/d3-4.5.0/d3.min.js"></script>
<script src="libs/sankey-1/sankey.js"></script>
<script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="https://ropensci.github.io/dev_guide/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">The drake R Package User Manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#short-version"><i class="fa fa-check"></i><b>1.1</b> Short version</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#long-version"><i class="fa fa-check"></i><b>1.2</b> Long version</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#the-drake-r-package"><i class="fa fa-check"></i><b>1.3</b> The drake R package</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#installation"><i class="fa fa-check"></i><b>1.4</b> Installation</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#why-drake"><i class="fa fa-check"></i><b>1.5</b> Why drake?</a><ul>
<li class="chapter" data-level="1.5.1" data-path="index.html"><a href="index.html#what-gets-done-stays-done."><i class="fa fa-check"></i><b>1.5.1</b> What gets done stays done.</a></li>
<li class="chapter" data-level="1.5.2" data-path="index.html"><a href="index.html#reproducibility-with-confidence"><i class="fa fa-check"></i><b>1.5.2</b> Reproducibility with confidence</a></li>
<li class="chapter" data-level="1.5.3" data-path="index.html"><a href="index.html#scale-up-and-out."><i class="fa fa-check"></i><b>1.5.3</b> Scale up and out.</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#with-docker"><i class="fa fa-check"></i><b>1.6</b> With Docker</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#documentation"><i class="fa fa-check"></i><b>1.7</b> Documentation</a><ul>
<li class="chapter" data-level="1.7.1" data-path="index.html"><a href="index.html#frequently-asked-questions"><i class="fa fa-check"></i><b>1.7.1</b> Frequently asked questions</a></li>
<li class="chapter" data-level="1.7.2" data-path="index.html"><a href="index.html#function-reference"><i class="fa fa-check"></i><b>1.7.2</b> Function reference</a></li>
<li class="chapter" data-level="1.7.3" data-path="index.html"><a href="index.html#tutorials"><i class="fa fa-check"></i><b>1.7.3</b> Tutorials</a></li>
<li class="chapter" data-level="1.7.4" data-path="index.html"><a href="index.html#examples"><i class="fa fa-check"></i><b>1.7.4</b> Examples</a></li>
<li class="chapter" data-level="1.7.5" data-path="index.html"><a href="index.html#presentations"><i class="fa fa-check"></i><b>1.7.5</b> Presentations</a></li>
<li class="chapter" data-level="1.7.6" data-path="index.html"><a href="index.html#context-and-history"><i class="fa fa-check"></i><b>1.7.6</b> Context and history</a></li>
</ul></li>
<li class="chapter" data-level="1.8" data-path="index.html"><a href="index.html#help-and-troubleshooting"><i class="fa fa-check"></i><b>1.8</b> Help and troubleshooting</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="similar-work.html"><a href="similar-work.html"><i class="fa fa-check"></i><b>2</b> Similar work</a><ul>
<li class="chapter" data-level="2.1" data-path="similar-work.html"><a href="similar-work.html#pipeline-tools"><i class="fa fa-check"></i><b>2.1</b> Pipeline tools</a><ul>
<li class="chapter" data-level="2.1.1" data-path="similar-work.html"><a href="similar-work.html#gnu-make"><i class="fa fa-check"></i><b>2.1.1</b> GNU Make</a></li>
<li class="chapter" data-level="2.1.2" data-path="similar-work.html"><a href="similar-work.html#remake"><i class="fa fa-check"></i><b>2.1.2</b> Remake</a></li>
<li class="chapter" data-level="2.1.3" data-path="similar-work.html"><a href="similar-work.html#factuals-drake"><i class="fa fa-check"></i><b>2.1.3</b> Factualâs Drake</a></li>
<li class="chapter" data-level="2.1.4" data-path="similar-work.html"><a href="similar-work.html#other-pipeline-tools"><i class="fa fa-check"></i><b>2.1.4</b> Other pipeline tools</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="similar-work.html"><a href="similar-work.html#memoization"><i class="fa fa-check"></i><b>2.2</b> Memoization</a></li>
<li class="chapter" data-level="2.3" data-path="similar-work.html"><a href="similar-work.html#literate-programming"><i class="fa fa-check"></i><b>2.3</b> Literate programming</a><ul>
<li class="chapter" data-level="2.3.1" data-path="similar-work.html"><a href="similar-work.html#knitr-and-r-markdown"><i class="fa fa-check"></i><b>2.3.1</b> knitr and R Markdown</a></li>
<li class="chapter" data-level="2.3.2" data-path="similar-work.html"><a href="similar-work.html#version-control"><i class="fa fa-check"></i><b>2.3.2</b> Version control</a></li>
<li class="chapter" data-level="2.3.3" data-path="similar-work.html"><a href="similar-work.html#containerization-and-r-package-environments"><i class="fa fa-check"></i><b>2.3.3</b> Containerization and R package environments</a></li>
<li class="chapter" data-level="2.3.4" data-path="similar-work.html"><a href="similar-work.html#workflowr"><i class="fa fa-check"></i><b>2.3.4</b> workflowr</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="similar-work.html"><a href="similar-work.html#acknowledgements"><i class="fa fa-check"></i><b>2.4</b> Acknowledgements</a></li>
</ul></li>
<li class="part"><span><b>I Getting started</b></span></li>
<li class="chapter" data-level="3" data-path="walkthrough.html"><a href="walkthrough.html"><i class="fa fa-check"></i><b>3</b> Walkthrough</a><ul>
<li class="chapter" data-level="3.1" data-path="walkthrough.html"><a href="walkthrough.html#set-the-stage."><i class="fa fa-check"></i><b>3.1</b> Set the stage.</a></li>
<li class="chapter" data-level="3.2" data-path="walkthrough.html"><a href="walkthrough.html#make-your-results."><i class="fa fa-check"></i><b>3.2</b> Make your results.</a></li>
<li class="chapter" data-level="3.3" data-path="walkthrough.html"><a href="walkthrough.html#go-back-and-fix-things."><i class="fa fa-check"></i><b>3.3</b> Go back and fix things.</a></li>
<li class="chapter" data-level="3.4" data-path="walkthrough.html"><a href="walkthrough.html#history-and-provenance"><i class="fa fa-check"></i><b>3.4</b> History and provenance</a></li>
<li class="chapter" data-level="3.5" data-path="walkthrough.html"><a href="walkthrough.html#reproducible-data-recovery-and-renaming"><i class="fa fa-check"></i><b>3.5</b> Reproducible data recovery and renaming</a><ul>
<li class="chapter" data-level="3.5.1" data-path="walkthrough.html"><a href="walkthrough.html#undoing-clean"><i class="fa fa-check"></i><b>3.5.1</b> Undoing <code>clean()</code></a></li>
<li class="chapter" data-level="3.5.2" data-path="walkthrough.html"><a href="walkthrough.html#renaming"><i class="fa fa-check"></i><b>3.5.2</b> Renaming</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="walkthrough.html"><a href="walkthrough.html#try-the-code-yourself"><i class="fa fa-check"></i><b>3.6</b> Try the code yourself!</a></li>
<li class="chapter" data-level="3.7" data-path="walkthrough.html"><a href="walkthrough.html#thanks"><i class="fa fa-check"></i><b>3.7</b> Thanks</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="plans.html"><a href="plans.html"><i class="fa fa-check"></i><b>4</b> <code>drake</code> plans</a><ul>
<li class="chapter" data-level="4.1" data-path="plans.html"><a href="plans.html#what-is-a-drake-plan"><i class="fa fa-check"></i><b>4.1</b> What is a <code>drake</code> plan?</a></li>
<li class="chapter" data-level="4.2" data-path="plans.html"><a href="plans.html#plans-are-similar-to-r-scripts."><i class="fa fa-check"></i><b>4.2</b> Plans are similar to R scripts.</a></li>
<li class="chapter" data-level="4.3" data-path="plans.html"><a href="plans.html#so-why-do-we-use-plans"><i class="fa fa-check"></i><b>4.3</b> So why do we use plans?</a><ul>
<li class="chapter" data-level="4.3.1" data-path="plans.html"><a href="plans.html#plans-chop-up-the-work-into-pieces."><i class="fa fa-check"></i><b>4.3.1</b> Plans chop up the work into pieces.</a></li>
<li class="chapter" data-level="4.3.2" data-path="plans.html"><a href="plans.html#drake-uses-plans-to-schedule-you-work."><i class="fa fa-check"></i><b>4.3.2</b> <code>drake</code> uses plans to schedule you work.</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="plans.html"><a href="plans.html#special-custom-columns-in-your-plan"><i class="fa fa-check"></i><b>4.4</b> Special custom columns in your plan</a></li>
<li class="chapter" data-level="4.5" data-path="plans.html"><a href="plans.html#large-plans"><i class="fa fa-check"></i><b>4.5</b> Large plans</a><ul>
<li class="chapter" data-level="4.5.1" data-path="plans.html"><a href="plans.html#how-to-create-large-plans"><i class="fa fa-check"></i><b>4.5.1</b> How to create large plans</a></li>
<li class="chapter" data-level="4.5.2" data-path="plans.html"><a href="plans.html#start-small"><i class="fa fa-check"></i><b>4.5.2</b> Start small</a></li>
<li class="chapter" data-level="4.5.3" data-path="plans.html"><a href="plans.html#the-types-of-transformations"><i class="fa fa-check"></i><b>4.5.3</b> The types of transformations</a></li>
<li class="chapter" data-level="4.5.4" data-path="plans.html"><a href="plans.html#grouping-variables"><i class="fa fa-check"></i><b>4.5.4</b> Grouping variables</a></li>
<li class="chapter" data-level="4.5.5" data-path="plans.html"><a href="plans.html#tags"><i class="fa fa-check"></i><b>4.5.5</b> Tags</a></li>
<li class="chapter" data-level="4.5.6" data-path="plans.html"><a href="plans.html#target-names"><i class="fa fa-check"></i><b>4.5.6</b> Target names</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="projects.html"><a href="projects.html"><i class="fa fa-check"></i><b>5</b> <code>drake</code> projects</a><ul>
<li class="chapter" data-level="5.1" data-path="projects.html"><a href="projects.html#code-files"><i class="fa fa-check"></i><b>5.1</b> Code files</a></li>
<li class="chapter" data-level="5.2" data-path="projects.html"><a href="projects.html#safer-interactivity"><i class="fa fa-check"></i><b>5.2</b> Safer interactivity</a><ul>
<li class="chapter" data-level="5.2.1" data-path="projects.html"><a href="projects.html#motivation"><i class="fa fa-check"></i><b>5.2.1</b> Motivation</a></li>
<li class="chapter" data-level="5.2.2" data-path="projects.html"><a href="projects.html#usage"><i class="fa fa-check"></i><b>5.2.2</b> Usage</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="projects.html"><a href="projects.html#script-file-pitfalls"><i class="fa fa-check"></i><b>5.3</b> Script file pitfalls</a></li>
<li class="chapter" data-level="5.4" data-path="projects.html"><a href="projects.html#workflows-as-r-packages"><i class="fa fa-check"></i><b>5.4</b> Workflows as R packages</a></li>
<li class="chapter" data-level="5.5" data-path="projects.html"><a href="projects.html#other-tools"><i class="fa fa-check"></i><b>5.5</b> Other tools</a></li>
</ul></li>
<li class="part"><span><b>II Examples</b></span></li>
<li class="chapter" data-level="6" data-path="churn.html"><a href="churn.html"><i class="fa fa-check"></i><b>6</b> Customer churn and deep learning</a><ul>
<li class="chapter" data-level="6.1" data-path="churn.html"><a href="churn.html#packages"><i class="fa fa-check"></i><b>6.1</b> Packages</a></li>
<li class="chapter" data-level="6.2" data-path="churn.html"><a href="churn.html#functions"><i class="fa fa-check"></i><b>6.2</b> Functions</a></li>
<li class="chapter" data-level="6.3" data-path="churn.html"><a href="churn.html#plan"><i class="fa fa-check"></i><b>6.3</b> Plan</a></li>
<li class="chapter" data-level="6.4" data-path="churn.html"><a href="churn.html#dependency-graph"><i class="fa fa-check"></i><b>6.4</b> Dependency graph</a></li>
<li class="chapter" data-level="6.5" data-path="churn.html"><a href="churn.html#run-the-models"><i class="fa fa-check"></i><b>6.5</b> Run the models</a></li>
<li class="chapter" data-level="6.6" data-path="churn.html"><a href="churn.html#inspect-the-results"><i class="fa fa-check"></i><b>6.6</b> Inspect the results</a></li>
<li class="chapter" data-level="6.7" data-path="churn.html"><a href="churn.html#add-models"><i class="fa fa-check"></i><b>6.7</b> Add models</a></li>
<li class="chapter" data-level="6.8" data-path="churn.html"><a href="churn.html#inspect-the-results-again"><i class="fa fa-check"></i><b>6.8</b> Inspect the results again</a></li>
<li class="chapter" data-level="6.9" data-path="churn.html"><a href="churn.html#update-your-code"><i class="fa fa-check"></i><b>6.9</b> Update your code</a></li>
<li class="chapter" data-level="6.10" data-path="churn.html"><a href="churn.html#history-and-provenance-1"><i class="fa fa-check"></i><b>6.10</b> History and provenance</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="churn.html"><a href="churn.html#packages"><i class="fa fa-check"></i><b>7</b> An analysis of R package download trends</a><ul>
<li class="chapter" data-level="7.1" data-path="packages.html"><a href="packages.html"><i class="fa fa-check"></i><b>7.1</b> Get the code.</a></li>
<li class="chapter" data-level="7.2" data-path="packages.html"><a href="packages.html#overview"><i class="fa fa-check"></i><b>7.2</b> Overview</a></li>
<li class="chapter" data-level="7.3" data-path="packages.html"><a href="packages.html#analysis"><i class="fa fa-check"></i><b>7.3</b> Analysis</a></li>
<li class="chapter" data-level="7.4" data-path="packages.html"><a href="packages.html#other-ways-to-trigger-downloads"><i class="fa fa-check"></i><b>7.4</b> Other ways to trigger downloads</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="gsp.html"><a href="gsp.html"><i class="fa fa-check"></i><b>8</b> Finding the best model of gross state product</a><ul>
<li class="chapter" data-level="8.1" data-path="gsp.html"><a href="gsp.html#get-the-code.-1"><i class="fa fa-check"></i><b>8.1</b> Get the code.</a></li>
<li class="chapter" data-level="8.2" data-path="gsp.html"><a href="gsp.html#objective-and-methods"><i class="fa fa-check"></i><b>8.2</b> Objective and methods</a></li>
<li class="chapter" data-level="8.3" data-path="gsp.html"><a href="gsp.html#data"><i class="fa fa-check"></i><b>8.3</b> Data</a></li>
<li class="chapter" data-level="8.4" data-path="gsp.html"><a href="gsp.html#analysis-1"><i class="fa fa-check"></i><b>8.4</b> Analysis</a></li>
<li class="chapter" data-level="8.5" data-path="gsp.html"><a href="gsp.html#results"><i class="fa fa-check"></i><b>8.5</b> Results</a></li>
<li class="chapter" data-level="8.6" data-path="gsp.html"><a href="gsp.html#comparison-with-gnu-make"><i class="fa fa-check"></i><b>8.6</b> Comparison with GNU Make</a></li>
<li class="chapter" data-level="8.7" data-path="gsp.html"><a href="gsp.html#references"><i class="fa fa-check"></i><b>8.7</b> References</a></li>
</ul></li>
<li class="part"><span><b>III Resource management</b></span></li>
<li class="chapter" data-level="9" data-path="hpc.html"><a href="hpc.html"><i class="fa fa-check"></i><b>9</b> High-performance computing</a><ul>
<li class="chapter" data-level="9.1" data-path="hpc.html"><a href="hpc.html#start-small-1"><i class="fa fa-check"></i><b>9.1</b> Start small</a></li>
<li class="chapter" data-level="9.2" data-path="hpc.html"><a href="hpc.html#let-make-schedule-your-targets."><i class="fa fa-check"></i><b>9.2</b> Let <code>make()</code> schedule your targets.</a></li>
<li class="chapter" data-level="9.3" data-path="hpc.html"><a href="hpc.html#the-master-process"><i class="fa fa-check"></i><b>9.3</b> The master process</a><ul>
<li class="chapter" data-level="9.3.1" data-path="hpc.html"><a href="hpc.html#master-on-a-cluster"><i class="fa fa-check"></i><b>9.3.1</b> Master on a cluster</a></li>
<li class="chapter" data-level="9.3.2" data-path="hpc.html"><a href="hpc.html#local-master"><i class="fa fa-check"></i><b>9.3.2</b> Local master</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="hpc.html"><a href="hpc.html#parallel-backends"><i class="fa fa-check"></i><b>9.4</b> Parallel backends</a></li>
<li class="chapter" data-level="9.5" data-path="hpc.html"><a href="hpc.html#the-clustermq-backend"><i class="fa fa-check"></i><b>9.5</b> The <code>clustermq</code> backend</a><ul>
<li class="chapter" data-level="9.5.1" data-path="hpc.html"><a href="hpc.html#persistent-workers"><i class="fa fa-check"></i><b>9.5.1</b> Persistent workers</a></li>
<li class="chapter" data-level="9.5.2" data-path="hpc.html"><a href="hpc.html#installation-1"><i class="fa fa-check"></i><b>9.5.2</b> Installation</a></li>
<li class="chapter" data-level="9.5.3" data-path="hpc.html"><a href="hpc.html#on-your-local-machine"><i class="fa fa-check"></i><b>9.5.3</b> On your local machine</a></li>
<li class="chapter" data-level="9.5.4" data-path="hpc.html"><a href="hpc.html#on-a-cluster"><i class="fa fa-check"></i><b>9.5.4</b> On a cluster</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="hpc.html"><a href="hpc.html#the-future-backend"><i class="fa fa-check"></i><b>9.6</b> The <code>future</code> backend</a><ul>
<li class="chapter" data-level="9.6.1" data-path="hpc.html"><a href="hpc.html#transient-workers"><i class="fa fa-check"></i><b>9.6.1</b> Transient workers</a></li>
<li class="chapter" data-level="9.6.2" data-path="hpc.html"><a href="hpc.html#installation-2"><i class="fa fa-check"></i><b>9.6.2</b> Installation</a></li>
<li class="chapter" data-level="9.6.3" data-path="hpc.html"><a href="hpc.html#on-your-local-machine-1"><i class="fa fa-check"></i><b>9.6.3</b> On your local machine</a></li>
<li class="chapter" data-level="9.6.4" data-path="hpc.html"><a href="hpc.html#on-a-cluster-1"><i class="fa fa-check"></i><b>9.6.4</b> On a cluster</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="hpc.html"><a href="hpc.html#advanced-options"><i class="fa fa-check"></i><b>9.7</b> Advanced options</a><ul>
<li class="chapter" data-level="9.7.1" data-path="hpc.html"><a href="hpc.html#selectivity"><i class="fa fa-check"></i><b>9.7.1</b> Selectivity</a></li>
<li class="chapter" data-level="9.7.2" data-path="hpc.html"><a href="hpc.html#memory-options"><i class="fa fa-check"></i><b>9.7.2</b> Memory options</a></li>
<li class="chapter" data-level="9.7.3" data-path="hpc.html"><a href="hpc.html#storage-options"><i class="fa fa-check"></i><b>9.7.3</b> Storage options</a></li>
<li class="chapter" data-level="9.7.4" data-path="hpc.html"><a href="hpc.html#the-template-argument-for-persistent-workers"><i class="fa fa-check"></i><b>9.7.4</b> The <code>template</code> argument for persistent workers</a></li>
<li class="chapter" data-level="9.7.5" data-path="hpc.html"><a href="hpc.html#the-resources-column-for-transient-workers"><i class="fa fa-check"></i><b>9.7.5</b> The <code>resources</code> column for transient workers</a></li>
<li class="chapter" data-level="9.7.6" data-path="hpc.html"><a href="hpc.html#parallel-computing-within-targets"><i class="fa fa-check"></i><b>9.7.6</b> Parallel computing <em>within</em> targets</a></li>
<li class="chapter" data-level="9.7.7" data-path="hpc.html"><a href="hpc.html#custom-job-schedulers"><i class="fa fa-check"></i><b>9.7.7</b> Custom job schedulers</a></li>
<li class="chapter" data-level="9.7.8" data-path="hpc.html"><a href="hpc.html#hasty-mode"><i class="fa fa-check"></i><b>9.7.8</b> Hasty mode</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="time.html"><a href="time.html"><i class="fa fa-check"></i><b>10</b> Time: logging, prediction, and strategy</a><ul>
<li class="chapter" data-level="10.1" data-path="time.html"><a href="time.html#predict-total-runtime"><i class="fa fa-check"></i><b>10.1</b> Predict total runtime</a></li>
<li class="chapter" data-level="10.2" data-path="time.html"><a href="time.html#strategize-your-high-performance-computing"><i class="fa fa-check"></i><b>10.2</b> Strategize your high-performance computing</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="memory.html"><a href="memory.html"><i class="fa fa-check"></i><b>11</b> Memory management</a><ul>
<li class="chapter" data-level="11.1" data-path="memory.html"><a href="memory.html#garbage-collection-and-custom-files"><i class="fa fa-check"></i><b>11.1</b> Garbage collection and custom files</a></li>
<li class="chapter" data-level="11.2" data-path="memory.html"><a href="memory.html#memory-strategies"><i class="fa fa-check"></i><b>11.2</b> Memory strategies</a></li>
<li class="chapter" data-level="11.3" data-path="memory.html"><a href="memory.html#data-splitting"><i class="fa fa-check"></i><b>11.3</b> Data splitting</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="storage.html"><a href="storage.html"><i class="fa fa-check"></i><b>12</b> Storage</a><ul>
<li class="chapter" data-level="12.1" data-path="storage.html"><a href="storage.html#cache-formats"><i class="fa fa-check"></i><b>12.1</b> Cache formats</a><ul>
<li class="chapter" data-level="12.1.1" data-path="storage.html"><a href="storage.html#rds-caches"><i class="fa fa-check"></i><b>12.1.1</b> RDS caches</a></li>
<li class="chapter" data-level="12.1.2" data-path="storage.html"><a href="storage.html#database-caches"><i class="fa fa-check"></i><b>12.1.2</b> Database caches</a></li>
<li class="chapter" data-level="12.1.3" data-path="storage.html"><a href="storage.html#environment-caches"><i class="fa fa-check"></i><b>12.1.3</b> Environment caches</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="storage.html"><a href="storage.html#hash-algorithms"><i class="fa fa-check"></i><b>12.2</b> Hash algorithms</a></li>
</ul></li>
<li class="part"><span><b>IV Extra features</b></span></li>
<li class="chapter" data-level="13" data-path="visuals.html"><a href="visuals.html"><i class="fa fa-check"></i><b>13</b> Visualization with drake</a><ul>
<li class="chapter" data-level="13.0.1" data-path="visuals.html"><a href="visuals.html#vis_drake_graph"><i class="fa fa-check"></i><b>13.0.1</b> <code>vis_drake_graph()</code></a></li>
<li class="chapter" data-level="13.0.2" data-path="visuals.html"><a href="visuals.html#sankey_drake_graph"><i class="fa fa-check"></i><b>13.0.2</b> <code>sankey_drake_graph()</code></a></li>
<li class="chapter" data-level="13.0.3" data-path="visuals.html"><a href="visuals.html#drake_ggraph"><i class="fa fa-check"></i><b>13.0.3</b> <code>drake_ggraph()</code></a></li>
<li class="chapter" data-level="13.0.4" data-path="visuals.html"><a href="visuals.html#text_drake_graph"><i class="fa fa-check"></i><b>13.0.4</b> <code>text_drake_graph()</code></a></li>
<li class="chapter" data-level="13.1" data-path="visuals.html"><a href="visuals.html#underlying-graph-data-node-and-edge-data-frames"><i class="fa fa-check"></i><b>13.1</b> Underlying graph data: node and edge data frames</a></li>
<li class="chapter" data-level="13.2" data-path="visuals.html"><a href="visuals.html#visualizing-target-status"><i class="fa fa-check"></i><b>13.2</b> Visualizing target status</a></li>
<li class="chapter" data-level="13.3" data-path="visuals.html"><a href="visuals.html#subgraphs"><i class="fa fa-check"></i><b>13.3</b> Subgraphs</a></li>
<li class="chapter" data-level="13.4" data-path="visuals.html"><a href="visuals.html#control-the-vis_drake_graph-legend."><i class="fa fa-check"></i><b>13.4</b> Control the <code>vis_drake_graph()</code> legend.</a></li>
<li class="chapter" data-level="13.5" data-path="visuals.html"><a href="visuals.html#clusters"><i class="fa fa-check"></i><b>13.5</b> Clusters</a></li>
<li class="chapter" data-level="13.6" data-path="visuals.html"><a href="visuals.html#output-files"><i class="fa fa-check"></i><b>13.6</b> Output files</a></li>
<li class="chapter" data-level="13.7" data-path="visuals.html"><a href="visuals.html#node-selection"><i class="fa fa-check"></i><b>13.7</b> Node Selection</a><ul>
<li class="chapter" data-level="13.7.1" data-path="visuals.html"><a href="visuals.html#perform-the-default-action-on-select"><i class="fa fa-check"></i><b>13.7.1</b> Perform the default action on select</a></li>
<li class="chapter" data-level="13.7.2" data-path="visuals.html"><a href="visuals.html#perform-no-action-on-select"><i class="fa fa-check"></i><b>13.7.2</b> Perform no action on select</a></li>
<li class="chapter" data-level="13.7.3" data-path="visuals.html"><a href="visuals.html#customize-the-onselect-event-behaviour"><i class="fa fa-check"></i><b>13.7.3</b> Customize the onSelect event behaviour</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="debugging.html"><a href="debugging.html"><i class="fa fa-check"></i><b>14</b> Debugging and testing drake projects</a><ul>
<li class="chapter" data-level="14.0.1" data-path="debugging.html"><a href="debugging.html#start-small-2"><i class="fa fa-check"></i><b>14.0.1</b> Start small</a></li>
<li class="chapter" data-level="14.1" data-path="debugging.html"><a href="debugging.html#dependencies"><i class="fa fa-check"></i><b>14.1</b> Dependencies</a><ul>
<li class="chapter" data-level="14.1.1" data-path="debugging.html"><a href="debugging.html#visualize-your-dependency-graph."><i class="fa fa-check"></i><b>14.1.1</b> Visualize your dependency graph.</a></li>
<li class="chapter" data-level="14.1.2" data-path="debugging.html"><a href="debugging.html#check-specific-dependency-information."><i class="fa fa-check"></i><b>14.1.2</b> Check specific dependency information.</a></li>
<li class="chapter" data-level="14.1.3" data-path="debugging.html"><a href="debugging.html#outdated-targets-and-missing-dependencies"><i class="fa fa-check"></i><b>14.1.3</b> Outdated targets and missing dependencies</a></li>
<li class="chapter" data-level="14.1.4" data-path="debugging.html"><a href="debugging.html#but-why-are-my-targets-out-of-date"><i class="fa fa-check"></i><b>14.1.4</b> But <em>why</em> are my targets out of date?</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="debugging.html"><a href="debugging.html#diagnose-failures."><i class="fa fa-check"></i><b>14.2</b> Diagnose failures.</a></li>
<li class="chapter" data-level="14.3" data-path="debugging.html"><a href="debugging.html#timeouts-and-retries"><i class="fa fa-check"></i><b>14.3</b> Timeouts and retries</a></li>
<li class="chapter" data-level="14.4" data-path="debugging.html"><a href="debugging.html#more-help"><i class="fa fa-check"></i><b>14.4</b> More help</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="triggers.html"><a href="triggers.html"><i class="fa fa-check"></i><b>15</b> Triggers: decision rules for building targets</a><ul>
<li class="chapter" data-level="15.1" data-path="triggers.html"><a href="triggers.html#what-are-triggers"><i class="fa fa-check"></i><b>15.1</b> What are triggers?</a></li>
<li class="chapter" data-level="15.2" data-path="triggers.html"><a href="triggers.html#customization"><i class="fa fa-check"></i><b>15.2</b> Customization</a></li>
<li class="chapter" data-level="15.3" data-path="triggers.html"><a href="triggers.html#alternative-trigger-modes"><i class="fa fa-check"></i><b>15.3</b> Alternative trigger modes</a></li>
<li class="chapter" data-level="15.4" data-path="triggers.html"><a href="triggers.html#consider-hasty-mode"><i class="fa fa-check"></i><b>15.4</b> Consider hasty mode</a></li>
<li class="chapter" data-level="15.5" data-path="triggers.html"><a href="triggers.html#a-more-practical-example"><i class="fa fa-check"></i><b>15.5</b> A more practical example</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="faq.html"><a href="faq.html"><i class="fa fa-check"></i><b>A</b> Frequently-asked questions</a></li>
<li class="chapter" data-level="B" data-path="caution.html"><a href="caution.html"><i class="fa fa-check"></i><b>B</b> Cautionary notes</a><ul>
<li class="chapter" data-level="B.1" data-path="caution.html"><a href="caution.html#workflow-plans"><i class="fa fa-check"></i><b>B.1</b> Workflow plans</a><ul>
<li class="chapter" data-level="B.1.1" data-path="caution.html"><a href="caution.html#externalizing-commands-in-r-script-files"><i class="fa fa-check"></i><b>B.1.1</b> Externalizing commands in R script files</a></li>
<li class="chapter" data-level="B.1.2" data-path="caution.html"><a href="caution.html#commands-are-not-perfectly-flexible."><i class="fa fa-check"></i><b>B.1.2</b> Commands are NOT perfectly flexible.</a></li>
</ul></li>
<li class="chapter" data-level="B.2" data-path="caution.html"><a href="caution.html#execution"><i class="fa fa-check"></i><b>B.2</b> Execution</a><ul>
<li class="chapter" data-level="B.2.1" data-path="caution.html"><a href="caution.html#install-drake-properly."><i class="fa fa-check"></i><b>B.2.1</b> Install <code>drake</code> properly.</a></li>
<li class="chapter" data-level="B.2.2" data-path="caution.html"><a href="caution.html#install-all-your-packages."><i class="fa fa-check"></i><b>B.2.2</b> Install all your packages.</a></li>
<li class="chapter" data-level="B.2.3" data-path="caution.html"><a href="caution.html#a-note-on-tidy-evaluation"><i class="fa fa-check"></i><b>B.2.3</b> A note on tidy evaluation</a></li>
<li class="chapter" data-level="B.2.4" data-path="caution.html"><a href="caution.html#find-and-diagnose-your-errors."><i class="fa fa-check"></i><b>B.2.4</b> Find and diagnose your errors.</a></li>
<li class="chapter" data-level="B.2.5" data-path="caution.html"><a href="caution.html#refresh-the-drake_config-list-early-and-often."><i class="fa fa-check"></i><b>B.2.5</b> Refresh the <code>drake_config()</code> list early and often.</a></li>
<li class="chapter" data-level="B.2.6" data-path="caution.html"><a href="caution.html#workflows-as-r-packages."><i class="fa fa-check"></i><b>B.2.6</b> Workflows as R packages.</a></li>
<li class="chapter" data-level="B.2.7" data-path="caution.html"><a href="caution.html#the-lazy_load-flag-does-not-work-with-parlapply-parallelism."><i class="fa fa-check"></i><b>B.2.7</b> The <code>lazy_load</code> flag does not work with <code>&quot;parLapply&quot;</code> parallelism.</a></li>
<li class="chapter" data-level="B.2.8" data-path="caution.html"><a href="caution.html#timeouts-may-be-unreliable."><i class="fa fa-check"></i><b>B.2.8</b> Timeouts may be unreliable.</a></li>
</ul></li>
<li class="chapter" data-level="B.3" data-path="caution.html"><a href="caution.html#dependencies-1"><i class="fa fa-check"></i><b>B.3</b> Dependencies</a><ul>
<li class="chapter" data-level="B.3.1" data-path="caution.html"><a href="caution.html#objects-that-contain-functions-may-rebuild-too-often"><i class="fa fa-check"></i><b>B.3.1</b> Objects that contain functions may rebuild too often</a></li>
<li class="chapter" data-level="B.3.2" data-path="caution.html"><a href="caution.html#dependencies-are-not-tracked-in-some-edge-cases."><i class="fa fa-check"></i><b>B.3.2</b> Dependencies are not tracked in some edge cases.</a></li>
<li class="chapter" data-level="B.3.3" data-path="caution.html"><a href="caution.html#dependencies-of-knitr-reports"><i class="fa fa-check"></i><b>B.3.3</b> Dependencies of <code>knitr</code> reports</a></li>
<li class="chapter" data-level="B.3.4" data-path="caution.html"><a href="caution.html#s3-and-generic-methods"><i class="fa fa-check"></i><b>B.3.4</b> S3 and generic methods</a></li>
<li class="chapter" data-level="B.3.5" data-path="caution.html"><a href="caution.html#file-outputs-in-imported-functions."><i class="fa fa-check"></i><b>B.3.5</b> File outputs in imported functions.</a></li>
<li class="chapter" data-level="B.3.6" data-path="caution.html"><a href="caution.html#functions-produced-by-vectorize"><i class="fa fa-check"></i><b>B.3.6</b> Functions produced by <code>Vectorize()</code></a></li>
<li class="chapter" data-level="B.3.7" data-path="caution.html"><a href="caution.html#compiled-code-is-not-reproducibly-tracked."><i class="fa fa-check"></i><b>B.3.7</b> Compiled code is not reproducibly tracked.</a></li>
<li class="chapter" data-level="B.3.8" data-path="caution.html"><a href="caution.html#directories-folders-are-not-reproducibly-tracked."><i class="fa fa-check"></i><b>B.3.8</b> Directories (folders) are not reproducibly tracked.</a></li>
<li class="chapter" data-level="B.3.9" data-path="caution.html"><a href="caution.html#packages-are-not-tracked-as-dependencies."><i class="fa fa-check"></i><b>B.3.9</b> Packages are not tracked as dependencies.</a></li>
</ul></li>
<li class="chapter" data-level="B.4" data-path="caution.html"><a href="caution.html#high-performance-computing"><i class="fa fa-check"></i><b>B.4</b> High-performance computing</a><ul>
<li class="chapter" data-level="B.4.1" data-path="caution.html"><a href="caution.html#calling-mclapply-within-targets"><i class="fa fa-check"></i><b>B.4.1</b> Calling <code>mclapply()</code> <em>within</em> targets</a></li>
<li class="chapter" data-level="B.4.2" data-path="caution.html"><a href="caution.html#zombie-processes"><i class="fa fa-check"></i><b>B.4.2</b> Zombie processes</a></li>
</ul></li>
<li class="chapter" data-level="B.5" data-path="caution.html"><a href="caution.html#storage-1"><i class="fa fa-check"></i><b>B.5</b> Storage</a><ul>
<li class="chapter" data-level="B.5.1" data-path="caution.html"><a href="caution.html#projects-hosted-on-dropbox-and-similar-platforms"><i class="fa fa-check"></i><b>B.5.1</b> Projects hosted on Dropbox and similar platforms</a></li>
<li class="chapter" data-level="B.5.2" data-path="caution.html"><a href="caution.html#cache-customization-is-limited"><i class="fa fa-check"></i><b>B.5.2</b> Cache customization is limited</a></li>
<li class="chapter" data-level="B.5.3" data-path="caution.html"><a href="caution.html#runtime-predictions"><i class="fa fa-check"></i><b>B.5.3</b> Runtime predictions</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The drake R Package User Manual</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="plans" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> <code>drake</code> plans</h1>
<div id="what-is-a-drake-plan" class="section level2">
<h2><span class="header-section-number">4.1</span> What is a <code>drake</code> plan?</h2>
<p>A <code>drake</code> plan is a data frame with columns named <code>target</code> and <code>command</code>. Each target is an R object, and each command is an <a href="http://adv-r.had.co.nz/Expressions.html">expression</a> to produce it.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> The <code>drake_plan()</code> function is the best way to set up plans.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> Recall the plan from the <a href="walkthrough.html#walkthrough">walkthrough</a>:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb25-2" data-line-number="2">  <span class="dt">raw_data =</span> readxl<span class="op">::</span><span class="kw">read_excel</span>(<span class="kw">file_in</span>(<span class="st">&quot;raw_data.xlsx&quot;</span>)),</a>
<a class="sourceLine" id="cb25-3" data-line-number="3">  <span class="dt">data =</span> raw_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb25-4" data-line-number="4"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Species =</span> forcats<span class="op">::</span><span class="kw">fct_inorder</span>(Species)),</a>
<a class="sourceLine" id="cb25-5" data-line-number="5">  <span class="dt">hist =</span> <span class="kw">create_plot</span>(data),</a>
<a class="sourceLine" id="cb25-6" data-line-number="6">  <span class="dt">fit =</span> <span class="kw">lm</span>(Sepal.Width <span class="op">~</span><span class="st"> </span>Petal.Width <span class="op">+</span><span class="st"> </span>Species, data),</a>
<a class="sourceLine" id="cb25-7" data-line-number="7">  <span class="dt">report =</span> rmarkdown<span class="op">::</span><span class="kw">render</span>(</a>
<a class="sourceLine" id="cb25-8" data-line-number="8">    <span class="kw">knitr_in</span>(<span class="st">&quot;report.Rmd&quot;</span>),</a>
<a class="sourceLine" id="cb25-9" data-line-number="9">    <span class="dt">output_file =</span> <span class="kw">file_out</span>(<span class="st">&quot;report.html&quot;</span>),</a>
<a class="sourceLine" id="cb25-10" data-line-number="10">    <span class="dt">quiet =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb25-11" data-line-number="11">  )</a>
<a class="sourceLine" id="cb25-12" data-line-number="12">)</a>
<a class="sourceLine" id="cb25-13" data-line-number="13"></a>
<a class="sourceLine" id="cb25-14" data-line-number="14">plan</a>
<a class="sourceLine" id="cb25-15" data-line-number="15"><span class="co">#&gt; # A tibble: 5 x 2</span></a>
<a class="sourceLine" id="cb25-16" data-line-number="16"><span class="co">#&gt;   target   command                                                         </span></a>
<a class="sourceLine" id="cb25-17" data-line-number="17"><span class="co">#&gt;   &lt;chr&gt;    &lt;expr&gt;                                                          </span></a>
<a class="sourceLine" id="cb25-18" data-line-number="18"><span class="co">#&gt; 1 raw_data readxl::read_excel(file_in(&quot;raw_data.xlsx&quot;))                   â¦</span></a>
<a class="sourceLine" id="cb25-19" data-line-number="19"><span class="co">#&gt; 2 data     raw_data %&gt;% mutate(Species = forcats::fct_inorder(Species))   â¦</span></a>
<a class="sourceLine" id="cb25-20" data-line-number="20"><span class="co">#&gt; 3 hist     create_plot(data)                                              â¦</span></a>
<a class="sourceLine" id="cb25-21" data-line-number="21"><span class="co">#&gt; 4 fit      lm(Sepal.Width ~ Petal.Width + Species, data)                  â¦</span></a>
<a class="sourceLine" id="cb25-22" data-line-number="22"><span class="co">#&gt; 5 report   rmarkdown::render(knitr_in(&quot;report.Rmd&quot;), output_file = file_ouâ¦</span></a></code></pre></div>
<p><code>drake_plan()</code> does not run the workflow, it only creates the plan. To build the actual targets, we need to run <code>make()</code>. Creating the plan is like writing an R script, and running <code>make(your_plan)</code> is like calling <a href="https://www.rdocumentation.org/packages/base/versions/3.5.2/topics/source"><code>source(&quot;your_script.R&quot;)</code></a>.</p>
</div>
<div id="plans-are-similar-to-r-scripts." class="section level2">
<h2><span class="header-section-number">4.2</span> Plans are similar to R scripts.</h2>
<!-- Your `drake` plan is like a top-level R script that runs everything from end to end. In fact, you can convert back and forth between plans and scripts using functions [`plan_to_code()`](https://docs.ropensci.org/drake/reference/plan_to_code.html) and [`code_to_plan()`](https://docs.ropensci.org/drake/reference/code_to_plan.html) (with some [caveats](https://docs.ropensci.org/drake/reference/code_to_plan.html#details)). -->
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="kw">plan_to_code</span>(plan, <span class="st">&quot;new_script.R&quot;</span>)</a>
<a class="sourceLine" id="cb26-2" data-line-number="2"><span class="co">#&gt; Loading required namespace: styler</span></a>
<a class="sourceLine" id="cb26-3" data-line-number="3"><span class="kw">cat</span>(<span class="kw">readLines</span>(<span class="st">&quot;new_script.R&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb26-4" data-line-number="4"><span class="co">#&gt; raw_data &lt;- readxl::read_excel(file_in(&quot;raw_data.xlsx&quot;))</span></a>
<a class="sourceLine" id="cb26-5" data-line-number="5"><span class="co">#&gt; data &lt;- raw_data %&gt;% mutate(Species = forcats::fct_inorder(Species))</span></a>
<a class="sourceLine" id="cb26-6" data-line-number="6"><span class="co">#&gt; fit &lt;- lm(Sepal.Width ~ Petal.Width + Species, data)</span></a>
<a class="sourceLine" id="cb26-7" data-line-number="7"><span class="co">#&gt; hist &lt;- create_plot(data)</span></a>
<a class="sourceLine" id="cb26-8" data-line-number="8"><span class="co">#&gt; report &lt;- rmarkdown::render(knitr_in(&quot;report.Rmd&quot;),</span></a>
<a class="sourceLine" id="cb26-9" data-line-number="9"><span class="co">#&gt;   output_file = file_out(&quot;report.html&quot;),</span></a>
<a class="sourceLine" id="cb26-10" data-line-number="10"><span class="co">#&gt;   quiet = TRUE</span></a>
<a class="sourceLine" id="cb26-11" data-line-number="11"><span class="co">#&gt; )</span></a>
<a class="sourceLine" id="cb26-12" data-line-number="12"></a>
<a class="sourceLine" id="cb26-13" data-line-number="13"><span class="kw">code_to_plan</span>(<span class="st">&quot;new_script.R&quot;</span>)</a>
<a class="sourceLine" id="cb26-14" data-line-number="14"><span class="co">#&gt; # A tibble: 5 x 2</span></a>
<a class="sourceLine" id="cb26-15" data-line-number="15"><span class="co">#&gt;   target   command                                                         </span></a>
<a class="sourceLine" id="cb26-16" data-line-number="16"><span class="co">#&gt;   &lt;chr&gt;    &lt;expr&gt;                                                          </span></a>
<a class="sourceLine" id="cb26-17" data-line-number="17"><span class="co">#&gt; 1 raw_data readxl::read_excel(file_in(&quot;raw_data.xlsx&quot;))                   â¦</span></a>
<a class="sourceLine" id="cb26-18" data-line-number="18"><span class="co">#&gt; 2 data     raw_data %&gt;% mutate(Species = forcats::fct_inorder(Species))   â¦</span></a>
<a class="sourceLine" id="cb26-19" data-line-number="19"><span class="co">#&gt; 3 fit      lm(Sepal.Width ~ Petal.Width + Species, data)                  â¦</span></a>
<a class="sourceLine" id="cb26-20" data-line-number="20"><span class="co">#&gt; 4 hist     create_plot(data)                                              â¦</span></a>
<a class="sourceLine" id="cb26-21" data-line-number="21"><span class="co">#&gt; 5 report   rmarkdown::render(knitr_in(&quot;report.Rmd&quot;), output_file = file_ouâ¦</span></a></code></pre></div>
<p>And <a href="https://docs.ropensci.org/drake/reference/plan_to_notebook.html"><code>plan_to_notebook()</code></a> turns plans into <a href="https://bookdown.org/yihui/rmarkdown/notebook.html">R notebooks</a>.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="kw">plan_to_notebook</span>(plan, <span class="st">&quot;new_notebook.Rmd&quot;</span>)</a>
<a class="sourceLine" id="cb27-2" data-line-number="2"><span class="kw">cat</span>(<span class="kw">readLines</span>(<span class="st">&quot;new_notebook.Rmd&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb27-3" data-line-number="3"><span class="co">#&gt; ---</span></a>
<a class="sourceLine" id="cb27-4" data-line-number="4"><span class="co">#&gt; title: &quot;My Notebook&quot;</span></a>
<a class="sourceLine" id="cb27-5" data-line-number="5"><span class="co">#&gt; output: html_notebook</span></a>
<a class="sourceLine" id="cb27-6" data-line-number="6"><span class="co">#&gt; ---</span></a>
<a class="sourceLine" id="cb27-7" data-line-number="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb27-8" data-line-number="8"><span class="co">#&gt; ```{r my_code}</span></a>
<a class="sourceLine" id="cb27-9" data-line-number="9"><span class="co">#&gt; raw_data &lt;- readxl::read_excel(file_in(&quot;raw_data.xlsx&quot;))</span></a>
<a class="sourceLine" id="cb27-10" data-line-number="10"><span class="co">#&gt; data &lt;- raw_data %&gt;% mutate(Species = forcats::fct_inorder(Species))</span></a>
<a class="sourceLine" id="cb27-11" data-line-number="11"><span class="co">#&gt; fit &lt;- lm(Sepal.Width ~ Petal.Width + Species, data)</span></a>
<a class="sourceLine" id="cb27-12" data-line-number="12"><span class="co">#&gt; hist &lt;- create_plot(data)</span></a>
<a class="sourceLine" id="cb27-13" data-line-number="13"><span class="co">#&gt; report &lt;- rmarkdown::render(knitr_in(&quot;report.Rmd&quot;),</span></a>
<a class="sourceLine" id="cb27-14" data-line-number="14"><span class="co">#&gt;   output_file = file_out(&quot;report.html&quot;),</span></a>
<a class="sourceLine" id="cb27-15" data-line-number="15"><span class="co">#&gt;   quiet = TRUE</span></a>
<a class="sourceLine" id="cb27-16" data-line-number="16"><span class="co">#&gt; )</span></a>
<a class="sourceLine" id="cb27-17" data-line-number="17"><span class="co">#&gt; ```</span></a>
<a class="sourceLine" id="cb27-18" data-line-number="18"></a>
<a class="sourceLine" id="cb27-19" data-line-number="19"><span class="kw">code_to_plan</span>(<span class="st">&quot;new_notebook.Rmd&quot;</span>)</a>
<a class="sourceLine" id="cb27-20" data-line-number="20"><span class="co">#&gt; # A tibble: 5 x 2</span></a>
<a class="sourceLine" id="cb27-21" data-line-number="21"><span class="co">#&gt;   target   command                                                         </span></a>
<a class="sourceLine" id="cb27-22" data-line-number="22"><span class="co">#&gt;   &lt;chr&gt;    &lt;expr&gt;                                                          </span></a>
<a class="sourceLine" id="cb27-23" data-line-number="23"><span class="co">#&gt; 1 raw_data readxl::read_excel(file_in(&quot;raw_data.xlsx&quot;))                   â¦</span></a>
<a class="sourceLine" id="cb27-24" data-line-number="24"><span class="co">#&gt; 2 data     raw_data %&gt;% mutate(Species = forcats::fct_inorder(Species))   â¦</span></a>
<a class="sourceLine" id="cb27-25" data-line-number="25"><span class="co">#&gt; 3 fit      lm(Sepal.Width ~ Petal.Width + Species, data)                  â¦</span></a>
<a class="sourceLine" id="cb27-26" data-line-number="26"><span class="co">#&gt; 4 hist     create_plot(data)                                              â¦</span></a>
<a class="sourceLine" id="cb27-27" data-line-number="27"><span class="co">#&gt; 5 report   rmarkdown::render(knitr_in(&quot;report.Rmd&quot;), output_file = file_ouâ¦</span></a></code></pre></div>
</div>
<div id="so-why-do-we-use-plans" class="section level2">
<h2><span class="header-section-number">4.3</span> So why do we use plans?</h2>
<p>If you have ever waited more than 10 minutes for an R script to finish, then you know the frustration of having to rerun the whole thing every time you make a change. Plans make life easier.</p>
<div id="plans-chop-up-the-work-into-pieces." class="section level3">
<h3><span class="header-section-number">4.3.1</span> Plans chop up the work into pieces.</h3>
<p>Some targets may need an update while others may not. In the <a href="walkthrough.html#walkthrough">walkthrough</a>, <code>make()</code> was smart enough to skip the data cleaning step and just rebuild the plot and report. <code>drake</code> and its plans compartmentalize the work, and this can save you from wasted effort in the long run.</p>
</div>
<div id="drake-uses-plans-to-schedule-you-work." class="section level3">
<h3><span class="header-section-number">4.3.2</span> <code>drake</code> uses plans to schedule you work.</h3>
<p><code>make()</code> automatically learns the build order of your targets and <a href="hpc.html#hpc">how to run them in parallel</a>. The underlying magic is <a href="http://adv-r.had.co.nz/Expressions.html#ast-funs"><em>static code analysis</em></a>, which automatically detects the dependencies of each target without having to run its command.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1">create_plot &lt;-<span class="st"> </span><span class="cf">function</span>(data) {</a>
<a class="sourceLine" id="cb28-2" data-line-number="2">  <span class="kw">ggplot</span>(data, <span class="kw">aes</span>(<span class="dt">x =</span> .data<span class="op">$</span>Petal.Width, <span class="dt">fill =</span> .data<span class="op">$</span>Species)) <span class="op">+</span></a>
<a class="sourceLine" id="cb28-3" data-line-number="3"><span class="st">    </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">20</span>)</a>
<a class="sourceLine" id="cb28-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb28-5" data-line-number="5"></a>
<a class="sourceLine" id="cb28-6" data-line-number="6"><span class="kw">deps_code</span>(create_plot)</a>
<a class="sourceLine" id="cb28-7" data-line-number="7"><span class="co">#&gt; # A tibble: 4 x 2</span></a>
<a class="sourceLine" id="cb28-8" data-line-number="8"><span class="co">#&gt;   name           type   </span></a>
<a class="sourceLine" id="cb28-9" data-line-number="9"><span class="co">#&gt;   &lt;chr&gt;          &lt;chr&gt;  </span></a>
<a class="sourceLine" id="cb28-10" data-line-number="10"><span class="co">#&gt; 1 geom_histogram globals</span></a>
<a class="sourceLine" id="cb28-11" data-line-number="11"><span class="co">#&gt; 2 ggplot         globals</span></a>
<a class="sourceLine" id="cb28-12" data-line-number="12"><span class="co">#&gt; 3 .data          globals</span></a>
<a class="sourceLine" id="cb28-13" data-line-number="13"><span class="co">#&gt; 4 aes            globals</span></a>
<a class="sourceLine" id="cb28-14" data-line-number="14"></a>
<a class="sourceLine" id="cb28-15" data-line-number="15"><span class="kw">deps_code</span>(<span class="kw">quote</span>(<span class="kw">create_plot</span>(datasets<span class="op">::</span>iris)))</a>
<a class="sourceLine" id="cb28-16" data-line-number="16"><span class="co">#&gt; # A tibble: 2 x 2</span></a>
<a class="sourceLine" id="cb28-17" data-line-number="17"><span class="co">#&gt;   name           type      </span></a>
<a class="sourceLine" id="cb28-18" data-line-number="18"><span class="co">#&gt;   &lt;chr&gt;          &lt;chr&gt;     </span></a>
<a class="sourceLine" id="cb28-19" data-line-number="19"><span class="co">#&gt; 1 create_plot    globals   </span></a>
<a class="sourceLine" id="cb28-20" data-line-number="20"><span class="co">#&gt; 2 datasets::iris namespaced</span></a></code></pre></div>
<p>Because of the dependency relationships, row order does not matter once the plan is fully defined. The following plan declares <code>file</code> before <code>plot</code>.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1">small_plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb29-2" data-line-number="2">  <span class="dt">file =</span> <span class="kw">ggsave</span>(<span class="kw">file_out</span>(<span class="st">&quot;plot.png&quot;</span>), plot, <span class="dt">width =</span> <span class="dv">7</span>, <span class="dt">height =</span> <span class="dv">5</span>),</a>
<a class="sourceLine" id="cb29-3" data-line-number="3">  <span class="dt">plot =</span> <span class="kw">create_plot</span>(datasets<span class="op">::</span>iris)</a>
<a class="sourceLine" id="cb29-4" data-line-number="4">)</a></code></pre></div>
<p>But <code>file</code> actually depends on <code>plot</code>.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1">small_config &lt;-<span class="st"> </span><span class="kw">drake_config</span>(small_plan)</a>
<a class="sourceLine" id="cb30-2" data-line-number="2"><span class="kw">vis_drake_graph</span>(small_config)</a></code></pre></div>
<div id="htmlwidget-437c9b36fe661843587a" style="width:576px;height:576px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-437c9b36fe661843587a">{"x":{"nodes":{"id":["create_plot","n-MRQXIYLTMV2HGOR2NFZGS4Y","plot","file","p-OBWG65BOOBXGO"],"imported":[true,true,false,false,false],"label":["create_plot","datasets::iris","plot","file","file plot.png"],"status":["imported","imported","outdated","outdated","outdated"],"type":["function","object","object","object","file"],"font.size":[20,20,20,20,20],"color":["#1874CD","#1874CD","#000000","#000000","#000000"],"shape":["triangle","dot","dot","dot","square"],"level":[1,1,2,3,4],"x":[-1,-1,-0.333333333333333,0.333333333333333,1],"y":[-1,1,2.22044604925031e-16,2.22044604925031e-16,2.22044604925031e-16]},"edges":{"from":["create_plot","plot","file","n-MRQXIYLTMV2HGOR2NFZGS4Y"],"to":["plot","file","p-OBWG65BOOBXGO","plot"],"arrows":["to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"interaction":{"navigationButtons":true},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)"},"main":{"text":"Dependency graph","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":false,"hoverNearest":false,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Outdated","Imported","Object","Function","File"],"color":["#000000","#1874CD","#888888","#888888","#888888"],"shape":["dot","dot","dot","triangle","square"],"font.color":["black","black","black","black","black"],"font.size":[20,20,20,20,20],"id":[2,5,7,8,9]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script>
<p>So <code>make()</code> builds <code>plot</code> first.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb31-2" data-line-number="2"><span class="kw">make</span>(small_plan)</a>
<a class="sourceLine" id="cb31-3" data-line-number="3"><span class="co">#&gt; target plot</span></a>
<a class="sourceLine" id="cb31-4" data-line-number="4"><span class="co">#&gt; target file</span></a></code></pre></div>
</div>
</div>
<div id="special-custom-columns-in-your-plan" class="section level2">
<h2><span class="header-section-number">4.4</span> Special custom columns in your plan</h2>
<p>You can add other columns besides the required <code>target</code> and <code>command</code>.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1"><span class="kw">cbind</span>(small_plan, <span class="dt">cpu =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb32-2" data-line-number="2"><span class="co">#&gt;   target                                                   command cpu</span></a>
<a class="sourceLine" id="cb32-3" data-line-number="3"><span class="co">#&gt; 1   file ggsave(file_out(&quot;plot.png&quot;), plot, width = 7, height = 5)   1</span></a>
<a class="sourceLine" id="cb32-4" data-line-number="4"><span class="co">#&gt; 2   plot                               create_plot(datasets::iris)   2</span></a></code></pre></div>
<p>Within <code>drake_plan()</code>, <code>target()</code> lets you create any custom column except <code>target</code>, <code>command</code>, and <code>transform</code>, the last of which <a href="https://ropenscilabs.github.io/drake-manual/plans.html#create-large-plans-the-easy-way">has a special meaning</a>.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb33-2" data-line-number="2">  <span class="dt">file =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb33-3" data-line-number="3">    <span class="kw">ggsave</span>(<span class="kw">file_out</span>(<span class="st">&quot;plot.png&quot;</span>), plot),</a>
<a class="sourceLine" id="cb33-4" data-line-number="4">    <span class="dt">elapsed =</span> <span class="dv">10</span></a>
<a class="sourceLine" id="cb33-5" data-line-number="5">  ),</a>
<a class="sourceLine" id="cb33-6" data-line-number="6">  <span class="kw">create_plot</span>(datasets<span class="op">::</span>iris)</a>
<a class="sourceLine" id="cb33-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb33-8" data-line-number="8"><span class="co">#&gt; # A tibble: 2 x 3</span></a>
<a class="sourceLine" id="cb33-9" data-line-number="9"><span class="co">#&gt;   target         command                            elapsed</span></a>
<a class="sourceLine" id="cb33-10" data-line-number="10"><span class="co">#&gt;   &lt;chr&gt;          &lt;expr&gt;                               &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb33-11" data-line-number="11"><span class="co">#&gt; 1 file           ggsave(file_out(&quot;plot.png&quot;), plot)      10</span></a>
<a class="sourceLine" id="cb33-12" data-line-number="12"><span class="co">#&gt; 2 drake_target_1 create_plot(datasets::iris)             NA</span></a></code></pre></div>
<p>The following columns have special meanings for <code>make()</code>.</p>
<ul>
<li><code>format</code>: set a storage format to save big targets more efficiently. Most formats are faster than ordinary storage, and they consume far less memory. Available formats:
<ul>
<li><code>&quot;fst&quot;</code>: save big data frames fast. Requirements:
<ol style="list-style-type: decimal">
<li>The <code>fst</code> package must be installed.</li>
<li>The targetâs value must be a plain data frame. If it is not a
plain data frame (for example, a tibble or data.table)
then drake will coerce it to a plain data frame with
<code>as.data.frame()</code>.
All non-data-frame-specific attributes are lost
when <code>drake</code> saves the target.</li>
</ol></li>
<li><code>&quot;fst_dt&quot;</code>: Like <code>&quot;fst&quot;</code> format, but for <code>data.table</code> objects.
Requirements:
<ol style="list-style-type: decimal">
<li>The <code>data.table</code> and <code>fst</code> packages must be installed.</li>
<li>The targetâs value must be a data.table object. If it is not a
data.table object (for example, a data frame or tibble)
then drake will coerce it to a data.table object using
<code>data.table::as.data.table()</code>.
All non-data-table-specific attributes are lost
when <code>drake</code> saves the target.</li>
</ol>
<ul>
<li><code>&quot;keras&quot;</code>: save Keras models as HDF5 files. Requires the <code>keras</code> package.</li>
<li><code>&quot;rds&quot;</code>: save any object. This is similar to the default storage except we avoid creating a serialized copy of the entire target in memory. Requires R &gt;= 3.5.0 so drake can use ALTREP.</li>
</ul></li>
</ul></li>
<li><code>trigger</code>: rule to decide whether a target needs to run. See the <a href="triggers.html#triggers">trigger chapter</a> to learn more.</li>
<li><code>elapsed</code> and <code>cpu</code>: number of seconds to wait for the target to build before timing out (<code>elapsed</code> for elapsed time and <code>cpu</code> for CPU time).</li>
<li><code>hpc</code>: logical values (<code>TRUE</code>/<code>FALSE</code>/<code>NA</code>) whether to send each target to parallel workers. <a href="https://ropenscilabs.github.io/drake-manual/hpc.html#selectivity">Click here</a> to learn more.</li>
<li><code>resources</code>: target-specific lists of resources for a computing cluster. See the advanced options in the <a href="hpc.html#hpc">parallel computing</a> chapter for details.</li>
<li><code>caching</code>: overrides the <code>caching</code> argument of <code>make()</code> for each target individually. Only supported in <code>drake</code> version 7.6.1.9000 and above. Possible values:
<ul>
<li>âmasterâ: tell the master process to store the target in the cache.</li>
<li>âworkerâ: tell the HPC worker to store the target in the cache.</li>
<li>NA: default to the <code>caching</code> argument of <code>make()</code>.</li>
</ul></li>
<li><code>retries</code>: number of times to retry building a target in the event of an error.</li>
<li><code>seed</code>: pseudo-random number generator (RNG) seed for each target. <code>drake</code> usually computes its own unique reproducible target-specific seeds using the target name and the global seed (the <code>seed</code> argument of <code>make()</code> and <code>drake_config()</code>). Any non-missing seeds in the <code>seed</code> column override <code>drake</code>âs default target seeds.</li>
</ul>
</div>
<div id="large-plans" class="section level2">
<h2><span class="header-section-number">4.5</span> Large plans</h2>
<p><code>drake</code> version 7.0.0 introduced new syntax to make it easier to create plans. To try it out before the next <a href="http://cran.r-project.org">CRAN</a> release, install the <a href="https://github.com/ropensci/drake">current development version</a> from GitHub.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1"><span class="kw">install.packages</span>(<span class="st">&quot;remotes&quot;</span>)</a>
<a class="sourceLine" id="cb34-2" data-line-number="2"><span class="kw">library</span>(remotes)</a>
<a class="sourceLine" id="cb34-3" data-line-number="3"><span class="kw">install_github</span>(<span class="st">&quot;ropensci/drake&quot;</span>)</a></code></pre></div>
<div id="how-to-create-large-plans" class="section level3">
<h3><span class="header-section-number">4.5.1</span> How to create large plans</h3>
<p>Ordinarily, <code>drake_plan()</code> requires you to write out all the targets one-by-one. This is a literal pain.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1"><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb35-2" data-line-number="2">  <span class="dt">data =</span> <span class="kw">get_data</span>(),</a>
<a class="sourceLine" id="cb35-3" data-line-number="3">  <span class="dt">analysis_1_1 =</span> <span class="kw">fit_model_x</span>(data, <span class="dt">mean =</span> <span class="dv">1</span>, <span class="dt">sd =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb35-4" data-line-number="4">  <span class="dt">analysis_2_1 =</span> <span class="kw">fit_model_x</span>(data, <span class="dt">mean =</span> <span class="dv">2</span>, <span class="dt">sd =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb35-5" data-line-number="5">  <span class="dt">analysis_5_1 =</span> <span class="kw">fit_model_x</span>(data, <span class="dt">mean =</span> <span class="dv">5</span>, <span class="dt">sd =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb35-6" data-line-number="6">  <span class="dt">analysis_10_1 =</span> <span class="kw">fit_model_x</span>(data, <span class="dt">mean =</span> <span class="dv">10</span>, <span class="dt">sd =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb35-7" data-line-number="7">  <span class="dt">analysis_100_1 =</span> <span class="kw">fit_model_x</span>(data, <span class="dt">mean =</span> <span class="dv">100</span>, <span class="dt">sd =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb35-8" data-line-number="8">  <span class="dt">analysis_1000_1 =</span> <span class="kw">fit_model_x</span>(data, <span class="dt">mean =</span> <span class="dv">1000</span>, <span class="dt">sd =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb35-9" data-line-number="9">  <span class="dt">analysis_1_2 =</span> <span class="kw">fit_model_x</span>(data, <span class="dt">mean =</span> <span class="dv">1</span>, <span class="dt">sd =</span> <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb35-10" data-line-number="10">  <span class="dt">analysis_2_2 =</span> <span class="kw">fit_model_x</span>(data, <span class="dt">mean =</span> <span class="dv">2</span>, <span class="dt">sd =</span> <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb35-11" data-line-number="11">  <span class="dt">analysis_5_2 =</span> <span class="kw">fit_model_x</span>(data, <span class="dt">mean =</span> <span class="dv">5</span>, <span class="dt">sd =</span> <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb35-12" data-line-number="12">  <span class="dt">analysis_10_2 =</span> <span class="kw">fit_model_x</span>(data, <span class="dt">mean =</span> <span class="dv">10</span>, <span class="dt">sd =</span> <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb35-13" data-line-number="13">  <span class="dt">analysis_100_2 =</span> <span class="kw">fit_model_x</span>(data, <span class="dt">mean =</span> <span class="dv">100</span>, <span class="dt">sd =</span> <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb35-14" data-line-number="14">  <span class="dt">analysis_1000_2 =</span> <span class="kw">fit_model_x</span>(data, <span class="dt">mean =</span> <span class="dv">1000</span>, <span class="dt">sd =</span> <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb35-15" data-line-number="15">  <span class="co"># UUUGGGHH my wrists are cramping! :( ...</span></a>
<a class="sourceLine" id="cb35-16" data-line-number="16">)</a></code></pre></div>
<p>Transformations reduce typing, especially when combined with tidy evaluation (<code>!!</code>).</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1">lots_of_sds &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="dv">1</span><span class="op">:</span><span class="fl">1e3</span>)</a>
<a class="sourceLine" id="cb36-2" data-line-number="2"></a>
<a class="sourceLine" id="cb36-3" data-line-number="3"><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb36-4" data-line-number="4">  <span class="dt">data =</span> <span class="kw">get_data</span>(),</a>
<a class="sourceLine" id="cb36-5" data-line-number="5">  <span class="dt">analysis =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb36-6" data-line-number="6">    <span class="kw">fun</span>(data, <span class="dt">mean =</span> mean_val, <span class="dt">sd =</span> sd_val),</a>
<a class="sourceLine" id="cb36-7" data-line-number="7">    <span class="dt">transform =</span> <span class="kw">cross</span>(<span class="dt">mean_val =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>), <span class="dt">sd_val =</span> <span class="op">!!</span>lots_of_sds)</a>
<a class="sourceLine" id="cb36-8" data-line-number="8">  )</a>
<a class="sourceLine" id="cb36-9" data-line-number="9">)</a>
<a class="sourceLine" id="cb36-10" data-line-number="10"><span class="co">#&gt; # A tibble: 5,001 x 2</span></a>
<a class="sourceLine" id="cb36-11" data-line-number="11"><span class="co">#&gt;    target          command                       </span></a>
<a class="sourceLine" id="cb36-12" data-line-number="12"><span class="co">#&gt;    &lt;chr&gt;           &lt;expr&gt;                        </span></a>
<a class="sourceLine" id="cb36-13" data-line-number="13"><span class="co">#&gt;  1 data            get_data()                    </span></a>
<a class="sourceLine" id="cb36-14" data-line-number="14"><span class="co">#&gt;  2 analysis_2_1    fun(data, mean = 2, sd = 1)   </span></a>
<a class="sourceLine" id="cb36-15" data-line-number="15"><span class="co">#&gt;  3 analysis_5_1    fun(data, mean = 5, sd = 1)   </span></a>
<a class="sourceLine" id="cb36-16" data-line-number="16"><span class="co">#&gt;  4 analysis_10_1   fun(data, mean = 10, sd = 1)  </span></a>
<a class="sourceLine" id="cb36-17" data-line-number="17"><span class="co">#&gt;  5 analysis_100_1  fun(data, mean = 100, sd = 1) </span></a>
<a class="sourceLine" id="cb36-18" data-line-number="18"><span class="co">#&gt;  6 analysis_1000_1 fun(data, mean = 1000, sd = 1)</span></a>
<a class="sourceLine" id="cb36-19" data-line-number="19"><span class="co">#&gt;  7 analysis_2_2    fun(data, mean = 2, sd = 2)   </span></a>
<a class="sourceLine" id="cb36-20" data-line-number="20"><span class="co">#&gt;  8 analysis_5_2    fun(data, mean = 5, sd = 2)   </span></a>
<a class="sourceLine" id="cb36-21" data-line-number="21"><span class="co">#&gt;  9 analysis_10_2   fun(data, mean = 10, sd = 2)  </span></a>
<a class="sourceLine" id="cb36-22" data-line-number="22"><span class="co">#&gt; 10 analysis_100_2  fun(data, mean = 100, sd = 2) </span></a>
<a class="sourceLine" id="cb36-23" data-line-number="23"><span class="co">#&gt; # â¦ with 4,991 more rows</span></a></code></pre></div>
<p>Behind the scenes during a transformation, <code>drake_plan()</code> creates new columns to track what is happening. You can see them with <code>trace = TRUE</code>.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1"><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb37-2" data-line-number="2">  <span class="dt">data =</span> <span class="kw">get_data</span>(),</a>
<a class="sourceLine" id="cb37-3" data-line-number="3">  <span class="dt">analysis =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb37-4" data-line-number="4">    <span class="kw">analyze</span>(data, mean, sd),</a>
<a class="sourceLine" id="cb37-5" data-line-number="5">    <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">mean =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">4</span>), <span class="dt">sd =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb37-6" data-line-number="6">  ),</a>
<a class="sourceLine" id="cb37-7" data-line-number="7">  <span class="dt">trace =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb37-8" data-line-number="8">)</a>
<a class="sourceLine" id="cb37-9" data-line-number="9"><span class="co">#&gt; # A tibble: 3 x 5</span></a>
<a class="sourceLine" id="cb37-10" data-line-number="10"><span class="co">#&gt;   target       command             mean  sd    analysis    </span></a>
<a class="sourceLine" id="cb37-11" data-line-number="11"><span class="co">#&gt;   &lt;chr&gt;        &lt;expr&gt;              &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;       </span></a>
<a class="sourceLine" id="cb37-12" data-line-number="12"><span class="co">#&gt; 1 data         get_data()          &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;        </span></a>
<a class="sourceLine" id="cb37-13" data-line-number="13"><span class="co">#&gt; 2 analysis_3_1 analyze(data, 3, 1) 3     1     analysis_3_1</span></a>
<a class="sourceLine" id="cb37-14" data-line-number="14"><span class="co">#&gt; 3 analysis_4_2 analyze(data, 4, 2) 4     2     analysis_4_2</span></a></code></pre></div>
<p>Because of those columns, you can chain transformations together in complex pipelines.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1">plan1 &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb38-2" data-line-number="2">  <span class="dt">small =</span> <span class="kw">get_small_data</span>(),</a>
<a class="sourceLine" id="cb38-3" data-line-number="3">  <span class="dt">large =</span> <span class="kw">get_large_data</span>(),</a>
<a class="sourceLine" id="cb38-4" data-line-number="4">  <span class="dt">analysis =</span> <span class="kw">target</span>( <span class="co"># Analyze each dataset once with a different mean.</span></a>
<a class="sourceLine" id="cb38-5" data-line-number="5">    <span class="kw">analyze</span>(data, mean),</a>
<a class="sourceLine" id="cb38-6" data-line-number="6">    <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">data =</span> <span class="kw">c</span>(small, large), <span class="dt">mean =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb38-7" data-line-number="7">  ),</a>
<a class="sourceLine" id="cb38-8" data-line-number="8">  <span class="co"># Calculate 2 different performance metrics on every model fit.</span></a>
<a class="sourceLine" id="cb38-9" data-line-number="9">  <span class="dt">metric =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb38-10" data-line-number="10">    <span class="kw">metric_fun</span>(analysis),</a>
<a class="sourceLine" id="cb38-11" data-line-number="11">    <span class="co"># mse = mean squared error, mae = mean absolute error.</span></a>
<a class="sourceLine" id="cb38-12" data-line-number="12">    <span class="co"># Assume these are functions you write.</span></a>
<a class="sourceLine" id="cb38-13" data-line-number="13">    <span class="dt">transform =</span> <span class="kw">cross</span>(<span class="dt">metric_fun =</span> <span class="kw">c</span>(mse, mae), analysis)</a>
<a class="sourceLine" id="cb38-14" data-line-number="14">  ),</a>
<a class="sourceLine" id="cb38-15" data-line-number="15">  <span class="co"># Summarize the performance metrics for each dataset.</span></a>
<a class="sourceLine" id="cb38-16" data-line-number="16">  <span class="dt">summ_data =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb38-17" data-line-number="17">    <span class="kw">summary</span>(metric),</a>
<a class="sourceLine" id="cb38-18" data-line-number="18">    <span class="dt">transform =</span> <span class="kw">combine</span>(metric, <span class="dt">.by =</span> data)</a>
<a class="sourceLine" id="cb38-19" data-line-number="19">  ),</a>
<a class="sourceLine" id="cb38-20" data-line-number="20">  <span class="co"># Same, but for each metric type.</span></a>
<a class="sourceLine" id="cb38-21" data-line-number="21">  <span class="dt">summ_metric =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb38-22" data-line-number="22">    <span class="kw">summary</span>(metric),</a>
<a class="sourceLine" id="cb38-23" data-line-number="23">    <span class="dt">transform =</span> <span class="kw">combine</span>(metric, <span class="dt">.by =</span> metric_fun)</a>
<a class="sourceLine" id="cb38-24" data-line-number="24">  )</a>
<a class="sourceLine" id="cb38-25" data-line-number="25">)</a>
<a class="sourceLine" id="cb38-26" data-line-number="26"></a>
<a class="sourceLine" id="cb38-27" data-line-number="27">plan1</a>
<a class="sourceLine" id="cb38-28" data-line-number="28"><span class="co">#&gt; # A tibble: 12 x 2</span></a>
<a class="sourceLine" id="cb38-29" data-line-number="29"><span class="co">#&gt;    target                 command                                          </span></a>
<a class="sourceLine" id="cb38-30" data-line-number="30"><span class="co">#&gt;    &lt;chr&gt;                  &lt;expr&gt;                                           </span></a>
<a class="sourceLine" id="cb38-31" data-line-number="31"><span class="co">#&gt;  1 small                  get_small_data()                                â¦</span></a>
<a class="sourceLine" id="cb38-32" data-line-number="32"><span class="co">#&gt;  2 large                  get_large_data()                                â¦</span></a>
<a class="sourceLine" id="cb38-33" data-line-number="33"><span class="co">#&gt;  3 analysis_small_1       analyze(small, 1)                               â¦</span></a>
<a class="sourceLine" id="cb38-34" data-line-number="34"><span class="co">#&gt;  4 analysis_large_2       analyze(large, 2)                               â¦</span></a>
<a class="sourceLine" id="cb38-35" data-line-number="35"><span class="co">#&gt;  5 metric_mse_analysis_sâ¦ mse(analysis_small_1)                           â¦</span></a>
<a class="sourceLine" id="cb38-36" data-line-number="36"><span class="co">#&gt;  6 metric_mae_analysis_sâ¦ mae(analysis_small_1)                           â¦</span></a>
<a class="sourceLine" id="cb38-37" data-line-number="37"><span class="co">#&gt;  7 metric_mse_analysis_lâ¦ mse(analysis_large_2)                           â¦</span></a>
<a class="sourceLine" id="cb38-38" data-line-number="38"><span class="co">#&gt;  8 metric_mae_analysis_lâ¦ mae(analysis_large_2)                           â¦</span></a>
<a class="sourceLine" id="cb38-39" data-line-number="39"><span class="co">#&gt;  9 summ_data_large        summary(metric_mse_analysis_large_2, metric_mae_â¦</span></a>
<a class="sourceLine" id="cb38-40" data-line-number="40"><span class="co">#&gt; 10 summ_data_small        summary(metric_mse_analysis_small_1, metric_mae_â¦</span></a>
<a class="sourceLine" id="cb38-41" data-line-number="41"><span class="co">#&gt; 11 summ_metric_mae        summary(metric_mae_analysis_small_1, metric_mae_â¦</span></a>
<a class="sourceLine" id="cb38-42" data-line-number="42"><span class="co">#&gt; 12 summ_metric_mse        summary(metric_mse_analysis_small_1, metric_mse_â¦</span></a>
<a class="sourceLine" id="cb38-43" data-line-number="43"></a>
<a class="sourceLine" id="cb38-44" data-line-number="44">config1 &lt;-<span class="st"> </span><span class="kw">drake_config</span>(plan1)</a>
<a class="sourceLine" id="cb38-45" data-line-number="45"><span class="kw">vis_drake_graph</span>(config1)</a></code></pre></div>
<div id="htmlwidget-52077144b47bb6e4b9dc" style="width:576px;height:576px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-52077144b47bb6e4b9dc">{"x":{"nodes":{"id":["small","large","analysis_small_1","analysis_large_2","metric_mae_analysis_small_1","metric_mse_analysis_small_1","metric_mae_analysis_large_2","metric_mse_analysis_large_2","summ_data_small","summ_metric_mae","summ_data_large","summ_metric_mse"],"imported":[false,false,false,false,false,false,false,false,false,false,false,false],"label":["small","large","analysis_small_1","analysis_large_2","metric_mae_analysis_small_1","metric_mse_analysis_small_1","metric_mae_analysis_large_2","metric_mse_analysis_large_2","summ_data_small","summ_metric_mae","summ_data_large","summ_metric_mse"],"status":["outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated"],"type":["object","object","object","object","object","object","object","object","object","object","object","object"],"font.size":[20,20,20,20,20,20,20,20,20,20,20,20],"color":["#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000"],"shape":["dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot"],"level":[1,1,2,2,3,3,3,3,4,4,4,4],"x":[-1,-1,-0.333333333333333,-0.333333333333333,0.333333333333333,0.333333333333333,0.333333333333333,0.333333333333333,1,1,1,1],"y":[-0.555555555555556,0.555555555555555,-0.555555555555556,0.555555555555555,-1,-0.333333333333333,0.333333333333333,1,-1,-0.333333333333333,0.333333333333333,1]},"edges":{"from":["small","large","analysis_small_1","analysis_small_1","analysis_large_2","analysis_large_2","metric_mae_analysis_large_2","metric_mae_analysis_large_2","metric_mse_analysis_large_2","metric_mse_analysis_large_2","metric_mae_analysis_small_1","metric_mae_analysis_small_1","metric_mse_analysis_small_1","metric_mse_analysis_small_1"],"to":["analysis_small_1","analysis_large_2","metric_mae_analysis_small_1","metric_mse_analysis_small_1","metric_mae_analysis_large_2","metric_mse_analysis_large_2","summ_data_large","summ_metric_mae","summ_data_large","summ_metric_mse","summ_data_small","summ_metric_mae","summ_data_small","summ_metric_mse"],"arrows":["to","to","to","to","to","to","to","to","to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"interaction":{"navigationButtons":true},"edges":{"smooth":false},"physics":{"stabilization":false}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)"},"main":{"text":"Dependency graph","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":false,"hoverNearest":false,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Outdated","Object"],"color":["#000000","#888888"],"shape":["dot","dot"],"font.color":["black","black"],"font.size":[20,20],"id":[2,7]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);","igraphlayout":{"type":"square"}},"evals":[],"jsHooks":[]}</script>
<p>And you can write the transformations in any order. The following plan is equivalent to <code>plan1</code> despite the rearranged rows.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1">plan2 &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb39-2" data-line-number="2">  <span class="co"># Calculate 2 different performance metrics on every model fit.</span></a>
<a class="sourceLine" id="cb39-3" data-line-number="3">  <span class="dt">summ_metric =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb39-4" data-line-number="4">    <span class="kw">summary</span>(metric),</a>
<a class="sourceLine" id="cb39-5" data-line-number="5">    <span class="dt">transform =</span> <span class="kw">combine</span>(metric, <span class="dt">.by =</span> metric_fun)</a>
<a class="sourceLine" id="cb39-6" data-line-number="6">  ),</a>
<a class="sourceLine" id="cb39-7" data-line-number="7">  <span class="dt">metric =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb39-8" data-line-number="8">    <span class="kw">metric_fun</span>(analysis),</a>
<a class="sourceLine" id="cb39-9" data-line-number="9">    <span class="co"># mse = mean squared error, mae = mean absolute error.</span></a>
<a class="sourceLine" id="cb39-10" data-line-number="10">    <span class="co"># Assume these are functions you write.</span></a>
<a class="sourceLine" id="cb39-11" data-line-number="11">    <span class="dt">transform =</span> <span class="kw">cross</span>(<span class="dt">metric_fun =</span> <span class="kw">c</span>(mse, mae), analysis)</a>
<a class="sourceLine" id="cb39-12" data-line-number="12">  ),</a>
<a class="sourceLine" id="cb39-13" data-line-number="13">  <span class="dt">small =</span> <span class="kw">get_small_data</span>(),</a>
<a class="sourceLine" id="cb39-14" data-line-number="14">  <span class="dt">analysis =</span> <span class="kw">target</span>( <span class="co"># Analyze each dataset once with a different mean.</span></a>
<a class="sourceLine" id="cb39-15" data-line-number="15">    <span class="kw">analyze</span>(data, mean),</a>
<a class="sourceLine" id="cb39-16" data-line-number="16">    <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">data =</span> <span class="kw">c</span>(small, large), <span class="dt">mean =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb39-17" data-line-number="17">  ),</a>
<a class="sourceLine" id="cb39-18" data-line-number="18">  <span class="co"># Summarize the performance metrics for each dataset.</span></a>
<a class="sourceLine" id="cb39-19" data-line-number="19">  <span class="dt">summ_data =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb39-20" data-line-number="20">    <span class="kw">summary</span>(metric),</a>
<a class="sourceLine" id="cb39-21" data-line-number="21">    <span class="dt">transform =</span> <span class="kw">combine</span>(metric, <span class="dt">.by =</span> data)</a>
<a class="sourceLine" id="cb39-22" data-line-number="22">  ),</a>
<a class="sourceLine" id="cb39-23" data-line-number="23">  <span class="dt">large =</span> <span class="kw">get_large_data</span>()</a>
<a class="sourceLine" id="cb39-24" data-line-number="24">  <span class="co"># Same, but for each metric type.</span></a>
<a class="sourceLine" id="cb39-25" data-line-number="25">)</a>
<a class="sourceLine" id="cb39-26" data-line-number="26"></a>
<a class="sourceLine" id="cb39-27" data-line-number="27">plan2</a>
<a class="sourceLine" id="cb39-28" data-line-number="28"><span class="co">#&gt; # A tibble: 12 x 2</span></a>
<a class="sourceLine" id="cb39-29" data-line-number="29"><span class="co">#&gt;    target                 command                                          </span></a>
<a class="sourceLine" id="cb39-30" data-line-number="30"><span class="co">#&gt;    &lt;chr&gt;                  &lt;expr&gt;                                           </span></a>
<a class="sourceLine" id="cb39-31" data-line-number="31"><span class="co">#&gt;  1 summ_metric_mae        summary(metric_mae_analysis_small_1, metric_mae_â¦</span></a>
<a class="sourceLine" id="cb39-32" data-line-number="32"><span class="co">#&gt;  2 summ_metric_mse        summary(metric_mse_analysis_small_1, metric_mse_â¦</span></a>
<a class="sourceLine" id="cb39-33" data-line-number="33"><span class="co">#&gt;  3 metric_mse_analysis_sâ¦ mse(analysis_small_1)                           â¦</span></a>
<a class="sourceLine" id="cb39-34" data-line-number="34"><span class="co">#&gt;  4 metric_mae_analysis_sâ¦ mae(analysis_small_1)                           â¦</span></a>
<a class="sourceLine" id="cb39-35" data-line-number="35"><span class="co">#&gt;  5 metric_mse_analysis_lâ¦ mse(analysis_large_2)                           â¦</span></a>
<a class="sourceLine" id="cb39-36" data-line-number="36"><span class="co">#&gt;  6 metric_mae_analysis_lâ¦ mae(analysis_large_2)                           â¦</span></a>
<a class="sourceLine" id="cb39-37" data-line-number="37"><span class="co">#&gt;  7 small                  get_small_data()                                â¦</span></a>
<a class="sourceLine" id="cb39-38" data-line-number="38"><span class="co">#&gt;  8 analysis_small_1       analyze(small, 1)                               â¦</span></a>
<a class="sourceLine" id="cb39-39" data-line-number="39"><span class="co">#&gt;  9 analysis_large_2       analyze(large, 2)                               â¦</span></a>
<a class="sourceLine" id="cb39-40" data-line-number="40"><span class="co">#&gt; 10 summ_data_large        summary(metric_mse_analysis_large_2, metric_mae_â¦</span></a>
<a class="sourceLine" id="cb39-41" data-line-number="41"><span class="co">#&gt; 11 summ_data_small        summary(metric_mse_analysis_small_1, metric_mae_â¦</span></a>
<a class="sourceLine" id="cb39-42" data-line-number="42"><span class="co">#&gt; 12 large                  get_large_data()                                â¦</span></a>
<a class="sourceLine" id="cb39-43" data-line-number="43"></a>
<a class="sourceLine" id="cb39-44" data-line-number="44">config2 &lt;-<span class="st"> </span><span class="kw">drake_config</span>(plan2)</a>
<a class="sourceLine" id="cb39-45" data-line-number="45"><span class="kw">vis_drake_graph</span>(config2)</a></code></pre></div>
<div id="htmlwidget-5b2f3f64e2ae588c1146" style="width:576px;height:576px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-5b2f3f64e2ae588c1146">{"x":{"nodes":{"id":["small","large","analysis_small_1","analysis_large_2","metric_mae_analysis_small_1","metric_mse_analysis_small_1","metric_mae_analysis_large_2","metric_mse_analysis_large_2","summ_data_small","summ_metric_mae","summ_metric_mse","summ_data_large"],"imported":[false,false,false,false,false,false,false,false,false,false,false,false],"label":["small","large","analysis_small_1","analysis_large_2","metric_mae_analysis_small_1","metric_mse_analysis_small_1","metric_mae_analysis_large_2","metric_mse_analysis_large_2","summ_data_small","summ_metric_mae","summ_metric_mse","summ_data_large"],"status":["outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated"],"type":["object","object","object","object","object","object","object","object","object","object","object","object"],"font.size":[20,20,20,20,20,20,20,20,20,20,20,20],"color":["#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000"],"shape":["dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot"],"level":[1,1,2,2,3,3,3,3,4,4,4,4],"x":[-1,-1,-0.333333333333333,-0.333333333333333,0.333333333333333,0.333333333333333,0.333333333333333,0.333333333333333,1,1,1,1],"y":[-0.555555555555556,0.555555555555555,-0.555555555555556,0.555555555555555,-1,-0.333333333333333,0.333333333333333,1,-1,-0.333333333333333,0.333333333333333,1]},"edges":{"from":["metric_mae_analysis_large_2","metric_mae_analysis_large_2","metric_mae_analysis_small_1","metric_mae_analysis_small_1","metric_mse_analysis_large_2","metric_mse_analysis_large_2","metric_mse_analysis_small_1","metric_mse_analysis_small_1","analysis_small_1","analysis_small_1","analysis_large_2","analysis_large_2","small","large"],"to":["summ_metric_mae","summ_data_large","summ_metric_mae","summ_data_small","summ_metric_mse","summ_data_large","summ_metric_mse","summ_data_small","metric_mae_analysis_small_1","metric_mse_analysis_small_1","metric_mae_analysis_large_2","metric_mse_analysis_large_2","analysis_small_1","analysis_large_2"],"arrows":["to","to","to","to","to","to","to","to","to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"interaction":{"navigationButtons":true},"edges":{"smooth":false},"physics":{"stabilization":false}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)"},"main":{"text":"Dependency graph","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":false,"hoverNearest":false,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Outdated","Object"],"color":["#000000","#888888"],"shape":["dot","dot"],"font.color":["black","black"],"font.size":[20,20],"id":[2,7]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);","igraphlayout":{"type":"square"}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="start-small" class="section level3">
<h3><span class="header-section-number">4.5.2</span> Start small</h3>
<p>Some plans are too large to deploy right away.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb40-2" data-line-number="2">  <span class="dt">data =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb40-3" data-line-number="3">    <span class="kw">get_data</span>(source),</a>
<a class="sourceLine" id="cb40-4" data-line-number="4">    <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">source =</span> <span class="op">!!</span><span class="kw">seq_len</span>(<span class="dv">25</span>))</a>
<a class="sourceLine" id="cb40-5" data-line-number="5">  ),</a>
<a class="sourceLine" id="cb40-6" data-line-number="6">  <span class="dt">analysis =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb40-7" data-line-number="7">    <span class="kw">fn</span>(data, param),</a>
<a class="sourceLine" id="cb40-8" data-line-number="8">    <span class="dt">transform =</span> <span class="kw">cross</span>(</a>
<a class="sourceLine" id="cb40-9" data-line-number="9">      data,</a>
<a class="sourceLine" id="cb40-10" data-line-number="10">      <span class="dt">fn =</span> <span class="op">!!</span>letters,</a>
<a class="sourceLine" id="cb40-11" data-line-number="11">      <span class="dt">param =</span> <span class="op">!!</span><span class="kw">seq_len</span>(<span class="dv">25</span>)</a>
<a class="sourceLine" id="cb40-12" data-line-number="12">    ),</a>
<a class="sourceLine" id="cb40-13" data-line-number="13">  ),</a>
<a class="sourceLine" id="cb40-14" data-line-number="14">  <span class="dt">result =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb40-15" data-line-number="15">    <span class="kw">bind_rows</span>(analysis),</a>
<a class="sourceLine" id="cb40-16" data-line-number="16">    <span class="dt">transform =</span> <span class="kw">combine</span>(analysis, <span class="dt">.by =</span> fn)</a>
<a class="sourceLine" id="cb40-17" data-line-number="17">  )</a>
<a class="sourceLine" id="cb40-18" data-line-number="18">)</a>
<a class="sourceLine" id="cb40-19" data-line-number="19"></a>
<a class="sourceLine" id="cb40-20" data-line-number="20"><span class="kw">dim</span>(plan)</a>
<a class="sourceLine" id="cb40-21" data-line-number="21"><span class="co">#&gt; [1] 16301     2</span></a></code></pre></div>
<p>It is extremely difficult to understand, visualize, test, and debug a workflow with so many targets. <code>make()</code>, <code>drake_config()</code>, and <code>vis_drake_graph()</code> simply take too long if you are not ready for production.</p>
<p>To speed up initial testing and experimentation, you may want to limit the number of extra targets created by the <code>map()</code> and <code>cross()</code> transformations. Simply set <code>max_expand</code> in <code>drake_plan()</code>.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb41-2" data-line-number="2">  <span class="dt">max_expand =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb41-3" data-line-number="3">  <span class="dt">data =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb41-4" data-line-number="4">    <span class="kw">get_data</span>(source),</a>
<a class="sourceLine" id="cb41-5" data-line-number="5">    <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">source =</span> <span class="op">!!</span><span class="kw">seq_len</span>(<span class="dv">25</span>))</a>
<a class="sourceLine" id="cb41-6" data-line-number="6">  ),</a>
<a class="sourceLine" id="cb41-7" data-line-number="7">  <span class="dt">analysis =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb41-8" data-line-number="8">    <span class="kw">fn</span>(data, param),</a>
<a class="sourceLine" id="cb41-9" data-line-number="9">    <span class="dt">transform =</span> <span class="kw">cross</span>(</a>
<a class="sourceLine" id="cb41-10" data-line-number="10">      data,</a>
<a class="sourceLine" id="cb41-11" data-line-number="11">      <span class="dt">fn =</span> <span class="op">!!</span>letters,</a>
<a class="sourceLine" id="cb41-12" data-line-number="12">      <span class="dt">param =</span> <span class="op">!!</span><span class="kw">seq_len</span>(<span class="dv">25</span>)</a>
<a class="sourceLine" id="cb41-13" data-line-number="13">    ),</a>
<a class="sourceLine" id="cb41-14" data-line-number="14">  ),</a>
<a class="sourceLine" id="cb41-15" data-line-number="15">  <span class="dt">result =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb41-16" data-line-number="16">    <span class="kw">bind_rows</span>(analysis),</a>
<a class="sourceLine" id="cb41-17" data-line-number="17">    <span class="dt">transform =</span> <span class="kw">combine</span>(analysis, <span class="dt">.by =</span> fn)</a>
<a class="sourceLine" id="cb41-18" data-line-number="18">  )</a>
<a class="sourceLine" id="cb41-19" data-line-number="19">)</a>
<a class="sourceLine" id="cb41-20" data-line-number="20"></a>
<a class="sourceLine" id="cb41-21" data-line-number="21">plan</a>
<a class="sourceLine" id="cb41-22" data-line-number="22"><span class="co">#&gt; # A tibble: 6 x 2</span></a>
<a class="sourceLine" id="cb41-23" data-line-number="23"><span class="co">#&gt;   target                  command                           </span></a>
<a class="sourceLine" id="cb41-24" data-line-number="24"><span class="co">#&gt;   &lt;chr&gt;                   &lt;expr&gt;                            </span></a>
<a class="sourceLine" id="cb41-25" data-line-number="25"><span class="co">#&gt; 1 data_1L                 get_data(1L)                      </span></a>
<a class="sourceLine" id="cb41-26" data-line-number="26"><span class="co">#&gt; 2 data_25L                get_data(25L)                     </span></a>
<a class="sourceLine" id="cb41-27" data-line-number="27"><span class="co">#&gt; 3 analysis_a_1L_data_1L   a(data_1L, 1L)                    </span></a>
<a class="sourceLine" id="cb41-28" data-line-number="28"><span class="co">#&gt; 4 analysis_z_25L_data_25L z(data_25L, 25L)                  </span></a>
<a class="sourceLine" id="cb41-29" data-line-number="29"><span class="co">#&gt; 5 result_a                bind_rows(analysis_a_1L_data_1L)  </span></a>
<a class="sourceLine" id="cb41-30" data-line-number="30"><span class="co">#&gt; 6 result_z                bind_rows(analysis_z_25L_data_25L)</span></a></code></pre></div>
<p>With a downsized plan, we can inspect the graph to make sure the dependencies line up correctly.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1">config &lt;-<span class="st"> </span><span class="kw">drake_config</span>(plan)</a>
<a class="sourceLine" id="cb42-2" data-line-number="2"><span class="kw">vis_drake_graph</span>(config)</a></code></pre></div>
<div id="htmlwidget-4bd26251e3510f85efcc" style="width:576px;height:576px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-4bd26251e3510f85efcc">{"x":{"nodes":{"id":["data_1L","data_25L","analysis_a_1L_data_1L","analysis_z_25L_data_25L","result_a","result_z"],"imported":[false,false,false,false,false,false],"label":["data_1L","data_25L","analysis_a_1L_data_1L","analysis_z_25L_data_25L","result_a","result_z"],"status":["outdated","outdated","outdated","outdated","outdated","outdated"],"type":["object","object","object","object","object","object"],"font.size":[20,20,20,20,20,20],"color":["#000000","#000000","#000000","#000000","#000000","#000000"],"shape":["dot","dot","dot","dot","dot","dot"],"level":[1,1,2,2,3,3],"x":[-1,-1,0,0,1,1],"y":[-1,1,-1,1,-1,1]},"edges":{"from":["data_1L","data_25L","analysis_a_1L_data_1L","analysis_z_25L_data_25L"],"to":["analysis_a_1L_data_1L","analysis_z_25L_data_25L","result_a","result_z"],"arrows":["to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"interaction":{"navigationButtons":true},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)"},"main":{"text":"Dependency graph","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":false,"hoverNearest":false,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Outdated","Object"],"color":["#000000","#888888"],"shape":["dot","dot"],"font.color":["black","black"],"font.size":[20,20],"id":[2,7]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script>
<p>We can even run <code>make(plan)</code> and check a strategic subset of targets.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1"><span class="kw">make</span>(plan)                       <span class="co"># Run the small subset of targets we kept.</span></a>
<a class="sourceLine" id="cb43-2" data-line-number="2"><span class="kw">loadd</span>()                          <span class="co"># Load all those targets into memory.</span></a>
<a class="sourceLine" id="cb43-3" data-line-number="3"><span class="kw">summary</span>(analysis_z_25L_data_13L) <span class="co"># Look at the values of those targets</span></a>
<a class="sourceLine" id="cb43-4" data-line-number="4">                                 <span class="co"># and decide if we are ready to scale up.</span></a></code></pre></div>
<p>When we are ready to scale back up, we simply remove <code>max_expand</code> from the call to <code>drake_plan()</code>. Nothing else needs to change.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb44-2" data-line-number="2">  <span class="dt">data =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb44-3" data-line-number="3">    <span class="kw">get_data</span>(source),</a>
<a class="sourceLine" id="cb44-4" data-line-number="4">    <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">source =</span> <span class="op">!!</span><span class="kw">seq_len</span>(<span class="dv">25</span>))</a>
<a class="sourceLine" id="cb44-5" data-line-number="5">  ),</a>
<a class="sourceLine" id="cb44-6" data-line-number="6">  <span class="dt">analysis =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb44-7" data-line-number="7">    <span class="kw">fn</span>(data, param),</a>
<a class="sourceLine" id="cb44-8" data-line-number="8">    <span class="dt">transform =</span> <span class="kw">cross</span>(</a>
<a class="sourceLine" id="cb44-9" data-line-number="9">      data,</a>
<a class="sourceLine" id="cb44-10" data-line-number="10">      <span class="dt">fn =</span> <span class="op">!!</span>letters,</a>
<a class="sourceLine" id="cb44-11" data-line-number="11">      <span class="dt">param =</span> <span class="op">!!</span><span class="kw">seq_len</span>(<span class="dv">25</span>)</a>
<a class="sourceLine" id="cb44-12" data-line-number="12">    ),</a>
<a class="sourceLine" id="cb44-13" data-line-number="13">  ),</a>
<a class="sourceLine" id="cb44-14" data-line-number="14">  <span class="dt">result =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb44-15" data-line-number="15">    <span class="kw">bind_rows</span>(analysis),</a>
<a class="sourceLine" id="cb44-16" data-line-number="16">    <span class="dt">transform =</span> <span class="kw">combine</span>(analysis, <span class="dt">.by =</span> fn)</a>
<a class="sourceLine" id="cb44-17" data-line-number="17">  )</a>
<a class="sourceLine" id="cb44-18" data-line-number="18">)</a>
<a class="sourceLine" id="cb44-19" data-line-number="19"></a>
<a class="sourceLine" id="cb44-20" data-line-number="20"><span class="kw">nrow</span>(plan)</a>
<a class="sourceLine" id="cb44-21" data-line-number="21"><span class="co">#&gt; [1] 16301</span></a></code></pre></div>
</div>
<div id="the-types-of-transformations" class="section level3">
<h3><span class="header-section-number">4.5.3</span> The types of transformations</h3>
<p><code>drake</code> supports four types of transformations: <code>map()</code>, <code>cross()</code>, <code>split()</code> (unsupported in <code>drake</code> &lt;= 7.3.0), and <code>combine()</code>. These are not actual functions, but you can treat them as functions when you use them in <code>drake_plan()</code>. Each transformation takes after a function from the <a href="https://www.tidyverse.org/">Tidyverse</a>.</p>
<table>
<thead>
<tr class="header">
<th><code>drake</code></th>
<th>Tidyverse analogue</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>map()</code></td>
<td><code>pmap()</code> from <code>purrr</code></td>
</tr>
<tr class="even">
<td><code>cross()</code></td>
<td><code>crossing()</code> from <code>tidyr</code></td>
</tr>
<tr class="odd">
<td><code>split()</code></td>
<td><code>group_map()</code> from <code>dplyr</code></td>
</tr>
<tr class="even">
<td><code>combine()</code></td>
<td><code>summarize()</code> from <code>dplyr</code></td>
</tr>
</tbody>
</table>
<div id="map" class="section level4">
<h4><span class="header-section-number">4.5.3.1</span> <code>map()</code></h4>
<p><code>map()</code> creates a new target for each row in a grid.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1"><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb45-2" data-line-number="2">  <span class="dt">x =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb45-3" data-line-number="3">    <span class="kw">simulate_data</span>(center, scale),</a>
<a class="sourceLine" id="cb45-4" data-line-number="4">    <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">center =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="dt">scale =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb45-5" data-line-number="5">  )</a>
<a class="sourceLine" id="cb45-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb45-7" data-line-number="7"><span class="co">#&gt; # A tibble: 3 x 2</span></a>
<a class="sourceLine" id="cb45-8" data-line-number="8"><span class="co">#&gt;   target command            </span></a>
<a class="sourceLine" id="cb45-9" data-line-number="9"><span class="co">#&gt;   &lt;chr&gt;  &lt;expr&gt;             </span></a>
<a class="sourceLine" id="cb45-10" data-line-number="10"><span class="co">#&gt; 1 x_2_3  simulate_data(2, 3)</span></a>
<a class="sourceLine" id="cb45-11" data-line-number="11"><span class="co">#&gt; 2 x_1_2  simulate_data(1, 2)</span></a>
<a class="sourceLine" id="cb45-12" data-line-number="12"><span class="co">#&gt; 3 x_0_1  simulate_data(0, 1)</span></a></code></pre></div>
<p>You can supply your own custom grid using the <code>.data</code> argument. Note the use of <code>!!</code> below.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1">my_grid &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb46-2" data-line-number="2">  <span class="dt">sim_function =</span> <span class="kw">c</span>(<span class="st">&quot;rnorm&quot;</span>, <span class="st">&quot;rt&quot;</span>, <span class="st">&quot;rcauchy&quot;</span>),</a>
<a class="sourceLine" id="cb46-3" data-line-number="3">  <span class="dt">title =</span> <span class="kw">c</span>(<span class="st">&quot;Normal&quot;</span>, <span class="st">&quot;Student t&quot;</span>, <span class="st">&quot;Cauchy&quot;</span>)</a>
<a class="sourceLine" id="cb46-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb46-5" data-line-number="5">my_grid<span class="op">$</span>sim_function &lt;-<span class="st"> </span>rlang<span class="op">::</span><span class="kw">syms</span>(my_grid<span class="op">$</span>sim_function)</a>
<a class="sourceLine" id="cb46-6" data-line-number="6"></a>
<a class="sourceLine" id="cb46-7" data-line-number="7"><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb46-8" data-line-number="8">  <span class="dt">x =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb46-9" data-line-number="9">    <span class="kw">simulate_data</span>(sim_function, title, center, scale),</a>
<a class="sourceLine" id="cb46-10" data-line-number="10">    <span class="dt">transform =</span> <span class="kw">map</span>(</a>
<a class="sourceLine" id="cb46-11" data-line-number="11">      <span class="dt">center =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb46-12" data-line-number="12">      <span class="dt">scale =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb46-13" data-line-number="13">      <span class="dt">.data =</span> <span class="op">!!</span>my_grid,</a>
<a class="sourceLine" id="cb46-14" data-line-number="14">      <span class="co"># In `.id`, you can select one or more grouping variables</span></a>
<a class="sourceLine" id="cb46-15" data-line-number="15">      <span class="co"># for pretty target names.</span></a>
<a class="sourceLine" id="cb46-16" data-line-number="16">      <span class="co"># Set to FALSE to use short numeric suffixes.</span></a>
<a class="sourceLine" id="cb46-17" data-line-number="17">      <span class="dt">.id =</span> sim_function <span class="co"># Try `.id = c(sim_function, center)` yourself.</span></a>
<a class="sourceLine" id="cb46-18" data-line-number="18">    )</a>
<a class="sourceLine" id="cb46-19" data-line-number="19">  )</a>
<a class="sourceLine" id="cb46-20" data-line-number="20">)</a>
<a class="sourceLine" id="cb46-21" data-line-number="21"><span class="co">#&gt; # A tibble: 3 x 2</span></a>
<a class="sourceLine" id="cb46-22" data-line-number="22"><span class="co">#&gt;   target    command                               </span></a>
<a class="sourceLine" id="cb46-23" data-line-number="23"><span class="co">#&gt;   &lt;chr&gt;     &lt;expr&gt;                                </span></a>
<a class="sourceLine" id="cb46-24" data-line-number="24"><span class="co">#&gt; 1 x_rnorm   simulate_data(rnorm, &quot;Normal&quot;, 2, 3)  </span></a>
<a class="sourceLine" id="cb46-25" data-line-number="25"><span class="co">#&gt; 2 x_rt      simulate_data(rt, &quot;Student t&quot;, 1, 2)  </span></a>
<a class="sourceLine" id="cb46-26" data-line-number="26"><span class="co">#&gt; 3 x_rcauchy simulate_data(rcauchy, &quot;Cauchy&quot;, 0, 1)</span></a></code></pre></div>
</div>
<div id="special-considerations-in-map" class="section level4">
<h4><span class="header-section-number">4.5.3.2</span> Special considerations in <code>map()</code></h4>
<p><code>map()</code> column-binds variables together to create a grid. The lengths of those variables need to be conformable just as with <code>data.frame()</code>.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1"><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb47-2" data-line-number="2">  <span class="dt">x =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb47-3" data-line-number="3">    <span class="kw">simulate_data</span>(center, scale),</a>
<a class="sourceLine" id="cb47-4" data-line-number="4">    <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">center =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="dt">scale =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb47-5" data-line-number="5">  )</a>
<a class="sourceLine" id="cb47-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb47-7" data-line-number="7"><span class="co">#&gt; Error: Failed to make a grid of grouping variables for map().</span></a>
<a class="sourceLine" id="cb47-8" data-line-number="8"><span class="co">#&gt; Grouping variables in map() must have suitable lengths for coercion to a data frame.</span></a>
<a class="sourceLine" id="cb47-9" data-line-number="9"><span class="co">#&gt; Possibly uneven groupings detected in map(center = c(2, 1, 0), scale = c(3, 2)):</span></a>
<a class="sourceLine" id="cb47-10" data-line-number="10"><span class="co">#&gt;   c(&quot;2&quot;, &quot;1&quot;, &quot;0&quot;)</span></a>
<a class="sourceLine" id="cb47-11" data-line-number="11"><span class="co">#&gt;   c(&quot;3&quot;, &quot;2&quot;)</span></a></code></pre></div>
<p>Sometimes, the results are sensible when grouping variable lengths are multiples of each other, but be careful.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" data-line-number="1"><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb48-2" data-line-number="2">  <span class="dt">x =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb48-3" data-line-number="3">    <span class="kw">simulate_data</span>(center, scale),</a>
<a class="sourceLine" id="cb48-4" data-line-number="4">    <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">center =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="dt">scale =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb48-5" data-line-number="5">  )</a>
<a class="sourceLine" id="cb48-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb48-7" data-line-number="7"><span class="co">#&gt; # A tibble: 3 x 2</span></a>
<a class="sourceLine" id="cb48-8" data-line-number="8"><span class="co">#&gt;   target command            </span></a>
<a class="sourceLine" id="cb48-9" data-line-number="9"><span class="co">#&gt;   &lt;chr&gt;  &lt;expr&gt;             </span></a>
<a class="sourceLine" id="cb48-10" data-line-number="10"><span class="co">#&gt; 1 x_2_4  simulate_data(2, 4)</span></a>
<a class="sourceLine" id="cb48-11" data-line-number="11"><span class="co">#&gt; 2 x_1_4  simulate_data(1, 4)</span></a>
<a class="sourceLine" id="cb48-12" data-line-number="12"><span class="co">#&gt; 3 x_0_4  simulate_data(0, 4)</span></a></code></pre></div>
<p>Things get tricker when <code>drake</code> reuses grouping variables from previous transformations. For example, below, each <code>x_*</code> target has an associated <code>center</code> value. So if you write <code>transform = map(x)</code>, then <code>center</code> goes along for the ride.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" data-line-number="1"><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb49-2" data-line-number="2">  <span class="dt">x =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb49-3" data-line-number="3">    <span class="kw">simulate_data</span>(center),</a>
<a class="sourceLine" id="cb49-4" data-line-number="4">    <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">center =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb49-5" data-line-number="5">  ),</a>
<a class="sourceLine" id="cb49-6" data-line-number="6">  <span class="dt">y =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb49-7" data-line-number="7">    <span class="kw">process_data</span>(x, center),</a>
<a class="sourceLine" id="cb49-8" data-line-number="8">    <span class="dt">transform =</span> <span class="kw">map</span>(x)</a>
<a class="sourceLine" id="cb49-9" data-line-number="9">  ),</a>
<a class="sourceLine" id="cb49-10" data-line-number="10">  <span class="dt">trace =</span> <span class="ot">TRUE</span> <span class="co"># Adds extra columns for the grouping variables.</span></a>
<a class="sourceLine" id="cb49-11" data-line-number="11">)</a>
<a class="sourceLine" id="cb49-12" data-line-number="12"><span class="co">#&gt; # A tibble: 4 x 5</span></a>
<a class="sourceLine" id="cb49-13" data-line-number="13"><span class="co">#&gt;   target command              center x     y    </span></a>
<a class="sourceLine" id="cb49-14" data-line-number="14"><span class="co">#&gt;   &lt;chr&gt;  &lt;expr&gt;               &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;</span></a>
<a class="sourceLine" id="cb49-15" data-line-number="15"><span class="co">#&gt; 1 x_1    simulate_data(1)     1      x_1   &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb49-16" data-line-number="16"><span class="co">#&gt; 2 x_2    simulate_data(2)     2      x_2   &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb49-17" data-line-number="17"><span class="co">#&gt; 3 y_x_1  process_data(x_1, 1) 1      x_1   y_x_1</span></a>
<a class="sourceLine" id="cb49-18" data-line-number="18"><span class="co">#&gt; 4 y_x_2  process_data(x_2, 2) 2      x_2   y_x_2</span></a></code></pre></div>
<p>But if other targets have <code>centers</code>âs of their own, <code>drake_plan()</code> may not know what to do with them.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" data-line-number="1"><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb50-2" data-line-number="2">  <span class="dt">w =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb50-3" data-line-number="3">    <span class="kw">simulate_data</span>(center),</a>
<a class="sourceLine" id="cb50-4" data-line-number="4">    <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">center =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">4</span>))</a>
<a class="sourceLine" id="cb50-5" data-line-number="5">  ),</a>
<a class="sourceLine" id="cb50-6" data-line-number="6">  <span class="dt">x =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb50-7" data-line-number="7">    <span class="kw">simulate_data_2</span>(center),</a>
<a class="sourceLine" id="cb50-8" data-line-number="8">    <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">center =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb50-9" data-line-number="9">  ),</a>
<a class="sourceLine" id="cb50-10" data-line-number="10">  <span class="dt">y =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb50-11" data-line-number="11">    <span class="kw">process_data</span>(w, x, center),</a>
<a class="sourceLine" id="cb50-12" data-line-number="12">    <span class="dt">transform =</span> <span class="kw">map</span>(w, x)</a>
<a class="sourceLine" id="cb50-13" data-line-number="13">  ),</a>
<a class="sourceLine" id="cb50-14" data-line-number="14">  <span class="dt">trace =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb50-15" data-line-number="15">)</a>
<a class="sourceLine" id="cb50-16" data-line-number="16"><span class="co">#&gt; # A tibble: 6 x 6</span></a>
<a class="sourceLine" id="cb50-17" data-line-number="17"><span class="co">#&gt;   target    command                   center w     x     y        </span></a>
<a class="sourceLine" id="cb50-18" data-line-number="18"><span class="co">#&gt;   &lt;chr&gt;     &lt;expr&gt;                    &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;    </span></a>
<a class="sourceLine" id="cb50-19" data-line-number="19"><span class="co">#&gt; 1 w_3       simulate_data(3)          3      w_3   &lt;NA&gt;  &lt;NA&gt;     </span></a>
<a class="sourceLine" id="cb50-20" data-line-number="20"><span class="co">#&gt; 2 w_4       simulate_data(4)          4      w_4   &lt;NA&gt;  &lt;NA&gt;     </span></a>
<a class="sourceLine" id="cb50-21" data-line-number="21"><span class="co">#&gt; 3 x_1       simulate_data_2(1)        1      &lt;NA&gt;  x_1   &lt;NA&gt;     </span></a>
<a class="sourceLine" id="cb50-22" data-line-number="22"><span class="co">#&gt; 4 x_2       simulate_data_2(2)        2      &lt;NA&gt;  x_2   &lt;NA&gt;     </span></a>
<a class="sourceLine" id="cb50-23" data-line-number="23"><span class="co">#&gt; 5 y_w_3_x_1 process_data(w_3, x_1, 3) 3      w_3   x_1   y_w_3_x_1</span></a>
<a class="sourceLine" id="cb50-24" data-line-number="24"><span class="co">#&gt; 6 y_w_4_x_2 process_data(w_4, x_2, 4) 4      w_4   x_2   y_w_4_x_2</span></a></code></pre></div>
<p>The problems is that there are 4 values of <code>center</code> and only two <code>x_*</code> targets (and two <code>y_*</code> targets). Even if you explicitly supply <code>center</code> to the transformation, <code>map()</code> can only takes the first two values.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" data-line-number="1"><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb51-2" data-line-number="2">  <span class="dt">w =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb51-3" data-line-number="3">    <span class="kw">simulate_data</span>(center),</a>
<a class="sourceLine" id="cb51-4" data-line-number="4">    <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">center =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">4</span>))</a>
<a class="sourceLine" id="cb51-5" data-line-number="5">  ),</a>
<a class="sourceLine" id="cb51-6" data-line-number="6">  <span class="dt">x =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb51-7" data-line-number="7">    <span class="kw">simulate_data_2</span>(center),</a>
<a class="sourceLine" id="cb51-8" data-line-number="8">    <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">center =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb51-9" data-line-number="9">  ),</a>
<a class="sourceLine" id="cb51-10" data-line-number="10">  <span class="dt">y =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb51-11" data-line-number="11">    <span class="kw">process_data</span>(w, x, center),</a>
<a class="sourceLine" id="cb51-12" data-line-number="12">    <span class="dt">transform =</span> <span class="kw">map</span>(w, x, center)</a>
<a class="sourceLine" id="cb51-13" data-line-number="13">  ),</a>
<a class="sourceLine" id="cb51-14" data-line-number="14">  <span class="dt">trace =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb51-15" data-line-number="15">)</a>
<a class="sourceLine" id="cb51-16" data-line-number="16"><span class="co">#&gt; Warning in min(vapply(out, length, FUN.VALUE = integer(1))): no non-missing</span></a>
<a class="sourceLine" id="cb51-17" data-line-number="17"><span class="co">#&gt; arguments to min; returning Inf</span></a>
<a class="sourceLine" id="cb51-18" data-line-number="18"><span class="co">#&gt; Warning: A grouping or splitting variable for target &#39;y&#39; is missing or</span></a>
<a class="sourceLine" id="cb51-19" data-line-number="19"><span class="co">#&gt; undefined. Transformation skipped and target deleted.</span></a>
<a class="sourceLine" id="cb51-20" data-line-number="20"><span class="co">#&gt; # A tibble: 4 x 5</span></a>
<a class="sourceLine" id="cb51-21" data-line-number="21"><span class="co">#&gt;   target command            center w     x    </span></a>
<a class="sourceLine" id="cb51-22" data-line-number="22"><span class="co">#&gt;   &lt;chr&gt;  &lt;expr&gt;             &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;</span></a>
<a class="sourceLine" id="cb51-23" data-line-number="23"><span class="co">#&gt; 1 w_3    simulate_data(3)   3      w_3   &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb51-24" data-line-number="24"><span class="co">#&gt; 2 w_4    simulate_data(4)   4      w_4   &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb51-25" data-line-number="25"><span class="co">#&gt; 3 x_1    simulate_data_2(1) 1      &lt;NA&gt;  x_1  </span></a>
<a class="sourceLine" id="cb51-26" data-line-number="26"><span class="co">#&gt; 4 x_2    simulate_data_2(2) 2      &lt;NA&gt;  x_2</span></a></code></pre></div>
<p>So please inspect the plan before you run it with <code>make()</code>. Once you have a <code>drake_config()</code> object, <code>vis_drake_graph()</code> and <code>deps_target()</code> can help.</p>
</div>
<div id="cross" class="section level4">
<h4><span class="header-section-number">4.5.3.3</span> <code>cross()</code></h4>
<p><code>cross()</code> creates a new target for each combination of argument values.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" data-line-number="1"><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb52-2" data-line-number="2">  <span class="dt">x =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb52-3" data-line-number="3">    <span class="kw">simulate_data</span>(nrow, ncol),</a>
<a class="sourceLine" id="cb52-4" data-line-number="4">    <span class="dt">transform =</span> <span class="kw">cross</span>(<span class="dt">nrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="dt">ncol =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">5</span>))</a>
<a class="sourceLine" id="cb52-5" data-line-number="5">  )</a>
<a class="sourceLine" id="cb52-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb52-7" data-line-number="7"><span class="co">#&gt; # A tibble: 6 x 2</span></a>
<a class="sourceLine" id="cb52-8" data-line-number="8"><span class="co">#&gt;   target command            </span></a>
<a class="sourceLine" id="cb52-9" data-line-number="9"><span class="co">#&gt;   &lt;chr&gt;  &lt;expr&gt;             </span></a>
<a class="sourceLine" id="cb52-10" data-line-number="10"><span class="co">#&gt; 1 x_1_4  simulate_data(1, 4)</span></a>
<a class="sourceLine" id="cb52-11" data-line-number="11"><span class="co">#&gt; 2 x_2_4  simulate_data(2, 4)</span></a>
<a class="sourceLine" id="cb52-12" data-line-number="12"><span class="co">#&gt; 3 x_3_4  simulate_data(3, 4)</span></a>
<a class="sourceLine" id="cb52-13" data-line-number="13"><span class="co">#&gt; 4 x_1_5  simulate_data(1, 5)</span></a>
<a class="sourceLine" id="cb52-14" data-line-number="14"><span class="co">#&gt; 5 x_2_5  simulate_data(2, 5)</span></a>
<a class="sourceLine" id="cb52-15" data-line-number="15"><span class="co">#&gt; 6 x_3_5  simulate_data(3, 5)</span></a></code></pre></div>
</div>
<div id="split" class="section level4">
<h4><span class="header-section-number">4.5.3.4</span> <code>split()</code></h4>
<p><code>split()</code> is not supported in <code>drake</code> 7.3.0 and below. It should reach the next CRAN release in June 2019.</p>
<p>The <code>split()</code> transformation distributes a dataset as uniformly as possible across multiple targets.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" data-line-number="1">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb53-2" data-line-number="2">  <span class="dt">large_data =</span> <span class="kw">get_data</span>(),</a>
<a class="sourceLine" id="cb53-3" data-line-number="3">  <span class="dt">slice_analysis =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb53-4" data-line-number="4">    large_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb53-5" data-line-number="5"><span class="st">      </span><span class="kw">analyze</span>(),</a>
<a class="sourceLine" id="cb53-6" data-line-number="6">    <span class="dt">transform =</span> <span class="kw">split</span>(large_data, <span class="dt">slices =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb53-7" data-line-number="7">  ),</a>
<a class="sourceLine" id="cb53-8" data-line-number="8">  <span class="dt">results =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb53-9" data-line-number="9">    dplyr<span class="op">::</span><span class="kw">bind_rows</span>(slice_analysis),</a>
<a class="sourceLine" id="cb53-10" data-line-number="10">    <span class="dt">transform =</span> <span class="kw">combine</span>(slice_analysis)</a>
<a class="sourceLine" id="cb53-11" data-line-number="11">  )</a>
<a class="sourceLine" id="cb53-12" data-line-number="12">)</a>
<a class="sourceLine" id="cb53-13" data-line-number="13"></a>
<a class="sourceLine" id="cb53-14" data-line-number="14">plan</a>
<a class="sourceLine" id="cb53-15" data-line-number="15"><span class="co">#&gt; # A tibble: 6 x 2</span></a>
<a class="sourceLine" id="cb53-16" data-line-number="16"><span class="co">#&gt;   target         command                                                   </span></a>
<a class="sourceLine" id="cb53-17" data-line-number="17"><span class="co">#&gt;   &lt;chr&gt;          &lt;expr&gt;                                                    </span></a>
<a class="sourceLine" id="cb53-18" data-line-number="18"><span class="co">#&gt; 1 large_data     get_data()                                               â¦</span></a>
<a class="sourceLine" id="cb53-19" data-line-number="19"><span class="co">#&gt; 2 slice_analysiâ¦ drake_slice(data = large_data, slices = 4, index = 1) %&gt;%â¦</span></a>
<a class="sourceLine" id="cb53-20" data-line-number="20"><span class="co">#&gt; 3 slice_analysiâ¦ drake_slice(data = large_data, slices = 4, index = 2) %&gt;%â¦</span></a>
<a class="sourceLine" id="cb53-21" data-line-number="21"><span class="co">#&gt; 4 slice_analysiâ¦ drake_slice(data = large_data, slices = 4, index = 3) %&gt;%â¦</span></a>
<a class="sourceLine" id="cb53-22" data-line-number="22"><span class="co">#&gt; 5 slice_analysiâ¦ drake_slice(data = large_data, slices = 4, index = 4) %&gt;%â¦</span></a>
<a class="sourceLine" id="cb53-23" data-line-number="23"><span class="co">#&gt; 6 results        dplyr::bind_rows(slice_analysis_1, slice_analysis_2, slicâ¦</span></a></code></pre></div>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" data-line-number="1">config &lt;-<span class="st"> </span><span class="kw">drake_config</span>(plan)</a>
<a class="sourceLine" id="cb54-2" data-line-number="2"><span class="kw">vis_drake_graph</span>(config)</a></code></pre></div>
<div id="htmlwidget-c8c2efd752b3f9f48dc8" style="width:576px;height:576px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-c8c2efd752b3f9f48dc8">{"x":{"nodes":{"id":["large_data","n-MRYGY6LSHI5GE2LOMRPXE33XOM","slice_analysis_1","slice_analysis_2","slice_analysis_3","slice_analysis_4","results"],"imported":[false,true,false,false,false,false,false],"label":["large_data","dplyr::bind_rows","slice_analysis_1","slice_analysis_2","slice_analysis_3","slice_analysis_4","results"],"status":["outdated","imported","outdated","outdated","outdated","outdated","outdated"],"type":["object","function","object","object","object","object","object"],"font.size":[20,20,20,20,20,20,20],"color":["#000000","#1874CD","#000000","#000000","#000000","#000000","#000000"],"shape":["dot","triangle","dot","dot","dot","dot","dot"],"level":[1,1,2,2,2,2,3],"x":[-1,-1,0,0,0,0,1],"y":[-0.555555555555556,0.555555555555555,-1,-0.333333333333333,0.333333333333333,1,-2.22044604925031e-16]},"edges":{"from":["large_data","large_data","large_data","large_data","slice_analysis_1","slice_analysis_2","slice_analysis_3","slice_analysis_4","n-MRYGY6LSHI5GE2LOMRPXE33XOM"],"to":["slice_analysis_1","slice_analysis_2","slice_analysis_3","slice_analysis_4","results","results","results","results","results"],"arrows":["to","to","to","to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"interaction":{"navigationButtons":true},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)"},"main":{"text":"Dependency graph","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":false,"hoverNearest":false,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Outdated","Imported","Object","Function"],"color":["#000000","#1874CD","#888888","#888888"],"shape":["dot","dot","dot","triangle"],"font.color":["black","black","black","black"],"font.size":[20,20,20,20],"id":[2,5,7,8]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script>
<p>Here, <code>drake_slice()</code> takes a single subset of the data at runtime.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" data-line-number="1">dataset &lt;-<span class="st"> </span>tibble<span class="op">::</span><span class="kw">as_tibble</span>(iris)</a>
<a class="sourceLine" id="cb55-2" data-line-number="2"><span class="kw">dim</span>(dataset)</a>
<a class="sourceLine" id="cb55-3" data-line-number="3"><span class="co">#&gt; [1] 150   5</span></a>
<a class="sourceLine" id="cb55-4" data-line-number="4"></a>
<a class="sourceLine" id="cb55-5" data-line-number="5"><span class="kw">drake_slice</span>(dataset, <span class="dt">slices =</span> <span class="dv">50</span>, <span class="dt">index =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb55-6" data-line-number="6"><span class="co">#&gt; # A tibble: 3 x 5</span></a>
<a class="sourceLine" id="cb55-7" data-line-number="7"><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></a>
<a class="sourceLine" id="cb55-8" data-line-number="8"><span class="co">#&gt;          &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;  </span></a>
<a class="sourceLine" id="cb55-9" data-line-number="9"><span class="co">#&gt; 1          5.1         3.5          1.4         0.2 setosa </span></a>
<a class="sourceLine" id="cb55-10" data-line-number="10"><span class="co">#&gt; 2          4.9         3            1.4         0.2 setosa </span></a>
<a class="sourceLine" id="cb55-11" data-line-number="11"><span class="co">#&gt; 3          4.7         3.2          1.3         0.2 setosa</span></a>
<a class="sourceLine" id="cb55-12" data-line-number="12"></a>
<a class="sourceLine" id="cb55-13" data-line-number="13"><span class="kw">drake_slice</span>(dataset, <span class="dt">slices =</span> <span class="dv">50</span>, <span class="dt">index =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb55-14" data-line-number="14"><span class="co">#&gt; # A tibble: 3 x 5</span></a>
<a class="sourceLine" id="cb55-15" data-line-number="15"><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></a>
<a class="sourceLine" id="cb55-16" data-line-number="16"><span class="co">#&gt;          &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;  </span></a>
<a class="sourceLine" id="cb55-17" data-line-number="17"><span class="co">#&gt; 1          4.6         3.1          1.5         0.2 setosa </span></a>
<a class="sourceLine" id="cb55-18" data-line-number="18"><span class="co">#&gt; 2          5           3.6          1.4         0.2 setosa </span></a>
<a class="sourceLine" id="cb55-19" data-line-number="19"><span class="co">#&gt; 3          5.4         3.9          1.7         0.4 setosa</span></a>
<a class="sourceLine" id="cb55-20" data-line-number="20"></a>
<a class="sourceLine" id="cb55-21" data-line-number="21"><span class="kw">drake_slice</span>(dataset, <span class="dt">slices =</span> <span class="dv">3</span>, <span class="dt">index =</span> <span class="dv">1</span>, <span class="dt">margin =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb55-22" data-line-number="22"><span class="co">#&gt; # A tibble: 150 x 2</span></a>
<a class="sourceLine" id="cb55-23" data-line-number="23"><span class="co">#&gt;    Sepal.Length Sepal.Width</span></a>
<a class="sourceLine" id="cb55-24" data-line-number="24"><span class="co">#&gt;           &lt;dbl&gt;       &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb55-25" data-line-number="25"><span class="co">#&gt;  1          5.1         3.5</span></a>
<a class="sourceLine" id="cb55-26" data-line-number="26"><span class="co">#&gt;  2          4.9         3  </span></a>
<a class="sourceLine" id="cb55-27" data-line-number="27"><span class="co">#&gt;  3          4.7         3.2</span></a>
<a class="sourceLine" id="cb55-28" data-line-number="28"><span class="co">#&gt;  4          4.6         3.1</span></a>
<a class="sourceLine" id="cb55-29" data-line-number="29"><span class="co">#&gt;  5          5           3.6</span></a>
<a class="sourceLine" id="cb55-30" data-line-number="30"><span class="co">#&gt;  6          5.4         3.9</span></a>
<a class="sourceLine" id="cb55-31" data-line-number="31"><span class="co">#&gt;  7          4.6         3.4</span></a>
<a class="sourceLine" id="cb55-32" data-line-number="32"><span class="co">#&gt;  8          5           3.4</span></a>
<a class="sourceLine" id="cb55-33" data-line-number="33"><span class="co">#&gt;  9          4.4         2.9</span></a>
<a class="sourceLine" id="cb55-34" data-line-number="34"><span class="co">#&gt; 10          4.9         3.1</span></a>
<a class="sourceLine" id="cb55-35" data-line-number="35"><span class="co">#&gt; # â¦ with 140 more rows</span></a></code></pre></div>
<p><code>drake_slice()</code> supports data frames, matrices, and arbitrary arrays, and you can subset on any margin (rows, columns, etc). Even better, you can split up ordinary vectors and lists. Instead of taking slices of the actual dataset, you can split up a set of indices. Combined with <a href="hpc.html#hpc">high-performance computing</a>, this should help you avoid loading an entire big data file into memory on a single compute node.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" data-line-number="1">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb56-2" data-line-number="2">  <span class="dt">all_rows =</span> <span class="kw">file_in</span>(<span class="st">&quot;huge.csv&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb56-3" data-line-number="3"><span class="st">    </span><span class="kw">number_of_rows</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb56-4" data-line-number="4"><span class="st">    </span><span class="kw">seq_len</span>(),</a>
<a class="sourceLine" id="cb56-5" data-line-number="5">  <span class="dt">rows =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb56-6" data-line-number="6">    all_rows,</a>
<a class="sourceLine" id="cb56-7" data-line-number="7">    <span class="dt">transform =</span> <span class="kw">split</span>(all_rows, <span class="dt">slices =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb56-8" data-line-number="8">  ),</a>
<a class="sourceLine" id="cb56-9" data-line-number="9">  <span class="dt">analysis =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb56-10" data-line-number="10">    <span class="kw">read_rows</span>( <span class="co"># custom function</span></a>
<a class="sourceLine" id="cb56-11" data-line-number="11">      <span class="dt">file =</span> <span class="kw">file_in</span>(<span class="st">&quot;huge.csv&quot;</span>),</a>
<a class="sourceLine" id="cb56-12" data-line-number="12">      <span class="dt">rows =</span> rows</a>
<a class="sourceLine" id="cb56-13" data-line-number="13">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb56-14" data-line-number="14"><span class="st">      </span><span class="kw">analyze_data</span>(),</a>
<a class="sourceLine" id="cb56-15" data-line-number="15">    <span class="dt">transform =</span> <span class="kw">map</span>(rows, <span class="dt">.id =</span> rows_index) <span class="co"># an internal trick</span></a>
<a class="sourceLine" id="cb56-16" data-line-number="16">  )</a>
<a class="sourceLine" id="cb56-17" data-line-number="17">)</a>
<a class="sourceLine" id="cb56-18" data-line-number="18"></a>
<a class="sourceLine" id="cb56-19" data-line-number="19"><span class="kw">drake_plan_source</span>(plan)</a>
<a class="sourceLine" id="cb56-20" data-line-number="20"><span class="co">#&gt; drake_plan(</span></a>
<a class="sourceLine" id="cb56-21" data-line-number="21"><span class="co">#&gt;   all_rows = file_in(&quot;huge.csv&quot;) %&gt;%</span></a>
<a class="sourceLine" id="cb56-22" data-line-number="22"><span class="co">#&gt;     number_of_rows() %&gt;%</span></a>
<a class="sourceLine" id="cb56-23" data-line-number="23"><span class="co">#&gt;     seq_len(),</span></a>
<a class="sourceLine" id="cb56-24" data-line-number="24"><span class="co">#&gt;   rows_1 = drake_slice(data = all_rows, slices = 3, index = 1),</span></a>
<a class="sourceLine" id="cb56-25" data-line-number="25"><span class="co">#&gt;   rows_2 = drake_slice(data = all_rows, slices = 3, index = 2),</span></a>
<a class="sourceLine" id="cb56-26" data-line-number="26"><span class="co">#&gt;   rows_3 = drake_slice(data = all_rows, slices = 3, index = 3),</span></a>
<a class="sourceLine" id="cb56-27" data-line-number="27"><span class="co">#&gt;   analysis_1 = read_rows(file = file_in(&quot;huge.csv&quot;), rows = rows_1) %&gt;% analyze_data(),</span></a>
<a class="sourceLine" id="cb56-28" data-line-number="28"><span class="co">#&gt;   analysis_2 = read_rows(file = file_in(&quot;huge.csv&quot;), rows = rows_2) %&gt;% analyze_data(),</span></a>
<a class="sourceLine" id="cb56-29" data-line-number="29"><span class="co">#&gt;   analysis_3 = read_rows(file = file_in(&quot;huge.csv&quot;), rows = rows_3) %&gt;% analyze_data()</span></a>
<a class="sourceLine" id="cb56-30" data-line-number="30"><span class="co">#&gt; )</span></a></code></pre></div>
</div>
<div id="combine" class="section level4">
<h4><span class="header-section-number">4.5.3.5</span> <code>combine()</code></h4>
<p>In <code>combine()</code>, you can insert multiple targets into individual commands. The closest comparison is the unquote-splice operator <code>!!!</code> from the Tidyverse.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" data-line-number="1">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb57-2" data-line-number="2">  <span class="dt">data =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb57-3" data-line-number="3">    <span class="kw">sim_data</span>(<span class="dt">mean =</span> x, <span class="dt">sd =</span> y),</a>
<a class="sourceLine" id="cb57-4" data-line-number="4">    <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">4</span>))</a>
<a class="sourceLine" id="cb57-5" data-line-number="5">  ),</a>
<a class="sourceLine" id="cb57-6" data-line-number="6">  <span class="dt">larger =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb57-7" data-line-number="7">    <span class="kw">bind_rows</span>(data, <span class="dt">.id =</span> <span class="st">&quot;id&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb57-8" data-line-number="8"><span class="st">      </span><span class="kw">arrange</span>(sd) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb57-9" data-line-number="9"><span class="st">      </span><span class="kw">head</span>(<span class="dt">n =</span> <span class="dv">400</span>),</a>
<a class="sourceLine" id="cb57-10" data-line-number="10">    <span class="dt">transform =</span> <span class="kw">combine</span>(data)</a>
<a class="sourceLine" id="cb57-11" data-line-number="11">  )</a>
<a class="sourceLine" id="cb57-12" data-line-number="12">)</a>
<a class="sourceLine" id="cb57-13" data-line-number="13"></a>
<a class="sourceLine" id="cb57-14" data-line-number="14">plan</a>
<a class="sourceLine" id="cb57-15" data-line-number="15"><span class="co">#&gt; # A tibble: 3 x 2</span></a>
<a class="sourceLine" id="cb57-16" data-line-number="16"><span class="co">#&gt;   target   command                                                         </span></a>
<a class="sourceLine" id="cb57-17" data-line-number="17"><span class="co">#&gt;   &lt;chr&gt;    &lt;expr&gt;                                                          </span></a>
<a class="sourceLine" id="cb57-18" data-line-number="18"><span class="co">#&gt; 1 data_1_3 sim_data(mean = 1, sd = 3)                                     â¦</span></a>
<a class="sourceLine" id="cb57-19" data-line-number="19"><span class="co">#&gt; 2 data_2_4 sim_data(mean = 2, sd = 4)                                     â¦</span></a>
<a class="sourceLine" id="cb57-20" data-line-number="20"><span class="co">#&gt; 3 larger   bind_rows(data_1_3, data_2_4, .id = &quot;id&quot;) %&gt;% arrange(sd) %&gt;%  â¦</span></a>
<a class="sourceLine" id="cb57-21" data-line-number="21"></a>
<a class="sourceLine" id="cb57-22" data-line-number="22"><span class="kw">drake_plan_source</span>(plan)</a>
<a class="sourceLine" id="cb57-23" data-line-number="23"><span class="co">#&gt; drake_plan(</span></a>
<a class="sourceLine" id="cb57-24" data-line-number="24"><span class="co">#&gt;   data_1_3 = sim_data(mean = 1, sd = 3),</span></a>
<a class="sourceLine" id="cb57-25" data-line-number="25"><span class="co">#&gt;   data_2_4 = sim_data(mean = 2, sd = 4),</span></a>
<a class="sourceLine" id="cb57-26" data-line-number="26"><span class="co">#&gt;   larger = bind_rows(data_1_3, data_2_4, .id = &quot;id&quot;) %&gt;%</span></a>
<a class="sourceLine" id="cb57-27" data-line-number="27"><span class="co">#&gt;     arrange(sd) %&gt;%</span></a>
<a class="sourceLine" id="cb57-28" data-line-number="28"><span class="co">#&gt;     head(n = 400)</span></a>
<a class="sourceLine" id="cb57-29" data-line-number="29"><span class="co">#&gt; )</span></a>
<a class="sourceLine" id="cb57-30" data-line-number="30"></a>
<a class="sourceLine" id="cb57-31" data-line-number="31">config &lt;-<span class="st"> </span><span class="kw">drake_config</span>(plan)</a>
<a class="sourceLine" id="cb57-32" data-line-number="32"><span class="kw">vis_drake_graph</span>(config)</a></code></pre></div>
<div id="htmlwidget-094a7ca09aea0953f3fb" style="width:576px;height:576px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-094a7ca09aea0953f3fb">{"x":{"nodes":{"id":["data_1_3","data_2_4","larger"],"imported":[false,false,false],"label":["data_1_3","data_2_4","larger"],"status":["outdated","outdated","outdated"],"type":["object","object","object"],"font.size":[20,20,20],"color":["#000000","#000000","#000000"],"shape":["dot","dot","dot"],"level":[1,1,2],"x":[-1,-1,1],"y":[-1,1,2.22044604925031e-16]},"edges":{"from":["data_1_3","data_2_4"],"to":["larger","larger"],"arrows":["to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"interaction":{"navigationButtons":true},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)"},"main":{"text":"Dependency graph","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":false,"hoverNearest":false,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Outdated","Object"],"color":["#000000","#888888"],"shape":["dot","dot"],"font.color":["black","black"],"font.size":[20,20],"id":[2,7]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script>
<p>You can different groups of targets in the same command.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" data-line-number="1">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb58-2" data-line-number="2">  <span class="dt">data_group1 =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb58-3" data-line-number="3">    <span class="kw">sim_data</span>(<span class="dt">mean =</span> x, <span class="dt">sd =</span> y),</a>
<a class="sourceLine" id="cb58-4" data-line-number="4">    <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">4</span>))</a>
<a class="sourceLine" id="cb58-5" data-line-number="5">  ),</a>
<a class="sourceLine" id="cb58-6" data-line-number="6">  <span class="dt">data_group2 =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb58-7" data-line-number="7">    <span class="kw">pull_data</span>(url),</a>
<a class="sourceLine" id="cb58-8" data-line-number="8">    <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">url =</span> <span class="kw">c</span>(<span class="st">&quot;example1.com&quot;</span>, <span class="st">&quot;example2.com&quot;</span>))</a>
<a class="sourceLine" id="cb58-9" data-line-number="9">  ),</a>
<a class="sourceLine" id="cb58-10" data-line-number="10">  <span class="dt">larger =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb58-11" data-line-number="11">    <span class="kw">bind_rows</span>(data_group1, data_group2, <span class="dt">.id =</span> <span class="st">&quot;id&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb58-12" data-line-number="12"><span class="st">      </span><span class="kw">arrange</span>(sd) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb58-13" data-line-number="13"><span class="st">      </span><span class="kw">head</span>(<span class="dt">n =</span> <span class="dv">400</span>),</a>
<a class="sourceLine" id="cb58-14" data-line-number="14">    <span class="dt">transform =</span> <span class="kw">combine</span>(data_group1, data_group2)</a>
<a class="sourceLine" id="cb58-15" data-line-number="15">  )</a>
<a class="sourceLine" id="cb58-16" data-line-number="16">)</a>
<a class="sourceLine" id="cb58-17" data-line-number="17"></a>
<a class="sourceLine" id="cb58-18" data-line-number="18"><span class="kw">drake_plan_source</span>(plan)</a>
<a class="sourceLine" id="cb58-19" data-line-number="19"><span class="co">#&gt; drake_plan(</span></a>
<a class="sourceLine" id="cb58-20" data-line-number="20"><span class="co">#&gt;   data_group1_1_3 = sim_data(mean = 1, sd = 3),</span></a>
<a class="sourceLine" id="cb58-21" data-line-number="21"><span class="co">#&gt;   data_group1_2_4 = sim_data(mean = 2, sd = 4),</span></a>
<a class="sourceLine" id="cb58-22" data-line-number="22"><span class="co">#&gt;   data_group2_example1.com = pull_data(&quot;example1.com&quot;),</span></a>
<a class="sourceLine" id="cb58-23" data-line-number="23"><span class="co">#&gt;   data_group2_example2.com = pull_data(&quot;example2.com&quot;),</span></a>
<a class="sourceLine" id="cb58-24" data-line-number="24"><span class="co">#&gt;   larger = bind_rows(data_group1_1_3, data_group1_2_4, data_group2_example1.com,</span></a>
<a class="sourceLine" id="cb58-25" data-line-number="25"><span class="co">#&gt;     data_group2_example2.com,</span></a>
<a class="sourceLine" id="cb58-26" data-line-number="26"><span class="co">#&gt;     .id = &quot;id&quot;</span></a>
<a class="sourceLine" id="cb58-27" data-line-number="27"><span class="co">#&gt;   ) %&gt;%</span></a>
<a class="sourceLine" id="cb58-28" data-line-number="28"><span class="co">#&gt;     arrange(sd) %&gt;%</span></a>
<a class="sourceLine" id="cb58-29" data-line-number="29"><span class="co">#&gt;     head(n = 400)</span></a>
<a class="sourceLine" id="cb58-30" data-line-number="30"><span class="co">#&gt; )</span></a></code></pre></div>
<p>And as with <code>group_by()</code> from <code>dplyr</code>, you can create a separate aggregate for each combination of levels of the arguments. Just pass a symbol or vector of symbols to the optional <code>.by</code> argument of <code>combine()</code>.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" data-line-number="1">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb59-2" data-line-number="2">  <span class="dt">data =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb59-3" data-line-number="3">    <span class="kw">sim_data</span>(<span class="dt">mean =</span> x, <span class="dt">sd =</span> y, <span class="dt">skew =</span> z),</a>
<a class="sourceLine" id="cb59-4" data-line-number="4">    <span class="dt">transform =</span> <span class="kw">cross</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">4</span>), <span class="dt">z =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">6</span>))</a>
<a class="sourceLine" id="cb59-5" data-line-number="5">  ),</a>
<a class="sourceLine" id="cb59-6" data-line-number="6">  <span class="dt">combined =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb59-7" data-line-number="7">    <span class="kw">bind_rows</span>(data, <span class="dt">.id =</span> <span class="st">&quot;id&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb59-8" data-line-number="8"><span class="st">      </span><span class="kw">arrange</span>(sd) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb59-9" data-line-number="9"><span class="st">      </span><span class="kw">head</span>(<span class="dt">n =</span> <span class="dv">400</span>),</a>
<a class="sourceLine" id="cb59-10" data-line-number="10">    <span class="dt">transform =</span> <span class="kw">combine</span>(data, <span class="dt">.by =</span> <span class="kw">c</span>(x, y))</a>
<a class="sourceLine" id="cb59-11" data-line-number="11">  )</a>
<a class="sourceLine" id="cb59-12" data-line-number="12">)</a>
<a class="sourceLine" id="cb59-13" data-line-number="13"></a>
<a class="sourceLine" id="cb59-14" data-line-number="14"><span class="kw">drake_plan_source</span>(plan)</a>
<a class="sourceLine" id="cb59-15" data-line-number="15"><span class="co">#&gt; drake_plan(</span></a>
<a class="sourceLine" id="cb59-16" data-line-number="16"><span class="co">#&gt;   data_1_3_5 = sim_data(mean = 1, sd = 3, skew = 5),</span></a>
<a class="sourceLine" id="cb59-17" data-line-number="17"><span class="co">#&gt;   data_2_3_5 = sim_data(mean = 2, sd = 3, skew = 5),</span></a>
<a class="sourceLine" id="cb59-18" data-line-number="18"><span class="co">#&gt;   data_1_4_5 = sim_data(mean = 1, sd = 4, skew = 5),</span></a>
<a class="sourceLine" id="cb59-19" data-line-number="19"><span class="co">#&gt;   data_2_4_5 = sim_data(mean = 2, sd = 4, skew = 5),</span></a>
<a class="sourceLine" id="cb59-20" data-line-number="20"><span class="co">#&gt;   data_1_3_6 = sim_data(mean = 1, sd = 3, skew = 6),</span></a>
<a class="sourceLine" id="cb59-21" data-line-number="21"><span class="co">#&gt;   data_2_3_6 = sim_data(mean = 2, sd = 3, skew = 6),</span></a>
<a class="sourceLine" id="cb59-22" data-line-number="22"><span class="co">#&gt;   data_1_4_6 = sim_data(mean = 1, sd = 4, skew = 6),</span></a>
<a class="sourceLine" id="cb59-23" data-line-number="23"><span class="co">#&gt;   data_2_4_6 = sim_data(mean = 2, sd = 4, skew = 6),</span></a>
<a class="sourceLine" id="cb59-24" data-line-number="24"><span class="co">#&gt;   combined_1_3 = bind_rows(data_1_3_5, data_1_3_6, .id = &quot;id&quot;) %&gt;%</span></a>
<a class="sourceLine" id="cb59-25" data-line-number="25"><span class="co">#&gt;     arrange(sd) %&gt;%</span></a>
<a class="sourceLine" id="cb59-26" data-line-number="26"><span class="co">#&gt;     head(n = 400),</span></a>
<a class="sourceLine" id="cb59-27" data-line-number="27"><span class="co">#&gt;   combined_2_3 = bind_rows(data_2_3_5, data_2_3_6, .id = &quot;id&quot;) %&gt;%</span></a>
<a class="sourceLine" id="cb59-28" data-line-number="28"><span class="co">#&gt;     arrange(sd) %&gt;%</span></a>
<a class="sourceLine" id="cb59-29" data-line-number="29"><span class="co">#&gt;     head(n = 400),</span></a>
<a class="sourceLine" id="cb59-30" data-line-number="30"><span class="co">#&gt;   combined_1_4 = bind_rows(data_1_4_5, data_1_4_6, .id = &quot;id&quot;) %&gt;%</span></a>
<a class="sourceLine" id="cb59-31" data-line-number="31"><span class="co">#&gt;     arrange(sd) %&gt;%</span></a>
<a class="sourceLine" id="cb59-32" data-line-number="32"><span class="co">#&gt;     head(n = 400),</span></a>
<a class="sourceLine" id="cb59-33" data-line-number="33"><span class="co">#&gt;   combined_2_4 = bind_rows(data_2_4_5, data_2_4_6, .id = &quot;id&quot;) %&gt;%</span></a>
<a class="sourceLine" id="cb59-34" data-line-number="34"><span class="co">#&gt;     arrange(sd) %&gt;%</span></a>
<a class="sourceLine" id="cb59-35" data-line-number="35"><span class="co">#&gt;     head(n = 400)</span></a>
<a class="sourceLine" id="cb59-36" data-line-number="36"><span class="co">#&gt; )</span></a></code></pre></div>
<p>In your post-processing, you may need the values of <code>x</code> and <code>y</code> that underly <code>data_1_3</code> and <code>data_2_4</code>. Solution: get the trace and the target names. We define a new plan</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" data-line-number="1">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb60-2" data-line-number="2">  <span class="dt">data =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb60-3" data-line-number="3">    <span class="kw">sim_data</span>(<span class="dt">mean =</span> x, <span class="dt">sd =</span> y),</a>
<a class="sourceLine" id="cb60-4" data-line-number="4">    <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">4</span>))</a>
<a class="sourceLine" id="cb60-5" data-line-number="5">  ),</a>
<a class="sourceLine" id="cb60-6" data-line-number="6">  <span class="dt">larger =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb60-7" data-line-number="7">    <span class="kw">post_process</span>(data, <span class="dt">plan =</span> <span class="kw">ignore</span>(plan)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb60-8" data-line-number="8"><span class="st">      </span><span class="kw">arrange</span>(sd) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb60-9" data-line-number="9"><span class="st">      </span><span class="kw">head</span>(<span class="dt">n =</span> <span class="dv">400</span>),</a>
<a class="sourceLine" id="cb60-10" data-line-number="10">    <span class="dt">transform =</span> <span class="kw">combine</span>(data)</a>
<a class="sourceLine" id="cb60-11" data-line-number="11">  ),</a>
<a class="sourceLine" id="cb60-12" data-line-number="12">  <span class="dt">trace =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb60-13" data-line-number="13">)</a>
<a class="sourceLine" id="cb60-14" data-line-number="14"></a>
<a class="sourceLine" id="cb60-15" data-line-number="15"><span class="kw">drake_plan_source</span>(plan)</a>
<a class="sourceLine" id="cb60-16" data-line-number="16"><span class="co">#&gt; drake_plan(</span></a>
<a class="sourceLine" id="cb60-17" data-line-number="17"><span class="co">#&gt;   data_1_3 = target(</span></a>
<a class="sourceLine" id="cb60-18" data-line-number="18"><span class="co">#&gt;     command = sim_data(mean = 1, sd = 3),</span></a>
<a class="sourceLine" id="cb60-19" data-line-number="19"><span class="co">#&gt;     x = &quot;1&quot;,</span></a>
<a class="sourceLine" id="cb60-20" data-line-number="20"><span class="co">#&gt;     y = &quot;3&quot;,</span></a>
<a class="sourceLine" id="cb60-21" data-line-number="21"><span class="co">#&gt;     data = &quot;data_1_3&quot;</span></a>
<a class="sourceLine" id="cb60-22" data-line-number="22"><span class="co">#&gt;   ),</span></a>
<a class="sourceLine" id="cb60-23" data-line-number="23"><span class="co">#&gt;   data_2_4 = target(</span></a>
<a class="sourceLine" id="cb60-24" data-line-number="24"><span class="co">#&gt;     command = sim_data(mean = 2, sd = 4),</span></a>
<a class="sourceLine" id="cb60-25" data-line-number="25"><span class="co">#&gt;     x = &quot;2&quot;,</span></a>
<a class="sourceLine" id="cb60-26" data-line-number="26"><span class="co">#&gt;     y = &quot;4&quot;,</span></a>
<a class="sourceLine" id="cb60-27" data-line-number="27"><span class="co">#&gt;     data = &quot;data_2_4&quot;</span></a>
<a class="sourceLine" id="cb60-28" data-line-number="28"><span class="co">#&gt;   ),</span></a>
<a class="sourceLine" id="cb60-29" data-line-number="29"><span class="co">#&gt;   larger = target(</span></a>
<a class="sourceLine" id="cb60-30" data-line-number="30"><span class="co">#&gt;     command = post_process(data_1_3, data_2_4, plan = ignore(plan)) %&gt;%</span></a>
<a class="sourceLine" id="cb60-31" data-line-number="31"><span class="co">#&gt;       arrange(sd) %&gt;%</span></a>
<a class="sourceLine" id="cb60-32" data-line-number="32"><span class="co">#&gt;       head(n = 400),</span></a>
<a class="sourceLine" id="cb60-33" data-line-number="33"><span class="co">#&gt;     larger = &quot;larger&quot;</span></a>
<a class="sourceLine" id="cb60-34" data-line-number="34"><span class="co">#&gt;   )</span></a>
<a class="sourceLine" id="cb60-35" data-line-number="35"><span class="co">#&gt; )</span></a></code></pre></div>
<p>and a new function</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" data-line-number="1">post_process &lt;-<span class="st"> </span><span class="cf">function</span>(..., plan) {</a>
<a class="sourceLine" id="cb61-2" data-line-number="2">  args &lt;-<span class="st"> </span><span class="kw">list</span>(...)</a>
<a class="sourceLine" id="cb61-3" data-line-number="3">  <span class="kw">names</span>(args) &lt;-<span class="st"> </span><span class="kw">all.vars</span>(<span class="kw">substitute</span>(<span class="kw">list</span>(...)))</a>
<a class="sourceLine" id="cb61-4" data-line-number="4">  trace &lt;-<span class="st"> </span><span class="kw">filter</span>(plan, target <span class="op">%in%</span><span class="st"> </span><span class="kw">names</span>(args))</a>
<a class="sourceLine" id="cb61-5" data-line-number="5">  <span class="co"># Do post-processing with args and trace.</span></a>
<a class="sourceLine" id="cb61-6" data-line-number="6">}</a></code></pre></div>
</div>
</div>
<div id="grouping-variables" class="section level3">
<h3><span class="header-section-number">4.5.4</span> Grouping variables</h3>
<p>A grouping variable is an argument to <code>map()</code>, <code>cross()</code>, or <code>combine()</code> that identifies a sub-collection of target names. Grouping variables can be either literals or symbols. Symbols can be scalars or vectors, and you can pass them to transformations with or without argument names.</p>
<div id="literal-arguments" class="section level4">
<h4><span class="header-section-number">4.5.4.1</span> Literal arguments</h4>
<p>When you pass a grouping variable of literals, you must use an explicit argument name. One does not simply write <code>map(c(1, 2))</code>.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" data-line-number="1"><span class="kw">drake_plan</span>(<span class="dt">x =</span> <span class="kw">target</span>(<span class="kw">sqrt</span>(y), <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))))</a>
<a class="sourceLine" id="cb62-2" data-line-number="2"><span class="co">#&gt; # A tibble: 2 x 2</span></a>
<a class="sourceLine" id="cb62-3" data-line-number="3"><span class="co">#&gt;   target command</span></a>
<a class="sourceLine" id="cb62-4" data-line-number="4"><span class="co">#&gt;   &lt;chr&gt;  &lt;expr&gt; </span></a>
<a class="sourceLine" id="cb62-5" data-line-number="5"><span class="co">#&gt; 1 x_1    sqrt(1)</span></a>
<a class="sourceLine" id="cb62-6" data-line-number="6"><span class="co">#&gt; 2 x_2    sqrt(2)</span></a></code></pre></div>
<p>And if you supply integer sequences the usual way, you may notice some rows are missing.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" data-line-number="1"><span class="kw">drake_plan</span>(<span class="dt">x =</span> <span class="kw">target</span>(<span class="kw">sqrt</span>(y), <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">y =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)))</a>
<a class="sourceLine" id="cb63-2" data-line-number="2"><span class="co">#&gt; # A tibble: 2 x 2</span></a>
<a class="sourceLine" id="cb63-3" data-line-number="3"><span class="co">#&gt;   target command</span></a>
<a class="sourceLine" id="cb63-4" data-line-number="4"><span class="co">#&gt;   &lt;chr&gt;  &lt;expr&gt; </span></a>
<a class="sourceLine" id="cb63-5" data-line-number="5"><span class="co">#&gt; 1 x_1    sqrt(1)</span></a>
<a class="sourceLine" id="cb63-6" data-line-number="6"><span class="co">#&gt; 2 x_3    sqrt(3)</span></a></code></pre></div>
<p>Tidy evaluation and <code>as.numeric()</code> make sure all the data points show up.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" data-line-number="1">y_vals &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb64-2" data-line-number="2"><span class="kw">drake_plan</span>(<span class="dt">x =</span> <span class="kw">target</span>(<span class="kw">sqrt</span>(y), <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">y =</span> <span class="op">!!</span>y_vals)))</a>
<a class="sourceLine" id="cb64-3" data-line-number="3"><span class="co">#&gt; # A tibble: 3 x 2</span></a>
<a class="sourceLine" id="cb64-4" data-line-number="4"><span class="co">#&gt;   target command</span></a>
<a class="sourceLine" id="cb64-5" data-line-number="5"><span class="co">#&gt;   &lt;chr&gt;  &lt;expr&gt; </span></a>
<a class="sourceLine" id="cb64-6" data-line-number="6"><span class="co">#&gt; 1 x_1    sqrt(1)</span></a>
<a class="sourceLine" id="cb64-7" data-line-number="7"><span class="co">#&gt; 2 x_2    sqrt(2)</span></a>
<a class="sourceLine" id="cb64-8" data-line-number="8"><span class="co">#&gt; 3 x_3    sqrt(3)</span></a></code></pre></div>
<p>Character vectors usually work without a hitch, and quotes are converted into dots to make valid target names.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" data-line-number="1"><span class="kw">drake_plan</span>(<span class="dt">x =</span> <span class="kw">target</span>(<span class="kw">get_data</span>(y), <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">y =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>))))</a>
<a class="sourceLine" id="cb65-2" data-line-number="2"><span class="co">#&gt; # A tibble: 3 x 2</span></a>
<a class="sourceLine" id="cb65-3" data-line-number="3"><span class="co">#&gt;   target command      </span></a>
<a class="sourceLine" id="cb65-4" data-line-number="4"><span class="co">#&gt;   &lt;chr&gt;  &lt;expr&gt;       </span></a>
<a class="sourceLine" id="cb65-5" data-line-number="5"><span class="co">#&gt; 1 x_a    get_data(&quot;a&quot;)</span></a>
<a class="sourceLine" id="cb65-6" data-line-number="6"><span class="co">#&gt; 2 x_b    get_data(&quot;b&quot;)</span></a>
<a class="sourceLine" id="cb65-7" data-line-number="7"><span class="co">#&gt; 3 x_c    get_data(&quot;c&quot;)</span></a></code></pre></div>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" data-line-number="1">y_vals &lt;-<span class="st"> </span>letters</a>
<a class="sourceLine" id="cb66-2" data-line-number="2"><span class="kw">drake_plan</span>(<span class="dt">x =</span> <span class="kw">target</span>(<span class="kw">get_data</span>(y), <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">y =</span> <span class="op">!!</span>y_vals)))</a>
<a class="sourceLine" id="cb66-3" data-line-number="3"><span class="co">#&gt; # A tibble: 26 x 2</span></a>
<a class="sourceLine" id="cb66-4" data-line-number="4"><span class="co">#&gt;    target command      </span></a>
<a class="sourceLine" id="cb66-5" data-line-number="5"><span class="co">#&gt;    &lt;chr&gt;  &lt;expr&gt;       </span></a>
<a class="sourceLine" id="cb66-6" data-line-number="6"><span class="co">#&gt;  1 x_a    get_data(&quot;a&quot;)</span></a>
<a class="sourceLine" id="cb66-7" data-line-number="7"><span class="co">#&gt;  2 x_b    get_data(&quot;b&quot;)</span></a>
<a class="sourceLine" id="cb66-8" data-line-number="8"><span class="co">#&gt;  3 x_c    get_data(&quot;c&quot;)</span></a>
<a class="sourceLine" id="cb66-9" data-line-number="9"><span class="co">#&gt;  4 x_d    get_data(&quot;d&quot;)</span></a>
<a class="sourceLine" id="cb66-10" data-line-number="10"><span class="co">#&gt;  5 x_e    get_data(&quot;e&quot;)</span></a>
<a class="sourceLine" id="cb66-11" data-line-number="11"><span class="co">#&gt;  6 x_f    get_data(&quot;f&quot;)</span></a>
<a class="sourceLine" id="cb66-12" data-line-number="12"><span class="co">#&gt;  7 x_g    get_data(&quot;g&quot;)</span></a>
<a class="sourceLine" id="cb66-13" data-line-number="13"><span class="co">#&gt;  8 x_h    get_data(&quot;h&quot;)</span></a>
<a class="sourceLine" id="cb66-14" data-line-number="14"><span class="co">#&gt;  9 x_i    get_data(&quot;i&quot;)</span></a>
<a class="sourceLine" id="cb66-15" data-line-number="15"><span class="co">#&gt; 10 x_j    get_data(&quot;j&quot;)</span></a>
<a class="sourceLine" id="cb66-16" data-line-number="16"><span class="co">#&gt; # â¦ with 16 more rows</span></a></code></pre></div>
</div>
<div id="named-symbol-arguments" class="section level4">
<h4><span class="header-section-number">4.5.4.2</span> Named symbol arguments</h4>
<p>Symbols passed with explicit argument names define new groupings of existing targets on the fly, and only the <code>map()</code> and <code>cross()</code> transformations can accept them this ways. To generate long symbol lists, use the <code>syms()</code> function from the <code>rlang</code> package. Remember to use the tidy evaluation operator <code>!!</code> inside the transformation.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" data-line-number="1">vals &lt;-<span class="st"> </span>rlang<span class="op">::</span><span class="kw">syms</span>(letters)</a>
<a class="sourceLine" id="cb67-2" data-line-number="2"><span class="kw">drake_plan</span>(<span class="dt">x =</span> <span class="kw">target</span>(<span class="kw">get_data</span>(y), <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">y =</span> <span class="op">!!</span>vals)))</a>
<a class="sourceLine" id="cb67-3" data-line-number="3"><span class="co">#&gt; # A tibble: 26 x 2</span></a>
<a class="sourceLine" id="cb67-4" data-line-number="4"><span class="co">#&gt;    target command    </span></a>
<a class="sourceLine" id="cb67-5" data-line-number="5"><span class="co">#&gt;    &lt;chr&gt;  &lt;expr&gt;     </span></a>
<a class="sourceLine" id="cb67-6" data-line-number="6"><span class="co">#&gt;  1 x_a    get_data(a)</span></a>
<a class="sourceLine" id="cb67-7" data-line-number="7"><span class="co">#&gt;  2 x_b    get_data(b)</span></a>
<a class="sourceLine" id="cb67-8" data-line-number="8"><span class="co">#&gt;  3 x_c    get_data(c)</span></a>
<a class="sourceLine" id="cb67-9" data-line-number="9"><span class="co">#&gt;  4 x_d    get_data(d)</span></a>
<a class="sourceLine" id="cb67-10" data-line-number="10"><span class="co">#&gt;  5 x_e    get_data(e)</span></a>
<a class="sourceLine" id="cb67-11" data-line-number="11"><span class="co">#&gt;  6 x_f    get_data(f)</span></a>
<a class="sourceLine" id="cb67-12" data-line-number="12"><span class="co">#&gt;  7 x_g    get_data(g)</span></a>
<a class="sourceLine" id="cb67-13" data-line-number="13"><span class="co">#&gt;  8 x_h    get_data(h)</span></a>
<a class="sourceLine" id="cb67-14" data-line-number="14"><span class="co">#&gt;  9 x_i    get_data(i)</span></a>
<a class="sourceLine" id="cb67-15" data-line-number="15"><span class="co">#&gt; 10 x_j    get_data(j)</span></a>
<a class="sourceLine" id="cb67-16" data-line-number="16"><span class="co">#&gt; # â¦ with 16 more rows</span></a></code></pre></div>
<p>The new groupings carry over to downstream targets by default, which you can see with <code>trace = TRUE</code>. Below, the rows for targets <code>w_x</code> and <code>w_y</code> have entries in the and <code>z</code> column.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" data-line-number="1"><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb68-2" data-line-number="2">  <span class="dt">x =</span> <span class="kw">abs</span>(<span class="kw">mean</span>(<span class="kw">rnorm</span>(<span class="dv">10</span>))),</a>
<a class="sourceLine" id="cb68-3" data-line-number="3">  <span class="dt">y =</span> <span class="kw">abs</span>(<span class="kw">mean</span>(<span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dv">1</span>))),</a>
<a class="sourceLine" id="cb68-4" data-line-number="4">  <span class="dt">z =</span> <span class="kw">target</span>(<span class="kw">sqrt</span>(val), <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">val =</span> <span class="kw">c</span>(x, y))),</a>
<a class="sourceLine" id="cb68-5" data-line-number="5">  <span class="dt">w =</span> <span class="kw">target</span>(val <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">transform =</span> <span class="kw">map</span>(val)),</a>
<a class="sourceLine" id="cb68-6" data-line-number="6">  <span class="dt">trace =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb68-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb68-8" data-line-number="8"><span class="co">#&gt; # A tibble: 6 x 5</span></a>
<a class="sourceLine" id="cb68-9" data-line-number="9"><span class="co">#&gt;   target command                  val   z     w    </span></a>
<a class="sourceLine" id="cb68-10" data-line-number="10"><span class="co">#&gt;   &lt;chr&gt;  &lt;expr&gt;                   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;</span></a>
<a class="sourceLine" id="cb68-11" data-line-number="11"><span class="co">#&gt; 1 x      abs(mean(rnorm(10)))     &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb68-12" data-line-number="12"><span class="co">#&gt; 2 y      abs(mean(rnorm(100, 1))) &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb68-13" data-line-number="13"><span class="co">#&gt; 3 z_x    sqrt(x)                  x     z_x   &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb68-14" data-line-number="14"><span class="co">#&gt; 4 z_y    sqrt(y)                  y     z_y   &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb68-15" data-line-number="15"><span class="co">#&gt; 5 w_x    x + 1                    x     z_x   w_x  </span></a>
<a class="sourceLine" id="cb68-16" data-line-number="16"><span class="co">#&gt; 6 w_y    y + 1                    y     z_y   w_y</span></a></code></pre></div>
<p>However, this is <em>incorrect</em> because <code>w</code> does not depend on <code>z_x</code> or <code>z_y</code>. So for <code>w</code>, you should write <code>map(val = c(x, y))</code> instead of <code>map(val)</code> to tell <code>drake</code> to clear the trace. Then, you will see <code>NA</code>s in the <code>z</code> column for <code>w_x</code> and <code>w_y</code>, which is right and proper.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" data-line-number="1"><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb69-2" data-line-number="2">  <span class="dt">x =</span> <span class="kw">abs</span>(<span class="kw">mean</span>(<span class="kw">rnorm</span>(<span class="dv">10</span>))),</a>
<a class="sourceLine" id="cb69-3" data-line-number="3">  <span class="dt">y =</span> <span class="kw">abs</span>(<span class="kw">mean</span>(<span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dv">1</span>))),</a>
<a class="sourceLine" id="cb69-4" data-line-number="4">  <span class="dt">z =</span> <span class="kw">target</span>(<span class="kw">sqrt</span>(val), <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">val =</span> <span class="kw">c</span>(x, y))),</a>
<a class="sourceLine" id="cb69-5" data-line-number="5">  <span class="dt">w =</span> <span class="kw">target</span>(val <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">val =</span> <span class="kw">c</span>(x, y))),</a>
<a class="sourceLine" id="cb69-6" data-line-number="6">  <span class="dt">trace =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb69-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb69-8" data-line-number="8"><span class="co">#&gt; # A tibble: 6 x 5</span></a>
<a class="sourceLine" id="cb69-9" data-line-number="9"><span class="co">#&gt;   target command                  val   z     w    </span></a>
<a class="sourceLine" id="cb69-10" data-line-number="10"><span class="co">#&gt;   &lt;chr&gt;  &lt;expr&gt;                   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;</span></a>
<a class="sourceLine" id="cb69-11" data-line-number="11"><span class="co">#&gt; 1 x      abs(mean(rnorm(10)))     &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb69-12" data-line-number="12"><span class="co">#&gt; 2 y      abs(mean(rnorm(100, 1))) &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb69-13" data-line-number="13"><span class="co">#&gt; 3 z_x    sqrt(x)                  x     z_x   &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb69-14" data-line-number="14"><span class="co">#&gt; 4 z_y    sqrt(y)                  y     z_y   &lt;NA&gt; </span></a>
<a class="sourceLine" id="cb69-15" data-line-number="15"><span class="co">#&gt; 5 w_x    x + 1                    x     &lt;NA&gt;  w_x  </span></a>
<a class="sourceLine" id="cb69-16" data-line-number="16"><span class="co">#&gt; 6 w_y    y + 1                    y     &lt;NA&gt;  w_y</span></a></code></pre></div>
</div>
</div>
<div id="tags" class="section level3">
<h3><span class="header-section-number">4.5.5</span> Tags</h3>
<p>Tags are special optional grouping variables. They are ignored while the transformation is happening and then added to the plan to help subsequent transformations. There are two types of tags:</p>
<ol style="list-style-type: decimal">
<li>In-tags, which contain the target name you start with, and</li>
<li>Out-tags, which contain the target names generated by the transformations.</li>
</ol>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" data-line-number="1"><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb70-2" data-line-number="2">  <span class="dt">x =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb70-3" data-line-number="3">    command,</a>
<a class="sourceLine" id="cb70-4" data-line-number="4">    <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">.tag_in =</span> from, <span class="dt">.tag_out =</span> <span class="kw">c</span>(to, out))</a>
<a class="sourceLine" id="cb70-5" data-line-number="5">  ),</a>
<a class="sourceLine" id="cb70-6" data-line-number="6">  <span class="dt">trace =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb70-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb70-8" data-line-number="8"><span class="co">#&gt; # A tibble: 2 x 7</span></a>
<a class="sourceLine" id="cb70-9" data-line-number="9"><span class="co">#&gt;   target command y     x     from  to    out  </span></a>
<a class="sourceLine" id="cb70-10" data-line-number="10"><span class="co">#&gt;   &lt;chr&gt;  &lt;expr&gt;  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;</span></a>
<a class="sourceLine" id="cb70-11" data-line-number="11"><span class="co">#&gt; 1 x_1    command 1     x_1   x     x_1   x_1  </span></a>
<a class="sourceLine" id="cb70-12" data-line-number="12"><span class="co">#&gt; 2 x_2    command 2     x_2   x     x_2   x_2</span></a></code></pre></div>
<p>Subsequent transformations can use tags as grouping variables and add to existing tags.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb71-1" data-line-number="1">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb71-2" data-line-number="2">  <span class="dt">prep_work =</span> <span class="kw">do_prep_work</span>(),</a>
<a class="sourceLine" id="cb71-3" data-line-number="3">  <span class="dt">local =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb71-4" data-line-number="4">    <span class="kw">get_local_data</span>(n, prep_work),</a>
<a class="sourceLine" id="cb71-5" data-line-number="5">    <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">n =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">.tag_in =</span> data_source, <span class="dt">.tag_out =</span> data)</a>
<a class="sourceLine" id="cb71-6" data-line-number="6">  ),</a>
<a class="sourceLine" id="cb71-7" data-line-number="7">  <span class="dt">online =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb71-8" data-line-number="8">    <span class="kw">get_online_data</span>(n, prep_work, <span class="dt">port =</span> <span class="st">&quot;8080&quot;</span>),</a>
<a class="sourceLine" id="cb71-9" data-line-number="9">    <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">n =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">.tag_in =</span> data_source, <span class="dt">.tag_out =</span> data)</a>
<a class="sourceLine" id="cb71-10" data-line-number="10">  ),</a>
<a class="sourceLine" id="cb71-11" data-line-number="11">  <span class="dt">summary =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb71-12" data-line-number="12">    <span class="kw">summarize</span>(<span class="kw">bind_rows</span>(data, <span class="dt">.id =</span> <span class="st">&quot;data&quot;</span>)),</a>
<a class="sourceLine" id="cb71-13" data-line-number="13">    <span class="dt">transform =</span> <span class="kw">combine</span>(data, <span class="dt">.by =</span> data_source)</a>
<a class="sourceLine" id="cb71-14" data-line-number="14">  ),</a>
<a class="sourceLine" id="cb71-15" data-line-number="15">  <span class="dt">munged =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb71-16" data-line-number="16">    <span class="kw">munge</span>(<span class="kw">bind_rows</span>(data, <span class="dt">.id =</span> <span class="st">&quot;data&quot;</span>)),</a>
<a class="sourceLine" id="cb71-17" data-line-number="17">    <span class="dt">transform =</span> <span class="kw">combine</span>(data, <span class="dt">.by =</span> n)</a>
<a class="sourceLine" id="cb71-18" data-line-number="18">  )</a>
<a class="sourceLine" id="cb71-19" data-line-number="19">)</a>
<a class="sourceLine" id="cb71-20" data-line-number="20"></a>
<a class="sourceLine" id="cb71-21" data-line-number="21">plan</a>
<a class="sourceLine" id="cb71-22" data-line-number="22"><span class="co">#&gt; # A tibble: 9 x 2</span></a>
<a class="sourceLine" id="cb71-23" data-line-number="23"><span class="co">#&gt;   target         command                                               </span></a>
<a class="sourceLine" id="cb71-24" data-line-number="24"><span class="co">#&gt;   &lt;chr&gt;          &lt;expr&gt;                                                </span></a>
<a class="sourceLine" id="cb71-25" data-line-number="25"><span class="co">#&gt; 1 prep_work      do_prep_work()                                        </span></a>
<a class="sourceLine" id="cb71-26" data-line-number="26"><span class="co">#&gt; 2 local_1        get_local_data(1, prep_work)                          </span></a>
<a class="sourceLine" id="cb71-27" data-line-number="27"><span class="co">#&gt; 3 local_2        get_local_data(2, prep_work)                          </span></a>
<a class="sourceLine" id="cb71-28" data-line-number="28"><span class="co">#&gt; 4 online_1       get_online_data(1, prep_work, port = &quot;8080&quot;)          </span></a>
<a class="sourceLine" id="cb71-29" data-line-number="29"><span class="co">#&gt; 5 online_2       get_online_data(2, prep_work, port = &quot;8080&quot;)          </span></a>
<a class="sourceLine" id="cb71-30" data-line-number="30"><span class="co">#&gt; 6 summary_local  summarize(bind_rows(local_1, local_2, .id = &quot;data&quot;))  </span></a>
<a class="sourceLine" id="cb71-31" data-line-number="31"><span class="co">#&gt; 7 summary_online summarize(bind_rows(online_1, online_2, .id = &quot;data&quot;))</span></a>
<a class="sourceLine" id="cb71-32" data-line-number="32"><span class="co">#&gt; 8 munged_1       munge(bind_rows(local_1, online_1, .id = &quot;data&quot;))     </span></a>
<a class="sourceLine" id="cb71-33" data-line-number="33"><span class="co">#&gt; 9 munged_2       munge(bind_rows(local_2, online_2, .id = &quot;data&quot;))</span></a>
<a class="sourceLine" id="cb71-34" data-line-number="34"></a>
<a class="sourceLine" id="cb71-35" data-line-number="35">config &lt;-<span class="st"> </span><span class="kw">drake_config</span>(plan)</a>
<a class="sourceLine" id="cb71-36" data-line-number="36"><span class="kw">vis_drake_graph</span>(config)</a></code></pre></div>
<div id="htmlwidget-d6a708145d7725acdca8" style="width:576px;height:576px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-d6a708145d7725acdca8">{"x":{"nodes":{"id":["prep_work","local_1","local_2","online_1","online_2","summary_local","munged_1","summary_online","munged_2"],"imported":[false,false,false,false,false,false,false,false,false],"label":["prep_work","local_1","local_2","online_1","online_2","summary_local","munged_1","summary_online","munged_2"],"status":["outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated"],"type":["object","object","object","object","object","object","object","object","object"],"font.size":[20,20,20,20,20,20,20,20,20],"color":["#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000"],"shape":["dot","dot","dot","dot","dot","dot","dot","dot","dot"],"level":[1,2,2,2,2,3,3,3,3],"x":[-1,0,0,0,0,1,1,1,1],"y":[-2.22044604925031e-16,-1,-0.333333333333333,0.333333333333333,1,-1,-0.333333333333333,0.333333333333333,1]},"edges":{"from":["prep_work","prep_work","prep_work","prep_work","local_1","local_1","local_2","local_2","online_1","online_1","online_2","online_2"],"to":["local_1","local_2","online_1","online_2","summary_local","munged_1","summary_local","munged_2","summary_online","munged_1","summary_online","munged_2"],"arrows":["to","to","to","to","to","to","to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"interaction":{"navigationButtons":true},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)"},"main":{"text":"Dependency graph","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":false,"hoverNearest":false,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Outdated","Object"],"color":["#000000","#888888"],"shape":["dot","dot"],"font.color":["black","black"],"font.size":[20,20],"id":[2,7]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script>
<p><br></p>
</div>
<div id="target-names" class="section level3">
<h3><span class="header-section-number">4.5.6</span> Target names</h3>
<p>All transformations have an optional <code>.id</code> argument to control the names of targets. Use it to select the grouping variables that go into the names, as well as the order they appear in the suffixes.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" data-line-number="1"><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb72-2" data-line-number="2">  <span class="dt">data =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb72-3" data-line-number="3">    <span class="kw">get_data</span>(param1, param2),</a>
<a class="sourceLine" id="cb72-4" data-line-number="4">    <span class="dt">transform =</span> <span class="kw">map</span>(</a>
<a class="sourceLine" id="cb72-5" data-line-number="5">      <span class="dt">param1 =</span> <span class="kw">c</span>(<span class="dv">123</span>, <span class="dv">456</span>),</a>
<a class="sourceLine" id="cb72-6" data-line-number="6">      <span class="dt">param2 =</span> <span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">9</span>),</a>
<a class="sourceLine" id="cb72-7" data-line-number="7">      <span class="dt">param2 =</span> <span class="kw">c</span>(<span class="st">&quot;abc&quot;</span>, <span class="st">&quot;xyz&quot;</span>),</a>
<a class="sourceLine" id="cb72-8" data-line-number="8">      <span class="dt">.id =</span> param2</a>
<a class="sourceLine" id="cb72-9" data-line-number="9">    )</a>
<a class="sourceLine" id="cb72-10" data-line-number="10">  )</a>
<a class="sourceLine" id="cb72-11" data-line-number="11">)</a>
<a class="sourceLine" id="cb72-12" data-line-number="12"><span class="co">#&gt; # A tibble: 2 x 2</span></a>
<a class="sourceLine" id="cb72-13" data-line-number="13"><span class="co">#&gt;   target command         </span></a>
<a class="sourceLine" id="cb72-14" data-line-number="14"><span class="co">#&gt;   &lt;chr&gt;  &lt;expr&gt;          </span></a>
<a class="sourceLine" id="cb72-15" data-line-number="15"><span class="co">#&gt; 1 data_7 get_data(123, 7)</span></a>
<a class="sourceLine" id="cb72-16" data-line-number="16"><span class="co">#&gt; 2 data_9 get_data(456, 9)</span></a></code></pre></div>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" data-line-number="1"><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb73-2" data-line-number="2">  <span class="dt">data =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb73-3" data-line-number="3">    <span class="kw">get_data</span>(param1, param2),</a>
<a class="sourceLine" id="cb73-4" data-line-number="4">    <span class="dt">transform =</span> <span class="kw">map</span>(</a>
<a class="sourceLine" id="cb73-5" data-line-number="5">      <span class="dt">param1 =</span> <span class="kw">c</span>(<span class="dv">123</span>, <span class="dv">456</span>),</a>
<a class="sourceLine" id="cb73-6" data-line-number="6">      <span class="dt">param2 =</span> <span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">9</span>),</a>
<a class="sourceLine" id="cb73-7" data-line-number="7">      <span class="dt">param2 =</span> <span class="kw">c</span>(<span class="st">&quot;abc&quot;</span>, <span class="st">&quot;xyz&quot;</span>),</a>
<a class="sourceLine" id="cb73-8" data-line-number="8">      <span class="dt">.id =</span> <span class="kw">c</span>(param2, param1)</a>
<a class="sourceLine" id="cb73-9" data-line-number="9">    )</a>
<a class="sourceLine" id="cb73-10" data-line-number="10">  )</a>
<a class="sourceLine" id="cb73-11" data-line-number="11">)</a>
<a class="sourceLine" id="cb73-12" data-line-number="12"><span class="co">#&gt; # A tibble: 2 x 2</span></a>
<a class="sourceLine" id="cb73-13" data-line-number="13"><span class="co">#&gt;   target     command         </span></a>
<a class="sourceLine" id="cb73-14" data-line-number="14"><span class="co">#&gt;   &lt;chr&gt;      &lt;expr&gt;          </span></a>
<a class="sourceLine" id="cb73-15" data-line-number="15"><span class="co">#&gt; 1 data_7_123 get_data(123, 7)</span></a>
<a class="sourceLine" id="cb73-16" data-line-number="16"><span class="co">#&gt; 2 data_9_456 get_data(456, 9)</span></a></code></pre></div>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" data-line-number="1"><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb74-2" data-line-number="2">  <span class="dt">data =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb74-3" data-line-number="3">    <span class="kw">get_data</span>(param1, param2),</a>
<a class="sourceLine" id="cb74-4" data-line-number="4">    <span class="dt">transform =</span> <span class="kw">map</span>(</a>
<a class="sourceLine" id="cb74-5" data-line-number="5">      <span class="dt">param1 =</span> <span class="kw">c</span>(<span class="dv">123</span>, <span class="dv">456</span>),</a>
<a class="sourceLine" id="cb74-6" data-line-number="6">      <span class="dt">param2 =</span> <span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">9</span>),</a>
<a class="sourceLine" id="cb74-7" data-line-number="7">      <span class="dt">param2 =</span> <span class="kw">c</span>(<span class="st">&quot;abc&quot;</span>, <span class="st">&quot;xyz&quot;</span>),</a>
<a class="sourceLine" id="cb74-8" data-line-number="8">      <span class="dt">.id =</span> <span class="kw">c</span>(param1, param2)</a>
<a class="sourceLine" id="cb74-9" data-line-number="9">    )</a>
<a class="sourceLine" id="cb74-10" data-line-number="10">  )</a>
<a class="sourceLine" id="cb74-11" data-line-number="11">)</a>
<a class="sourceLine" id="cb74-12" data-line-number="12"><span class="co">#&gt; # A tibble: 2 x 2</span></a>
<a class="sourceLine" id="cb74-13" data-line-number="13"><span class="co">#&gt;   target     command         </span></a>
<a class="sourceLine" id="cb74-14" data-line-number="14"><span class="co">#&gt;   &lt;chr&gt;      &lt;expr&gt;          </span></a>
<a class="sourceLine" id="cb74-15" data-line-number="15"><span class="co">#&gt; 1 data_123_7 get_data(123, 7)</span></a>
<a class="sourceLine" id="cb74-16" data-line-number="16"><span class="co">#&gt; 2 data_456_9 get_data(456, 9)</span></a></code></pre></div>
<p>Set <code>.id</code> to <code>FALSE</code> to ignore the grouping variables altogether.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" data-line-number="1"><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb75-2" data-line-number="2">  <span class="dt">data =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb75-3" data-line-number="3">    <span class="kw">get_data</span>(param1, param2),</a>
<a class="sourceLine" id="cb75-4" data-line-number="4">    <span class="dt">transform =</span> <span class="kw">map</span>(</a>
<a class="sourceLine" id="cb75-5" data-line-number="5">      <span class="dt">param1 =</span> <span class="kw">c</span>(<span class="dv">123</span>, <span class="dv">456</span>),</a>
<a class="sourceLine" id="cb75-6" data-line-number="6">      <span class="dt">param2 =</span> <span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">9</span>),</a>
<a class="sourceLine" id="cb75-7" data-line-number="7">      <span class="dt">param2 =</span> <span class="kw">c</span>(<span class="st">&quot;abc&quot;</span>, <span class="st">&quot;xyz&quot;</span>),</a>
<a class="sourceLine" id="cb75-8" data-line-number="8">      <span class="dt">.id =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb75-9" data-line-number="9">    )</a>
<a class="sourceLine" id="cb75-10" data-line-number="10">  )</a>
<a class="sourceLine" id="cb75-11" data-line-number="11">)</a>
<a class="sourceLine" id="cb75-12" data-line-number="12"><span class="co">#&gt; # A tibble: 2 x 2</span></a>
<a class="sourceLine" id="cb75-13" data-line-number="13"><span class="co">#&gt;   target command         </span></a>
<a class="sourceLine" id="cb75-14" data-line-number="14"><span class="co">#&gt;   &lt;chr&gt;  &lt;expr&gt;          </span></a>
<a class="sourceLine" id="cb75-15" data-line-number="15"><span class="co">#&gt; 1 data   get_data(123, 7)</span></a>
<a class="sourceLine" id="cb75-16" data-line-number="16"><span class="co">#&gt; 2 data_2 get_data(456, 9)</span></a></code></pre></div>
<p>Finally, <code>drake</code> supports a special <code>.id_chr</code> symbol in commands to let you refer to the name of the current target as a character string.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" data-line-number="1">as_chr &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb76-2" data-line-number="2">  <span class="kw">deparse</span>(<span class="kw">substitute</span>(x))</a>
<a class="sourceLine" id="cb76-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb76-4" data-line-number="4">plan &lt;-<span class="st"> </span><span class="kw">drake_plan</span>(</a>
<a class="sourceLine" id="cb76-5" data-line-number="5">  <span class="dt">data =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb76-6" data-line-number="6">    <span class="kw">get_data</span>(param),</a>
<a class="sourceLine" id="cb76-7" data-line-number="7">    <span class="dt">transform =</span> <span class="kw">map</span>(<span class="dt">param =</span> <span class="kw">c</span>(<span class="dv">123</span>, <span class="dv">456</span>))</a>
<a class="sourceLine" id="cb76-8" data-line-number="8">  ),</a>
<a class="sourceLine" id="cb76-9" data-line-number="9">  <span class="dt">keras_model =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb76-10" data-line-number="10">    <span class="kw">save_model_hdf5</span>(<span class="kw">fit_model</span>(data), <span class="kw">file_out</span>(<span class="op">!!</span><span class="kw">sprintf</span>(<span class="st">&quot;%s.h5&quot;</span>, .id_chr))),</a>
<a class="sourceLine" id="cb76-11" data-line-number="11">    <span class="dt">transform =</span> <span class="kw">map</span>(data, <span class="dt">.id =</span> param)</a>
<a class="sourceLine" id="cb76-12" data-line-number="12">  ),</a>
<a class="sourceLine" id="cb76-13" data-line-number="13">  <span class="dt">result =</span> <span class="kw">target</span>(</a>
<a class="sourceLine" id="cb76-14" data-line-number="14">    <span class="kw">predict</span>(<span class="kw">load_model_hdf5</span>(<span class="kw">file_in</span>(<span class="op">!!</span><span class="kw">sprintf</span>(<span class="st">&quot;%s.h5&quot;</span>, <span class="kw">as_chr</span>(keras_model))))),</a>
<a class="sourceLine" id="cb76-15" data-line-number="15">    <span class="dt">transform =</span> <span class="kw">map</span>(keras_model, <span class="dt">.id =</span> param)</a>
<a class="sourceLine" id="cb76-16" data-line-number="16">  )</a>
<a class="sourceLine" id="cb76-17" data-line-number="17">)</a>
<a class="sourceLine" id="cb76-18" data-line-number="18"></a>
<a class="sourceLine" id="cb76-19" data-line-number="19">plan</a>
<a class="sourceLine" id="cb76-20" data-line-number="20"><span class="co">#&gt; # A tibble: 6 x 2</span></a>
<a class="sourceLine" id="cb76-21" data-line-number="21"><span class="co">#&gt;   target         command                                                   </span></a>
<a class="sourceLine" id="cb76-22" data-line-number="22"><span class="co">#&gt;   &lt;chr&gt;          &lt;expr&gt;                                                    </span></a>
<a class="sourceLine" id="cb76-23" data-line-number="23"><span class="co">#&gt; 1 data_123       get_data(123)                                            â¦</span></a>
<a class="sourceLine" id="cb76-24" data-line-number="24"><span class="co">#&gt; 2 data_456       get_data(456)                                            â¦</span></a>
<a class="sourceLine" id="cb76-25" data-line-number="25"><span class="co">#&gt; 3 keras_model_1â¦ save_model_hdf5(fit_model(data_123), file_out(&quot;keras_modeâ¦</span></a>
<a class="sourceLine" id="cb76-26" data-line-number="26"><span class="co">#&gt; 4 keras_model_4â¦ save_model_hdf5(fit_model(data_456), file_out(&quot;keras_modeâ¦</span></a>
<a class="sourceLine" id="cb76-27" data-line-number="27"><span class="co">#&gt; 5 result_123     predict(load_model_hdf5(file_in(&quot;keras_model_123.h5&quot;)))  â¦</span></a>
<a class="sourceLine" id="cb76-28" data-line-number="28"><span class="co">#&gt; 6 result_456     predict(load_model_hdf5(file_in(&quot;keras_model_456.h5&quot;)))  â¦</span></a></code></pre></div>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" data-line-number="1"><span class="kw">drake_plan_source</span>(plan)</a>
<a class="sourceLine" id="cb77-2" data-line-number="2"><span class="co">#&gt; drake_plan(</span></a>
<a class="sourceLine" id="cb77-3" data-line-number="3"><span class="co">#&gt;   data_123 = get_data(123),</span></a>
<a class="sourceLine" id="cb77-4" data-line-number="4"><span class="co">#&gt;   data_456 = get_data(456),</span></a>
<a class="sourceLine" id="cb77-5" data-line-number="5"><span class="co">#&gt;   keras_model_123 = save_model_hdf5(fit_model(data_123), file_out(&quot;keras_model_123.h5&quot;)),</span></a>
<a class="sourceLine" id="cb77-6" data-line-number="6"><span class="co">#&gt;   keras_model_456 = save_model_hdf5(fit_model(data_456), file_out(&quot;keras_model_456.h5&quot;)),</span></a>
<a class="sourceLine" id="cb77-7" data-line-number="7"><span class="co">#&gt;   result_123 = predict(load_model_hdf5(file_in(&quot;keras_model_123.h5&quot;))),</span></a>
<a class="sourceLine" id="cb77-8" data-line-number="8"><span class="co">#&gt;   result_456 = predict(load_model_hdf5(file_in(&quot;keras_model_456.h5&quot;)))</span></a>
<a class="sourceLine" id="cb77-9" data-line-number="9"><span class="co">#&gt; )</span></a></code></pre></div>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>Only supported in <code>drake</code> version 7.5.0 and above.<a href="plans.html#fnref1" class="footnote-back">â©</a></p></li>
<li id="fn2"><p>Only supported in <code>drake</code> version 7.4.0 and above.<a href="plans.html#fnref2" class="footnote-back">â©</a></p></li>
</ol>
</div>
<div style = "background: #1C356D; color: white; padding: 10px 10px 10px 25px; font-size: 1em; width: 100%;">
  Copyright Eli Lilly and Company
</div>
            </section>

          </div>
        </div>
      </div>
<a href="walkthrough.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="projects.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ropenscilabs/drake-manual/edit/master/plans.Rmd",
"text": "Edit this chapter"
},
"history": {
"link": "https://github.com/ropenscilabs/drake-manual/commits/master/plans.Rmd",
"text": "Chapter edit history"
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
